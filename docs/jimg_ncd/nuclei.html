<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>jimg_ncd.nuclei API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>
    /* --- Custom Style --- */
    pre {
    line-height: 130%;
    background: #1e1e1e; /* ciemne tło jak w VS Code */
    color: #e0e0e0;
    padding: 1em;
    border-radius: 10px;
    overflow-x: auto;
    }

    span.linenos {
    color: #888;
    background-color: transparent;
    padding-left: 5px;
    padding-right: 20px;
    }

    .pdoc-code .hll {
    background-color: rgba(255, 153, 51, 0.2);
    }

    .pdoc-code {
    background: #1e1e1e;
    color: #e0e0e0;
    }

    /* --- Comments (szaro-zielone) --- */
    .pdoc-code .c,
    .pdoc-code .cm,
    .pdoc-code .ch,
    .pdoc-code .cpf,
    .pdoc-code .c1,
    .pdoc-code .cs {
    color: #6a9955;
    font-style: italic;
    }

    /* --- Keywords (zielone / limonkowe) --- */
    .pdoc-code .k,
    .pdoc-code .kd,
    .pdoc-code .kn,
    .pdoc-code .kr,
    .pdoc-code .kc,
    .pdoc-code .nt {
    color: #4ec9b0;
    font-weight: bold;
    }

    /* --- Strings (czerwono-pomarańczowe) --- */
    .pdoc-code .s,
    .pdoc-code .s1,
    .pdoc-code .s2,
    .pdoc-code .sa,
    .pdoc-code .sb,
    .pdoc-code .sd,
    .pdoc-code .sh,
    .pdoc-code .sr {
    color: #f78c6c;
    }

    /* --- Numbers (szare) --- */
    .pdoc-code .m,
    .pdoc-code .mi,
    .pdoc-code .mf,
    .pdoc-code .mh,
    .pdoc-code .il {
    color: #c0c0c0;
    }

    /* --- Functions (fioletowe) --- */
    .pdoc-code .nf,
    .pdoc-code .fm {
    color: #c586c0;
    font-weight: bold;
    }

    /* --- Classes / Types (niebiesko-fioletowe) --- */
    .pdoc-code .nc,
    .pdoc-code .nn,
    .pdoc-code .kt {
    color: #9cdcfe;
    font-weight: bold;
    }

    /* --- Constants / Variables (zielono-niebieskie) --- */
    .pdoc-code .nv,
    .pdoc-code .vc,
    .pdoc-code .vg,
    .pdoc-code .vi {
    color: #4ec9b0;
    }

    /* --- Operators (jasnoszare) --- */
    .pdoc-code .o,
    .pdoc-code .ow {
    color: #d4d4d4;
    }

    /* --- Decorators / Special (pomarańczowo-fioletowe) --- */
    .pdoc-code .nd,
    .pdoc-code .ne,
    .pdoc-code .gu,
    .pdoc-code .gt {
    color: #d16969;
    font-weight: bold;
    }

    /* --- Errors / Diff --- */
    .pdoc-code .err {
    border: 1px solid #ff5555;
    background: rgba(255, 85, 85, 0.1);
    }

    /* --- Misc --- */
    .pdoc-code .w { color: #777; }
    .pdoc-code .go { color: #999; }
    .pdoc-code .gp { color: #ffcc00; font-weight: bold; }
    </style>
    <style>/* custom style *//*! theme.css */:root{--pdoc-background:#585656;}.pdoc{
        --text:#ffffff;
        --muted:#ffffff;
        --link:#c51616;
        --link-hover:#c51616;
        --code:#302d2d;
        --active:#302d2d;
        --accent:#302d2d;
        --accent2:#c1c1c1;
        --nav-hover:rgba(255, 255, 255, 0.5);
        --name:#cf7b0c;
        --def:#ff0000;
        --annotation:#9f00be;}
    </style>

    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../jimg_ncd.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;jimg_ncd</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#RepTools">RepTools</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#RepTools.extract_dict_by_indices">extract_dict_by_indices</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.drop_outlires">drop_outlires</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.nn">nn</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.compute_axes_length">compute_axes_length</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.compute_eccentricity">compute_eccentricity</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.compute_feret_diameter">compute_feret_diameter</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.compute_perimeter">compute_perimeter</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.compute_circularity">compute_circularity</a>
                        </li>
                        <li>
                                <a class="function" href="#RepTools.repairing_nuclei">repairing_nuclei</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ImagesManagement">ImagesManagement</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ImagesManagement.__init__">ImagesManagement</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImagesManagement.images_ids">images_ids</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImagesManagement.results_images">results_images</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImagesManagement.experiment_name">experiment_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#ImagesManagement.prepared_images">prepared_images</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.load_from_dict">load_from_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.load_experimental_images">load_experimental_images</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.load_images_ids">load_images_ids</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.get_included_acronyms">get_included_acronyms</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.get_prepared_images">get_prepared_images</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.save_prepared_images">save_prepared_images</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.adjust_images">adjust_images</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.image_merging">image_merging</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.image_stitching">image_stitching</a>
                        </li>
                        <li>
                                <a class="function" href="#ImagesManagement.save_raw">save_raw</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NucleiFinder">NucleiFinder</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NucleiFinder.__init__">NucleiFinder</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.image">image</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.test_results">test_results</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.hyperparameter_nuclei">hyperparameter_nuclei</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.hyperparameter_chromatinization">hyperparameter_chromatinization</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.img_adj_par_chrom">img_adj_par_chrom</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.img_adj_par">img_adj_par</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.show_plots">show_plots</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.nuclei_results">nuclei_results</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.images">images</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.series_im">series_im</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nms">set_nms</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_prob">set_prob</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nuclei_circularity">set_nuclei_circularity</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nuclei_local_intenisty_FC">set_nuclei_local_intenisty_FC</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nuclei_global_area_FC">set_nuclei_global_area_FC</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nuclei_size">set_nuclei_size</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_nuclei_min_mean_intensity">set_nuclei_min_mean_intensity</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_chromatinization_size">set_chromatinization_size</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_chromatinization_ratio">set_chromatinization_ratio</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_chromatinization_cut_point">set_chromatinization_cut_point</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_image_gamma">set_adj_image_gamma</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_image_contrast">set_adj_image_contrast</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_image_brightness">set_adj_image_brightness</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_chrom_gamma">set_adj_chrom_gamma</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_chrom_contrast">set_adj_chrom_contrast</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.set_adj_chrom_brightness">set_adj_chrom_brightness</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.current_parameters_nuclei">current_parameters_nuclei</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.current_parameters_chromatinization">current_parameters_chromatinization</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.current_parameters_img_adj">current_parameters_img_adj</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiFinder.current_parameters_img_adj_chro">current_parameters_img_adj_chro</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.get_results_nuclei">get_results_nuclei</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.get_results_nuclei_selected">get_results_nuclei_selected</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.get_results_nuclei_chromatinization">get_results_nuclei_chromatinization</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.add_test">add_test</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.input_image">input_image</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.get_features">get_features</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.nuclei_finder_test">nuclei_finder_test</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.find_nuclei">find_nuclei</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.select_nuclei">select_nuclei</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.nuclei_chromatinization">nuclei_chromatinization</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.browser_test">browser_test</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.series_analysis_chromatinization">series_analysis_chromatinization</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiFinder.series_analysis_nuclei">series_analysis_nuclei</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#NucleiDataManagement">NucleiDataManagement</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#NucleiDataManagement.__init__">NucleiDataManagement</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiDataManagement.experiment_name">experiment_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiDataManagement.nuceli_data_df">nuceli_data_df</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiDataManagement.nuclei_IS_data">nuclei_IS_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#NucleiDataManagement.concat_data">concat_data</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.load_nuc_dict">load_nuc_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.add_IS_data">add_IS_data</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.get_data_with_IS">get_data_with_IS</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.get_data">get_data</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.save_nuc_project">save_nuc_project</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.save_results_df">save_results_df</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.save_results_df_with_IS">save_results_df_with_IS</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.add_experiment">add_experiment</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.get_mutual_experiments_data">get_mutual_experiments_data</a>
                        </li>
                        <li>
                                <a class="function" href="#NucleiDataManagement.save_mutual_experiments">save_mutual_experiments</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#GroupAnalysis">GroupAnalysis</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#GroupAnalysis.__init__">GroupAnalysis</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.input_data">input_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.input_metadata">input_metadata</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.tmp_metadata">tmp_metadata</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.tmp_data">tmp_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.scaled_data">scaled_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.PCA_results">PCA_results</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.var_data">var_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.knee_plot">knee_plot</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.UMAP_data">UMAP_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.UMAP_plot">UMAP_plot</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.dblabels">dblabels</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.explained_variance_ratio">explained_variance_ratio</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.DFA_results">DFA_results</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.proportion_stats">proportion_stats</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.proportion_plot">proportion_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.resest_project">resest_project</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.load_data">load_data</a>
                        </li>
                        <li>
                                <a class="variable" href="#GroupAnalysis.groups">groups</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_DFA">get_DFA</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_PCA">get_PCA</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_knee_plot">get_knee_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_var_data">get_var_data</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_scaled_data">get_scaled_data</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_UMAP_data">get_UMAP_data</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_UMAP_plots">get_UMAP_plots</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.select_data">select_data</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.data_scale">data_scale</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.PCA">PCA</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.var_plot">var_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.UMAP">UMAP</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.db_scan">db_scan</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.UMAP_on_clusters">UMAP_on_clusters</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.full_info">full_info</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.DFA">DFA</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.heatmap_DFA">heatmap_DFA</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_DFA_plot">get_DFA_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.print_avaiable_features">print_avaiable_features</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.proportion_analysis">proportion_analysis</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_proportion_plot">get_proportion_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#GroupAnalysis.get_proportion_stats">get_proportion_stats</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../jimg_ncd.html">jimg_ncd</a><wbr>.nuclei    </h1>

                
                        <input id="mod-nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-nuclei-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">base64</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">webbrowser</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">BytesIO</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">harmonypy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">harmonize</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.io</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pio</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">plotly.offline</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pyo</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.cluster</span><span class="w"> </span><span class="kn">import</span> <span class="n">DBSCAN</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">skimage</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">umap</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">csbdeep.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">normalize</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">measure</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.decomposition</span><span class="w"> </span><span class="kn">import</span> <span class="n">PCA</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.preprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.cluster.hierarchy</span><span class="w"> </span><span class="kn">import</span> <span class="n">leaves_list</span><span class="p">,</span> <span class="n">linkage</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">stardist.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">StarDist2D</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">stardist.plot</span><span class="w"> </span><span class="kn">import</span> <span class="n">render_label</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="n">pio</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="s2">&quot;browser&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">jimg_ncd.config</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfg</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="c1"># new features (nuclei adjustment and repair images)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RepTools</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    A utility class for processing and repairing nuclei data.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">    Provides methods for extracting subsets, removing outliers, computing geometrical features,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    and merging/splitting nuclei based on spatial and intensity criteria.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_dict_by_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">        Extracts elements from all dictionary lists using provided indices.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a><span class="sd">        Parameters</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="sd">        ----------</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="sd">        d : dict</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">            Dictionary with list values.</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="sd">        indices : list</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">            List of indices to extract from each dictionary entry.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        Returns</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">        -------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        dict</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">            Dictionary containing only the selected elements.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="p">}</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">drop_outlires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">circ</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a><span class="sd">        Identify indices of nuclei that are considered outliers based on circularity and intensity.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">        Parameters</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        ----------</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a><span class="sd">        row : dict</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">            Dictionary containing nuclei properties, including &#39;circularity&#39; and &#39;intensity_mean&#39;.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="sd">        diff_FC_intensity : float</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a><span class="sd">            Fraction of mean intensity below which a nucleus is considered an outlier.</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="sd">        circ : float</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a><span class="sd">            Minimum circularity threshold for nuclei to be considered.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="sd">        Returns</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">        -------</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        list</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a><span class="sd">            List of indices to drop as outliers.</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="n">cd</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]):</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">circ</span><span class="p">:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>                <span class="n">cd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="n">drop</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="n">is_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]):</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="n">FC_mean</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">is_mean</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="k">if</span> <span class="n">FC_mean</span> <span class="o">&lt;</span> <span class="n">diff_FC_intensity</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>                <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="k">return</span> <span class="n">drop</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">        Compute close neighbors between nuclei coordinates using a threshold distance.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        Parameters</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        ----------</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        coords : list</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">            List of numpy arrays, each containing coordinates for a nucleus.</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        Returns</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        -------</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        dict</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">            Dictionary mapping pairs of nuclei indices to the number of close neighbors.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>        <span class="n">full_list</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>                    <span class="n">tree1</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>                    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>                    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>                    <span class="n">close_neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>                    <span class="n">full_list</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_neighbors</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="k">return</span> <span class="n">full_list</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_axes_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">        Compute major and minor axis lengths of a nucleus from its contour.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">        Parameters</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">        ----------</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">        Returns</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a><span class="sd">        -------</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">        tuple</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">            Major and minor axis lengths.</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="n">axis_major_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="n">axis_minor_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="k">return</span> <span class="n">axis_major_length</span><span class="p">,</span> <span class="n">axis_minor_length</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_eccentricity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">        Compute eccentricity of a nucleus from its contour.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        Parameters</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        ----------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        Returns</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        -------</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        float</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">            Eccentricity of the nucleus.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="n">eccentricity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="k">return</span> <span class="n">eccentricity</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_feret_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">        Compute the Feret diameter of a given contour.</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">        The Feret diameter is defined as the maximum pairwise Euclidean distance between points in the contour.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">        Parameters</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        ----------</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">        Returns</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">        -------</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">        float</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">            The maximum distance between any two points in the contour.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>        <span class="n">rect</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Compute the perimeter of a contour.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">        The perimeter is calculated as the sum of Euclidean distances between consecutive points in the contour.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">        Parameters</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">        ----------</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        Returns</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        -------</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        float</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">            Perimeter length of the contour.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        Compute the circularity of a contour.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        Circularity is a measure of how close the shape is to a perfect circle.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        It is calculated as 4 * pi * (area / perimeter^2).</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        Parameters</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        ----------</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        Returns</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">        -------</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        float</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">            Circularity of the contour. Value ranges from 0 to 1, where 1 indicates a perfect circle.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="n">perimeter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_perimeter</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">hull</span><span class="o">.</span><span class="n">volume</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repairing_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="sd">        Repair nuclei segmentation results by merging or removing outlier nuclei.</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a><span class="sd">        This method adjusts nuclei detection results based on global and local thresholds, circularity, nearest neighbor relationships,</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="sd">        and merges small or fragmented nuclei when appropriate. It also recalculates key morphological properties for merged nuclei.</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        Parameters</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="sd">        ----------</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a><span class="sd">        results : dict</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="sd">            Dictionary where keys are image identifiers and values are dictionaries containing detected nuclei properties</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="sd">            (e.g., &#39;area&#39;, &#39;coords&#39;, &#39;label&#39;, &#39;circularity&#39;, etc.).</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="sd">        Returns</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        -------</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="sd">        dict</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">            A dictionary in the same structure as `results`, but with repaired nuclei information after merging or removing outliers.</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>        <span class="c1"># repairing nuclei</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>        <span class="n">mean_sum_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="n">mean_sum_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="n">im</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>        <span class="n">mean_sum_area_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_sum_area</span><span class="p">)</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image repairing:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="p">)):</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>                <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>                <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">mean_sum_area_sum</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>                <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>            <span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>                <span class="c1"># adjustment to global changes</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>                <span class="n">temporary_dict</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>                <span class="n">check_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_outlires</span><span class="p">(</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                    <span class="n">temporary_dict</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>                    <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>                        <span class="s2">&quot;FC_diff_local_intensity&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>                    <span class="p">],</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                    <span class="n">circ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">],</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                <span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>                <span class="n">to_final</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>                    <span class="n">x</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_drop</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                <span class="p">]</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">,</span> <span class="n">to_final</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="n">to_concat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                    <span class="n">results_nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>                    <span class="k">for</span> <span class="n">kn</span> <span class="ow">in</span> <span class="n">results_nn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>                        <span class="k">if</span> <span class="n">results_nn</span><span class="p">[</span><span class="n">kn</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nn_min&quot;</span><span class="p">]:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; --&gt; .*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.* --&gt; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                    <span class="n">to_concat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                    <span class="n">to_rest</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>                        <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_concat</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                    <span class="p">]</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                <span class="c1">#</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_concat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                    <span class="n">to_concat_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_concat</span><span class="p">)</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])]</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])]</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])]</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">])]</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">])</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                    <span class="p">]</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">])</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                    <span class="p">]</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">])</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                    <span class="p">]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                    <span class="p">]</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">])</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                    <span class="p">]</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                    <span class="n">major</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_axes_length</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">major</span><span class="p">]</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span><span class="p">]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span> <span class="o">/</span> <span class="n">major</span><span class="p">]</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                    <span class="n">ecc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eccentricity</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecc</span><span class="p">]</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">])</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                    <span class="p">]</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                    <span class="n">feret_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_feret_diameter</span><span class="p">(</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                        <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                    <span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">feret_diameter</span><span class="p">]</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">])]</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">])]</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">])</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                    <span class="p">]</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">])</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                    <span class="p">]</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                    <span class="n">to_rest_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_rest</span><span class="p">)</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                    <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="n">to_rest_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                        <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">+</span> <span class="n">to_concat_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                <span class="n">m</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                <span class="ow">and</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>            <span class="p">):</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ImagesManagement</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">    A class for managing, preprocessing, merging, stitching, saving, and loading</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">    microscopy or flow cytometry images used in NucleiFinder-based analyses.</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="sd">    This class provides a unified interface for:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">    - loading image data,</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">    - selecting images by IDs,</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">    - preprocessing images (equalization, CLAHE, gamma/contrast/brightness adjustment),</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">    - merging images with user-defined intensity ratios,</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">    - stitching images horizontally,</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">    - retrieving and saving processed image sets.</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">    The class stores original or loaded data in the ``results_images`` attribute,</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">    and all processed images in ``prepared_images`` under user-defined acronyms.</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">    These acronyms allow flexible retrieval with ``get_prepared_images()``</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">    and exporting via ``save_prepared_images()``.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a><span class="sd">    Parameters</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a><span class="sd">    ----------</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a><span class="sd">    images_ids : list[int]</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a><span class="sd">        List of selected image identifiers.</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="sd">    result_dict : dict or None</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a><span class="sd">        Dictionary containing raw or preprocessed images.</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="sd">        If ``None``, images may later be loaded or processed from file.</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">    experiment_name : str</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        Name of the experiment. Used for saving and structuring output.</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">    Attributes</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">    ----------</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">    images_ids : list[int]</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="sd">        IDs of images managed by the class.</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">    results_images : dict or None</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        Dictionary containing raw or analysis-derived images.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">    experiment_name : str</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        Name of the experiment. Used in saved filenames.</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">    prepared_images : dict</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        Container for processed/adjusted/merged/stitched images,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">        indexed by user-defined acronyms.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">    Notes</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">    -----</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">    Processed images are stored only in memory until saved explicitly with</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">    ``save_prepared_images()``.</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">    Raw images loaded from NucleiFinder analyses can be saved for later reuse</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">    in a serialized `.inuc` format using ``save_raw()``.</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="sd">    Examples</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">    --------</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">    Load image results from an analysis:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">    &gt;&gt;&gt; manager = ImagesManagement.load_experimental_images(results, &quot;experiment1&quot;)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a><span class="sd">    Adjust selected images:</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a><span class="sd">    &gt;&gt;&gt; manager.adjust_images(</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="sd">    ...     acronyme=&quot;adj&quot;,</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="sd">    ...     path_to_images=&quot;path/to/imgs&quot;,</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="sd">    ...     eq=True,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">    ...     clahe=True</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a><span class="sd">    ... )</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">    Merge multiple prepared sets:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">    &gt;&gt;&gt; manager.image_merging([&quot;adj&quot;, &quot;other&quot;], ratio_list=[0.7, 0.3])</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">    Retrieve processed images:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">    &gt;&gt;&gt; imgs = manager.get_prepared_images(&quot;adj&quot;)</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">    Save stitched images to disk:</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">    &gt;&gt;&gt; manager.save_prepared_images(&quot;stitched_adj_other&quot;, &quot;./output/&quot;)</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        Initialize the ImagesManagement object.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="sd">        Parameters</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        ----------</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">            List of image identifiers.</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        result_dict : dict or None</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">            Dictionary containing processed images.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span> <span class="o">=</span> <span class="n">images_ids</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the list of image IDs managed by this instance.&quot;&quot;&quot;</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span> <span class="o">=</span> <span class="n">result_dict</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores dictionary containing processed images.&quot;&quot;&quot;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the experiment name for file naming and organizational purposes.&quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary for storing processed images (adjusted, merged, stitched),</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">        indexed by user-defined acronyms for flexible retrieval.&quot;&quot;&quot;</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        Load an ImagesManagement instance from a `.inuc` serialized dictionary.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        Parameters</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        ----------</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        path : str</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">            Path to the `.inuc` file exported with `save_raw()`.</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="sd">        Returns</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a><span class="sd">        -------</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a><span class="sd">        ImagesManagement</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="sd">            A reconstructed ImagesManagement object.</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="k">if</span> <span class="s2">&quot;.inuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">loaded_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loaded_data</span><span class="p">}</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .inuc extension!&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>            <span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_experimental_images</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        Load results exported from NucleiFinder series analysis.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        Initialize the object with results from series_analysis_nuclei()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">        or series_analysis_chromatinization() of the NucleiFinder class.</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        Parameters</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        ----------</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        results_dict : dict</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">            Dictionary returned by `series_analysis_nuclei()` or</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">            `series_analysis_chromatinization()`.</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a><span class="sd">        Returns</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="sd">        -------</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a><span class="sd">        ImagesManagement</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>        <span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                <span class="s2">&quot;Incorrect data provided. The data must come from series_analysis_nuclei() &quot;</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                <span class="s2">&quot;or series_analysis_chromatinization() of the NucleiFinder class.&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>            <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">res_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_images_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        Initialize the object with list of images IDs for porcesing.</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        Parameters</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        ----------</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">            List of selected image IDs.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">        Returns</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a><span class="sd">        -------</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        ImagesManagement</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                <span class="s2">&quot;Incorrect data provided. There must be a list of image IDs.&quot;</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="p">)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">images_ids</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_included_acronyms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">        Print the data acronyms for adjusted images, processed using the</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        self.adjust_images(), self.image_merging(), and self.image_stitching() methods.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        Acronym information is essential for retrieving and saving data using</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        the self.get_prepared_images() and self.save_prepared_images() methods.</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        Notes</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        -----</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        This method prints the list of available acronyms but does not return it.</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Avaiable stored images:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="k">for</span> <span class="n">kd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">kd</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        Retrieves the prepared images (returned from preapre_selected_img()) stored in the object.</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">        Parameters</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">        ----------</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">        acronyme : str or None</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">            Acronym identifying a processed image set. If None, prints available keys.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a><span class="sd">        Returns</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        -------</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        dict</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">            Dictionary of prepared images.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">        Saves prepared images (returned from preapre_selected_img() method) to the specified directory.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        Parameters</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">        ----------</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="sd">        path_to_save : str</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">            Directory path where the images will be saved. Default is the current working directory.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>                <span class="n">path_to_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>                    <span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">acronyme</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">):</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">),</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                    <span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjust_images</span><span class="p">(</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tif&quot;</span><span class="p">,</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="n">eq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>        <span class="n">clahe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="n">kernal</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>        <span class="n">max_intensity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>        <span class="n">min_intenisty</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>        <span class="n">brightness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">img_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="p">):</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a><span class="sd">        Prepares selected images for processing, applying histogram equalization and CLAHE, if required.</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a><span class="sd">        Parameters</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        ----------</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        acronyme : str</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">            Name of images being adjusted in this run.</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        path_to_images : str</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            Path to the directory containing images.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        file_extension : str</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">            Image file extension. Default is &#39;tiff&#39;.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        eq : bool</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">            Whether to apply histogram equalization. Default is True.</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">        clahe : bool</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">            Whether to apply CLAHE. Default is True.</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        kernal : tuple</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">            Kernel size for CLAHE. Default is (50, 50).</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">        fille_name_part : str</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        color : str</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">            Color space to use. Default is &#39;gray&#39;.</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a><span class="sd">        max_intensity : int</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">            Maximum intensity for image adjustment. Default is 65535.</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">        min_intenisty : int</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">            Minimum intensity for image adjustment. Default is 0.</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">        brightness : int</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="sd">            Brightness adjustment value. Default is 1000.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        contrast : float</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">            Contrast adjustment factor. Default is 1.0.</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">        gamma : float</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            Gamma correction factor. Default is 1.0.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">        img_n : int</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">            Number of images to process. Default is 0, which means all images.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">        Returns</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        -------</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        dict</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">            Dictionary containing the processed images.</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        Notes</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="sd">        -----</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>        <span class="n">selected_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>                <span class="n">x</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="p">]</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="k">if</span> <span class="n">img_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">img_n</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                <span class="k">pass</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>            <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">equalizeHist_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>            <span class="k">if</span> <span class="n">clahe</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">clahe_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernal</span><span class="o">=</span><span class="n">kernal</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="n">img</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="n">max_intensity</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">,</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                <span class="n">min_intenisty</span><span class="o">=</span><span class="n">min_intenisty</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="n">brightness</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>            <span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="n">results_dict</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_merging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ratio_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        Merge previously prepared images stored in `self.prepared_images`,</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">        adjusted based on the image ratios. The used ratios adjust relative image intensity.</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">        Parameters</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="sd">        ----------</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        acronyme : list</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a><span class="sd">            List of image names to be merged.</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="sd">        ratio_list : list[float]</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="sd">            List of ratio intensity values (0.0–1.0) for the merged image.</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a><span class="sd">            The `acronyme` list and `ratio_list` must be of the same length.</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a><span class="sd">        Returns</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="sd">        -------</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="sd">        dict</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a><span class="sd">        Notes</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="sd">        -----</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                    <span class="n">x</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="p">]</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                    <span class="k">break</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>                    <span class="n">img_list</span><span class="p">,</span> <span class="n">ratio_list</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>                <span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_stitching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">to_results_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="sd">        Stitch (horizontally) previously prepared images stored in `self.prepared_images`.</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a><span class="sd">        Parameters</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a><span class="sd">        ----------</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        acronyme : list</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">            List of image names to be stitched.</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">        to_results_image : bool</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">            Boolean value indicating whether images obtained from the</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">            `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">            methods of the `NucleiFinder` class should be stitched to the right</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a><span class="sd">            side of the images in the `acronyme` list.</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">        Returns</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">        -------</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">        dict</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">        Notes</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">        -----</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">):</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                    <span class="n">x</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>                <span class="p">]</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                    <span class="k">break</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>            <span class="k">if</span> <span class="n">to_results_image</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                    <span class="n">x</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>                <span class="p">]</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                    <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">[</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">_res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>            <span class="k">elif</span> <span class="n">to_results_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">        Save `self.results_images` loaded by the `self.load_experimental_images()` method,</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a><span class="sd">        obtained from the `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">        methods of the `NucleiFinder` class for later usage with cls.load_from_dict() method.</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        The data will be saved with a `.inuc` extension.</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">        Parameters</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">        ----------</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">        path_to_save : str</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">            The directory path where the images will be saved.</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">            Default is the current working directory.</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.inuc&quot;</span><span class="p">)</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NucleiFinder</span><span class="p">(</span><span class="n">ImageTools</span><span class="p">,</span> <span class="n">RepTools</span><span class="p">):</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">    Implements a comprehensive pipeline for automated segmentation,</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="sd">    selection, and analysis of cell nuclei and their internal chromatin structure</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">    in microscopy images.</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">    It utilizes a pre-trained deep learning model (StarDist2D) for initial</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">    nuclear identification, followed by the application of advanced morphological</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">    and intensity filters, and a dedicated algorithm for quantifying chromatinization.</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a><span class="sd">    The class provides detailed control over the hyperparameters for both the</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a><span class="sd">    segmentation process and image preprocessing stages.</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a><span class="sd">    Parameters</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a><span class="sd">    ----------</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a><span class="sd">    image : np.ndarray, optional</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a><span class="sd">        The input image (typically 16-bit) for analysis.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="sd">    test_results : list, optional</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="sd">        Plots resulting from parameter testing (e.g., NMS/Prob combinations).</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">    hyperparameter_nuclei : dict, optional</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">        Parameters for nuclei segmentation and filtering (e.g., &#39;nms&#39;, &#39;prob&#39;, &#39;min_size&#39;, &#39;circularity&#39;).</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">    hyperparameter_chromatinization : dict, optional</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        Parameters for segmenting and filtering chromatin spots (e.g., &#39;cut_point&#39;, &#39;ratio&#39;).</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">    img_adj_par_chrom : dict, optional</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">        Image adjustment parameters (gamma, contrast) specifically for chromatin analysis.</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">    img_adj_par : dict, optional</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">        Image adjustment parameters for nuclei segmentation.</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">    show_plots : bool, optional</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">        Flag controlling the automatic display of visual results.</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">    nuclei_results : dict, optional</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="sd">        A dictionary storing numerical data (features) extracted from the nuclei.</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">    images : dict, optional</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        A dictionary storing output images and masks.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">    Attributes</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    ----------</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">    image : np.ndarray</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        The currently loaded image for analysis.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a><span class="sd">    test_results : list</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">        The visual outcomes of NMS/Prob parameter tests.</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">    hyperparameter_nuclei : dict</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">        A dictionary of active parameters used by the `find_nuclei()` and `select_nuclei()` methods.</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">    hyperparameter_chromatinization : dict</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">        A dictionary of active parameters used by the `nuclei_chromatinization()` method.</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">    img_adj_par : dict</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        Image correction parameters for nuclei segmentation.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">    img_adj_par_chrom : dict</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="sd">        Image correction parameters for chromatin analysis.</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a><span class="sd">    show_plots : bool</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a><span class="sd">        The state of the plot display flag.</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="sd">    nuclei_results : dict</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        Stores feature dictionaries for: all detected (&#39;nuclei&#39;), selected (&#39;nuclei_reduced&#39;),</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="sd">        and chromatinization data (&#39;nuclei_chromatinization&#39;).</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">    images : dict</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        Stores masks and images visualizing the results.</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">    series_im : bool</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        Flag indicating if the class is operating in a batch or series processing mode.</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">    Methods</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">    -------</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">    set_nms(nms)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        Sets the Non-Maximum Suppression (NMS) threshold.</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">    set_prob(prob)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        Sets the segmentation probability threshold.</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a><span class="sd">    set_nuclei_circularity(circ)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">        Sets the minimum required circularity for a nucleus.</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">    set_nuclei_local_intenisty_FC(local_FC)</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">        Sets the factor used for removing false positives based on local intensity differences.</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a><span class="sd">    set_nuclei_global_area_FC(global_FC)</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">        Sets the factor used for removing size-based outlier false positives.</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a><span class="sd">    set_nuclei_size(size)</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a><span class="sd">        Sets the minimum and maximum area (in pixels) for nuclei selection.</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a><span class="sd">    set_nuclei_min_mean_intensity(intensity)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="sd">        Sets the minimum required mean intensity value for a nucleus.</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">    set_chromatinization_size(size)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="sd">        Sets the minimum and maximum area (in pixels) for chromatin spot selection.</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="sd">    set_chromatinization_cut_point(cut_point)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="sd">        Sets the factor used to adjust the chromatin segmentation threshold (Otsu&#39;s method).</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a><span class="sd">    set_adj_image_gamma(gamma)</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">        Sets the gamma correction for the nuclei image.</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">    set_adj_chrom_contrast(contrast)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a><span class="sd">        Sets the contrast adjustment for the chromatinization image.</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">    current_parameters_nuclei (property)</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a><span class="sd">        Returns the active nuclei segmentation and filtering parameters.</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">    find_nuclei()</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a><span class="sd">        Performs nuclei segmentation using StarDist and extracts initial features.</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a><span class="sd">    select_nuclei()</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a><span class="sd">        Filters the detected nuclei based on set morphological and intensity criteria.</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a><span class="sd">    nuclei_chromatinization()</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a><span class="sd">        Performs quantitative and morphological analysis of chromatin spots in selected nuclei.</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">    get_features(model_out, image)</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a><span class="sd">        Calculates geometric and intensity features from a segmented mask (label image).</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">    Notes</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">    -----</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">    The typical analysis workflow follows this order:</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a><span class="sd">    1. `input_image()`</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">    2. `find_nuclei()`</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">    3. `select_nuclei()` (Optional)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">    4. `nuclei_chromatinization()` (Optional)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>        <span class="n">test_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>        <span class="n">hyperparameter_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>        <span class="n">hyperparameter_chromatinization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>        <span class="n">img_adj_par_chrom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>        <span class="n">img_adj_par</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>        <span class="n">show_plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>        <span class="n">nuclei_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>        <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="p">):</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        The main class for the detection and analysis of cell nuclei and their chromatinization</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        in microscopy or flow cytometry images, utilizing the StarDist segmentation model.</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">        This class inherits functionality for image processing (ImageTools) and</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        results handling (RepTools).</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        Parameters</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">        ----------</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">        image : np.ndarray, optional</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">            The input image for analysis.</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">            Default: None.</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        test_results : list, optional</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">            A list of plots or images resulting from parameter testing.</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">            Default: None.</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a><span class="sd">        hyperparameter_nuclei : dict, optional</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a><span class="sd">            The segmentation parameters for nuclei detection.</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="sd">            Default:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a><span class="sd">            {&#39;nms&#39;: 0.8, &#39;prob&#39;: 0.4, &#39;max_size&#39;: 1000, &#39;min_size&#39;: 20,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="sd">             &#39;circularity&#39;: 0.6, &#39;intensity_mean&#39;: 6553.5, &#39;nn_min&#39;: 10,</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a><span class="sd">             &#39;FC_diff_global&#39;: 1.5, &#39;FC_diff_local_intensity&#39;: 0.6}</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">        hyperparameter_chromatinization : dict, optional</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">            The analysis parameters for chromatin spots within the nuclei.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">            Default:</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">            {&#39;max_size&#39;: 800, &#39;min_size&#39;: 2, &#39;ratio&#39;: 0.1, &#39;cut_point&#39;: 0.95}</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        img_adj_par_chrom : dict, optional</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for chromatin analysis.</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.25, &#39;contrast&#39;: 5, &#39;brightness&#39;: 950}</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        img_adj_par : dict, optional</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for nuclei segmentation.</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.9, &#39;contrast&#39;: 2, &#39;brightness&#39;: 1000}</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        show_plots : bool, optional</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">            Flag to determine whether results and plots should be displayed automatically.</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">            Default: True.</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a><span class="sd">        nuclei_results : dict, optional</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">            A dictionary storing the numerical results of the analysis.</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">        images : dict, optional</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">            A dictionary storing the output images (e.g., masks).</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="sd">        Attributes</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a><span class="sd">        ----------</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">            The currently loaded image for analysis.</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">        hyperparameter_nuclei : dict</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a><span class="sd">            Active nuclei segmentation parameters.</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a><span class="sd">        hyperparameter_chromatinization : dict</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="sd">            Active chromatinization analysis parameters.</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a><span class="sd">        img_adj_par : dict</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="sd">            Active image correction parameters for nuclei segmentation.</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">        img_adj_par_chrom : dict</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a><span class="sd">            Active image correction parameters for chromatin analysis.</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        show_plots : bool</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">            The current state of the plot display flag.</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">        series_im : bool</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">            Flag indicating if a series of images is being processed.</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        Notes</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        -----</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        The default value for &#39;intensity_mean&#39; in hyperparameter_nuclei is calculated</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        as $(2^{16} - 1) / 10$, which represents 10% of the maximum 16-bit value (65535 / 10 = 6553.5).</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        The image adjustment parameters are crucial for optimizing contrast and brightness</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">        to improve the performance of both the StarDist model and the subsequent</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">        chromatin thresholding.</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>        <span class="c1"># Use default values if parameters are None</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loaded input image.&quot;&quot;&quot;</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">test_results</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Results of parameter tests.</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">            This attribute or method stores the outcomes of parameter testing procedures.</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">            For interactive browsing and inspection of the results, use the </span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">            `browser_test(self)` method.&quot;&quot;&quot;</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span> <span class="o">=</span> <span class="n">hyperparameter_nuclei</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>            <span class="s2">&quot;nms&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>            <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;nn_min&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="s2">&quot;FC_diff_global&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="p">}</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active nuclei segmentation/filter parameters.&quot;&quot;&quot;</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span> <span class="o">=</span> <span class="n">hyperparameter_chromatinization</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>            <span class="s2">&quot;cut_point&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="p">}</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active chromatin analysis parameters.&quot;&quot;&quot;</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span> <span class="o">=</span> <span class="n">img_adj_par_chrom</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">950</span><span class="p">,</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>        <span class="p">}</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for chromatin analysis.&quot;&quot;&quot;</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span> <span class="o">=</span> <span class="n">img_adj_par</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>        <span class="p">}</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for nuclei segmentation.&quot;&quot;&quot;</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span> <span class="ow">or</span> <span class="kc">True</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag controlling plot display.&quot;&quot;&quot;</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span> <span class="o">=</span> <span class="n">nuclei_results</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>        <span class="p">}</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of nuclei analysis results.&quot;&quot;&quot;</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>        <span class="p">}</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of images from nuclei analysis.&quot;&quot;&quot;</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>        <span class="c1"># sereies images</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag for batch/series image processing.&quot;&quot;&quot;</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nms</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">        Set the Non-Maximum Suppression (NMS) threshold.</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a><span class="sd">        The NMS threshold controls how aggressively overlapping detections are suppressed.</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a><span class="sd">        A lower value reduces the probability of overlapping nuclei being kept.</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        Parameters</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">        ----------</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a><span class="sd">        nms : float</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">            The NMS IoU threshold value.</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nms</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">        Set the probability threshold used in segmentation.</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">        The probability threshold determines the minimum confidence required for an object</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">        (e.g., a nucleus) to be classified as a segmented entity. Higher values result in</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">        fewer segmented objects, as only detections with strong confidence scores are kept.</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        This may lead to omission of weaker or less distinct structures.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">        Because optimal values depend on image characteristics, it is important to visually</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">        inspect segmentation results produced with different thresholds to determine the</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">        most suitable setting.</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">        Parameters</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">        ----------</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a><span class="sd">        prob : float</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">            The probability threshold value.</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circ</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a><span class="sd">        This method sets &#39;circ&#39; parameter. The circ is a parameter used for adjust minimal nucleus circularity.</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a><span class="sd">        Parameters</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a><span class="sd">        ----------</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="sd">        circ : float</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a><span class="sd">            Nuclei circularity value.</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circ</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_local_intenisty_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">        This method sets the &#39;FC_diff_local_intensity&#39; parameter. The &#39;local_FC&#39; is used to remove false positive multiple nuclei that were detected in single image.</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">        Parameters</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="sd">        ----------</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="sd">        local_FC : float</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">            local_FC value.</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_FC</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="c1"># change</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_global_area_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">        This method sets the &#39;FC_diff_global&#39; parameter. The &#39;global_FC&#39; is used to remove false positive multiple nuclei that were detected in a single image and are outliers from the global mean area size.</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">        Parameters</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">        ----------</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">        FC_diff_global : float</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">            global_FC value.</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_FC</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal nucleus area (px).</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a><span class="sd">        Parameters</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">        ----------</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">        size : tuple</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_min_mean_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">        This method sets &#39;intensity&#39; parameter. The &#39;intensity&#39; parameter is used to adjust the minimum mean intensity of all pixel intensities within the nucleus.</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">        Parameters</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">        ----------</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">        intensity : int</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">            intensity value.</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal chromanitization spot area (px) within the nucleus.</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="sd">        Parameters</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">        ----------</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">        size : tuple</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">        This method sets the &#39;ratio&#39; parameter. In this case, the &#39;ratio&#39; parameter is similar to &#39;circularity&#39; as it describes the ratio between the maximum lengths in the x and y dimensions of the nucleus chromatinization.</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">        Parameters</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">        ----------</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">        ratio : float</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">            ratio value.</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_cut_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cut_point</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">        This method sets the &#39;cut_point&#39; parameter. The &#39;cut_point&#39; parameter is a factor used to adjust the threshold for separating the background from chromatin spots.</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">        Parameters</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a><span class="sd">        ----------</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">        cut_point : int</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">            cut_point value.</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut_point</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>    <span class="c1">#</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus image.</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="sd">        Parameters</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a><span class="sd">        ----------</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a><span class="sd">        gamma : float</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a><span class="sd">            gamma value.</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus image.</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">        Parameters</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">        ----------</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">        contrast : float</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a><span class="sd">            contrast value.</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus image.</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        Parameters</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        ----------</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        brightness : float</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">            brightness value.</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>    <span class="c1">#</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus chromatinization image.</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">        Parameters</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">        ----------</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a><span class="sd">        gamma : float</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a><span class="sd">            gamma value.</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus chromatinization image.</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a><span class="sd">        Parameters</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a><span class="sd">        ----------</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a><span class="sd">        contrast : float</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a><span class="sd">            contrast value.</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus chromatinization image.</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a><span class="sd">        Parameters</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="sd">        ----------</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a><span class="sd">        brightness : float</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a><span class="sd">            brightness value.</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>    <span class="nd">@property</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a><span class="sd">        This method returns current nuclei analysis parameters.</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a><span class="sd">        Returns</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a><span class="sd">        -------</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a><span class="sd">        dict</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a><span class="sd">            Nuclei analysis parameters.</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="nd">@property</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a><span class="sd">        This method returns current nuclei chromatinization analysis parameters.</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a><span class="sd">        Returns</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a><span class="sd">        -------</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a><span class="sd">        dict</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a><span class="sd">            Nuclei chromatinization analysis parameters.</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">)</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>    <span class="nd">@property</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="sd">        This method returns current nuclei image setup.</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">        Returns</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">        -------</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="sd">        dict</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">            Nuclei image setup.</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">)</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="nd">@property</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj_chro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a><span class="sd">        This method returns current nuclei chromatinization image setup.</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a><span class="sd">        Returns</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a><span class="sd">        -------</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a><span class="sd">        dict</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a><span class="sd">            Nuclei chromatinization image setup.</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">)</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        This function returns nuclei analysis results.</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a><span class="sd">        Returns</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a><span class="sd">        -------</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a><span class="sd">        dict</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]))</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">        This function returns the results of the nuclei analysis following adjustments to the data selection thresholds.</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">        Returns</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a><span class="sd">        -------</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a><span class="sd">        dict</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>                    <span class="p">)</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a><span class="sd">        This function returns the results of the nuclei chromatinization analysis.</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a><span class="sd">        Returns</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a><span class="sd">        -------</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a><span class="sd">        dict</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a><span class="sd">            Nuclei chromatinization results in the dictionary format.</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">])</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>            <span class="p">)</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plots</span><span class="p">):</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">plots</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a><span class="sd">        Helper method.</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a><span class="sd">        This method adds the image to the class for nuclei and/or chromatinization analysis.</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a><span class="sd">        Parameters</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a><span class="sd">        ----------</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a><span class="sd">        img : np.ndarray</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a><span class="sd">            Input image.</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_out</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a><span class="sd">        Extracts numerical feature descriptors from model output for a given image.</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a><span class="sd">        This method processes the output returned by a feature-extraction model</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a><span class="sd">        (e.g., CNN, encoder network, statistical model) and converts it into a</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a><span class="sd">        structured feature vector associated with the provided image.</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a><span class="sd">        Typically used for downstream analysis, classification, or clustering.</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a><span class="sd">        Parameters</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a><span class="sd">        ----------</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a><span class="sd">        model_out : any</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a><span class="sd">            Output returned by the feature-extraction model.</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a><span class="sd">            The expected format depends on the model (e.g., tensor, dict, list of arrays).</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="sd">        image : ndarray</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a><span class="sd">            The input image (2D or 3D array) for which features are being extracted.</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="sd">            Provided for reference or for combining raw image metrics with model features.</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">        Returns</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">        -------</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a><span class="sd">        features : dict</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">            Dictionary containing extracted features.</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">            Keys correspond to feature names, and values are numerical descriptors.</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>            <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>            <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>            <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>            <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>            <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>            <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>            <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>            <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>            <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>            <span class="s2">&quot;intensity_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>            <span class="s2">&quot;intensity_min&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>            <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>        <span class="p">}</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">skimage</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">model_out</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">image</span><span class="p">):</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>            <span class="c1"># Compute circularity</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>            <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">perimeter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">region</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span><span class="p">)</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span><span class="p">)</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span><span class="p">)</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span><span class="p">)</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span><span class="p">)</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circularity</span><span class="p">)</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_max</span><span class="p">))</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_min</span><span class="p">))</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_mean</span><span class="p">))</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>        <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>        <span class="c1"># Calculate the ratio for each pair of values</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>        <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>        <span class="p">):</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>            <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>    <span class="c1"># repaired stat</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_finder_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">        This method performs testing analysis of parameters (specified &#39;nms&#39; and &#39;prob&#39; parameters)</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">        for the image provided by the input_image() method.</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">        This method evaluates the performance of the internal NucleiFinder</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">        configuration using the currently loaded images, parameters, or model</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">        settings. It is typically used to check whether the detection, segmentation</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">        or preprocessing stages run correctly on sample data.</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">        Examples</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">        --------</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a><span class="sd">        &gt;&gt;&gt; nf.nuclei_finder_test()</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a><span class="sd">        &gt;&gt;&gt; nf.browser_test()</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>        <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">()</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="n">nmst</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>        <span class="n">probt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>        <span class="n">plot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>        <span class="c1"># adj img</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>            <span class="n">img</span><span class="p">,</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>            <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>            <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>            <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>        <span class="p">)</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>        <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nmst</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loop 1: nmst&quot;</span><span class="p">):</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">➡️ Starting outer loop for n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">probt</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;   ↳ Loop 2 for n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   → Starting inner loop for t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>                    <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span> <span class="n">nms_thresh</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">prob_thresh</span><span class="o">=</span><span class="n">t</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>                <span class="p">)</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">render_label</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">))</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>                    <span class="sa">f</span><span class="s2">&quot;nms </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> &amp; prob </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> detected nuc: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>                <span class="p">)</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>                <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a><span class="sd">            - ``get_results_nuclei()``</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                <span class="n">img</span><span class="p">,</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>            <span class="p">)</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>                <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>                <span class="n">nms_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">],</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>                <span class="n">prob_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">],</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>            <span class="p">)</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>                <span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>            <span class="p">)</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="n">oryginal</span><span class="p">),</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>                        <span class="p">),</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>                    <span class="p">)</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>                        <span class="p">)</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nuclei not detected!&quot;</span><span class="p">)</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Add image firstly!&quot;</span><span class="p">)</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a><span class="sd">        Selects data obtained from ``find_nuclei()`` based on the set threshold parameters.</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a><span class="sd">            - ``get_results_nuclei_selected()``</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>            <span class="n">input_in</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>                <span class="n">input_in</span><span class="p">,</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>            <span class="p">)</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>            <span class="p">)</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">,</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">],</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>            <span class="p">)</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="n">oryginal</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>                            <span class="p">),</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>                        <span class="p">),</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>                    <span class="p">)</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>                        <span class="p">)</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected zero nuclei! Analysis stop!&quot;</span><span class="p">)</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a><span class="sd">        Performs chromatinization analysis of nuclei using data obtained from</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a><span class="sd">        ``find_nuclei()`` and/or ``select_nuclei()``.</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a><span class="sd">            - ``get_results_nuclei_chromatinization()``</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_lists</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>            <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>                <span class="n">f_elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>                <span class="n">g_elem</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_elem</span> <span class="o">+</span> <span class="n">g_elem</span><span class="p">)</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>            <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>            <span class="n">zero</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>            <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>            <span class="k">return</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="k">if</span> <span class="n">nuclei_dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>            <span class="n">arrays_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>            <span class="n">chromatione_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>                <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>                <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>                <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>                <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>                <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>                <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>                <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>                <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>                <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>                <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>            <span class="p">}</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">full_im</span><span class="p">)</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">reverse_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a>                <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">regions_chro2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">)</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>                    <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>                    <span class="k">pass</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>                    <span class="n">regions_chro2</span><span class="p">,</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>                    <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>                    <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>                    <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>                <span class="p">)</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>                <span class="n">full_im</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>                    <span class="n">image_list</span><span class="o">=</span><span class="p">[</span><span class="n">full_im</span><span class="p">,</span> <span class="n">regions_chro2</span><span class="p">],</span> <span class="n">intensity_factors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>                <span class="p">)</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>                    <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>                    <span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>                <span class="p">)</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>                <span class="n">regions_chro2</span><span class="p">[</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>                    <span class="n">regions_chro2</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>                    <span class="o">&lt;=</span> <span class="n">ret</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>                <span class="n">chromatione</span> <span class="o">=</span> <span class="n">regions_chro2</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>                <span class="n">labeled_cells</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">chromatione</span><span class="p">)</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_cells</span><span class="p">)</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>                    <span class="n">labeled_cells</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">regions_chro2</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>                <span class="p">)</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>                    <span class="p">)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>                    <span class="p">)</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>                    <span class="p">)</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>                    <span class="p">)</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>                    <span class="p">)</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>            <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">],</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>            <span class="p">):</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>                <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>            <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>                <span class="n">chromatione_info</span><span class="p">,</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>            <span class="p">)</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>            <span class="p">)</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">],</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>            <span class="p">)</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>            <span class="n">arrays_list2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">):</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>                <span class="n">spot_size_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>                <span class="n">spot_size_area_bbox</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>                <span class="n">spot_size_area_filled</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>                <span class="n">spot_axis_major_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>                <span class="n">spot_axis_minor_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>                <span class="n">spot_eccentricity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>                <span class="n">spot_size_equivalent_diameter_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>                <span class="n">spot_feret_diameter_max</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>                <span class="n">spot_perimeter</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>                <span class="n">spot_perimeter_crofton</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>                <span class="c1"># Flatten the array,</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>                <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>                <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>                <span class="p">)</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>                <span class="n">counter_tmp</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list2</span><span class="p">):</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>                    <span class="n">df_tmp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>                    <span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>                    <span class="p">)</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>                    <span class="n">counter_tmp2</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>                    <span class="n">intersection_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">counter_tmp2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>                    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp2</span><span class="p">))</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>                    <span class="k">if</span> <span class="n">intersection_length</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>                        <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>                            <span class="n">spot_size_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>                            <span class="n">spot_size_area_bbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>                            <span class="n">spot_size_area_convex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>                            <span class="p">)</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>                            <span class="n">spot_size_area_filled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>                            <span class="p">)</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>                            <span class="n">spot_axis_major_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>                            <span class="p">)</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>                            <span class="n">spot_axis_minor_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>                            <span class="p">)</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>                            <span class="n">spot_eccentricity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>                            <span class="n">spot_size_equivalent_diameter_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>                            <span class="p">)</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>                            <span class="n">spot_feret_diameter_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>                            <span class="p">)</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>                            <span class="n">spot_perimeter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>                            <span class="n">spot_perimeter_crofton</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>                            <span class="p">)</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area</span><span class="p">)</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_bbox</span><span class="p">)</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_convex</span><span class="p">)</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_filled</span><span class="p">)</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>                    <span class="n">spot_axis_major_length</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>                <span class="p">)</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>                    <span class="n">spot_axis_minor_length</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>                <span class="p">)</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_eccentricity</span><span class="p">)</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>                    <span class="n">spot_size_equivalent_diameter_area</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>                <span class="p">)</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>                    <span class="n">spot_feret_diameter_max</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>                <span class="p">)</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_perimeter</span><span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>                    <span class="n">spot_perimeter_crofton</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>                <span class="p">)</span>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromation_dic</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>                <span class="n">chromation_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>            <span class="p">)</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>            <span class="n">img_chrom</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>                    <span class="p">),</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>                <span class="p">),</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>            <span class="p">)</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>                        <span class="p">),</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>                    <span class="p">),</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>                <span class="p">)</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>                    <span class="p">),</span>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>                <span class="p">)</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">([</span><span class="n">nuclei_mask</span><span class="p">,</span> <span class="n">img_chrom</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">full_im</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">full_im</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>            <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>            <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>                        <span class="p">)</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>                    <span class="p">)</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>    <span class="c1"># separate function for chromatinization</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_nuclei_chromatinization_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">nuclei_data</span><span class="p">):</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a><span class="sd">        Helper method for performing chromatinization analysis on nuclei detected in the provided image.</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_lists</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>            <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>                <span class="n">f_elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>                <span class="n">g_elem</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_elem</span> <span class="o">+</span> <span class="n">g_elem</span><span class="p">)</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>            <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>            <span class="n">zero</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>            <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>            <span class="k">return</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>        <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="n">nuclei_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>        <span class="k">if</span> <span class="n">nuclei_dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">arrays_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>            <span class="n">chromatione_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>                <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>                <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>                <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>                <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>                <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>                <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>                <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>                <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>                <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>                <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>                <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>                <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>            <span class="p">}</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">full_im</span><span class="p">)</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>                <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">regions_chro2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">)</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>                    <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>                    <span class="k">pass</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>                    <span class="n">regions_chro2</span><span class="p">,</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>                    <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>                    <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>                    <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>                <span class="p">)</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>                <span class="n">full_im</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>                    <span class="n">image_list</span><span class="o">=</span><span class="p">[</span><span class="n">full_im</span><span class="p">,</span> <span class="n">regions_chro2</span><span class="p">],</span> <span class="n">intensity_factors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>                <span class="p">)</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>                    <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>                    <span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a>                <span class="p">)</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>                <span class="n">regions_chro2</span><span class="p">[</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>                    <span class="n">regions_chro2</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>                    <span class="o">&lt;=</span> <span class="n">ret</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a>                <span class="n">chromatione</span> <span class="o">=</span> <span class="n">regions_chro2</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>                <span class="n">labeled_cells</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">chromatione</span><span class="p">)</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_cells</span><span class="p">)</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>                    <span class="n">labeled_cells</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">regions_chro2</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>                <span class="p">)</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>                    <span class="p">)</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>                    <span class="p">)</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>                    <span class="p">)</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>                    <span class="p">)</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>                    <span class="p">)</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>            <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">],</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>            <span class="p">):</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>                <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>            <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>                <span class="n">chromatione_info</span><span class="p">,</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>            <span class="p">)</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>            <span class="p">)</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">],</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>            <span class="p">)</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>            <span class="n">arrays_list2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>                <span class="n">spot_size_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>                <span class="n">spot_size_area_bbox</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>                <span class="n">spot_size_area_filled</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>                <span class="n">spot_axis_major_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>                <span class="n">spot_axis_minor_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>                <span class="n">spot_eccentricity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>                <span class="n">spot_size_equivalent_diameter_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>                <span class="n">spot_feret_diameter_max</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>                <span class="n">spot_perimeter</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>                <span class="n">spot_perimeter_crofton</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>                <span class="c1"># Flatten the array,</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>                <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>                <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>                <span class="p">)</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>                <span class="n">counter_tmp</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list2</span><span class="p">):</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>                    <span class="n">df_tmp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>                    <span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>                    <span class="p">)</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>                    <span class="n">counter_tmp2</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>                    <span class="n">intersection_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">counter_tmp2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>                    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp2</span><span class="p">))</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>                    <span class="k">if</span> <span class="n">intersection_length</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>                        <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>                            <span class="n">spot_size_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>                            <span class="n">spot_size_area_bbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>                            <span class="n">spot_size_area_convex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>                            <span class="p">)</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>                            <span class="n">spot_size_area_filled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>                            <span class="p">)</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>                            <span class="n">spot_axis_major_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>                            <span class="p">)</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>                            <span class="n">spot_axis_minor_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>                            <span class="p">)</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>                            <span class="n">spot_eccentricity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>                            <span class="n">spot_size_equivalent_diameter_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>                            <span class="p">)</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>                            <span class="n">spot_feret_diameter_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>                            <span class="p">)</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>                            <span class="n">spot_perimeter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>                            <span class="n">spot_perimeter_crofton</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>                            <span class="p">)</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area</span><span class="p">)</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_bbox</span><span class="p">)</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_convex</span><span class="p">)</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_filled</span><span class="p">)</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>                    <span class="n">spot_axis_major_length</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>                <span class="p">)</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>                    <span class="n">spot_axis_minor_length</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>                <span class="p">)</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_eccentricity</span><span class="p">)</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>                    <span class="n">spot_size_equivalent_diameter_area</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>                <span class="p">)</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>                    <span class="n">spot_feret_diameter_max</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>                <span class="p">)</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_perimeter</span><span class="p">)</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>                    <span class="n">spot_perimeter_crofton</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>                <span class="p">)</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromation_dic</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>                <span class="n">chromation_dic</span><span class="p">,</span> <span class="n">image</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>            <span class="p">)</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>            <span class="n">img_chrom</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">],</span> <span class="n">image</span><span class="p">),</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>                <span class="p">),</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>            <span class="p">)</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">,</span> <span class="n">image</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">),</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>            <span class="p">)</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">([</span><span class="n">nuclei_mask</span><span class="p">,</span> <span class="n">img_chrom</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">full_im</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">full_im</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>            <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>            <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>                        <span class="p">)</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>                    <span class="p">)</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">browser_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a><span class="sd">        Displays test results generated by the ``nuclei_finder_test()`` method</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a><span class="sd">        in the default web browser.</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>        <span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="p">:</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>            <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>            <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>            <span class="n">img_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">img_base64</span><span class="si">}</span><span class="s1">&quot; style=&quot;margin:10px;&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.html&quot;</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>            <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>            <span class="n">tmp_filename</span> <span class="o">=</span> <span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">)</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_chromatinization</span><span class="p">(</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>    <span class="p">):</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a><span class="sd">        Performs full analysis on images provided via the ``input_image()`` method</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a><span class="sd">        This method runs nuclei detection, nuclei selection, and chromatinization</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a><span class="sd">        analysis in a single pipeline. Users can adjust parameters for each step</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a><span class="sd">        before running the analysis.</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a><span class="sd">        Parameters</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a><span class="sd">        ----------</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a><span class="sd">        path_to_images : str</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a><span class="sd">            Whether to run ``select_nuclei()`` with the defined parameters. Default is True.</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a><span class="sd">        Returns</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a><span class="sd">        -------</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a><span class="sd">        results_dict : dict</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a><span class="sd">        Notes</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a><span class="sd">        -----</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a><span class="sd">        This method runs the complete nuclei and chromatinization analysis pipeline.</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a><span class="sd">        Parameters must be set appropriately before calling to ensure correct results.</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>        <span class="n">results_img_raw</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>                <span class="n">x</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>            <span class="p">]</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>            <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>                    <span class="k">del</span> <span class="n">tmp</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>                    <span class="k">del</span> <span class="n">image</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chromatization searching:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>        <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei_chromatinization_series</span><span class="p">(</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>                <span class="p">)</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_chromatinization</span><span class="p">()</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="n">ke</span><span class="si">}</span><span class="s2"> could not be processed.&quot;</span><span class="p">)</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>                    <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>                    <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>                            <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>                            <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>                        <span class="p">}</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_nuclei</span><span class="p">(</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>    <span class="p">):</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a><span class="sd">        This method runs nuclei detection and selection using the currently set</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a><span class="sd">        parameters. Users can adjust image preprocessing and nuclei detection</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a><span class="sd">        parameters before running the analysis.</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a><span class="sd">        Parameters</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a><span class="sd">        ----------</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a><span class="sd">        path_to_images : str</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a><span class="sd">            Whether to run the ``select_nuclei()`` method with the defined parameters.</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a><span class="sd">            Default is True.</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a><span class="sd">        Returns</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a><span class="sd">        -------</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a><span class="sd">        results_dict : dict</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>                <span class="n">x</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>            <span class="p">]</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>                <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>                <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>                    <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a>                        <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>                            <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>        <span class="k">if</span> <span class="n">include_img</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a>            <span class="k">return</span> <span class="n">results_dict_tmp</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>            <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>            <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">]),</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>                    <span class="p">),</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>                <span class="p">)</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>                <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>                <span class="n">cred</span> <span class="o">=</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>                <span class="c1"># cred.pop(&#39;coords&#39;)</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">cred</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">concatenated_image</span><span class="p">}</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>            <span class="k">return</span> <span class="n">results_dict</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NucleiDataManagement</span><span class="p">:</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a><span class="sd">    Manages nuclei analysis data obtained from the `NucleiFinder` class,</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a><span class="sd">    including nuclei properties and optionally Image Stream (IS) data.</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a><span class="sd">    This class allows loading nuclei data from JSON files or directly from</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a><span class="sd">    `NucleiFinder` analysis results, converting them to pandas DataFrames,</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a><span class="sd">    adding IS data, concatenating results from multiple experiments, and</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a><span class="sd">    saving results in JSON or CSV format. It also provides helper methods</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a><span class="sd">    for merging, filtering, and retrieving data.</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a><span class="sd">    Attributes</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a><span class="sd">    ----------</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a><span class="sd">    nuceli_data : dict</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a><span class="sd">        Dictionary storing nuclei properties for each image or experiment.</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a><span class="sd">    experiment_name : str</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a><span class="sd">        Name of the experiment.</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a><span class="sd">    nuceli_data_df : pd.DataFrame or None</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a><span class="sd">        DataFrame representation of nuclei properties.</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a><span class="sd">    nuclei_IS_data : pd.DataFrame or None</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a><span class="sd">        DataFrame of nuclei data merged with IS data.</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a><span class="sd">    concat_data : list or None</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a><span class="sd">        List of other `NucleiDataManagement` objects added for combined analysis.</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a><span class="sd">    Methods</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a><span class="sd">    -------</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a><span class="sd">    load_nuc_dict(path)</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a><span class="sd">        Load nuclei data from a JSON dictionary file (*.nuc) and initialize the object.</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a><span class="sd">        _convert_to_df()</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a><span class="sd">        Convert nuclei dictionary data to a pandas DataFrame.</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a><span class="sd">    add_IS_data(IS_data, IS_features)</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a><span class="sd">        Merge Image Stream (IS) data with nuclei data.</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a><span class="sd">    get_data()</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a><span class="sd">        Retrieve the nuclei data as a pandas DataFrame.</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a><span class="sd">    get_data_with_IS()</span>
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a><span class="sd">        Retrieve the nuclei data merged with IS data.</span>
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a><span class="sd">    save_nuc_project(path)</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a><span class="sd">        Save nuclei data as a JSON file with *.nuc extension.</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a><span class="sd">    save_results_df(path)</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a><span class="sd">        Save nuclei data as a CSV file.</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a><span class="sd">    save_results_df_with_IS(path)</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a><span class="sd">        Save nuclei data merged with IS data as a CSV file.</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a><span class="sd">    add_experiment(data_list)</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a><span class="sd">        Add other `NucleiDataManagement` objects for concatenated analysis.</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="sd">    get_mutual_experiments_data(inc_is)</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a><span class="sd">        Retrieve concatenated nuclei data from multiple experiments.</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a><span class="sd">    save_mutual_experiments(path, inc_is)</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a><span class="sd">        Save concatenated data from multiple experiments as a CSV file.</span>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a><span class="sd">        Initialize a NucleiDataManagement object with nuclei data and experiment name.</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a><span class="sd">        Parameters</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a><span class="sd">        ----------</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a><span class="sd">        nuclei_data : dict</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a><span class="sd">            Dictionary containing nuclei properties for each image or experiment.</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a><span class="sd">            If the dictionary entries have keys &#39;stats&#39; and &#39;img&#39;, only &#39;stats&#39; are stored.</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a><span class="sd">        Attributes</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a><span class="sd">        ----------</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a><span class="sd">        nuceli_data : dict</span>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a><span class="sd">            Dictionary storing nuclei properties for each image or experiment.</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a><span class="sd">        experiment_name : str</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a><span class="sd">        nuceli_data_df : pd.DataFrame or None</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a><span class="sd">            DataFrame representation of nuclei properties (initialized as None).</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a><span class="sd">        nuclei_IS_data : pd.DataFrame or None</span>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a><span class="sd">            DataFrame of nuclei data merged with Image Stream (IS) data (initialized as None).</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a><span class="sd">        concat_data : list or None</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a><span class="sd">            List of other `NucleiDataManagement` objects added for combined analysis (initialized as None).</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a>        <span class="p">):</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="n">nuclei_data</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the experiment.&quot;&quot;&quot;</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame representation of nuclei features&quot;&quot;&quot;</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame of data from Image Stream (IS).&quot;&quot;&quot;</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotored list of other `NucleiDataManagement` objects.&quot;&quot;&quot;</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_nuc_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a><span class="sd">        Initialize a NucleiDataManagement object from a JSON dictionary file.</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a><span class="sd">        The loaded data must be previously saved using the ``save_nuc_project()`` method.</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a><span class="sd">        Parameters</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a><span class="sd">        ----------</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a><span class="sd">        path : str</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a><span class="sd">            Path to the *.nuc JSON file containing nuclei data.</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>        <span class="k">if</span> <span class="s2">&quot;.nuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>                    <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .nuc extension!&quot;</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>            <span class="p">)</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a><span class="sd">        Helper method that converts the internal nuclei dictionary into a pandas DataFrame.</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a><span class="sd">        This method iterates over the nuclei data stored in `self.nuceli_data`,</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a><span class="sd">        flattens the information for each nucleus, computes aggregate statistics</span>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a><span class="sd">        for associated spots if present, and stores the resulting DataFrame in</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a><span class="sd">        `self.nuceli_data_df`.</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a>        <span class="n">nuclei_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]):</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>                    <span class="s2">&quot;id_name&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>                    <span class="s2">&quot;nuclei_area&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>                    <span class="s2">&quot;nuclei_area_bbox&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>                    <span class="s2">&quot;nuclei_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>                        <span class="s2">&quot;equivalent_diameter_area&quot;</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>                    <span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>                    <span class="s2">&quot;nuclei_feret_diameter_max&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>                        <span class="n">n</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>                    <span class="p">],</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>                    <span class="s2">&quot;nuclei_axis_major_length&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>                    <span class="s2">&quot;nuclei_axis_minor_length&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>                    <span class="s2">&quot;nuclei_circularity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>                    <span class="s2">&quot;nuclei_eccentricity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>                    <span class="s2">&quot;nuclei_perimeter&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>                    <span class="s2">&quot;nuclei_ratio&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ratio&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>                    <span class="s2">&quot;nuclei_solidity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;solidity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>                <span class="p">}</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>                <span class="k">if</span> <span class="s2">&quot;spot_size_area&quot;</span> <span class="ow">in</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>                        <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>                            <span class="p">{</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>                                <span class="s2">&quot;spot_n&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]),</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>                                <span class="s2">&quot;avg_spot_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>                                <span class="p">),</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>                                <span class="s2">&quot;avg_spot_area_bbox&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>                                <span class="p">),</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>                                <span class="s2">&quot;avg_spot_perimeter&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>                                <span class="p">),</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>                                <span class="s2">&quot;sum_spot_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>                                <span class="p">),</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>                                <span class="s2">&quot;sum_spot_area_bbox&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a>                                <span class="p">),</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a>                                <span class="s2">&quot;sum_spot_perimeter&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a>                                <span class="p">),</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>                                <span class="s2">&quot;avg_spot_axis_major_length&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>                                <span class="p">),</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>                                <span class="s2">&quot;avg_spot_axis_minor_length&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>                                <span class="p">),</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>                                <span class="s2">&quot;avg_spot_eccentricity&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>                                <span class="p">),</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>                                <span class="s2">&quot;avg_spot_size_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>                                        <span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>                                    <span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>                                <span class="p">),</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>                                <span class="s2">&quot;sum_spot_size_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>                                        <span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>                                    <span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>                                <span class="p">),</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>                            <span class="p">}</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>                        <span class="p">)</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>                        <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>                            <span class="p">{</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>                                    <span class="s2">&quot;spot_n&quot;</span><span class="p">,</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>                                    <span class="s2">&quot;avg_spot_area&quot;</span><span class="p">,</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>                                    <span class="s2">&quot;avg_spot_area_bbox&quot;</span><span class="p">,</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>                                    <span class="s2">&quot;avg_spot_perimeter&quot;</span><span class="p">,</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>                                    <span class="s2">&quot;sum_spot_area&quot;</span><span class="p">,</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>                                    <span class="s2">&quot;sum_spot_area_bbox&quot;</span><span class="p">,</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>                                    <span class="s2">&quot;sum_spot_perimeter&quot;</span><span class="p">,</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>                                    <span class="s2">&quot;avg_spot_axis_major_length&quot;</span><span class="p">,</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>                                    <span class="s2">&quot;avg_spot_axis_minor_length&quot;</span><span class="p">,</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>                                    <span class="s2">&quot;avg_spot_eccentricity&quot;</span><span class="p">,</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>                                    <span class="s2">&quot;avg_spot_size_equivalent_diameter_area&quot;</span><span class="p">,</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>                                    <span class="s2">&quot;sum_spot_size_equivalent_diameter_area&quot;</span><span class="p">,</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>                                <span class="p">]</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>                            <span class="p">}</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>                        <span class="p">)</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>        <span class="n">nuclei_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a>        <span class="n">nuclei_df</span><span class="p">[</span><span class="s2">&quot;nuclei_per_img&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;id_name&quot;</span><span class="p">)[</span><span class="s2">&quot;id_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a>            <span class="s2">&quot;count&quot;</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>        <span class="p">)</span>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a>        <span class="n">nuclei_df</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="o">=</span> <span class="n">nuclei_df</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_IS_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">IS_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a><span class="sd">        Merge Image Stream (IS) data with nuclei analysis data.</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a><span class="sd">        This method concatenates IS (Image Stream, https://cytekbio.com/pages/imagestream)</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a><span class="sd">        results with the nuclei data stored in the object. The merge is performed based</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a><span class="sd">        on object IDs, allowing joint analysis of nuclei features and IS features.</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a><span class="sd">        Parameters</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a><span class="sd">        ----------</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a><span class="sd">        IS_data : pd.DataFrame</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a><span class="sd">            DataFrame containing IS data results.</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a><span class="sd">        IS_features : list, optional</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a><span class="sd">            List of features to extract from the IS data. Default is an empty list.</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a><span class="sd">        Notes</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a><span class="sd">        -----</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a><span class="sd">        The merged data will be stored in the attribute `self.nuclei_IS_data`.</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>        <span class="n">nuclei_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IS_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>            <span class="n">IS_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">IS_features</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">]))</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>            <span class="n">IS_data</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="n">IS_features</span><span class="p">]</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>        <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>            <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>        <span class="p">)</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>        <span class="n">merged_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;set_x&quot;</span><span class="p">)</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;set_y&quot;</span><span class="p">:</span> <span class="s2">&quot;set&quot;</span><span class="p">})</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="n">merged_data</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a><span class="sd">        Helper method to retrieve the nuclei data as a pandas DataFrame.</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a><span class="sd">        If the internal DataFrame `self.nuceli_data_df` has not been created yet,</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a><span class="sd">        this method calls `_convert_to_df()` to generate it from `self.nuceli_data`.</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_df</span><span class="p">()</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a><span class="sd">        Retrieve nuclei results for a single project including IS data.</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a><span class="sd">        Returns</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a><span class="sd">        -------</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a><span class="sd">            DataFrame containing nuclei results merged with IS (Image Stream) data</span>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a><span class="sd">            added via `self.add_IS_data()`. Returns None if no IS data has been added.</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a><span class="sd">        Retrieve nuclei results for a single project as a pandas DataFrame.</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a><span class="sd">        Returns</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a><span class="sd">        -------</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a><span class="sd">            DataFrame containing nuclei analysis results for the experiment.</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_nuc_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a><span class="sd">        Save nuclei results as a JSON file with a *.nuc extension.</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a><span class="sd">        The saved data can later be loaded using the `cls.load_nuc_dict()` method.</span>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a><span class="sd">        Parameters</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a><span class="sd">        ----------</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a><span class="sd">        path : str, optional</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a><span class="sd">            Directory where the results will be saved. Default is the current working directory.</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span> <span class="o">+</span> <span class="s2">&quot;.nuc&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data not provided!&quot;</span><span class="p">)</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a><span class="sd">        Save nuclei results for a single project as a CSV file.</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a><span class="sd">        Parameters</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a><span class="sd">        ----------</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a><span class="sd">        path : str, optional</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a><span class="sd">        Save nuclei results with IS data for a single project as a CSV file.</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a><span class="sd">        IS data should have been added via `self.add_IS_data()`.</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a><span class="sd">        Parameters</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a><span class="sd">        ----------</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a><span class="sd">        path : str, optional</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There was nothing to save.&quot;</span><span class="p">)</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a><span class="sd">        Add additional NucleiDataManagement objects from other experiments for concatenation.</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a><span class="sd">        Parameters</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a><span class="sd">        ----------</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a><span class="sd">        data_list : list</span>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a><span class="sd">            List of `NucleiDataManagement` objects from separate experiments to be added.</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>        <span class="n">valid_class</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>                <span class="n">valid_class</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> is invalid type.&quot;</span><span class="p">)</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="n">valid_class</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mutual_experiments_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a><span class="sd">        Retrieve concatenated NucleiDataManagement data from other added experiments.</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a><span class="sd">        Parameters</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a><span class="sd">        ----------</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a><span class="sd">        Returns</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a><span class="sd">        -------</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a><span class="sd">            Concatenated nuclei data (with or without IS data) from all added experiments.</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>            <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>                    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>                        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>                        <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()]</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>                    <span class="p">)</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>                        <span class="s2">&quot;Lack of IS data in some object. Check if the IS data was added to each project.&quot;</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>                    <span class="p">)</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>                <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()]</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>                <span class="p">)</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>            <span class="k">return</span> <span class="n">final_df</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No object to concatenate. Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_mutual_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a><span class="sd">        Save concatenated NucleiDataManagement data from added experiments as a CSV file.</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a><span class="sd">        Parameters</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a><span class="sd">        ----------</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mutual_experiments_data</span><span class="p">(</span><span class="n">inc_is</span><span class="o">=</span><span class="n">inc_is</span><span class="p">)</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>        <span class="n">experimets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">experiment_name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>        <span class="p">]</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>        <span class="n">experimets_names</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimets</span><span class="p">)</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>        <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>        <span class="n">dt</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a><span class="k">class</span><span class="w"> </span><span class="nc">GroupAnalysis</span><span class="p">:</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a><span class="sd">    A class for performing multivariate analysis, dimensionality reduction,</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a><span class="sd">    clustering, and differential feature analysis (DFA) on biological or</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a><span class="sd">    experimental datasets.</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a><span class="sd">    This class provides tools for:</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a><span class="sd">    - Scaling and PCA of input data</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a><span class="sd">    - UMAP embedding and DBSCAN clustering</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a><span class="sd">    - Differential Feature Analysis across groups</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a><span class="sd">    - Proportion analysis and plotting</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a><span class="sd">    - Data selection and merging with metadata</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a><span class="sd">    Attributes</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a><span class="sd">    ----------</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a><span class="sd">    input_data : pd.DataFrame</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a><span class="sd">        The primary dataset containing features for analysis.</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a><span class="sd">    input_metadata : pd.DataFrame</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a><span class="sd">        Metadata corresponding to the input data, including identifiers and group labels.</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a><span class="sd">    tmp_data : pd.DataFrame</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a><span class="sd">        Temporary copy of the input data, used for feature selection and filtering.</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a><span class="sd">    tmp_metadata : pd.DataFrame</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a><span class="sd">        Temporary copy of metadata, used for filtered or subsetted operations.</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a><span class="sd">    scaled_data : np.ndarray or None</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a><span class="sd">        Scaled version of the temporary dataset (`tmp_data`), updated after `data_scale()`.</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a><span class="sd">    PCA_results : np.ndarray or None</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a><span class="sd">        Results of PCA transformation applied on scaled data.</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a><span class="sd">    var_data : np.ndarray or None</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a><span class="sd">        Explained variance ratio from PCA.</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a><span class="sd">    knee_plot : matplotlib.figure.Figure or None</span>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a><span class="sd">        Figure of cumulative explained variance for PCA components.</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a><span class="sd">    UMAP_data : np.ndarray or None</span>
</span><span id="L-3488"><a href="#L-3488"><span class="linenos">3488</span></a><span class="sd">        Embedding results from UMAP dimensionality reduction.</span>
</span><span id="L-3489"><a href="#L-3489"><span class="linenos">3489</span></a>
</span><span id="L-3490"><a href="#L-3490"><span class="linenos">3490</span></a><span class="sd">    UMAP_plot : dict</span>
</span><span id="L-3491"><a href="#L-3491"><span class="linenos">3491</span></a><span class="sd">        Dictionary containing UMAP plots. Keys: &#39;static&#39; (matplotlib) and &#39;html&#39; (plotly).</span>
</span><span id="L-3492"><a href="#L-3492"><span class="linenos">3492</span></a>
</span><span id="L-3493"><a href="#L-3493"><span class="linenos">3493</span></a><span class="sd">    dblabels : list or None</span>
</span><span id="L-3494"><a href="#L-3494"><span class="linenos">3494</span></a><span class="sd">        Cluster labels assigned by DBSCAN after UMAP embedding.</span>
</span><span id="L-3495"><a href="#L-3495"><span class="linenos">3495</span></a>
</span><span id="L-3496"><a href="#L-3496"><span class="linenos">3496</span></a><span class="sd">    explained_variance_ratio : np.ndarray or None</span>
</span><span id="L-3497"><a href="#L-3497"><span class="linenos">3497</span></a><span class="sd">        Explained variance ratio of PCA components.</span>
</span><span id="L-3498"><a href="#L-3498"><span class="linenos">3498</span></a>
</span><span id="L-3499"><a href="#L-3499"><span class="linenos">3499</span></a><span class="sd">    DFA_results : pd.DataFrame or None</span>
</span><span id="L-3500"><a href="#L-3500"><span class="linenos">3500</span></a><span class="sd">        Results of Differential Feature Analysis (DFA).</span>
</span><span id="L-3501"><a href="#L-3501"><span class="linenos">3501</span></a>
</span><span id="L-3502"><a href="#L-3502"><span class="linenos">3502</span></a><span class="sd">    proportion_stats : pd.DataFrame or None</span>
</span><span id="L-3503"><a href="#L-3503"><span class="linenos">3503</span></a><span class="sd">        Statistics from proportion analysis.</span>
</span><span id="L-3504"><a href="#L-3504"><span class="linenos">3504</span></a>
</span><span id="L-3505"><a href="#L-3505"><span class="linenos">3505</span></a><span class="sd">    proportion_plot : matplotlib.figure.Figure or None</span>
</span><span id="L-3506"><a href="#L-3506"><span class="linenos">3506</span></a><span class="sd">        Figure of proportion analysis results.</span>
</span><span id="L-3507"><a href="#L-3507"><span class="linenos">3507</span></a>
</span><span id="L-3508"><a href="#L-3508"><span class="linenos">3508</span></a><span class="sd">    Methods</span>
</span><span id="L-3509"><a href="#L-3509"><span class="linenos">3509</span></a><span class="sd">    -------</span>
</span><span id="L-3510"><a href="#L-3510"><span class="linenos">3510</span></a><span class="sd">    resest_project():</span>
</span><span id="L-3511"><a href="#L-3511"><span class="linenos">3511</span></a><span class="sd">        Reset all temporary and analysis results to initial state.</span>
</span><span id="L-3512"><a href="#L-3512"><span class="linenos">3512</span></a>
</span><span id="L-3513"><a href="#L-3513"><span class="linenos">3513</span></a><span class="sd">    load_data(data, ids_col=&#39;id_name&#39;, set_col=&#39;set&#39;):</span>
</span><span id="L-3514"><a href="#L-3514"><span class="linenos">3514</span></a><span class="sd">        Class method to load data and metadata and initialize the object.</span>
</span><span id="L-3515"><a href="#L-3515"><span class="linenos">3515</span></a>
</span><span id="L-3516"><a href="#L-3516"><span class="linenos">3516</span></a><span class="sd">    groups:</span>
</span><span id="L-3517"><a href="#L-3517"><span class="linenos">3517</span></a><span class="sd">        Property returning available groups in the metadata.</span>
</span><span id="L-3518"><a href="#L-3518"><span class="linenos">3518</span></a>
</span><span id="L-3519"><a href="#L-3519"><span class="linenos">3519</span></a><span class="sd">    get_DFA(), get_PCA(), get_knee_plot(), get_var_data(), get_scaled_data():</span>
</span><span id="L-3520"><a href="#L-3520"><span class="linenos">3520</span></a><span class="sd">        Methods to retrieve previously computed results.</span>
</span><span id="L-3521"><a href="#L-3521"><span class="linenos">3521</span></a>
</span><span id="L-3522"><a href="#L-3522"><span class="linenos">3522</span></a><span class="sd">    UMAP(), db_scan(), UMAP_on_clusters():</span>
</span><span id="L-3523"><a href="#L-3523"><span class="linenos">3523</span></a><span class="sd">        Methods for dimensionality reduction and clustering visualization.</span>
</span><span id="L-3524"><a href="#L-3524"><span class="linenos">3524</span></a>
</span><span id="L-3525"><a href="#L-3525"><span class="linenos">3525</span></a><span class="sd">    DFA(meta_group_by=&#39;sets&#39;, sets={}, n_proc=5):</span>
</span><span id="L-3526"><a href="#L-3526"><span class="linenos">3526</span></a><span class="sd">        Perform Differential Feature Analysis.</span>
</span><span id="L-3527"><a href="#L-3527"><span class="linenos">3527</span></a>
</span><span id="L-3528"><a href="#L-3528"><span class="linenos">3528</span></a><span class="sd">    proportion_analysis(grouping_col=&#39;sets&#39;, val_col=&#39;nuclei_per_img&#39;, ...):</span>
</span><span id="L-3529"><a href="#L-3529"><span class="linenos">3529</span></a><span class="sd">        Perform and plot proportion analysis across groups.</span>
</span><span id="L-3530"><a href="#L-3530"><span class="linenos">3530</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-3531"><a href="#L-3531"><span class="linenos">3531</span></a>
</span><span id="L-3532"><a href="#L-3532"><span class="linenos">3532</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-3533"><a href="#L-3533"><span class="linenos">3533</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3534"><a href="#L-3534"><span class="linenos">3534</span></a>        <span class="n">input_data</span><span class="p">,</span>
</span><span id="L-3535"><a href="#L-3535"><span class="linenos">3535</span></a>        <span class="n">input_metadata</span><span class="p">,</span>
</span><span id="L-3536"><a href="#L-3536"><span class="linenos">3536</span></a>    <span class="p">):</span>
</span><span id="L-3537"><a href="#L-3537"><span class="linenos">3537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3538"><a href="#L-3538"><span class="linenos">3538</span></a><span class="sd">        Initialize a GroupAnalysis instance with data and metadata.</span>
</span><span id="L-3539"><a href="#L-3539"><span class="linenos">3539</span></a>
</span><span id="L-3540"><a href="#L-3540"><span class="linenos">3540</span></a><span class="sd">        Parameters</span>
</span><span id="L-3541"><a href="#L-3541"><span class="linenos">3541</span></a><span class="sd">        ----------</span>
</span><span id="L-3542"><a href="#L-3542"><span class="linenos">3542</span></a><span class="sd">        input_data : pd.DataFrame</span>
</span><span id="L-3543"><a href="#L-3543"><span class="linenos">3543</span></a><span class="sd">            Dataset containing features for analysis. Rows represent samples and columns represent features.</span>
</span><span id="L-3544"><a href="#L-3544"><span class="linenos">3544</span></a>
</span><span id="L-3545"><a href="#L-3545"><span class="linenos">3545</span></a><span class="sd">        input_metadata : pd.DataFrame</span>
</span><span id="L-3546"><a href="#L-3546"><span class="linenos">3546</span></a><span class="sd">            Metadata corresponding to `input_data`, including sample identifiers and group labels.</span>
</span><span id="L-3547"><a href="#L-3547"><span class="linenos">3547</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3548"><a href="#L-3548"><span class="linenos">3548</span></a>
</span><span id="L-3549"><a href="#L-3549"><span class="linenos">3549</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="L-3550"><a href="#L-3550"><span class="linenos">3550</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored input dataset for analysis.&quot;&quot;&quot;</span>
</span><span id="L-3551"><a href="#L-3551"><span class="linenos">3551</span></a>
</span><span id="L-3552"><a href="#L-3552"><span class="linenos">3552</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="L-3553"><a href="#L-3553"><span class="linenos">3553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored metadata associated with `input_data`.&quot;&quot;&quot;</span>
</span><span id="L-3554"><a href="#L-3554"><span class="linenos">3554</span></a>
</span><span id="L-3555"><a href="#L-3555"><span class="linenos">3555</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="L-3556"><a href="#L-3556"><span class="linenos">3556</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_data` used for filtering, selection, or scaling.&quot;&quot;&quot;</span>
</span><span id="L-3557"><a href="#L-3557"><span class="linenos">3557</span></a>
</span><span id="L-3558"><a href="#L-3558"><span class="linenos">3558</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="L-3559"><a href="#L-3559"><span class="linenos">3559</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_metadata` used for filtered operations.&quot;&quot;&quot;</span>
</span><span id="L-3560"><a href="#L-3560"><span class="linenos">3560</span></a>
</span><span id="L-3561"><a href="#L-3561"><span class="linenos">3561</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3562"><a href="#L-3562"><span class="linenos">3562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored scaled version of `tmp_data` after normalization or standardization.&quot;&quot;&quot;</span>
</span><span id="L-3563"><a href="#L-3563"><span class="linenos">3563</span></a>
</span><span id="L-3564"><a href="#L-3564"><span class="linenos">3564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3565"><a href="#L-3565"><span class="linenos">3565</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Stored results of PCA transformation applied on `scaled_data`.&quot;&quot;&quot;</span>
</span><span id="L-3566"><a href="#L-3566"><span class="linenos">3566</span></a>
</span><span id="L-3567"><a href="#L-3567"><span class="linenos">3567</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3568"><a href="#L-3568"><span class="linenos">3568</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotred explained variance ratio for PCA components.&quot;&quot;&quot;</span>
</span><span id="L-3569"><a href="#L-3569"><span class="linenos">3569</span></a>
</span><span id="L-3570"><a href="#L-3570"><span class="linenos">3570</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3571"><a href="#L-3571"><span class="linenos">3571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure showing cumulative explained variance for PCA.&quot;&quot;&quot;</span>
</span><span id="L-3572"><a href="#L-3572"><span class="linenos">3572</span></a>
</span><span id="L-3573"><a href="#L-3573"><span class="linenos">3573</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3574"><a href="#L-3574"><span class="linenos">3574</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored embedding coordinates from UMAP dimensionality reduction.&quot;&quot;&quot;</span>
</span><span id="L-3575"><a href="#L-3575"><span class="linenos">3575</span></a>
</span><span id="L-3576"><a href="#L-3576"><span class="linenos">3576</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-3577"><a href="#L-3577"><span class="linenos">3577</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary containing UMAP plots: &#39;static&#39; (matplotlib) and &#39;html&#39; (plotly).&quot;&quot;&quot;</span>
</span><span id="L-3578"><a href="#L-3578"><span class="linenos">3578</span></a>
</span><span id="L-3579"><a href="#L-3579"><span class="linenos">3579</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3580"><a href="#L-3580"><span class="linenos">3580</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored cluster labels assigned by DBSCAN after UMAP embedding.&quot;&quot;&quot;</span>
</span><span id="L-3581"><a href="#L-3581"><span class="linenos">3581</span></a>
</span><span id="L-3582"><a href="#L-3582"><span class="linenos">3582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3583"><a href="#L-3583"><span class="linenos">3583</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored explained variance ratio of PCA components.&quot;&quot;&quot;</span>
</span><span id="L-3584"><a href="#L-3584"><span class="linenos">3584</span></a>
</span><span id="L-3585"><a href="#L-3585"><span class="linenos">3585</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3586"><a href="#L-3586"><span class="linenos">3586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored Differential Feature Analysis (DFA) results.&quot;&quot;&quot;</span>
</span><span id="L-3587"><a href="#L-3587"><span class="linenos">3587</span></a>
</span><span id="L-3588"><a href="#L-3588"><span class="linenos">3588</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3589"><a href="#L-3589"><span class="linenos">3589</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored statistics from proportion analysis of groups.&quot;&quot;&quot;</span>
</span><span id="L-3590"><a href="#L-3590"><span class="linenos">3590</span></a>
</span><span id="L-3591"><a href="#L-3591"><span class="linenos">3591</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3592"><a href="#L-3592"><span class="linenos">3592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure visualizing proportion analysis results.&quot;&quot;&quot;</span>
</span><span id="L-3593"><a href="#L-3593"><span class="linenos">3593</span></a>
</span><span id="L-3594"><a href="#L-3594"><span class="linenos">3594</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resest_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3595"><a href="#L-3595"><span class="linenos">3595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3596"><a href="#L-3596"><span class="linenos">3596</span></a><span class="sd">        Resets the project state by clearing or reinitializing various attributes.</span>
</span><span id="L-3597"><a href="#L-3597"><span class="linenos">3597</span></a>
</span><span id="L-3598"><a href="#L-3598"><span class="linenos">3598</span></a><span class="sd">        This method resets the following attributes to initial values:</span>
</span><span id="L-3599"><a href="#L-3599"><span class="linenos">3599</span></a><span class="sd">        - `tmp_metadata`</span>
</span><span id="L-3600"><a href="#L-3600"><span class="linenos">3600</span></a><span class="sd">        - `tmp_data`</span>
</span><span id="L-3601"><a href="#L-3601"><span class="linenos">3601</span></a><span class="sd">        - `scaled_data`</span>
</span><span id="L-3602"><a href="#L-3602"><span class="linenos">3602</span></a><span class="sd">        - `PCA_results`</span>
</span><span id="L-3603"><a href="#L-3603"><span class="linenos">3603</span></a><span class="sd">        - `var_data`</span>
</span><span id="L-3604"><a href="#L-3604"><span class="linenos">3604</span></a><span class="sd">        - `knee_plot`</span>
</span><span id="L-3605"><a href="#L-3605"><span class="linenos">3605</span></a><span class="sd">        - `UMAP_data`</span>
</span><span id="L-3606"><a href="#L-3606"><span class="linenos">3606</span></a><span class="sd">        - `UMAP_plot`</span>
</span><span id="L-3607"><a href="#L-3607"><span class="linenos">3607</span></a><span class="sd">        - `dblabels`</span>
</span><span id="L-3608"><a href="#L-3608"><span class="linenos">3608</span></a><span class="sd">        - `explained_variance_ratio`</span>
</span><span id="L-3609"><a href="#L-3609"><span class="linenos">3609</span></a><span class="sd">        - `DFA_results`</span>
</span><span id="L-3610"><a href="#L-3610"><span class="linenos">3610</span></a>
</span><span id="L-3611"><a href="#L-3611"><span class="linenos">3611</span></a><span class="sd">        This method is typically called to reinitialize the project data and results, preparing the system for new computations or project resets.</span>
</span><span id="L-3612"><a href="#L-3612"><span class="linenos">3612</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3613"><a href="#L-3613"><span class="linenos">3613</span></a>
</span><span id="L-3614"><a href="#L-3614"><span class="linenos">3614</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span>
</span><span id="L-3615"><a href="#L-3615"><span class="linenos">3615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span>
</span><span id="L-3616"><a href="#L-3616"><span class="linenos">3616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3617"><a href="#L-3617"><span class="linenos">3617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3618"><a href="#L-3618"><span class="linenos">3618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3619"><a href="#L-3619"><span class="linenos">3619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3620"><a href="#L-3620"><span class="linenos">3620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3621"><a href="#L-3621"><span class="linenos">3621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="L-3622"><a href="#L-3622"><span class="linenos">3622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3623"><a href="#L-3623"><span class="linenos">3623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3624"><a href="#L-3624"><span class="linenos">3624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3625"><a href="#L-3625"><span class="linenos">3625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3626"><a href="#L-3626"><span class="linenos">3626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-3627"><a href="#L-3627"><span class="linenos">3627</span></a>
</span><span id="L-3628"><a href="#L-3628"><span class="linenos">3628</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-3629"><a href="#L-3629"><span class="linenos">3629</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ids_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id_name&quot;</span><span class="p">,</span> <span class="n">set_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;set&quot;</span><span class="p">):</span>
</span><span id="L-3630"><a href="#L-3630"><span class="linenos">3630</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3631"><a href="#L-3631"><span class="linenos">3631</span></a><span class="sd">        Load data and initialize the class by storing both the feature data and metadata.</span>
</span><span id="L-3632"><a href="#L-3632"><span class="linenos">3632</span></a>
</span><span id="L-3633"><a href="#L-3633"><span class="linenos">3633</span></a><span class="sd">        Parameters</span>
</span><span id="L-3634"><a href="#L-3634"><span class="linenos">3634</span></a><span class="sd">        ----------</span>
</span><span id="L-3635"><a href="#L-3635"><span class="linenos">3635</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="L-3636"><a href="#L-3636"><span class="linenos">3636</span></a><span class="sd">            Input dataset used for group analysis. Must contain both feature columns and</span>
</span><span id="L-3637"><a href="#L-3637"><span class="linenos">3637</span></a><span class="sd">            metadata columns specified by `ids_col` and `set_col`.</span>
</span><span id="L-3638"><a href="#L-3638"><span class="linenos">3638</span></a>
</span><span id="L-3639"><a href="#L-3639"><span class="linenos">3639</span></a><span class="sd">        ids_col : str, optional</span>
</span><span id="L-3640"><a href="#L-3640"><span class="linenos">3640</span></a><span class="sd">            Name of the column containing unique object identifiers.</span>
</span><span id="L-3641"><a href="#L-3641"><span class="linenos">3641</span></a><span class="sd">            Default is ``&#39;id_name&#39;``.</span>
</span><span id="L-3642"><a href="#L-3642"><span class="linenos">3642</span></a>
</span><span id="L-3643"><a href="#L-3643"><span class="linenos">3643</span></a><span class="sd">        set_col : str, optional</span>
</span><span id="L-3644"><a href="#L-3644"><span class="linenos">3644</span></a><span class="sd">            Name of the column specifying group or set assignment for each object.</span>
</span><span id="L-3645"><a href="#L-3645"><span class="linenos">3645</span></a><span class="sd">            Default is ``&#39;set&#39;``.</span>
</span><span id="L-3646"><a href="#L-3646"><span class="linenos">3646</span></a>
</span><span id="L-3647"><a href="#L-3647"><span class="linenos">3647</span></a><span class="sd">        Notes</span>
</span><span id="L-3648"><a href="#L-3648"><span class="linenos">3648</span></a><span class="sd">        -----</span>
</span><span id="L-3649"><a href="#L-3649"><span class="linenos">3649</span></a><span class="sd">        This method performs in-place initialization of the class and does not return</span>
</span><span id="L-3650"><a href="#L-3650"><span class="linenos">3650</span></a><span class="sd">        a separate object. All loaded data and metadata become available through the</span>
</span><span id="L-3651"><a href="#L-3651"><span class="linenos">3651</span></a><span class="sd">        class attributes for downstream analysis.</span>
</span><span id="L-3652"><a href="#L-3652"><span class="linenos">3652</span></a>
</span><span id="L-3653"><a href="#L-3653"><span class="linenos">3653</span></a><span class="sd">        This method updates internal class attributes:</span>
</span><span id="L-3654"><a href="#L-3654"><span class="linenos">3654</span></a>
</span><span id="L-3655"><a href="#L-3655"><span class="linenos">3655</span></a><span class="sd">        - **input_data** : pd.DataFrame</span>
</span><span id="L-3656"><a href="#L-3656"><span class="linenos">3656</span></a><span class="sd">          Cleaned feature table with index set to object IDs.</span>
</span><span id="L-3657"><a href="#L-3657"><span class="linenos">3657</span></a>
</span><span id="L-3658"><a href="#L-3658"><span class="linenos">3658</span></a><span class="sd">        - **tmp_data** : pd.DataFrame</span>
</span><span id="L-3659"><a href="#L-3659"><span class="linenos">3659</span></a><span class="sd">          Copy of `input_data` used for temporary operations.</span>
</span><span id="L-3660"><a href="#L-3660"><span class="linenos">3660</span></a>
</span><span id="L-3661"><a href="#L-3661"><span class="linenos">3661</span></a><span class="sd">        - **input_metadata** : pd.DataFrame</span>
</span><span id="L-3662"><a href="#L-3662"><span class="linenos">3662</span></a><span class="sd">          Metadata containing object IDs and group assignments.</span>
</span><span id="L-3663"><a href="#L-3663"><span class="linenos">3663</span></a>
</span><span id="L-3664"><a href="#L-3664"><span class="linenos">3664</span></a><span class="sd">        - **tmp_metadata** : pd.DataFrame</span>
</span><span id="L-3665"><a href="#L-3665"><span class="linenos">3665</span></a><span class="sd">          Copy of `input_metadata` for temporary operations.</span>
</span><span id="L-3666"><a href="#L-3666"><span class="linenos">3666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3667"><a href="#L-3667"><span class="linenos">3667</span></a>
</span><span id="L-3668"><a href="#L-3668"><span class="linenos">3668</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="L-3669"><a href="#L-3669"><span class="linenos">3669</span></a>
</span><span id="L-3670"><a href="#L-3670"><span class="linenos">3670</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="L-3671"><a href="#L-3671"><span class="linenos">3671</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="L-3672"><a href="#L-3672"><span class="linenos">3672</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">set_col</span><span class="p">]</span>
</span><span id="L-3673"><a href="#L-3673"><span class="linenos">3673</span></a>
</span><span id="L-3674"><a href="#L-3674"><span class="linenos">3674</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="L-3675"><a href="#L-3675"><span class="linenos">3675</span></a>
</span><span id="L-3676"><a href="#L-3676"><span class="linenos">3676</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3677"><a href="#L-3677"><span class="linenos">3677</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;id_name&quot;</span><span class="p">)</span>
</span><span id="L-3678"><a href="#L-3678"><span class="linenos">3678</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3679"><a href="#L-3679"><span class="linenos">3679</span></a>            <span class="kc">None</span>
</span><span id="L-3680"><a href="#L-3680"><span class="linenos">3680</span></a>
</span><span id="L-3681"><a href="#L-3681"><span class="linenos">3681</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3682"><a href="#L-3682"><span class="linenos">3682</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Object Number&quot;</span><span class="p">)</span>
</span><span id="L-3683"><a href="#L-3683"><span class="linenos">3683</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3684"><a href="#L-3684"><span class="linenos">3684</span></a>            <span class="kc">None</span>
</span><span id="L-3685"><a href="#L-3685"><span class="linenos">3685</span></a>
</span><span id="L-3686"><a href="#L-3686"><span class="linenos">3686</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span id="L-3687"><a href="#L-3687"><span class="linenos">3687</span></a>
</span><span id="L-3688"><a href="#L-3688"><span class="linenos">3688</span></a>    <span class="nd">@property</span>
</span><span id="L-3689"><a href="#L-3689"><span class="linenos">3689</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3690"><a href="#L-3690"><span class="linenos">3690</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3691"><a href="#L-3691"><span class="linenos">3691</span></a><span class="sd">        Return information about available groups in the metadata for ``self.DFA``.</span>
</span><span id="L-3692"><a href="#L-3692"><span class="linenos">3692</span></a>
</span><span id="L-3693"><a href="#L-3693"><span class="linenos">3693</span></a><span class="sd">        Returns</span>
</span><span id="L-3694"><a href="#L-3694"><span class="linenos">3694</span></a><span class="sd">        -------</span>
</span><span id="L-3695"><a href="#L-3695"><span class="linenos">3695</span></a><span class="sd">        dict</span>
</span><span id="L-3696"><a href="#L-3696"><span class="linenos">3696</span></a><span class="sd">            Dictionary mapping each metadata column name to a list of unique groups</span>
</span><span id="L-3697"><a href="#L-3697"><span class="linenos">3697</span></a><span class="sd">            available in that column.</span>
</span><span id="L-3698"><a href="#L-3698"><span class="linenos">3698</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3699"><a href="#L-3699"><span class="linenos">3699</span></a>
</span><span id="L-3700"><a href="#L-3700"><span class="linenos">3700</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-3701"><a href="#L-3701"><span class="linenos">3701</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-3702"><a href="#L-3702"><span class="linenos">3702</span></a>                <span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]),</span>
</span><span id="L-3703"><a href="#L-3703"><span class="linenos">3703</span></a>                <span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]),</span>
</span><span id="L-3704"><a href="#L-3704"><span class="linenos">3704</span></a>            <span class="p">}</span>
</span><span id="L-3705"><a href="#L-3705"><span class="linenos">3705</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="L-3706"><a href="#L-3706"><span class="linenos">3706</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])}</span>
</span><span id="L-3707"><a href="#L-3707"><span class="linenos">3707</span></a>
</span><span id="L-3708"><a href="#L-3708"><span class="linenos">3708</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3709"><a href="#L-3709"><span class="linenos">3709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3710"><a href="#L-3710"><span class="linenos">3710</span></a><span class="sd">        Retrieve the DFA results produced by the ``DFA()`` method.</span>
</span><span id="L-3711"><a href="#L-3711"><span class="linenos">3711</span></a>
</span><span id="L-3712"><a href="#L-3712"><span class="linenos">3712</span></a><span class="sd">        Returns</span>
</span><span id="L-3713"><a href="#L-3713"><span class="linenos">3713</span></a><span class="sd">        -------</span>
</span><span id="L-3714"><a href="#L-3714"><span class="linenos">3714</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-3715"><a href="#L-3715"><span class="linenos">3715</span></a><span class="sd">            The DFA results stored in ``self.DFA_results``.</span>
</span><span id="L-3716"><a href="#L-3716"><span class="linenos">3716</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3717"><a href="#L-3717"><span class="linenos">3717</span></a>
</span><span id="L-3718"><a href="#L-3718"><span class="linenos">3718</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="p">:</span>
</span><span id="L-3719"><a href="#L-3719"><span class="linenos">3719</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3720"><a href="#L-3720"><span class="linenos">3720</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3721"><a href="#L-3721"><span class="linenos">3721</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span>
</span><span id="L-3722"><a href="#L-3722"><span class="linenos">3722</span></a>
</span><span id="L-3723"><a href="#L-3723"><span class="linenos">3723</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3724"><a href="#L-3724"><span class="linenos">3724</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3725"><a href="#L-3725"><span class="linenos">3725</span></a><span class="sd">        Retrieve the PCA results produced by the ``PCA()`` method.</span>
</span><span id="L-3726"><a href="#L-3726"><span class="linenos">3726</span></a>
</span><span id="L-3727"><a href="#L-3727"><span class="linenos">3727</span></a><span class="sd">        Returns</span>
</span><span id="L-3728"><a href="#L-3728"><span class="linenos">3728</span></a><span class="sd">        -------</span>
</span><span id="L-3729"><a href="#L-3729"><span class="linenos">3729</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-3730"><a href="#L-3730"><span class="linenos">3730</span></a><span class="sd">            The PCA results stored in ``self.PCA_results``.</span>
</span><span id="L-3731"><a href="#L-3731"><span class="linenos">3731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3732"><a href="#L-3732"><span class="linenos">3732</span></a>
</span><span id="L-3733"><a href="#L-3733"><span class="linenos">3733</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="L-3734"><a href="#L-3734"><span class="linenos">3734</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the PCA() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3735"><a href="#L-3735"><span class="linenos">3735</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3736"><a href="#L-3736"><span class="linenos">3736</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span><span id="L-3737"><a href="#L-3737"><span class="linenos">3737</span></a>
</span><span id="L-3738"><a href="#L-3738"><span class="linenos">3738</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_knee_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-3739"><a href="#L-3739"><span class="linenos">3739</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3740"><a href="#L-3740"><span class="linenos">3740</span></a><span class="sd">        Retrieve the knee plot of cumulative explained variance generated by the ``var_plot()`` method.</span>
</span><span id="L-3741"><a href="#L-3741"><span class="linenos">3741</span></a>
</span><span id="L-3742"><a href="#L-3742"><span class="linenos">3742</span></a><span class="sd">        Parameters</span>
</span><span id="L-3743"><a href="#L-3743"><span class="linenos">3743</span></a><span class="sd">        ----------</span>
</span><span id="L-3744"><a href="#L-3744"><span class="linenos">3744</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-3745"><a href="#L-3745"><span class="linenos">3745</span></a><span class="sd">            If ``True`` (default), the knee plot is displayed.</span>
</span><span id="L-3746"><a href="#L-3746"><span class="linenos">3746</span></a>
</span><span id="L-3747"><a href="#L-3747"><span class="linenos">3747</span></a><span class="sd">        Returns</span>
</span><span id="L-3748"><a href="#L-3748"><span class="linenos">3748</span></a><span class="sd">        -------</span>
</span><span id="L-3749"><a href="#L-3749"><span class="linenos">3749</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="L-3750"><a href="#L-3750"><span class="linenos">3750</span></a><span class="sd">            The figure object containing the knee plot.</span>
</span><span id="L-3751"><a href="#L-3751"><span class="linenos">3751</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3752"><a href="#L-3752"><span class="linenos">3752</span></a>
</span><span id="L-3753"><a href="#L-3753"><span class="linenos">3753</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-3754"><a href="#L-3754"><span class="linenos">3754</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3755"><a href="#L-3755"><span class="linenos">3755</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3756"><a href="#L-3756"><span class="linenos">3756</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-3757"><a href="#L-3757"><span class="linenos">3757</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-3758"><a href="#L-3758"><span class="linenos">3758</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span><span id="L-3759"><a href="#L-3759"><span class="linenos">3759</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-3760"><a href="#L-3760"><span class="linenos">3760</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span><span class="p">)</span>
</span><span id="L-3761"><a href="#L-3761"><span class="linenos">3761</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-3762"><a href="#L-3762"><span class="linenos">3762</span></a>                        <span class="kc">None</span>
</span><span id="L-3763"><a href="#L-3763"><span class="linenos">3763</span></a>
</span><span id="L-3764"><a href="#L-3764"><span class="linenos">3764</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span><span id="L-3765"><a href="#L-3765"><span class="linenos">3765</span></a>
</span><span id="L-3766"><a href="#L-3766"><span class="linenos">3766</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_var_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3767"><a href="#L-3767"><span class="linenos">3767</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3768"><a href="#L-3768"><span class="linenos">3768</span></a><span class="sd">        Retrieve the explained variance data from the ``var_plot()`` method.</span>
</span><span id="L-3769"><a href="#L-3769"><span class="linenos">3769</span></a>
</span><span id="L-3770"><a href="#L-3770"><span class="linenos">3770</span></a><span class="sd">        Returns</span>
</span><span id="L-3771"><a href="#L-3771"><span class="linenos">3771</span></a><span class="sd">        -------</span>
</span><span id="L-3772"><a href="#L-3772"><span class="linenos">3772</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-3773"><a href="#L-3773"><span class="linenos">3773</span></a><span class="sd">            Array containing the explained variance values stored in ``self.var_data``.</span>
</span><span id="L-3774"><a href="#L-3774"><span class="linenos">3774</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3775"><a href="#L-3775"><span class="linenos">3775</span></a>
</span><span id="L-3776"><a href="#L-3776"><span class="linenos">3776</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span><span class="p">:</span>
</span><span id="L-3777"><a href="#L-3777"><span class="linenos">3777</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3778"><a href="#L-3778"><span class="linenos">3778</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3779"><a href="#L-3779"><span class="linenos">3779</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span>
</span><span id="L-3780"><a href="#L-3780"><span class="linenos">3780</span></a>
</span><span id="L-3781"><a href="#L-3781"><span class="linenos">3781</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_scaled_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3782"><a href="#L-3782"><span class="linenos">3782</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3783"><a href="#L-3783"><span class="linenos">3783</span></a><span class="sd">        Retrieve the scaled data produced by the ``data_scale()`` method.</span>
</span><span id="L-3784"><a href="#L-3784"><span class="linenos">3784</span></a>
</span><span id="L-3785"><a href="#L-3785"><span class="linenos">3785</span></a><span class="sd">        Returns</span>
</span><span id="L-3786"><a href="#L-3786"><span class="linenos">3786</span></a><span class="sd">        -------</span>
</span><span id="L-3787"><a href="#L-3787"><span class="linenos">3787</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-3788"><a href="#L-3788"><span class="linenos">3788</span></a><span class="sd">            Scaled data stored in ``self.scaled_data``.</span>
</span><span id="L-3789"><a href="#L-3789"><span class="linenos">3789</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3790"><a href="#L-3790"><span class="linenos">3790</span></a>
</span><span id="L-3791"><a href="#L-3791"><span class="linenos">3791</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="L-3792"><a href="#L-3792"><span class="linenos">3792</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the data_scale() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3793"><a href="#L-3793"><span class="linenos">3793</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3794"><a href="#L-3794"><span class="linenos">3794</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span>
</span><span id="L-3795"><a href="#L-3795"><span class="linenos">3795</span></a>
</span><span id="L-3796"><a href="#L-3796"><span class="linenos">3796</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3797"><a href="#L-3797"><span class="linenos">3797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3798"><a href="#L-3798"><span class="linenos">3798</span></a><span class="sd">        Retrieve the UMAP-transformed data generated by the ``UMAP()`` method.</span>
</span><span id="L-3799"><a href="#L-3799"><span class="linenos">3799</span></a>
</span><span id="L-3800"><a href="#L-3800"><span class="linenos">3800</span></a><span class="sd">        Returns</span>
</span><span id="L-3801"><a href="#L-3801"><span class="linenos">3801</span></a><span class="sd">        -------</span>
</span><span id="L-3802"><a href="#L-3802"><span class="linenos">3802</span></a><span class="sd">        np.ndarray</span>
</span><span id="L-3803"><a href="#L-3803"><span class="linenos">3803</span></a><span class="sd">            UMAP-embedded data stored in ``self.UMAP_data``.</span>
</span><span id="L-3804"><a href="#L-3804"><span class="linenos">3804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3805"><a href="#L-3805"><span class="linenos">3805</span></a>
</span><span id="L-3806"><a href="#L-3806"><span class="linenos">3806</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="L-3807"><a href="#L-3807"><span class="linenos">3807</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3808"><a href="#L-3808"><span class="linenos">3808</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3809"><a href="#L-3809"><span class="linenos">3809</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span>
</span><span id="L-3810"><a href="#L-3810"><span class="linenos">3810</span></a>
</span><span id="L-3811"><a href="#L-3811"><span class="linenos">3811</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-3812"><a href="#L-3812"><span class="linenos">3812</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3813"><a href="#L-3813"><span class="linenos">3813</span></a><span class="sd">        Retrieve UMAP plots generated by the ``UMAP()`` and/or ``UMAP_on_clusters()`` methods.</span>
</span><span id="L-3814"><a href="#L-3814"><span class="linenos">3814</span></a>
</span><span id="L-3815"><a href="#L-3815"><span class="linenos">3815</span></a><span class="sd">        Parameters</span>
</span><span id="L-3816"><a href="#L-3816"><span class="linenos">3816</span></a><span class="sd">        ----------</span>
</span><span id="L-3817"><a href="#L-3817"><span class="linenos">3817</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-3818"><a href="#L-3818"><span class="linenos">3818</span></a><span class="sd">            Whether to display the UMAP plots. Default is True.</span>
</span><span id="L-3819"><a href="#L-3819"><span class="linenos">3819</span></a>
</span><span id="L-3820"><a href="#L-3820"><span class="linenos">3820</span></a><span class="sd">        Returns</span>
</span><span id="L-3821"><a href="#L-3821"><span class="linenos">3821</span></a><span class="sd">        -------</span>
</span><span id="L-3822"><a href="#L-3822"><span class="linenos">3822</span></a><span class="sd">        dict of matplotlib.figure.Figure</span>
</span><span id="L-3823"><a href="#L-3823"><span class="linenos">3823</span></a><span class="sd">            A dictionary containing the UMAP plots. Keys correspond to plot names, and values are the figure objects.</span>
</span><span id="L-3824"><a href="#L-3824"><span class="linenos">3824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3825"><a href="#L-3825"><span class="linenos">3825</span></a>
</span><span id="L-3826"><a href="#L-3826"><span class="linenos">3826</span></a>        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="L-3827"><a href="#L-3827"><span class="linenos">3827</span></a>
</span><span id="L-3828"><a href="#L-3828"><span class="linenos">3828</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3829"><a href="#L-3829"><span class="linenos">3829</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3830"><a href="#L-3830"><span class="linenos">3830</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="L-3831"><a href="#L-3831"><span class="linenos">3831</span></a>                <span class="p">)</span>
</span><span id="L-3832"><a href="#L-3832"><span class="linenos">3832</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3833"><a href="#L-3833"><span class="linenos">3833</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-3834"><a href="#L-3834"><span class="linenos">3834</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="L-3835"><a href="#L-3835"><span class="linenos">3835</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3836"><a href="#L-3836"><span class="linenos">3836</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-3837"><a href="#L-3837"><span class="linenos">3837</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-3838"><a href="#L-3838"><span class="linenos">3838</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="L-3839"><a href="#L-3839"><span class="linenos">3839</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="L-3840"><a href="#L-3840"><span class="linenos">3840</span></a>                                <span class="kc">None</span>
</span><span id="L-3841"><a href="#L-3841"><span class="linenos">3841</span></a>
</span><span id="L-3842"><a href="#L-3842"><span class="linenos">3842</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span>
</span><span id="L-3843"><a href="#L-3843"><span class="linenos">3843</span></a>
</span><span id="L-3844"><a href="#L-3844"><span class="linenos">3844</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3845"><a href="#L-3845"><span class="linenos">3845</span></a>
</span><span id="L-3846"><a href="#L-3846"><span class="linenos">3846</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-3847"><a href="#L-3847"><span class="linenos">3847</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3848"><a href="#L-3848"><span class="linenos">3848</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="L-3849"><a href="#L-3849"><span class="linenos">3849</span></a>                <span class="p">)</span>
</span><span id="L-3850"><a href="#L-3850"><span class="linenos">3850</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-3851"><a href="#L-3851"><span class="linenos">3851</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-3852"><a href="#L-3852"><span class="linenos">3852</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="L-3853"><a href="#L-3853"><span class="linenos">3853</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-3854"><a href="#L-3854"><span class="linenos">3854</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-3855"><a href="#L-3855"><span class="linenos">3855</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="L-3856"><a href="#L-3856"><span class="linenos">3856</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="L-3857"><a href="#L-3857"><span class="linenos">3857</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="L-3858"><a href="#L-3858"><span class="linenos">3858</span></a>                                <span class="kc">None</span>
</span><span id="L-3859"><a href="#L-3859"><span class="linenos">3859</span></a>
</span><span id="L-3860"><a href="#L-3860"><span class="linenos">3860</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span>
</span><span id="L-3861"><a href="#L-3861"><span class="linenos">3861</span></a>
</span><span id="L-3862"><a href="#L-3862"><span class="linenos">3862</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="L-3863"><a href="#L-3863"><span class="linenos">3863</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3864"><a href="#L-3864"><span class="linenos">3864</span></a><span class="sd">        Select specific features (columns) from the dataset for further analysis.</span>
</span><span id="L-3865"><a href="#L-3865"><span class="linenos">3865</span></a>
</span><span id="L-3866"><a href="#L-3866"><span class="linenos">3866</span></a><span class="sd">        Parameters</span>
</span><span id="L-3867"><a href="#L-3867"><span class="linenos">3867</span></a><span class="sd">        ----------</span>
</span><span id="L-3868"><a href="#L-3868"><span class="linenos">3868</span></a><span class="sd">        features_list : list of str, optional</span>
</span><span id="L-3869"><a href="#L-3869"><span class="linenos">3869</span></a><span class="sd">            List of feature names (column names) to select from the dataset. Default is an empty list, which selects no features.</span>
</span><span id="L-3870"><a href="#L-3870"><span class="linenos">3870</span></a>
</span><span id="L-3871"><a href="#L-3871"><span class="linenos">3871</span></a><span class="sd">        Notes</span>
</span><span id="L-3872"><a href="#L-3872"><span class="linenos">3872</span></a><span class="sd">        -----</span>
</span><span id="L-3873"><a href="#L-3873"><span class="linenos">3873</span></a><span class="sd">        Modifies the `self.tmp_data` attribute to contain only the selected features from `self.input_data`.</span>
</span><span id="L-3874"><a href="#L-3874"><span class="linenos">3874</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3875"><a href="#L-3875"><span class="linenos">3875</span></a>
</span><span id="L-3876"><a href="#L-3876"><span class="linenos">3876</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-3877"><a href="#L-3877"><span class="linenos">3877</span></a>
</span><span id="L-3878"><a href="#L-3878"><span class="linenos">3878</span></a>        <span class="n">not_in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="L-3879"><a href="#L-3879"><span class="linenos">3879</span></a>
</span><span id="L-3880"><a href="#L-3880"><span class="linenos">3880</span></a>        <span class="k">if</span> <span class="n">not_in_columns</span><span class="p">:</span>
</span><span id="L-3881"><a href="#L-3881"><span class="linenos">3881</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;These names are not in data&quot;</span><span class="p">,</span> <span class="n">not_in_columns</span><span class="p">)</span>
</span><span id="L-3882"><a href="#L-3882"><span class="linenos">3882</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3883"><a href="#L-3883"><span class="linenos">3883</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All names are present in data.&quot;</span><span class="p">)</span>
</span><span id="L-3884"><a href="#L-3884"><span class="linenos">3884</span></a>
</span><span id="L-3885"><a href="#L-3885"><span class="linenos">3885</span></a>        <span class="n">in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="L-3886"><a href="#L-3886"><span class="linenos">3886</span></a>
</span><span id="L-3887"><a href="#L-3887"><span class="linenos">3887</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">in_columns</span><span class="p">]</span>
</span><span id="L-3888"><a href="#L-3888"><span class="linenos">3888</span></a>
</span><span id="L-3889"><a href="#L-3889"><span class="linenos">3889</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">dat</span>
</span><span id="L-3890"><a href="#L-3890"><span class="linenos">3890</span></a>
</span><span id="L-3891"><a href="#L-3891"><span class="linenos">3891</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">data_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3892"><a href="#L-3892"><span class="linenos">3892</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3893"><a href="#L-3893"><span class="linenos">3893</span></a><span class="sd">        Scale the data using standardization (z-score normalization).</span>
</span><span id="L-3894"><a href="#L-3894"><span class="linenos">3894</span></a>
</span><span id="L-3895"><a href="#L-3895"><span class="linenos">3895</span></a><span class="sd">        This method applies `StandardScaler` from scikit-learn to the temporary dataset (`self.tmp_data`) and stores the scaled data.</span>
</span><span id="L-3896"><a href="#L-3896"><span class="linenos">3896</span></a>
</span><span id="L-3897"><a href="#L-3897"><span class="linenos">3897</span></a><span class="sd">        Notes</span>
</span><span id="L-3898"><a href="#L-3898"><span class="linenos">3898</span></a><span class="sd">        -----</span>
</span><span id="L-3899"><a href="#L-3899"><span class="linenos">3899</span></a><span class="sd">        Modifies the `self.scaled_data` attribute to contain the standardized version of `self.tmp_data`.</span>
</span><span id="L-3900"><a href="#L-3900"><span class="linenos">3900</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3901"><a href="#L-3901"><span class="linenos">3901</span></a>
</span><span id="L-3902"><a href="#L-3902"><span class="linenos">3902</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="p">:</span>
</span><span id="L-3903"><a href="#L-3903"><span class="linenos">3903</span></a>
</span><span id="L-3904"><a href="#L-3904"><span class="linenos">3904</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">is_id_column</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-3905"><a href="#L-3905"><span class="linenos">3905</span></a>                <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-3906"><a href="#L-3906"><span class="linenos">3906</span></a>                <span class="k">return</span> <span class="n">name_lower</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span> <span class="ow">or</span> <span class="s2">&quot;id_&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span> <span class="ow">or</span> <span class="s2">&quot;_id&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span>
</span><span id="L-3907"><a href="#L-3907"><span class="linenos">3907</span></a>
</span><span id="L-3908"><a href="#L-3908"><span class="linenos">3908</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="L-3909"><a href="#L-3909"><span class="linenos">3909</span></a>
</span><span id="L-3910"><a href="#L-3910"><span class="linenos">3910</span></a>            <span class="n">cols_with_strings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-3911"><a href="#L-3911"><span class="linenos">3911</span></a>                <span class="n">c</span>
</span><span id="L-3912"><a href="#L-3912"><span class="linenos">3912</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span>
</span><span id="L-3913"><a href="#L-3913"><span class="linenos">3913</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="L-3914"><a href="#L-3914"><span class="linenos">3914</span></a>            <span class="p">]</span>
</span><span id="L-3915"><a href="#L-3915"><span class="linenos">3915</span></a>
</span><span id="L-3916"><a href="#L-3916"><span class="linenos">3916</span></a>            <span class="n">cols_id_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">is_id_column</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
</span><span id="L-3917"><a href="#L-3917"><span class="linenos">3917</span></a>
</span><span id="L-3918"><a href="#L-3918"><span class="linenos">3918</span></a>            <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cols_id_pattern</span> <span class="o">+</span> <span class="n">cols_with_strings</span><span class="p">))</span>
</span><span id="L-3919"><a href="#L-3919"><span class="linenos">3919</span></a>
</span><span id="L-3920"><a href="#L-3920"><span class="linenos">3920</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_drop</span><span class="p">)</span>
</span><span id="L-3921"><a href="#L-3921"><span class="linenos">3921</span></a>
</span><span id="L-3922"><a href="#L-3922"><span class="linenos">3922</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span><span id="L-3923"><a href="#L-3923"><span class="linenos">3923</span></a>
</span><span id="L-3924"><a href="#L-3924"><span class="linenos">3924</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="L-3925"><a href="#L-3925"><span class="linenos">3925</span></a>
</span><span id="L-3926"><a href="#L-3926"><span class="linenos">3926</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3927"><a href="#L-3927"><span class="linenos">3927</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3928"><a href="#L-3928"><span class="linenos">3928</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data to scale. Please use the load_data() method first, and optionally the select_data() method.&quot;</span>
</span><span id="L-3929"><a href="#L-3929"><span class="linenos">3929</span></a>            <span class="p">)</span>
</span><span id="L-3930"><a href="#L-3930"><span class="linenos">3930</span></a>
</span><span id="L-3931"><a href="#L-3931"><span class="linenos">3931</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3932"><a href="#L-3932"><span class="linenos">3932</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3933"><a href="#L-3933"><span class="linenos">3933</span></a><span class="sd">        Perform Principal Component Analysis (PCA) on the scaled data.</span>
</span><span id="L-3934"><a href="#L-3934"><span class="linenos">3934</span></a>
</span><span id="L-3935"><a href="#L-3935"><span class="linenos">3935</span></a><span class="sd">        This method reduces the dimensionality of `self.scaled_data` while retaining the maximum variance.</span>
</span><span id="L-3936"><a href="#L-3936"><span class="linenos">3936</span></a>
</span><span id="L-3937"><a href="#L-3937"><span class="linenos">3937</span></a><span class="sd">        Notes</span>
</span><span id="L-3938"><a href="#L-3938"><span class="linenos">3938</span></a><span class="sd">        -----</span>
</span><span id="L-3939"><a href="#L-3939"><span class="linenos">3939</span></a><span class="sd">        Modifies the `self.PCA_results` attribute with the PCA-transformed data.</span>
</span><span id="L-3940"><a href="#L-3940"><span class="linenos">3940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3941"><a href="#L-3941"><span class="linenos">3941</span></a>
</span><span id="L-3942"><a href="#L-3942"><span class="linenos">3942</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="L-3943"><a href="#L-3943"><span class="linenos">3943</span></a>            <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-3944"><a href="#L-3944"><span class="linenos">3944</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="L-3945"><a href="#L-3945"><span class="linenos">3945</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
</span><span id="L-3946"><a href="#L-3946"><span class="linenos">3946</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3947"><a href="#L-3947"><span class="linenos">3947</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for PCA. Please use the data_scale() method first.&quot;</span><span class="p">)</span>
</span><span id="L-3948"><a href="#L-3948"><span class="linenos">3948</span></a>
</span><span id="L-3949"><a href="#L-3949"><span class="linenos">3949</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">var_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3950"><a href="#L-3950"><span class="linenos">3950</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3951"><a href="#L-3951"><span class="linenos">3951</span></a><span class="sd">        Plot the cumulative explained variance of the principal components from PCA.</span>
</span><span id="L-3952"><a href="#L-3952"><span class="linenos">3952</span></a>
</span><span id="L-3953"><a href="#L-3953"><span class="linenos">3953</span></a><span class="sd">        This method visualizes the cumulative explained variance to help determine how many components capture most of the variance.</span>
</span><span id="L-3954"><a href="#L-3954"><span class="linenos">3954</span></a>
</span><span id="L-3955"><a href="#L-3955"><span class="linenos">3955</span></a><span class="sd">        Notes</span>
</span><span id="L-3956"><a href="#L-3956"><span class="linenos">3956</span></a><span class="sd">        -----</span>
</span><span id="L-3957"><a href="#L-3957"><span class="linenos">3957</span></a><span class="sd">        Stores results in the following attributes:</span>
</span><span id="L-3958"><a href="#L-3958"><span class="linenos">3958</span></a><span class="sd">        - `self.var_data` (np.ndarray): Explained variance ratio for each principal component.</span>
</span><span id="L-3959"><a href="#L-3959"><span class="linenos">3959</span></a><span class="sd">        - `self.knee_plot` (matplotlib.figure.Figure): Figure of the cumulative explained variance plot.</span>
</span><span id="L-3960"><a href="#L-3960"><span class="linenos">3960</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-3961"><a href="#L-3961"><span class="linenos">3961</span></a>
</span><span id="L-3962"><a href="#L-3962"><span class="linenos">3962</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="L-3963"><a href="#L-3963"><span class="linenos">3963</span></a>
</span><span id="L-3964"><a href="#L-3964"><span class="linenos">3964</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="L-3965"><a href="#L-3965"><span class="linenos">3965</span></a>            <span class="n">explained_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span>
</span><span id="L-3966"><a href="#L-3966"><span class="linenos">3966</span></a>
</span><span id="L-3967"><a href="#L-3967"><span class="linenos">3967</span></a>            <span class="n">cumulative_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_var</span><span class="p">)</span>
</span><span id="L-3968"><a href="#L-3968"><span class="linenos">3968</span></a>
</span><span id="L-3969"><a href="#L-3969"><span class="linenos">3969</span></a>            <span class="c1"># Plot the cumulative explained variance as a function of the number of components</span>
</span><span id="L-3970"><a href="#L-3970"><span class="linenos">3970</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span>
</span><span id="L-3971"><a href="#L-3971"><span class="linenos">3971</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Components&quot;</span><span class="p">)</span>
</span><span id="L-3972"><a href="#L-3972"><span class="linenos">3972</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance&quot;</span><span class="p">)</span>
</span><span id="L-3973"><a href="#L-3973"><span class="linenos">3973</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Explained variance of PCs&quot;</span><span class="p">)</span>
</span><span id="L-3974"><a href="#L-3974"><span class="linenos">3974</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-3975"><a href="#L-3975"><span class="linenos">3975</span></a>
</span><span id="L-3976"><a href="#L-3976"><span class="linenos">3976</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="n">explained_var</span>
</span><span id="L-3977"><a href="#L-3977"><span class="linenos">3977</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="L-3978"><a href="#L-3978"><span class="linenos">3978</span></a>
</span><span id="L-3979"><a href="#L-3979"><span class="linenos">3979</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3980"><a href="#L-3980"><span class="linenos">3980</span></a>
</span><span id="L-3981"><a href="#L-3981"><span class="linenos">3981</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-3982"><a href="#L-3982"><span class="linenos">3982</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for variance explanation analysis. Please use the PCA() method first.&quot;</span>
</span><span id="L-3983"><a href="#L-3983"><span class="linenos">3983</span></a>            <span class="p">)</span>
</span><span id="L-3984"><a href="#L-3984"><span class="linenos">3984</span></a>
</span><span id="L-3985"><a href="#L-3985"><span class="linenos">3985</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP</span><span class="p">(</span>
</span><span id="L-3986"><a href="#L-3986"><span class="linenos">3986</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-3987"><a href="#L-3987"><span class="linenos">3987</span></a>        <span class="n">PC_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-3988"><a href="#L-3988"><span class="linenos">3988</span></a>        <span class="n">factorize_with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-3989"><a href="#L-3989"><span class="linenos">3989</span></a>        <span class="n">harmonize_sets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-3990"><a href="#L-3990"><span class="linenos">3990</span></a>        <span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="L-3991"><a href="#L-3991"><span class="linenos">3991</span></a>        <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="L-3992"><a href="#L-3992"><span class="linenos">3992</span></a>        <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="L-3993"><a href="#L-3993"><span class="linenos">3993</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="L-3994"><a href="#L-3994"><span class="linenos">3994</span></a>        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="L-3995"><a href="#L-3995"><span class="linenos">3995</span></a>    <span class="p">):</span>
</span><span id="L-3996"><a href="#L-3996"><span class="linenos">3996</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3997"><a href="#L-3997"><span class="linenos">3997</span></a><span class="sd">         Perform UMAP (Uniform Manifold Approximation and Projection) dimensionality reduction on PCA results.</span>
</span><span id="L-3998"><a href="#L-3998"><span class="linenos">3998</span></a>
</span><span id="L-3999"><a href="#L-3999"><span class="linenos">3999</span></a><span class="sd">         UMAP is applied to the top principal components, optionally using metadata labels to influence the embedding. Generates both 2D/3D embeddings and visualizations.</span>
</span><span id="L-4000"><a href="#L-4000"><span class="linenos">4000</span></a>
</span><span id="L-4001"><a href="#L-4001"><span class="linenos">4001</span></a><span class="sd">         Parameters</span>
</span><span id="L-4002"><a href="#L-4002"><span class="linenos">4002</span></a><span class="sd">         ----------</span>
</span><span id="L-4003"><a href="#L-4003"><span class="linenos">4003</span></a><span class="sd">         PC_num : int, optional</span>
</span><span id="L-4004"><a href="#L-4004"><span class="linenos">4004</span></a><span class="sd">             Number of top principal components to use for UMAP embedding. Default is 5.</span>
</span><span id="L-4005"><a href="#L-4005"><span class="linenos">4005</span></a>
</span><span id="L-4006"><a href="#L-4006"><span class="linenos">4006</span></a><span class="sd">         factorize_with_metadata : bool, optional</span>
</span><span id="L-4007"><a href="#L-4007"><span class="linenos">4007</span></a><span class="sd">             Whether to use metadata (e.g., &#39;sets&#39;) to factorize UMAP embedding. Default is False.</span>
</span><span id="L-4008"><a href="#L-4008"><span class="linenos">4008</span></a>
</span><span id="L-4009"><a href="#L-4009"><span class="linenos">4009</span></a><span class="sd">        harmonize_sets : bool, optional</span>
</span><span id="L-4010"><a href="#L-4010"><span class="linenos">4010</span></a><span class="sd">             If True, applies harmonization across data sets before computing the UMAP embedding.</span>
</span><span id="L-4011"><a href="#L-4011"><span class="linenos">4011</span></a><span class="sd">             Default is True.</span>
</span><span id="L-4012"><a href="#L-4012"><span class="linenos">4012</span></a>
</span><span id="L-4013"><a href="#L-4013"><span class="linenos">4013</span></a><span class="sd">         n_neighbors : int, optional</span>
</span><span id="L-4014"><a href="#L-4014"><span class="linenos">4014</span></a><span class="sd">             Number of neighbors for UMAP to compute local structure. Default is 25.</span>
</span><span id="L-4015"><a href="#L-4015"><span class="linenos">4015</span></a>
</span><span id="L-4016"><a href="#L-4016"><span class="linenos">4016</span></a><span class="sd">         min_dist : float, optional</span>
</span><span id="L-4017"><a href="#L-4017"><span class="linenos">4017</span></a><span class="sd">             Minimum distance between points in the low-dimensional embedding. Default is 0.01.</span>
</span><span id="L-4018"><a href="#L-4018"><span class="linenos">4018</span></a>
</span><span id="L-4019"><a href="#L-4019"><span class="linenos">4019</span></a><span class="sd">         n_components : int, optional</span>
</span><span id="L-4020"><a href="#L-4020"><span class="linenos">4020</span></a><span class="sd">             Number of dimensions for the UMAP embedding. Default is 2.</span>
</span><span id="L-4021"><a href="#L-4021"><span class="linenos">4021</span></a><span class="sd">             </span>
</span><span id="L-4022"><a href="#L-4022"><span class="linenos">4022</span></a><span class="sd">         width : int, optional</span>
</span><span id="L-4023"><a href="#L-4023"><span class="linenos">4023</span></a><span class="sd">             Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="L-4024"><a href="#L-4024"><span class="linenos">4024</span></a><span class="sd">    </span>
</span><span id="L-4025"><a href="#L-4025"><span class="linenos">4025</span></a><span class="sd">         height : int, optional</span>
</span><span id="L-4026"><a href="#L-4026"><span class="linenos">4026</span></a><span class="sd">             Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="L-4027"><a href="#L-4027"><span class="linenos">4027</span></a>
</span><span id="L-4028"><a href="#L-4028"><span class="linenos">4028</span></a><span class="sd">         Notes</span>
</span><span id="L-4029"><a href="#L-4029"><span class="linenos">4029</span></a><span class="sd">         -----</span>
</span><span id="L-4030"><a href="#L-4030"><span class="linenos">4030</span></a><span class="sd">         Stores results in the following attributes:</span>
</span><span id="L-4031"><a href="#L-4031"><span class="linenos">4031</span></a><span class="sd">         - `self.UMAP_data` (np.ndarray): UMAP-transformed data.</span>
</span><span id="L-4032"><a href="#L-4032"><span class="linenos">4032</span></a><span class="sd">         - `self.UMAP_plot[&#39;static&#39;][&#39;PrimaryUMAP&#39;]` (matplotlib.figure.Figure): Static visualization of UMAP embedding.</span>
</span><span id="L-4033"><a href="#L-4033"><span class="linenos">4033</span></a><span class="sd">         - `self.UMAP_plot[&#39;html&#39;][&#39;PrimaryUMAP&#39;]` (plotly.graph_objs.Figure): Interactive Plotly visualization of UMAP embedding.</span>
</span><span id="L-4034"><a href="#L-4034"><span class="linenos">4034</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4035"><a href="#L-4035"><span class="linenos">4035</span></a>
</span><span id="L-4036"><a href="#L-4036"><span class="linenos">4036</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="L-4037"><a href="#L-4037"><span class="linenos">4037</span></a>
</span><span id="L-4038"><a href="#L-4038"><span class="linenos">4038</span></a>            <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
</span><span id="L-4039"><a href="#L-4039"><span class="linenos">4039</span></a>                <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span>
</span><span id="L-4040"><a href="#L-4040"><span class="linenos">4040</span></a>                <span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span>
</span><span id="L-4041"><a href="#L-4041"><span class="linenos">4041</span></a>                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
</span><span id="L-4042"><a href="#L-4042"><span class="linenos">4042</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span><span id="L-4043"><a href="#L-4043"><span class="linenos">4043</span></a>            <span class="p">)</span>
</span><span id="L-4044"><a href="#L-4044"><span class="linenos">4044</span></a>
</span><span id="L-4045"><a href="#L-4045"><span class="linenos">4045</span></a>            <span class="n">pca_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span><span id="L-4046"><a href="#L-4046"><span class="linenos">4046</span></a>
</span><span id="L-4047"><a href="#L-4047"><span class="linenos">4047</span></a>            <span class="k">if</span> <span class="n">harmonize_sets</span><span class="p">:</span>
</span><span id="L-4048"><a href="#L-4048"><span class="linenos">4048</span></a>
</span><span id="L-4049"><a href="#L-4049"><span class="linenos">4049</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pca_res</span><span class="p">)</span>
</span><span id="L-4050"><a href="#L-4050"><span class="linenos">4050</span></a>
</span><span id="L-4051"><a href="#L-4051"><span class="linenos">4051</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="L-4052"><a href="#L-4052"><span class="linenos">4052</span></a>                    <span class="n">harmonize</span><span class="o">.</span><span class="n">run_harmony</span><span class="p">(</span>
</span><span id="L-4053"><a href="#L-4053"><span class="linenos">4053</span></a>                        <span class="n">pca_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span><span class="p">,</span> <span class="n">vars_use</span><span class="o">=</span><span class="s2">&quot;sets&quot;</span>
</span><span id="L-4054"><a href="#L-4054"><span class="linenos">4054</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">Z_corr</span>
</span><span id="L-4055"><a href="#L-4055"><span class="linenos">4055</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-4056"><a href="#L-4056"><span class="linenos">4056</span></a>
</span><span id="L-4057"><a href="#L-4057"><span class="linenos">4057</span></a>            <span class="k">if</span> <span class="n">factorize_with_metadata</span><span class="p">:</span>
</span><span id="L-4058"><a href="#L-4058"><span class="linenos">4058</span></a>                <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">codes</span>
</span><span id="L-4059"><a href="#L-4059"><span class="linenos">4059</span></a>
</span><span id="L-4060"><a href="#L-4060"><span class="linenos">4060</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
</span><span id="L-4061"><a href="#L-4061"><span class="linenos">4061</span></a>                    <span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">numeric_labels</span>
</span><span id="L-4062"><a href="#L-4062"><span class="linenos">4062</span></a>                <span class="p">)</span>
</span><span id="L-4063"><a href="#L-4063"><span class="linenos">4063</span></a>
</span><span id="L-4064"><a href="#L-4064"><span class="linenos">4064</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4065"><a href="#L-4065"><span class="linenos">4065</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-4066"><a href="#L-4066"><span class="linenos">4066</span></a>
</span><span id="L-4067"><a href="#L-4067"><span class="linenos">4067</span></a>            <span class="n">umap_result_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">umap_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-4068"><a href="#L-4068"><span class="linenos">4068</span></a>
</span><span id="L-4069"><a href="#L-4069"><span class="linenos">4069</span></a>            <span class="n">umap_result_plot</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span>
</span><span id="L-4070"><a href="#L-4070"><span class="linenos">4070</span></a>
</span><span id="L-4071"><a href="#L-4071"><span class="linenos">4071</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</span><span id="L-4072"><a href="#L-4072"><span class="linenos">4072</span></a>
</span><span id="L-4073"><a href="#L-4073"><span class="linenos">4073</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-4074"><a href="#L-4074"><span class="linenos">4074</span></a>
</span><span id="L-4075"><a href="#L-4075"><span class="linenos">4075</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="n">umap_result</span>
</span><span id="L-4076"><a href="#L-4076"><span class="linenos">4076</span></a>
</span><span id="L-4077"><a href="#L-4077"><span class="linenos">4077</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="L-4078"><a href="#L-4078"><span class="linenos">4078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="L-4079"><a href="#L-4079"><span class="linenos">4079</span></a>
</span><span id="L-4080"><a href="#L-4080"><span class="linenos">4080</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4081"><a href="#L-4081"><span class="linenos">4081</span></a>
</span><span id="L-4082"><a href="#L-4082"><span class="linenos">4082</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for UMAP. Please use the PCA() method first.&quot;</span><span class="p">)</span>
</span><span id="L-4083"><a href="#L-4083"><span class="linenos">4083</span></a>
</span><span id="L-4084"><a href="#L-4084"><span class="linenos">4084</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">db_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-4085"><a href="#L-4085"><span class="linenos">4085</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4086"><a href="#L-4086"><span class="linenos">4086</span></a><span class="sd">        Perform DBSCAN clustering on UMAP-transformed data.</span>
</span><span id="L-4087"><a href="#L-4087"><span class="linenos">4087</span></a>
</span><span id="L-4088"><a href="#L-4088"><span class="linenos">4088</span></a><span class="sd">        DBSCAN identifies clusters based on density, labeling points in dense regions as clusters and others as noise.</span>
</span><span id="L-4089"><a href="#L-4089"><span class="linenos">4089</span></a>
</span><span id="L-4090"><a href="#L-4090"><span class="linenos">4090</span></a><span class="sd">        Parameters</span>
</span><span id="L-4091"><a href="#L-4091"><span class="linenos">4091</span></a><span class="sd">        ----------</span>
</span><span id="L-4092"><a href="#L-4092"><span class="linenos">4092</span></a><span class="sd">        eps : float, optional</span>
</span><span id="L-4093"><a href="#L-4093"><span class="linenos">4093</span></a><span class="sd">            Maximum distance between two points to be considered neighbors. Default is 0.5.</span>
</span><span id="L-4094"><a href="#L-4094"><span class="linenos">4094</span></a>
</span><span id="L-4095"><a href="#L-4095"><span class="linenos">4095</span></a><span class="sd">        min_samples : int, optional</span>
</span><span id="L-4096"><a href="#L-4096"><span class="linenos">4096</span></a><span class="sd">            Minimum number of points required to form a dense region (cluster). Default is 10.</span>
</span><span id="L-4097"><a href="#L-4097"><span class="linenos">4097</span></a>
</span><span id="L-4098"><a href="#L-4098"><span class="linenos">4098</span></a><span class="sd">        Notes</span>
</span><span id="L-4099"><a href="#L-4099"><span class="linenos">4099</span></a><span class="sd">        -----</span>
</span><span id="L-4100"><a href="#L-4100"><span class="linenos">4100</span></a><span class="sd">        Stores the results in the following attribute:</span>
</span><span id="L-4101"><a href="#L-4101"><span class="linenos">4101</span></a><span class="sd">        - `self.dblabels` (list of str): Cluster labels assigned by DBSCAN for each point in the UMAP embedding.</span>
</span><span id="L-4102"><a href="#L-4102"><span class="linenos">4102</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4103"><a href="#L-4103"><span class="linenos">4103</span></a>
</span><span id="L-4104"><a href="#L-4104"><span class="linenos">4104</span></a>
</span><span id="L-4105"><a href="#L-4105"><span class="linenos">4105</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="L-4106"><a href="#L-4106"><span class="linenos">4106</span></a>
</span><span id="L-4107"><a href="#L-4107"><span class="linenos">4107</span></a>            <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">)</span>
</span><span id="L-4108"><a href="#L-4108"><span class="linenos">4108</span></a>            <span class="n">dbscan_labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">)</span>
</span><span id="L-4109"><a href="#L-4109"><span class="linenos">4109</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dbscan_labels</span><span class="p">]</span>
</span><span id="L-4110"><a href="#L-4110"><span class="linenos">4110</span></a>
</span><span id="L-4111"><a href="#L-4111"><span class="linenos">4111</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4112"><a href="#L-4112"><span class="linenos">4112</span></a>
</span><span id="L-4113"><a href="#L-4113"><span class="linenos">4113</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for DBSCAN. Please use the UMAP() method first.&quot;</span><span class="p">)</span>
</span><span id="L-4114"><a href="#L-4114"><span class="linenos">4114</span></a>
</span><span id="L-4115"><a href="#L-4115"><span class="linenos">4115</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP_on_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_entities</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="L-4116"><a href="#L-4116"><span class="linenos">4116</span></a>                         <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="L-4117"><a href="#L-4117"><span class="linenos">4117</span></a>                         <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="L-4118"><a href="#L-4118"><span class="linenos">4118</span></a>                         <span class="n">n_per_col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="L-4119"><a href="#L-4119"><span class="linenos">4119</span></a>                         <span class="p">):</span>
</span><span id="L-4120"><a href="#L-4120"><span class="linenos">4120</span></a><span class="w">        </span>
</span><span id="L-4121"><a href="#L-4121"><span class="linenos">4121</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4122"><a href="#L-4122"><span class="linenos">4122</span></a><span class="sd">        Generate UMAP visualizations for clusters filtered by a minimum entity threshold.</span>
</span><span id="L-4123"><a href="#L-4123"><span class="linenos">4123</span></a><span class="sd">    </span>
</span><span id="L-4124"><a href="#L-4124"><span class="linenos">4124</span></a><span class="sd">        This method removes clusters containing fewer than `min_entities` observations</span>
</span><span id="L-4125"><a href="#L-4125"><span class="linenos">4125</span></a><span class="sd">        and produces two UMAP visualizations:</span>
</span><span id="L-4126"><a href="#L-4126"><span class="linenos">4126</span></a><span class="sd">    </span>
</span><span id="L-4127"><a href="#L-4127"><span class="linenos">4127</span></a><span class="sd">        1. **Cluster UMAP** – points colored by cluster assignment only.</span>
</span><span id="L-4128"><a href="#L-4128"><span class="linenos">4128</span></a><span class="sd">        2. **Cluster × Set UMAP** – points colored by the combination of cluster and set identifier.</span>
</span><span id="L-4129"><a href="#L-4129"><span class="linenos">4129</span></a><span class="sd">    </span>
</span><span id="L-4130"><a href="#L-4130"><span class="linenos">4130</span></a><span class="sd">        Parameters</span>
</span><span id="L-4131"><a href="#L-4131"><span class="linenos">4131</span></a><span class="sd">        ----------</span>
</span><span id="L-4132"><a href="#L-4132"><span class="linenos">4132</span></a><span class="sd">        min_entities : int, optional</span>
</span><span id="L-4133"><a href="#L-4133"><span class="linenos">4133</span></a><span class="sd">            Minimum number of entities required for a cluster to be included</span>
</span><span id="L-4134"><a href="#L-4134"><span class="linenos">4134</span></a><span class="sd">            in the visualization. Default is 50.</span>
</span><span id="L-4135"><a href="#L-4135"><span class="linenos">4135</span></a><span class="sd">    </span>
</span><span id="L-4136"><a href="#L-4136"><span class="linenos">4136</span></a><span class="sd">        width : int, optional</span>
</span><span id="L-4137"><a href="#L-4137"><span class="linenos">4137</span></a><span class="sd">            Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="L-4138"><a href="#L-4138"><span class="linenos">4138</span></a><span class="sd">    </span>
</span><span id="L-4139"><a href="#L-4139"><span class="linenos">4139</span></a><span class="sd">        height : int, optional</span>
</span><span id="L-4140"><a href="#L-4140"><span class="linenos">4140</span></a><span class="sd">            Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="L-4141"><a href="#L-4141"><span class="linenos">4141</span></a><span class="sd">    </span>
</span><span id="L-4142"><a href="#L-4142"><span class="linenos">4142</span></a><span class="sd">        n_per_col : int, optional</span>
</span><span id="L-4143"><a href="#L-4143"><span class="linenos">4143</span></a><span class="sd">            Maximum number of legend entries per column. Default is 20.</span>
</span><span id="L-4144"><a href="#L-4144"><span class="linenos">4144</span></a>
</span><span id="L-4145"><a href="#L-4145"><span class="linenos">4145</span></a><span class="sd">        Notes</span>
</span><span id="L-4146"><a href="#L-4146"><span class="linenos">4146</span></a><span class="sd">        -----</span>
</span><span id="L-4147"><a href="#L-4147"><span class="linenos">4147</span></a><span class="sd">        This method updates the following attributes:</span>
</span><span id="L-4148"><a href="#L-4148"><span class="linenos">4148</span></a><span class="sd">    </span>
</span><span id="L-4149"><a href="#L-4149"><span class="linenos">4149</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="L-4150"><a href="#L-4150"><span class="linenos">4150</span></a><span class="sd">          Static matplotlib figure of the filtered cluster-only UMAP.</span>
</span><span id="L-4151"><a href="#L-4151"><span class="linenos">4151</span></a><span class="sd">    </span>
</span><span id="L-4152"><a href="#L-4152"><span class="linenos">4152</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="L-4153"><a href="#L-4153"><span class="linenos">4153</span></a><span class="sd">          Interactive HTML version of the cluster-only UMAP.</span>
</span><span id="L-4154"><a href="#L-4154"><span class="linenos">4154</span></a><span class="sd">    </span>
</span><span id="L-4155"><a href="#L-4155"><span class="linenos">4155</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="L-4156"><a href="#L-4156"><span class="linenos">4156</span></a><span class="sd">          Static matplotlib figure showing clusters combined with set identifiers.</span>
</span><span id="L-4157"><a href="#L-4157"><span class="linenos">4157</span></a><span class="sd">    </span>
</span><span id="L-4158"><a href="#L-4158"><span class="linenos">4158</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="L-4159"><a href="#L-4159"><span class="linenos">4159</span></a><span class="sd">          Interactive HTML version of the cluster × set visualization.</span>
</span><span id="L-4160"><a href="#L-4160"><span class="linenos">4160</span></a><span class="sd">    </span>
</span><span id="L-4161"><a href="#L-4161"><span class="linenos">4161</span></a><span class="sd">        - `self.tmp_data`  </span>
</span><span id="L-4162"><a href="#L-4162"><span class="linenos">4162</span></a><span class="sd">          Dataset filtered to include only clusters meeting the `min_entities` threshold.</span>
</span><span id="L-4163"><a href="#L-4163"><span class="linenos">4163</span></a><span class="sd">    </span>
</span><span id="L-4164"><a href="#L-4164"><span class="linenos">4164</span></a><span class="sd">        - `self.tmp_metadata`  </span>
</span><span id="L-4165"><a href="#L-4165"><span class="linenos">4165</span></a><span class="sd">          Metadata corresponding to the filtered dataset.</span>
</span><span id="L-4166"><a href="#L-4166"><span class="linenos">4166</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4167"><a href="#L-4167"><span class="linenos">4167</span></a>
</span><span id="L-4168"><a href="#L-4168"><span class="linenos">4168</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="L-4169"><a href="#L-4169"><span class="linenos">4169</span></a>            
</span><span id="L-4170"><a href="#L-4170"><span class="linenos">4170</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_data_old&quot;</span><span class="p">):</span>
</span><span id="L-4171"><a href="#L-4171"><span class="linenos">4171</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span>
</span><span id="L-4172"><a href="#L-4172"><span class="linenos">4172</span></a>            
</span><span id="L-4173"><a href="#L-4173"><span class="linenos">4173</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_metadata_old&quot;</span><span class="p">):</span>
</span><span id="L-4174"><a href="#L-4174"><span class="linenos">4174</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span>
</span><span id="L-4175"><a href="#L-4175"><span class="linenos">4175</span></a>    
</span><span id="L-4176"><a href="#L-4176"><span class="linenos">4176</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-4177"><a href="#L-4177"><span class="linenos">4177</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-4178"><a href="#L-4178"><span class="linenos">4178</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="L-4179"><a href="#L-4179"><span class="linenos">4179</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span><span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="L-4180"><a href="#L-4180"><span class="linenos">4180</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4181"><a href="#L-4181"><span class="linenos">4181</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="L-4182"><a href="#L-4182"><span class="linenos">4182</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="L-4183"><a href="#L-4183"><span class="linenos">4183</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4184"><a href="#L-4184"><span class="linenos">4184</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="L-4185"><a href="#L-4185"><span class="linenos">4185</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="L-4186"><a href="#L-4186"><span class="linenos">4186</span></a>
</span><span id="L-4187"><a href="#L-4187"><span class="linenos">4187</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span><span class="p">)</span>
</span><span id="L-4188"><a href="#L-4188"><span class="linenos">4188</span></a>
</span><span id="L-4189"><a href="#L-4189"><span class="linenos">4189</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="L-4190"><a href="#L-4190"><span class="linenos">4190</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="L-4191"><a href="#L-4191"><span class="linenos">4191</span></a>            <span class="p">)</span>
</span><span id="L-4192"><a href="#L-4192"><span class="linenos">4192</span></a>
</span><span id="L-4193"><a href="#L-4193"><span class="linenos">4193</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="L-4194"><a href="#L-4194"><span class="linenos">4194</span></a>
</span><span id="L-4195"><a href="#L-4195"><span class="linenos">4195</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-4196"><a href="#L-4196"><span class="linenos">4196</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="L-4197"><a href="#L-4197"><span class="linenos">4197</span></a>            <span class="p">)</span>
</span><span id="L-4198"><a href="#L-4198"><span class="linenos">4198</span></a>
</span><span id="L-4199"><a href="#L-4199"><span class="linenos">4199</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="L-4200"><a href="#L-4200"><span class="linenos">4200</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">])</span>
</span><span id="L-4201"><a href="#L-4201"><span class="linenos">4201</span></a>
</span><span id="L-4202"><a href="#L-4202"><span class="linenos">4202</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="L-4203"><a href="#L-4203"><span class="linenos">4203</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-4204"><a href="#L-4204"><span class="linenos">4204</span></a>            <span class="p">]</span>
</span><span id="L-4205"><a href="#L-4205"><span class="linenos">4205</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="L-4206"><a href="#L-4206"><span class="linenos">4206</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-4207"><a href="#L-4207"><span class="linenos">4207</span></a>            <span class="p">]</span>
</span><span id="L-4208"><a href="#L-4208"><span class="linenos">4208</span></a>            
</span><span id="L-4209"><a href="#L-4209"><span class="linenos">4209</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="L-4210"><a href="#L-4210"><span class="linenos">4210</span></a>            
</span><span id="L-4211"><a href="#L-4211"><span class="linenos">4211</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]))]</span>
</span><span id="L-4212"><a href="#L-4212"><span class="linenos">4212</span></a>
</span><span id="L-4213"><a href="#L-4213"><span class="linenos">4213</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="L-4214"><a href="#L-4214"><span class="linenos">4214</span></a>
</span><span id="L-4215"><a href="#L-4215"><span class="linenos">4215</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-4216"><a href="#L-4216"><span class="linenos">4216</span></a>
</span><span id="L-4217"><a href="#L-4217"><span class="linenos">4217</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="L-4218"><a href="#L-4218"><span class="linenos">4218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="L-4219"><a href="#L-4219"><span class="linenos">4219</span></a>
</span><span id="L-4220"><a href="#L-4220"><span class="linenos">4220</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="L-4221"><a href="#L-4221"><span class="linenos">4221</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="L-4222"><a href="#L-4222"><span class="linenos">4222</span></a>            <span class="p">)</span>
</span><span id="L-4223"><a href="#L-4223"><span class="linenos">4223</span></a>
</span><span id="L-4224"><a href="#L-4224"><span class="linenos">4224</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]))</span>
</span><span id="L-4225"><a href="#L-4225"><span class="linenos">4225</span></a>
</span><span id="L-4226"><a href="#L-4226"><span class="linenos">4226</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="L-4227"><a href="#L-4227"><span class="linenos">4227</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="L-4228"><a href="#L-4228"><span class="linenos">4228</span></a>            <span class="p">)</span>
</span><span id="L-4229"><a href="#L-4229"><span class="linenos">4229</span></a>
</span><span id="L-4230"><a href="#L-4230"><span class="linenos">4230</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="L-4231"><a href="#L-4231"><span class="linenos">4231</span></a>
</span><span id="L-4232"><a href="#L-4232"><span class="linenos">4232</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span>
</span><span id="L-4233"><a href="#L-4233"><span class="linenos">4233</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">])</span>
</span><span id="L-4234"><a href="#L-4234"><span class="linenos">4234</span></a>
</span><span id="L-4235"><a href="#L-4235"><span class="linenos">4235</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="L-4236"><a href="#L-4236"><span class="linenos">4236</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-4237"><a href="#L-4237"><span class="linenos">4237</span></a>            <span class="p">]</span>
</span><span id="L-4238"><a href="#L-4238"><span class="linenos">4238</span></a>
</span><span id="L-4239"><a href="#L-4239"><span class="linenos">4239</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="L-4240"><a href="#L-4240"><span class="linenos">4240</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="L-4241"><a href="#L-4241"><span class="linenos">4241</span></a>            <span class="p">]</span>
</span><span id="L-4242"><a href="#L-4242"><span class="linenos">4242</span></a>
</span><span id="L-4243"><a href="#L-4243"><span class="linenos">4243</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
</span><span id="L-4244"><a href="#L-4244"><span class="linenos">4244</span></a>
</span><span id="L-4245"><a href="#L-4245"><span class="linenos">4245</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="L-4246"><a href="#L-4246"><span class="linenos">4246</span></a>
</span><span id="L-4247"><a href="#L-4247"><span class="linenos">4247</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-4248"><a href="#L-4248"><span class="linenos">4248</span></a>
</span><span id="L-4249"><a href="#L-4249"><span class="linenos">4249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="L-4250"><a href="#L-4250"><span class="linenos">4250</span></a>
</span><span id="L-4251"><a href="#L-4251"><span class="linenos">4251</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="L-4252"><a href="#L-4252"><span class="linenos">4252</span></a>            
</span><span id="L-4253"><a href="#L-4253"><span class="linenos">4253</span></a>            
</span><span id="L-4254"><a href="#L-4254"><span class="linenos">4254</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="L-4255"><a href="#L-4255"><span class="linenos">4255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span>
</span><span id="L-4256"><a href="#L-4256"><span class="linenos">4256</span></a>            
</span><span id="L-4257"><a href="#L-4257"><span class="linenos">4257</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span>
</span><span id="L-4258"><a href="#L-4258"><span class="linenos">4258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span>
</span><span id="L-4259"><a href="#L-4259"><span class="linenos">4259</span></a>            
</span><span id="L-4260"><a href="#L-4260"><span class="linenos">4260</span></a>            
</span><span id="L-4261"><a href="#L-4261"><span class="linenos">4261</span></a>
</span><span id="L-4262"><a href="#L-4262"><span class="linenos">4262</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4263"><a href="#L-4263"><span class="linenos">4263</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-4264"><a href="#L-4264"><span class="linenos">4264</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for visualization. Please use the UMAP() and db_scan() methods first.&quot;</span>
</span><span id="L-4265"><a href="#L-4265"><span class="linenos">4265</span></a>            <span class="p">)</span>
</span><span id="L-4266"><a href="#L-4266"><span class="linenos">4266</span></a>
</span><span id="L-4267"><a href="#L-4267"><span class="linenos">4267</span></a>    <span class="c1">## save data</span>
</span><span id="L-4268"><a href="#L-4268"><span class="linenos">4268</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-4269"><a href="#L-4269"><span class="linenos">4269</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4270"><a href="#L-4270"><span class="linenos">4270</span></a><span class="sd">        Merge data with metadata based on the &#39;full_id&#39; column.</span>
</span><span id="L-4271"><a href="#L-4271"><span class="linenos">4271</span></a>
</span><span id="L-4272"><a href="#L-4272"><span class="linenos">4272</span></a><span class="sd">        This method combines `self.tmp_data` and `self.tmp_metadata` into a single DataFrame if the metadata contains a &#39;full_id&#39; column. If &#39;full_id&#39; is not present, the method prints a warning to complete the preprocessing pipeline.</span>
</span><span id="L-4273"><a href="#L-4273"><span class="linenos">4273</span></a>
</span><span id="L-4274"><a href="#L-4274"><span class="linenos">4274</span></a><span class="sd">        Returns</span>
</span><span id="L-4275"><a href="#L-4275"><span class="linenos">4275</span></a><span class="sd">        -------</span>
</span><span id="L-4276"><a href="#L-4276"><span class="linenos">4276</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="L-4277"><a href="#L-4277"><span class="linenos">4277</span></a><span class="sd">            Merged DataFrame containing both data and metadata if &#39;full_id&#39; exists; otherwise, None.</span>
</span><span id="L-4278"><a href="#L-4278"><span class="linenos">4278</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4279"><a href="#L-4279"><span class="linenos">4279</span></a>
</span><span id="L-4280"><a href="#L-4280"><span class="linenos">4280</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4281"><a href="#L-4281"><span class="linenos">4281</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4282"><a href="#L-4282"><span class="linenos">4282</span></a>
</span><span id="L-4283"><a href="#L-4283"><span class="linenos">4283</span></a>        <span class="k">if</span> <span class="s2">&quot;full_id&quot;</span> <span class="ow">in</span> <span class="n">tmp_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-4284"><a href="#L-4284"><span class="linenos">4284</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="L-4285"><a href="#L-4285"><span class="linenos">4285</span></a>
</span><span id="L-4286"><a href="#L-4286"><span class="linenos">4286</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="L-4287"><a href="#L-4287"><span class="linenos">4287</span></a>                <span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;full_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="L-4288"><a href="#L-4288"><span class="linenos">4288</span></a>            <span class="p">)</span>
</span><span id="L-4289"><a href="#L-4289"><span class="linenos">4289</span></a>
</span><span id="L-4290"><a href="#L-4290"><span class="linenos">4290</span></a>            <span class="k">return</span> <span class="n">merged_df</span>
</span><span id="L-4291"><a href="#L-4291"><span class="linenos">4291</span></a>
</span><span id="L-4292"><a href="#L-4292"><span class="linenos">4292</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4293"><a href="#L-4293"><span class="linenos">4293</span></a>
</span><span id="L-4294"><a href="#L-4294"><span class="linenos">4294</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metadata is not completed!&quot;</span><span class="p">)</span>
</span><span id="L-4295"><a href="#L-4295"><span class="linenos">4295</span></a>
</span><span id="L-4296"><a href="#L-4296"><span class="linenos">4296</span></a>        <span class="c1">#################################################################################</span>
</span><span id="L-4297"><a href="#L-4297"><span class="linenos">4297</span></a>
</span><span id="L-4298"><a href="#L-4298"><span class="linenos">4298</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_group_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">n_proc</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-4299"><a href="#L-4299"><span class="linenos">4299</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4300"><a href="#L-4300"><span class="linenos">4300</span></a><span class="sd">        Perform Differential Feature Analysis (DFA) on specified data groups.</span>
</span><span id="L-4301"><a href="#L-4301"><span class="linenos">4301</span></a>
</span><span id="L-4302"><a href="#L-4302"><span class="linenos">4302</span></a><span class="sd">        This method conducts DFA using a grouping factor from metadata and a dictionary of sets for comparison. It allows for the identification of significant differences across defined sets.</span>
</span><span id="L-4303"><a href="#L-4303"><span class="linenos">4303</span></a>
</span><span id="L-4304"><a href="#L-4304"><span class="linenos">4304</span></a><span class="sd">        The analysis includes:</span>
</span><span id="L-4305"><a href="#L-4305"><span class="linenos">4305</span></a><span class="sd">        - Mann–Whitney U test</span>
</span><span id="L-4306"><a href="#L-4306"><span class="linenos">4306</span></a><span class="sd">        - Percentage of non-zero values</span>
</span><span id="L-4307"><a href="#L-4307"><span class="linenos">4307</span></a><span class="sd">        - Means and standard deviations</span>
</span><span id="L-4308"><a href="#L-4308"><span class="linenos">4308</span></a><span class="sd">        - Effect size metric (ESM)</span>
</span><span id="L-4309"><a href="#L-4309"><span class="linenos">4309</span></a><span class="sd">        - Benjamini–Hochberg FDR correction</span>
</span><span id="L-4310"><a href="#L-4310"><span class="linenos">4310</span></a><span class="sd">        - Fold-change and log2 fold-change</span>
</span><span id="L-4311"><a href="#L-4311"><span class="linenos">4311</span></a>
</span><span id="L-4312"><a href="#L-4312"><span class="linenos">4312</span></a><span class="sd">        Parameters</span>
</span><span id="L-4313"><a href="#L-4313"><span class="linenos">4313</span></a><span class="sd">        ----------</span>
</span><span id="L-4314"><a href="#L-4314"><span class="linenos">4314</span></a><span class="sd">        meta_group_by : str, optional</span>
</span><span id="L-4315"><a href="#L-4315"><span class="linenos">4315</span></a><span class="sd">            Metadata column used for grouping during the analysis.</span>
</span><span id="L-4316"><a href="#L-4316"><span class="linenos">4316</span></a><span class="sd">            Default is ``&#39;sets&#39;``.</span>
</span><span id="L-4317"><a href="#L-4317"><span class="linenos">4317</span></a><span class="sd">            To view available grouping categories, use ``self.groups``.</span>
</span><span id="L-4318"><a href="#L-4318"><span class="linenos">4318</span></a>
</span><span id="L-4319"><a href="#L-4319"><span class="linenos">4319</span></a><span class="sd">        sets : dict, optional</span>
</span><span id="L-4320"><a href="#L-4320"><span class="linenos">4320</span></a><span class="sd">            Dictionary defining groups for pairwise comparison.</span>
</span><span id="L-4321"><a href="#L-4321"><span class="linenos">4321</span></a><span class="sd">            Keys correspond to group names, and values are lists of labels</span>
</span><span id="L-4322"><a href="#L-4322"><span class="linenos">4322</span></a><span class="sd">            belonging to each group.</span>
</span><span id="L-4323"><a href="#L-4323"><span class="linenos">4323</span></a>
</span><span id="L-4324"><a href="#L-4324"><span class="linenos">4324</span></a><span class="sd">            Example</span>
</span><span id="L-4325"><a href="#L-4325"><span class="linenos">4325</span></a><span class="sd">            -------</span>
</span><span id="L-4326"><a href="#L-4326"><span class="linenos">4326</span></a><span class="sd">            &gt;&gt;&gt; sets = {</span>
</span><span id="L-4327"><a href="#L-4327"><span class="linenos">4327</span></a><span class="sd">            ...     &#39;healthy&#39;: [&#39;21q&#39;],</span>
</span><span id="L-4328"><a href="#L-4328"><span class="linenos">4328</span></a><span class="sd">            ...     &#39;disease&#39;: [&#39;71q&#39;, &#39;77q&#39;, &#39;109q&#39;]</span>
</span><span id="L-4329"><a href="#L-4329"><span class="linenos">4329</span></a><span class="sd">            ... }</span>
</span><span id="L-4330"><a href="#L-4330"><span class="linenos">4330</span></a><span class="sd">            In this configuration, the *healthy* group is compared against the</span>
</span><span id="L-4331"><a href="#L-4331"><span class="linenos">4331</span></a><span class="sd">            aggregated *disease* groups.</span>
</span><span id="L-4332"><a href="#L-4332"><span class="linenos">4332</span></a>
</span><span id="L-4333"><a href="#L-4333"><span class="linenos">4333</span></a><span class="sd">        n_proc : int, optional</span>
</span><span id="L-4334"><a href="#L-4334"><span class="linenos">4334</span></a><span class="sd">            Number of CPU cores used for parallel processing.</span>
</span><span id="L-4335"><a href="#L-4335"><span class="linenos">4335</span></a><span class="sd">            Default is ``5``.</span>
</span><span id="L-4336"><a href="#L-4336"><span class="linenos">4336</span></a>
</span><span id="L-4337"><a href="#L-4337"><span class="linenos">4337</span></a><span class="sd">        Returns</span>
</span><span id="L-4338"><a href="#L-4338"><span class="linenos">4338</span></a><span class="sd">        -------</span>
</span><span id="L-4339"><a href="#L-4339"><span class="linenos">4339</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="L-4340"><a href="#L-4340"><span class="linenos">4340</span></a><span class="sd">            A DataFrame containing statistical results for each feature, including:</span>
</span><span id="L-4341"><a href="#L-4341"><span class="linenos">4341</span></a>
</span><span id="L-4342"><a href="#L-4342"><span class="linenos">4342</span></a><span class="sd">            - ``feature`` : str</span>
</span><span id="L-4343"><a href="#L-4343"><span class="linenos">4343</span></a><span class="sd">            - ``p_val`` : float</span>
</span><span id="L-4344"><a href="#L-4344"><span class="linenos">4344</span></a><span class="sd">            - ``adj_pval`` : float</span>
</span><span id="L-4345"><a href="#L-4345"><span class="linenos">4345</span></a><span class="sd">            - ``pct_valid`` : float</span>
</span><span id="L-4346"><a href="#L-4346"><span class="linenos">4346</span></a><span class="sd">            - ``pct_ctrl`` : float</span>
</span><span id="L-4347"><a href="#L-4347"><span class="linenos">4347</span></a><span class="sd">            - ``avg_valid`` : float</span>
</span><span id="L-4348"><a href="#L-4348"><span class="linenos">4348</span></a><span class="sd">            - ``avg_ctrl`` : float</span>
</span><span id="L-4349"><a href="#L-4349"><span class="linenos">4349</span></a><span class="sd">            - ``sd_valid`` : float</span>
</span><span id="L-4350"><a href="#L-4350"><span class="linenos">4350</span></a><span class="sd">            - ``sd_ctrl`` : float</span>
</span><span id="L-4351"><a href="#L-4351"><span class="linenos">4351</span></a><span class="sd">            - ``esm`` : float</span>
</span><span id="L-4352"><a href="#L-4352"><span class="linenos">4352</span></a><span class="sd">            - ``FC`` : float</span>
</span><span id="L-4353"><a href="#L-4353"><span class="linenos">4353</span></a><span class="sd">            - ``log(FC)`` : float</span>
</span><span id="L-4354"><a href="#L-4354"><span class="linenos">4354</span></a><span class="sd">            - ``norm_diff`` : float</span>
</span><span id="L-4355"><a href="#L-4355"><span class="linenos">4355</span></a><span class="sd">            - ``valid_group`` : str</span>
</span><span id="L-4356"><a href="#L-4356"><span class="linenos">4356</span></a><span class="sd">            - ``-log(p_val)`` : float</span>
</span><span id="L-4357"><a href="#L-4357"><span class="linenos">4357</span></a>
</span><span id="L-4358"><a href="#L-4358"><span class="linenos">4358</span></a><span class="sd">            If ``sets`` is ``None``, results for each group are concatenated.</span>
</span><span id="L-4359"><a href="#L-4359"><span class="linenos">4359</span></a>
</span><span id="L-4360"><a href="#L-4360"><span class="linenos">4360</span></a><span class="sd">            Returns ``None`` in case of errors or invalid parameters.</span>
</span><span id="L-4361"><a href="#L-4361"><span class="linenos">4361</span></a>
</span><span id="L-4362"><a href="#L-4362"><span class="linenos">4362</span></a><span class="sd">        Notes</span>
</span><span id="L-4363"><a href="#L-4363"><span class="linenos">4363</span></a><span class="sd">        -----</span>
</span><span id="L-4364"><a href="#L-4364"><span class="linenos">4364</span></a><span class="sd">        - Columns containing only zeros are automatically removed.</span>
</span><span id="L-4365"><a href="#L-4365"><span class="linenos">4365</span></a><span class="sd">        - p-values equal for both groups produce ``p_val = 1``.</span>
</span><span id="L-4366"><a href="#L-4366"><span class="linenos">4366</span></a><span class="sd">        - Benjamini–Hochberg correction is applied separately within each group comparison.</span>
</span><span id="L-4367"><a href="#L-4367"><span class="linenos">4367</span></a><span class="sd">        - Fold-change is stabilized using a small, data-derived ``low_factor``.</span>
</span><span id="L-4368"><a href="#L-4368"><span class="linenos">4368</span></a><span class="sd">        - Uses ``Mann–Whitney U`` test with ``alternative=&#39;two-sided&#39;``.</span>
</span><span id="L-4369"><a href="#L-4369"><span class="linenos">4369</span></a>
</span><span id="L-4370"><a href="#L-4370"><span class="linenos">4370</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4371"><a href="#L-4371"><span class="linenos">4371</span></a>
</span><span id="L-4372"><a href="#L-4372"><span class="linenos">4372</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4373"><a href="#L-4373"><span class="linenos">4373</span></a>
</span><span id="L-4374"><a href="#L-4374"><span class="linenos">4374</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span>
</span><span id="L-4375"><a href="#L-4375"><span class="linenos">4375</span></a>
</span><span id="L-4376"><a href="#L-4376"><span class="linenos">4376</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4377"><a href="#L-4377"><span class="linenos">4377</span></a>
</span><span id="L-4378"><a href="#L-4378"><span class="linenos">4378</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-4379"><a href="#L-4379"><span class="linenos">4379</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on provided sets dictionary and meta_group_by...&quot;</span><span class="p">)</span>
</span><span id="L-4380"><a href="#L-4380"><span class="linenos">4380</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="L-4381"><a href="#L-4381"><span class="linenos">4381</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="L-4382"><a href="#L-4382"><span class="linenos">4382</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="L-4383"><a href="#L-4383"><span class="linenos">4383</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="n">sets</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="L-4384"><a href="#L-4384"><span class="linenos">4384</span></a>            <span class="p">)</span>
</span><span id="L-4385"><a href="#L-4385"><span class="linenos">4385</span></a>
</span><span id="L-4386"><a href="#L-4386"><span class="linenos">4386</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4387"><a href="#L-4387"><span class="linenos">4387</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-4388"><a href="#L-4388"><span class="linenos">4388</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on for all groups to each other in meta_group_by...&quot;</span>
</span><span id="L-4389"><a href="#L-4389"><span class="linenos">4389</span></a>            <span class="p">)</span>
</span><span id="L-4390"><a href="#L-4390"><span class="linenos">4390</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="L-4391"><a href="#L-4391"><span class="linenos">4391</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="L-4392"><a href="#L-4392"><span class="linenos">4392</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="L-4393"><a href="#L-4393"><span class="linenos">4393</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="L-4394"><a href="#L-4394"><span class="linenos">4394</span></a>            <span class="p">)</span>
</span><span id="L-4395"><a href="#L-4395"><span class="linenos">4395</span></a>
</span><span id="L-4396"><a href="#L-4396"><span class="linenos">4396</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="n">results</span>
</span><span id="L-4397"><a href="#L-4397"><span class="linenos">4397</span></a>
</span><span id="L-4398"><a href="#L-4398"><span class="linenos">4398</span></a>    
</span><span id="L-4399"><a href="#L-4399"><span class="linenos">4399</span></a>
</span><span id="L-4400"><a href="#L-4400"><span class="linenos">4400</span></a>
</span><span id="L-4401"><a href="#L-4401"><span class="linenos">4401</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heatmap_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-4402"><a href="#L-4402"><span class="linenos">4402</span></a>                    <span class="n">p_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
</span><span id="L-4403"><a href="#L-4403"><span class="linenos">4403</span></a>                    <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-4404"><a href="#L-4404"><span class="linenos">4404</span></a>                    <span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-4405"><a href="#L-4405"><span class="linenos">4405</span></a>                    <span class="n">clustering</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span>
</span><span id="L-4406"><a href="#L-4406"><span class="linenos">4406</span></a>                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
</span><span id="L-4407"><a href="#L-4407"><span class="linenos">4407</span></a><span class="w">        </span>
</span><span id="L-4408"><a href="#L-4408"><span class="linenos">4408</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4409"><a href="#L-4409"><span class="linenos">4409</span></a><span class="sd">        Generate a heatmap of the top DFA features filtered by p-value and log fold change.</span>
</span><span id="L-4410"><a href="#L-4410"><span class="linenos">4410</span></a><span class="sd">    </span>
</span><span id="L-4411"><a href="#L-4411"><span class="linenos">4411</span></a><span class="sd">        Parameters</span>
</span><span id="L-4412"><a href="#L-4412"><span class="linenos">4412</span></a><span class="sd">        ----------</span>
</span><span id="L-4413"><a href="#L-4413"><span class="linenos">4413</span></a><span class="sd">        p_value : float or int, optional</span>
</span><span id="L-4414"><a href="#L-4414"><span class="linenos">4414</span></a><span class="sd">            Significance threshold used to filter features by their p-value.</span>
</span><span id="L-4415"><a href="#L-4415"><span class="linenos">4415</span></a><span class="sd">            Only features with p_val &lt; p_value are included. Default is 0.05.</span>
</span><span id="L-4416"><a href="#L-4416"><span class="linenos">4416</span></a><span class="sd">    </span>
</span><span id="L-4417"><a href="#L-4417"><span class="linenos">4417</span></a><span class="sd">        top_n : int, optional</span>
</span><span id="L-4418"><a href="#L-4418"><span class="linenos">4418</span></a><span class="sd">            Number of top features selected per group based on the &#39;esm&#39; score.</span>
</span><span id="L-4419"><a href="#L-4419"><span class="linenos">4419</span></a><span class="sd">            Default is 5.</span>
</span><span id="L-4420"><a href="#L-4420"><span class="linenos">4420</span></a><span class="sd">    </span>
</span><span id="L-4421"><a href="#L-4421"><span class="linenos">4421</span></a><span class="sd">        scale : bool, optional</span>
</span><span id="L-4422"><a href="#L-4422"><span class="linenos">4422</span></a><span class="sd">            Whether to apply Min–Max scaling to heatmap values across features.</span>
</span><span id="L-4423"><a href="#L-4423"><span class="linenos">4423</span></a><span class="sd">            Default is False.</span>
</span><span id="L-4424"><a href="#L-4424"><span class="linenos">4424</span></a><span class="sd">    </span>
</span><span id="L-4425"><a href="#L-4425"><span class="linenos">4425</span></a><span class="sd">        clustering : str or None, optional</span>
</span><span id="L-4426"><a href="#L-4426"><span class="linenos">4426</span></a><span class="sd">            Hierarchical clustering method applied to rows/columns of the heatmap.</span>
</span><span id="L-4427"><a href="#L-4427"><span class="linenos">4427</span></a><span class="sd">            If None, clustering is disabled. Default is &#39;ward&#39;.</span>
</span><span id="L-4428"><a href="#L-4428"><span class="linenos">4428</span></a><span class="sd">    </span>
</span><span id="L-4429"><a href="#L-4429"><span class="linenos">4429</span></a><span class="sd">        figsize : tuple, optional</span>
</span><span id="L-4430"><a href="#L-4430"><span class="linenos">4430</span></a><span class="sd">            Size of the resulting matplotlib figure. Default is (10, 5).</span>
</span><span id="L-4431"><a href="#L-4431"><span class="linenos">4431</span></a><span class="sd">    </span>
</span><span id="L-4432"><a href="#L-4432"><span class="linenos">4432</span></a><span class="sd">        Notes</span>
</span><span id="L-4433"><a href="#L-4433"><span class="linenos">4433</span></a><span class="sd">        -----</span>
</span><span id="L-4434"><a href="#L-4434"><span class="linenos">4434</span></a><span class="sd">        - Only features with a positive log fold change (&#39;log(FC)&#39; &gt; 0) are considered.</span>
</span><span id="L-4435"><a href="#L-4435"><span class="linenos">4435</span></a><span class="sd">        - Heatmap values represent -log10(p_value) for visualization.</span>
</span><span id="L-4436"><a href="#L-4436"><span class="linenos">4436</span></a><span class="sd">        - If `scale=True`, values are normalized using Min–Max scaling.</span>
</span><span id="L-4437"><a href="#L-4437"><span class="linenos">4437</span></a><span class="sd">        - The generated figure is displayed and stored in `self.DFA_plot`.</span>
</span><span id="L-4438"><a href="#L-4438"><span class="linenos">4438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4439"><a href="#L-4439"><span class="linenos">4439</span></a>
</span><span id="L-4440"><a href="#L-4440"><span class="linenos">4440</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4441"><a href="#L-4441"><span class="linenos">4441</span></a>
</span><span id="L-4442"><a href="#L-4442"><span class="linenos">4442</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;log(FC)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-4443"><a href="#L-4443"><span class="linenos">4443</span></a>
</span><span id="L-4444"><a href="#L-4444"><span class="linenos">4444</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p_value</span><span class="p">]</span>
</span><span id="L-4445"><a href="#L-4445"><span class="linenos">4445</span></a>
</span><span id="L-4446"><a href="#L-4446"><span class="linenos">4446</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-4447"><a href="#L-4447"><span class="linenos">4447</span></a>            <span class="n">df_reduced</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="s2">&quot;esm&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="L-4448"><a href="#L-4448"><span class="linenos">4448</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-4449"><a href="#L-4449"><span class="linenos">4449</span></a>            <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>
</span><span id="L-4450"><a href="#L-4450"><span class="linenos">4450</span></a>        <span class="p">)</span>
</span><span id="L-4451"><a href="#L-4451"><span class="linenos">4451</span></a>
</span><span id="L-4452"><a href="#L-4452"><span class="linenos">4452</span></a>        <span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;-log(p_value)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">])</span>
</span><span id="L-4453"><a href="#L-4453"><span class="linenos">4453</span></a>
</span><span id="L-4454"><a href="#L-4454"><span class="linenos">4454</span></a>        <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
</span><span id="L-4455"><a href="#L-4455"><span class="linenos">4455</span></a>            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;-log(p_value)&quot;</span>
</span><span id="L-4456"><a href="#L-4456"><span class="linenos">4456</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-4457"><a href="#L-4457"><span class="linenos">4457</span></a>
</span><span id="L-4458"><a href="#L-4458"><span class="linenos">4458</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;-log10(p_value)&quot;</span>
</span><span id="L-4459"><a href="#L-4459"><span class="linenos">4459</span></a>        
</span><span id="L-4460"><a href="#L-4460"><span class="linenos">4460</span></a>        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
</span><span id="L-4461"><a href="#L-4461"><span class="linenos">4461</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;scaled(</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="L-4462"><a href="#L-4462"><span class="linenos">4462</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
</span><span id="L-4463"><a href="#L-4463"><span class="linenos">4463</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="L-4464"><a href="#L-4464"><span class="linenos">4464</span></a>                <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">),</span>
</span><span id="L-4465"><a href="#L-4465"><span class="linenos">4465</span></a>                <span class="n">index</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="L-4466"><a href="#L-4466"><span class="linenos">4466</span></a>                <span class="n">columns</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="L-4467"><a href="#L-4467"><span class="linenos">4467</span></a>            <span class="p">)</span>
</span><span id="L-4468"><a href="#L-4468"><span class="linenos">4468</span></a>            
</span><span id="L-4469"><a href="#L-4469"><span class="linenos">4469</span></a>        <span class="k">if</span> <span class="n">clustering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4470"><a href="#L-4470"><span class="linenos">4470</span></a>            <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="L-4471"><a href="#L-4471"><span class="linenos">4471</span></a>            <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="L-4472"><a href="#L-4472"><span class="linenos">4472</span></a>    
</span><span id="L-4473"><a href="#L-4473"><span class="linenos">4473</span></a>            <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="L-4474"><a href="#L-4474"><span class="linenos">4474</span></a>            <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="L-4475"><a href="#L-4475"><span class="linenos">4475</span></a>    
</span><span id="L-4476"><a href="#L-4476"><span class="linenos">4476</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="L-4477"><a href="#L-4477"><span class="linenos">4477</span></a>
</span><span id="L-4478"><a href="#L-4478"><span class="linenos">4478</span></a>
</span><span id="L-4479"><a href="#L-4479"><span class="linenos">4479</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="L-4480"><a href="#L-4480"><span class="linenos">4480</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
</span><span id="L-4481"><a href="#L-4481"><span class="linenos">4481</span></a>            <span class="n">heatmap_data</span><span class="p">,</span>
</span><span id="L-4482"><a href="#L-4482"><span class="linenos">4482</span></a>            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="L-4483"><a href="#L-4483"><span class="linenos">4483</span></a>            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="L-4484"><a href="#L-4484"><span class="linenos">4484</span></a>            <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="L-4485"><a href="#L-4485"><span class="linenos">4485</span></a>            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">},</span>
</span><span id="L-4486"><a href="#L-4486"><span class="linenos">4486</span></a>            <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
</span><span id="L-4487"><a href="#L-4487"><span class="linenos">4487</span></a>        <span class="p">)</span>
</span><span id="L-4488"><a href="#L-4488"><span class="linenos">4488</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">)</span>
</span><span id="L-4489"><a href="#L-4489"><span class="linenos">4489</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)</span>
</span><span id="L-4490"><a href="#L-4490"><span class="linenos">4490</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="L-4491"><a href="#L-4491"><span class="linenos">4491</span></a>
</span><span id="L-4492"><a href="#L-4492"><span class="linenos">4492</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-4493"><a href="#L-4493"><span class="linenos">4493</span></a>
</span><span id="L-4494"><a href="#L-4494"><span class="linenos">4494</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-4495"><a href="#L-4495"><span class="linenos">4495</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="L-4496"><a href="#L-4496"><span class="linenos">4496</span></a>
</span><span id="L-4497"><a href="#L-4497"><span class="linenos">4497</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="o">=</span> <span class="n">figure</span>
</span><span id="L-4498"><a href="#L-4498"><span class="linenos">4498</span></a>
</span><span id="L-4499"><a href="#L-4499"><span class="linenos">4499</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-4500"><a href="#L-4500"><span class="linenos">4500</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4501"><a href="#L-4501"><span class="linenos">4501</span></a><span class="sd">        Retrieve the heatmap figure generated by `heatmap_DFA()`.</span>
</span><span id="L-4502"><a href="#L-4502"><span class="linenos">4502</span></a>
</span><span id="L-4503"><a href="#L-4503"><span class="linenos">4503</span></a><span class="sd">        Parameters</span>
</span><span id="L-4504"><a href="#L-4504"><span class="linenos">4504</span></a><span class="sd">        ----------</span>
</span><span id="L-4505"><a href="#L-4505"><span class="linenos">4505</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-4506"><a href="#L-4506"><span class="linenos">4506</span></a><span class="sd">            Whether to display the stored heatmap figure. Default is True.</span>
</span><span id="L-4507"><a href="#L-4507"><span class="linenos">4507</span></a>
</span><span id="L-4508"><a href="#L-4508"><span class="linenos">4508</span></a><span class="sd">        Returns</span>
</span><span id="L-4509"><a href="#L-4509"><span class="linenos">4509</span></a><span class="sd">        -------</span>
</span><span id="L-4510"><a href="#L-4510"><span class="linenos">4510</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="L-4511"><a href="#L-4511"><span class="linenos">4511</span></a><span class="sd">            The figure object containing the DFA heatmap.</span>
</span><span id="L-4512"><a href="#L-4512"><span class="linenos">4512</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4513"><a href="#L-4513"><span class="linenos">4513</span></a>
</span><span id="L-4514"><a href="#L-4514"><span class="linenos">4514</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4515"><a href="#L-4515"><span class="linenos">4515</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the heatmap_DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="L-4516"><a href="#L-4516"><span class="linenos">4516</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4517"><a href="#L-4517"><span class="linenos">4517</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-4518"><a href="#L-4518"><span class="linenos">4518</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-4519"><a href="#L-4519"><span class="linenos">4519</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span><span id="L-4520"><a href="#L-4520"><span class="linenos">4520</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-4521"><a href="#L-4521"><span class="linenos">4521</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span><span class="p">)</span>
</span><span id="L-4522"><a href="#L-4522"><span class="linenos">4522</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-4523"><a href="#L-4523"><span class="linenos">4523</span></a>                        <span class="kc">None</span>
</span><span id="L-4524"><a href="#L-4524"><span class="linenos">4524</span></a>
</span><span id="L-4525"><a href="#L-4525"><span class="linenos">4525</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span><span id="L-4526"><a href="#L-4526"><span class="linenos">4526</span></a>
</span><span id="L-4527"><a href="#L-4527"><span class="linenos">4527</span></a>       
</span><span id="L-4528"><a href="#L-4528"><span class="linenos">4528</span></a>
</span><span id="L-4529"><a href="#L-4529"><span class="linenos">4529</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_avaiable_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-4530"><a href="#L-4530"><span class="linenos">4530</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4531"><a href="#L-4531"><span class="linenos">4531</span></a><span class="sd">        Print the available features (columns) in the current dataset.</span>
</span><span id="L-4532"><a href="#L-4532"><span class="linenos">4532</span></a>
</span><span id="L-4533"><a href="#L-4533"><span class="linenos">4533</span></a><span class="sd">        This method lists all column names in `self.tmp_data` to help identify which features are available for analysis.</span>
</span><span id="L-4534"><a href="#L-4534"><span class="linenos">4534</span></a>
</span><span id="L-4535"><a href="#L-4535"><span class="linenos">4535</span></a><span class="sd">        Example</span>
</span><span id="L-4536"><a href="#L-4536"><span class="linenos">4536</span></a><span class="sd">        -------</span>
</span><span id="L-4537"><a href="#L-4537"><span class="linenos">4537</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.print_avaiable_features()</span>
</span><span id="L-4538"><a href="#L-4538"><span class="linenos">4538</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4539"><a href="#L-4539"><span class="linenos">4539</span></a>
</span><span id="L-4540"><a href="#L-4540"><span class="linenos">4540</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Avaiable features:&quot;</span><span class="p">)</span>
</span><span id="L-4541"><a href="#L-4541"><span class="linenos">4541</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="L-4542"><a href="#L-4542"><span class="linenos">4542</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="L-4543"><a href="#L-4543"><span class="linenos">4543</span></a>
</span><span id="L-4544"><a href="#L-4544"><span class="linenos">4544</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">proportion_analysis</span><span class="p">(</span>
</span><span id="L-4545"><a href="#L-4545"><span class="linenos">4545</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-4546"><a href="#L-4546"><span class="linenos">4546</span></a>        <span class="n">grouping_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span>
</span><span id="L-4547"><a href="#L-4547"><span class="linenos">4547</span></a>        <span class="n">val_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;nuclei_per_img&quot;</span><span class="p">,</span>
</span><span id="L-4548"><a href="#L-4548"><span class="linenos">4548</span></a>        <span class="n">grouping_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-4549"><a href="#L-4549"><span class="linenos">4549</span></a>        <span class="n">omit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-4550"><a href="#L-4550"><span class="linenos">4550</span></a>    <span class="p">):</span>
</span><span id="L-4551"><a href="#L-4551"><span class="linenos">4551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4552"><a href="#L-4552"><span class="linenos">4552</span></a><span class="sd">        Perform proportion analysis by comparing the distribution of values across groups.</span>
</span><span id="L-4553"><a href="#L-4553"><span class="linenos">4553</span></a>
</span><span id="L-4554"><a href="#L-4554"><span class="linenos">4554</span></a><span class="sd">        This method analyzes the distribution of values (e.g., nuclei counts) across different groups defined in the dataset. It can optionally group categories, omit specific values, and produces both statistical results and a visualization.</span>
</span><span id="L-4555"><a href="#L-4555"><span class="linenos">4555</span></a>
</span><span id="L-4556"><a href="#L-4556"><span class="linenos">4556</span></a><span class="sd">        Parameters</span>
</span><span id="L-4557"><a href="#L-4557"><span class="linenos">4557</span></a><span class="sd">        ----------</span>
</span><span id="L-4558"><a href="#L-4558"><span class="linenos">4558</span></a><span class="sd">        grouping_col : str, optional</span>
</span><span id="L-4559"><a href="#L-4559"><span class="linenos">4559</span></a><span class="sd">            Column to group by. Default is &#39;sets&#39;.</span>
</span><span id="L-4560"><a href="#L-4560"><span class="linenos">4560</span></a>
</span><span id="L-4561"><a href="#L-4561"><span class="linenos">4561</span></a><span class="sd">        val_col : str, optional</span>
</span><span id="L-4562"><a href="#L-4562"><span class="linenos">4562</span></a><span class="sd">            Column containing the values to analyze. Default is &#39;nuclei_per_img&#39;.</span>
</span><span id="L-4563"><a href="#L-4563"><span class="linenos">4563</span></a>
</span><span id="L-4564"><a href="#L-4564"><span class="linenos">4564</span></a><span class="sd">        grouping_dict : dict or None, optional</span>
</span><span id="L-4565"><a href="#L-4565"><span class="linenos">4565</span></a><span class="sd">            Dictionary mapping new group names to categories in `grouping_col`. If None, analysis is based on the original groups.</span>
</span><span id="L-4566"><a href="#L-4566"><span class="linenos">4566</span></a>
</span><span id="L-4567"><a href="#L-4567"><span class="linenos">4567</span></a><span class="sd">        omit : str, list, or None, optional</span>
</span><span id="L-4568"><a href="#L-4568"><span class="linenos">4568</span></a><span class="sd">            Values to exclude from the analysis. Default is None.</span>
</span><span id="L-4569"><a href="#L-4569"><span class="linenos">4569</span></a>
</span><span id="L-4570"><a href="#L-4570"><span class="linenos">4570</span></a><span class="sd">        Attributes</span>
</span><span id="L-4571"><a href="#L-4571"><span class="linenos">4571</span></a><span class="sd">        ----------</span>
</span><span id="L-4572"><a href="#L-4572"><span class="linenos">4572</span></a><span class="sd">        proportion_stats : pd.DataFrame</span>
</span><span id="L-4573"><a href="#L-4573"><span class="linenos">4573</span></a><span class="sd">            DataFrame containing chi-square test results for pairwise group comparisons.</span>
</span><span id="L-4574"><a href="#L-4574"><span class="linenos">4574</span></a>
</span><span id="L-4575"><a href="#L-4575"><span class="linenos">4575</span></a><span class="sd">        proportion_plot : matplotlib.figure.Figure</span>
</span><span id="L-4576"><a href="#L-4576"><span class="linenos">4576</span></a><span class="sd">            Plot visualizing the proportions across groups.</span>
</span><span id="L-4577"><a href="#L-4577"><span class="linenos">4577</span></a>
</span><span id="L-4578"><a href="#L-4578"><span class="linenos">4578</span></a><span class="sd">        Example</span>
</span><span id="L-4579"><a href="#L-4579"><span class="linenos">4579</span></a><span class="sd">        -------</span>
</span><span id="L-4580"><a href="#L-4580"><span class="linenos">4580</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.proportion_analysis(</span>
</span><span id="L-4581"><a href="#L-4581"><span class="linenos">4581</span></a><span class="sd">        ...     grouping_col=&#39;sets&#39;,</span>
</span><span id="L-4582"><a href="#L-4582"><span class="linenos">4582</span></a><span class="sd">        ...     val_col=&#39;nuclei_per_img&#39;,</span>
</span><span id="L-4583"><a href="#L-4583"><span class="linenos">4583</span></a><span class="sd">        ...     grouping_dict={&#39;Group A&#39;: [1, 2], &#39;Group B&#39;: [3, 4]},</span>
</span><span id="L-4584"><a href="#L-4584"><span class="linenos">4584</span></a><span class="sd">        ...     omit=5</span>
</span><span id="L-4585"><a href="#L-4585"><span class="linenos">4585</span></a><span class="sd">        ... )</span>
</span><span id="L-4586"><a href="#L-4586"><span class="linenos">4586</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4587"><a href="#L-4587"><span class="linenos">4587</span></a>
</span><span id="L-4588"><a href="#L-4588"><span class="linenos">4588</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-4589"><a href="#L-4589"><span class="linenos">4589</span></a>
</span><span id="L-4590"><a href="#L-4590"><span class="linenos">4590</span></a>        <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">])</span>
</span><span id="L-4591"><a href="#L-4591"><span class="linenos">4591</span></a>
</span><span id="L-4592"><a href="#L-4592"><span class="linenos">4592</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[[</span><span class="n">grouping_col</span><span class="p">,</span> <span class="n">val_col</span><span class="p">]]</span>
</span><span id="L-4593"><a href="#L-4593"><span class="linenos">4593</span></a>
</span><span id="L-4594"><a href="#L-4594"><span class="linenos">4594</span></a>        <span class="k">if</span> <span class="n">omit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4595"><a href="#L-4595"><span class="linenos">4595</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">omit</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-4596"><a href="#L-4596"><span class="linenos">4596</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="o">~</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">omit</span><span class="p">)]</span>
</span><span id="L-4597"><a href="#L-4597"><span class="linenos">4597</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-4598"><a href="#L-4598"><span class="linenos">4598</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span> <span class="o">!=</span> <span class="n">omit</span><span class="p">]</span>
</span><span id="L-4599"><a href="#L-4599"><span class="linenos">4599</span></a>
</span><span id="L-4600"><a href="#L-4600"><span class="linenos">4600</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-4601"><a href="#L-4601"><span class="linenos">4601</span></a>        <span class="n">andata</span><span class="p">[</span><span class="s2">&quot;index_col&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-4602"><a href="#L-4602"><span class="linenos">4602</span></a>
</span><span id="L-4603"><a href="#L-4603"><span class="linenos">4603</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-4604"><a href="#L-4604"><span class="linenos">4604</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">grouping_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="L-4605"><a href="#L-4605"><span class="linenos">4605</span></a>                <span class="n">andata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="L-4606"><a href="#L-4606"><span class="linenos">4606</span></a>                    <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">grouping_col</span>
</span><span id="L-4607"><a href="#L-4607"><span class="linenos">4607</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="L-4608"><a href="#L-4608"><span class="linenos">4608</span></a>
</span><span id="L-4609"><a href="#L-4609"><span class="linenos">4609</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
</span><span id="L-4610"><a href="#L-4610"><span class="linenos">4610</span></a>            <span class="n">index</span><span class="o">=</span><span class="n">val_col</span><span class="p">,</span>
</span><span id="L-4611"><a href="#L-4611"><span class="linenos">4611</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">grouping_col</span><span class="p">,</span>
</span><span id="L-4612"><a href="#L-4612"><span class="linenos">4612</span></a>            <span class="n">values</span><span class="o">=</span><span class="s2">&quot;index_col&quot;</span><span class="p">,</span>
</span><span id="L-4613"><a href="#L-4613"><span class="linenos">4613</span></a>            <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
</span><span id="L-4614"><a href="#L-4614"><span class="linenos">4614</span></a>            <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-4615"><a href="#L-4615"><span class="linenos">4615</span></a>        <span class="p">)</span>
</span><span id="L-4616"><a href="#L-4616"><span class="linenos">4616</span></a>        
</span><span id="L-4617"><a href="#L-4617"><span class="linenos">4617</span></a>        <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="L-4618"><a href="#L-4618"><span class="linenos">4618</span></a>        <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="L-4619"><a href="#L-4619"><span class="linenos">4619</span></a>
</span><span id="L-4620"><a href="#L-4620"><span class="linenos">4620</span></a>        <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="L-4621"><a href="#L-4621"><span class="linenos">4621</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="L-4622"><a href="#L-4622"><span class="linenos">4622</span></a>
</span><span id="L-4623"><a href="#L-4623"><span class="linenos">4623</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="L-4624"><a href="#L-4624"><span class="linenos">4624</span></a>
</span><span id="L-4625"><a href="#L-4625"><span class="linenos">4625</span></a>        <span class="n">chi_df</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="L-4626"><a href="#L-4626"><span class="linenos">4626</span></a>
</span><span id="L-4627"><a href="#L-4627"><span class="linenos">4627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="L-4628"><a href="#L-4628"><span class="linenos">4628</span></a>
</span><span id="L-4629"><a href="#L-4629"><span class="linenos">4629</span></a>        <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;Significance_Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;p-value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_significance_label</span><span class="p">)</span>
</span><span id="L-4630"><a href="#L-4630"><span class="linenos">4630</span></a>
</span><span id="L-4631"><a href="#L-4631"><span class="linenos">4631</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="n">prop_plot</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">,</span> <span class="n">chi_df</span><span class="p">)</span>
</span><span id="L-4632"><a href="#L-4632"><span class="linenos">4632</span></a>
</span><span id="L-4633"><a href="#L-4633"><span class="linenos">4633</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-4634"><a href="#L-4634"><span class="linenos">4634</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4635"><a href="#L-4635"><span class="linenos">4635</span></a><span class="sd">        Retrieve the proportion bar plot generated by the `proportion_analysis()` method.</span>
</span><span id="L-4636"><a href="#L-4636"><span class="linenos">4636</span></a>
</span><span id="L-4637"><a href="#L-4637"><span class="linenos">4637</span></a><span class="sd">        Parameters</span>
</span><span id="L-4638"><a href="#L-4638"><span class="linenos">4638</span></a><span class="sd">        ----------</span>
</span><span id="L-4639"><a href="#L-4639"><span class="linenos">4639</span></a><span class="sd">        show : bool, optional</span>
</span><span id="L-4640"><a href="#L-4640"><span class="linenos">4640</span></a><span class="sd">            Whether to display the proportion bar plot. Default is True.</span>
</span><span id="L-4641"><a href="#L-4641"><span class="linenos">4641</span></a>
</span><span id="L-4642"><a href="#L-4642"><span class="linenos">4642</span></a><span class="sd">        Returns</span>
</span><span id="L-4643"><a href="#L-4643"><span class="linenos">4643</span></a><span class="sd">        -------</span>
</span><span id="L-4644"><a href="#L-4644"><span class="linenos">4644</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="L-4645"><a href="#L-4645"><span class="linenos">4645</span></a><span class="sd">            The figure object containing the proportion bar plot.</span>
</span><span id="L-4646"><a href="#L-4646"><span class="linenos">4646</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4647"><a href="#L-4647"><span class="linenos">4647</span></a>
</span><span id="L-4648"><a href="#L-4648"><span class="linenos">4648</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-4649"><a href="#L-4649"><span class="linenos">4649</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-4650"><a href="#L-4650"><span class="linenos">4650</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="L-4651"><a href="#L-4651"><span class="linenos">4651</span></a>            <span class="p">)</span>
</span><span id="L-4652"><a href="#L-4652"><span class="linenos">4652</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4653"><a href="#L-4653"><span class="linenos">4653</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="L-4654"><a href="#L-4654"><span class="linenos">4654</span></a>                <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="L-4655"><a href="#L-4655"><span class="linenos">4655</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span><span id="L-4656"><a href="#L-4656"><span class="linenos">4656</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-4657"><a href="#L-4657"><span class="linenos">4657</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span><span class="p">)</span>
</span><span id="L-4658"><a href="#L-4658"><span class="linenos">4658</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="L-4659"><a href="#L-4659"><span class="linenos">4659</span></a>                        <span class="kc">None</span>
</span><span id="L-4660"><a href="#L-4660"><span class="linenos">4660</span></a>
</span><span id="L-4661"><a href="#L-4661"><span class="linenos">4661</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span><span id="L-4662"><a href="#L-4662"><span class="linenos">4662</span></a>
</span><span id="L-4663"><a href="#L-4663"><span class="linenos">4663</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-4664"><a href="#L-4664"><span class="linenos">4664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4665"><a href="#L-4665"><span class="linenos">4665</span></a><span class="sd">        Retrieve the proportion statistics computed by the `proportion_analysis()` method.</span>
</span><span id="L-4666"><a href="#L-4666"><span class="linenos">4666</span></a>
</span><span id="L-4667"><a href="#L-4667"><span class="linenos">4667</span></a><span class="sd">        Returns</span>
</span><span id="L-4668"><a href="#L-4668"><span class="linenos">4668</span></a><span class="sd">        -------</span>
</span><span id="L-4669"><a href="#L-4669"><span class="linenos">4669</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="L-4670"><a href="#L-4670"><span class="linenos">4670</span></a><span class="sd">            The proportion statistics stored in `self.proportion_stats`.</span>
</span><span id="L-4671"><a href="#L-4671"><span class="linenos">4671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-4672"><a href="#L-4672"><span class="linenos">4672</span></a>
</span><span id="L-4673"><a href="#L-4673"><span class="linenos">4673</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span><span class="p">:</span>
</span><span id="L-4674"><a href="#L-4674"><span class="linenos">4674</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="L-4675"><a href="#L-4675"><span class="linenos">4675</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="L-4676"><a href="#L-4676"><span class="linenos">4676</span></a>            <span class="p">)</span>
</span><span id="L-4677"><a href="#L-4677"><span class="linenos">4677</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-4678"><a href="#L-4678"><span class="linenos">4678</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span>
</span></pre></div>


            </section>
                <section id="RepTools">
                            <input id="RepTools-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">RepTools</span>:

                <label class="view-source-button" for="RepTools-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools-46"><a href="#RepTools-46"><span class="linenos"> 46</span></a><span class="k">class</span><span class="w"> </span><span class="nc">RepTools</span><span class="p">:</span>
</span><span id="RepTools-47"><a href="#RepTools-47"><span class="linenos"> 47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-48"><a href="#RepTools-48"><span class="linenos"> 48</span></a><span class="sd">    A utility class for processing and repairing nuclei data.</span>
</span><span id="RepTools-49"><a href="#RepTools-49"><span class="linenos"> 49</span></a><span class="sd">    Provides methods for extracting subsets, removing outliers, computing geometrical features,</span>
</span><span id="RepTools-50"><a href="#RepTools-50"><span class="linenos"> 50</span></a><span class="sd">    and merging/splitting nuclei based on spatial and intensity criteria.</span>
</span><span id="RepTools-51"><a href="#RepTools-51"><span class="linenos"> 51</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="RepTools-52"><a href="#RepTools-52"><span class="linenos"> 52</span></a>
</span><span id="RepTools-53"><a href="#RepTools-53"><span class="linenos"> 53</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_dict_by_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
</span><span id="RepTools-54"><a href="#RepTools-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-55"><a href="#RepTools-55"><span class="linenos"> 55</span></a><span class="sd">        Extracts elements from all dictionary lists using provided indices.</span>
</span><span id="RepTools-56"><a href="#RepTools-56"><span class="linenos"> 56</span></a>
</span><span id="RepTools-57"><a href="#RepTools-57"><span class="linenos"> 57</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-58"><a href="#RepTools-58"><span class="linenos"> 58</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-59"><a href="#RepTools-59"><span class="linenos"> 59</span></a><span class="sd">        d : dict</span>
</span><span id="RepTools-60"><a href="#RepTools-60"><span class="linenos"> 60</span></a><span class="sd">            Dictionary with list values.</span>
</span><span id="RepTools-61"><a href="#RepTools-61"><span class="linenos"> 61</span></a>
</span><span id="RepTools-62"><a href="#RepTools-62"><span class="linenos"> 62</span></a><span class="sd">        indices : list</span>
</span><span id="RepTools-63"><a href="#RepTools-63"><span class="linenos"> 63</span></a><span class="sd">            List of indices to extract from each dictionary entry.</span>
</span><span id="RepTools-64"><a href="#RepTools-64"><span class="linenos"> 64</span></a>
</span><span id="RepTools-65"><a href="#RepTools-65"><span class="linenos"> 65</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-66"><a href="#RepTools-66"><span class="linenos"> 66</span></a><span class="sd">        -------</span>
</span><span id="RepTools-67"><a href="#RepTools-67"><span class="linenos"> 67</span></a><span class="sd">        dict</span>
</span><span id="RepTools-68"><a href="#RepTools-68"><span class="linenos"> 68</span></a><span class="sd">            Dictionary containing only the selected elements.</span>
</span><span id="RepTools-69"><a href="#RepTools-69"><span class="linenos"> 69</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-70"><a href="#RepTools-70"><span class="linenos"> 70</span></a>
</span><span id="RepTools-71"><a href="#RepTools-71"><span class="linenos"> 71</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="RepTools-72"><a href="#RepTools-72"><span class="linenos"> 72</span></a>            <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
</span><span id="RepTools-73"><a href="#RepTools-73"><span class="linenos"> 73</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="RepTools-74"><a href="#RepTools-74"><span class="linenos"> 74</span></a>        <span class="p">}</span>
</span><span id="RepTools-75"><a href="#RepTools-75"><span class="linenos"> 75</span></a>
</span><span id="RepTools-76"><a href="#RepTools-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">drop_outlires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">circ</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="RepTools-77"><a href="#RepTools-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-78"><a href="#RepTools-78"><span class="linenos"> 78</span></a><span class="sd">        Identify indices of nuclei that are considered outliers based on circularity and intensity.</span>
</span><span id="RepTools-79"><a href="#RepTools-79"><span class="linenos"> 79</span></a>
</span><span id="RepTools-80"><a href="#RepTools-80"><span class="linenos"> 80</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-81"><a href="#RepTools-81"><span class="linenos"> 81</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-82"><a href="#RepTools-82"><span class="linenos"> 82</span></a><span class="sd">        row : dict</span>
</span><span id="RepTools-83"><a href="#RepTools-83"><span class="linenos"> 83</span></a><span class="sd">            Dictionary containing nuclei properties, including &#39;circularity&#39; and &#39;intensity_mean&#39;.</span>
</span><span id="RepTools-84"><a href="#RepTools-84"><span class="linenos"> 84</span></a>
</span><span id="RepTools-85"><a href="#RepTools-85"><span class="linenos"> 85</span></a><span class="sd">        diff_FC_intensity : float</span>
</span><span id="RepTools-86"><a href="#RepTools-86"><span class="linenos"> 86</span></a><span class="sd">            Fraction of mean intensity below which a nucleus is considered an outlier.</span>
</span><span id="RepTools-87"><a href="#RepTools-87"><span class="linenos"> 87</span></a>
</span><span id="RepTools-88"><a href="#RepTools-88"><span class="linenos"> 88</span></a><span class="sd">        circ : float</span>
</span><span id="RepTools-89"><a href="#RepTools-89"><span class="linenos"> 89</span></a><span class="sd">            Minimum circularity threshold for nuclei to be considered.</span>
</span><span id="RepTools-90"><a href="#RepTools-90"><span class="linenos"> 90</span></a>
</span><span id="RepTools-91"><a href="#RepTools-91"><span class="linenos"> 91</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-92"><a href="#RepTools-92"><span class="linenos"> 92</span></a><span class="sd">        -------</span>
</span><span id="RepTools-93"><a href="#RepTools-93"><span class="linenos"> 93</span></a><span class="sd">        list</span>
</span><span id="RepTools-94"><a href="#RepTools-94"><span class="linenos"> 94</span></a><span class="sd">            List of indices to drop as outliers.</span>
</span><span id="RepTools-95"><a href="#RepTools-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-96"><a href="#RepTools-96"><span class="linenos"> 96</span></a>
</span><span id="RepTools-97"><a href="#RepTools-97"><span class="linenos"> 97</span></a>        <span class="n">cd</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-98"><a href="#RepTools-98"><span class="linenos"> 98</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]):</span>
</span><span id="RepTools-99"><a href="#RepTools-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">circ</span><span class="p">:</span>
</span><span id="RepTools-100"><a href="#RepTools-100"><span class="linenos">100</span></a>                <span class="n">cd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="RepTools-101"><a href="#RepTools-101"><span class="linenos">101</span></a>
</span><span id="RepTools-102"><a href="#RepTools-102"><span class="linenos">102</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
</span><span id="RepTools-103"><a href="#RepTools-103"><span class="linenos">103</span></a>
</span><span id="RepTools-104"><a href="#RepTools-104"><span class="linenos">104</span></a>        <span class="n">drop</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-105"><a href="#RepTools-105"><span class="linenos">105</span></a>        <span class="n">is_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="RepTools-106"><a href="#RepTools-106"><span class="linenos">106</span></a>
</span><span id="RepTools-107"><a href="#RepTools-107"><span class="linenos">107</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]):</span>
</span><span id="RepTools-108"><a href="#RepTools-108"><span class="linenos">108</span></a>            <span class="n">FC_mean</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">is_mean</span>
</span><span id="RepTools-109"><a href="#RepTools-109"><span class="linenos">109</span></a>            <span class="k">if</span> <span class="n">FC_mean</span> <span class="o">&lt;</span> <span class="n">diff_FC_intensity</span><span class="p">:</span>
</span><span id="RepTools-110"><a href="#RepTools-110"><span class="linenos">110</span></a>                <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="RepTools-111"><a href="#RepTools-111"><span class="linenos">111</span></a>
</span><span id="RepTools-112"><a href="#RepTools-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">drop</span>
</span><span id="RepTools-113"><a href="#RepTools-113"><span class="linenos">113</span></a>
</span><span id="RepTools-114"><a href="#RepTools-114"><span class="linenos">114</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
</span><span id="RepTools-115"><a href="#RepTools-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-116"><a href="#RepTools-116"><span class="linenos">116</span></a><span class="sd">        Compute close neighbors between nuclei coordinates using a threshold distance.</span>
</span><span id="RepTools-117"><a href="#RepTools-117"><span class="linenos">117</span></a>
</span><span id="RepTools-118"><a href="#RepTools-118"><span class="linenos">118</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-119"><a href="#RepTools-119"><span class="linenos">119</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-120"><a href="#RepTools-120"><span class="linenos">120</span></a><span class="sd">        coords : list</span>
</span><span id="RepTools-121"><a href="#RepTools-121"><span class="linenos">121</span></a><span class="sd">            List of numpy arrays, each containing coordinates for a nucleus.</span>
</span><span id="RepTools-122"><a href="#RepTools-122"><span class="linenos">122</span></a>
</span><span id="RepTools-123"><a href="#RepTools-123"><span class="linenos">123</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-124"><a href="#RepTools-124"><span class="linenos">124</span></a><span class="sd">        -------</span>
</span><span id="RepTools-125"><a href="#RepTools-125"><span class="linenos">125</span></a><span class="sd">        dict</span>
</span><span id="RepTools-126"><a href="#RepTools-126"><span class="linenos">126</span></a><span class="sd">            Dictionary mapping pairs of nuclei indices to the number of close neighbors.</span>
</span><span id="RepTools-127"><a href="#RepTools-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-128"><a href="#RepTools-128"><span class="linenos">128</span></a>
</span><span id="RepTools-129"><a href="#RepTools-129"><span class="linenos">129</span></a>        <span class="n">full_list</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RepTools-130"><a href="#RepTools-130"><span class="linenos">130</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="RepTools-131"><a href="#RepTools-131"><span class="linenos">131</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="RepTools-132"><a href="#RepTools-132"><span class="linenos">132</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
</span><span id="RepTools-133"><a href="#RepTools-133"><span class="linenos">133</span></a>
</span><span id="RepTools-134"><a href="#RepTools-134"><span class="linenos">134</span></a>                    <span class="n">tree1</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="RepTools-135"><a href="#RepTools-135"><span class="linenos">135</span></a>
</span><span id="RepTools-136"><a href="#RepTools-136"><span class="linenos">136</span></a>                    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="RepTools-137"><a href="#RepTools-137"><span class="linenos">137</span></a>
</span><span id="RepTools-138"><a href="#RepTools-138"><span class="linenos">138</span></a>                    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="RepTools-139"><a href="#RepTools-139"><span class="linenos">139</span></a>                    <span class="n">close_neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="RepTools-140"><a href="#RepTools-140"><span class="linenos">140</span></a>
</span><span id="RepTools-141"><a href="#RepTools-141"><span class="linenos">141</span></a>                    <span class="n">full_list</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_neighbors</span>
</span><span id="RepTools-142"><a href="#RepTools-142"><span class="linenos">142</span></a>
</span><span id="RepTools-143"><a href="#RepTools-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">full_list</span>
</span><span id="RepTools-144"><a href="#RepTools-144"><span class="linenos">144</span></a>
</span><span id="RepTools-145"><a href="#RepTools-145"><span class="linenos">145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_axes_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools-146"><a href="#RepTools-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-147"><a href="#RepTools-147"><span class="linenos">147</span></a><span class="sd">        Compute major and minor axis lengths of a nucleus from its contour.</span>
</span><span id="RepTools-148"><a href="#RepTools-148"><span class="linenos">148</span></a>
</span><span id="RepTools-149"><a href="#RepTools-149"><span class="linenos">149</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-150"><a href="#RepTools-150"><span class="linenos">150</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-151"><a href="#RepTools-151"><span class="linenos">151</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools-152"><a href="#RepTools-152"><span class="linenos">152</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="RepTools-153"><a href="#RepTools-153"><span class="linenos">153</span></a>
</span><span id="RepTools-154"><a href="#RepTools-154"><span class="linenos">154</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-155"><a href="#RepTools-155"><span class="linenos">155</span></a><span class="sd">        -------</span>
</span><span id="RepTools-156"><a href="#RepTools-156"><span class="linenos">156</span></a><span class="sd">        tuple</span>
</span><span id="RepTools-157"><a href="#RepTools-157"><span class="linenos">157</span></a><span class="sd">            Major and minor axis lengths.</span>
</span><span id="RepTools-158"><a href="#RepTools-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-159"><a href="#RepTools-159"><span class="linenos">159</span></a>
</span><span id="RepTools-160"><a href="#RepTools-160"><span class="linenos">160</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="RepTools-161"><a href="#RepTools-161"><span class="linenos">161</span></a>
</span><span id="RepTools-162"><a href="#RepTools-162"><span class="linenos">162</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="RepTools-163"><a href="#RepTools-163"><span class="linenos">163</span></a>
</span><span id="RepTools-164"><a href="#RepTools-164"><span class="linenos">164</span></a>        <span class="n">axis_major_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="RepTools-165"><a href="#RepTools-165"><span class="linenos">165</span></a>        <span class="n">axis_minor_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="RepTools-166"><a href="#RepTools-166"><span class="linenos">166</span></a>
</span><span id="RepTools-167"><a href="#RepTools-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="n">axis_major_length</span><span class="p">,</span> <span class="n">axis_minor_length</span>
</span><span id="RepTools-168"><a href="#RepTools-168"><span class="linenos">168</span></a>
</span><span id="RepTools-169"><a href="#RepTools-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_eccentricity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools-170"><a href="#RepTools-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-171"><a href="#RepTools-171"><span class="linenos">171</span></a><span class="sd">        Compute eccentricity of a nucleus from its contour.</span>
</span><span id="RepTools-172"><a href="#RepTools-172"><span class="linenos">172</span></a>
</span><span id="RepTools-173"><a href="#RepTools-173"><span class="linenos">173</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-174"><a href="#RepTools-174"><span class="linenos">174</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-175"><a href="#RepTools-175"><span class="linenos">175</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools-176"><a href="#RepTools-176"><span class="linenos">176</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="RepTools-177"><a href="#RepTools-177"><span class="linenos">177</span></a>
</span><span id="RepTools-178"><a href="#RepTools-178"><span class="linenos">178</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-179"><a href="#RepTools-179"><span class="linenos">179</span></a><span class="sd">        -------</span>
</span><span id="RepTools-180"><a href="#RepTools-180"><span class="linenos">180</span></a><span class="sd">        float</span>
</span><span id="RepTools-181"><a href="#RepTools-181"><span class="linenos">181</span></a><span class="sd">            Eccentricity of the nucleus.</span>
</span><span id="RepTools-182"><a href="#RepTools-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-183"><a href="#RepTools-183"><span class="linenos">183</span></a>
</span><span id="RepTools-184"><a href="#RepTools-184"><span class="linenos">184</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="RepTools-185"><a href="#RepTools-185"><span class="linenos">185</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="RepTools-186"><a href="#RepTools-186"><span class="linenos">186</span></a>
</span><span id="RepTools-187"><a href="#RepTools-187"><span class="linenos">187</span></a>        <span class="n">eccentricity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="RepTools-188"><a href="#RepTools-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="n">eccentricity</span>
</span><span id="RepTools-189"><a href="#RepTools-189"><span class="linenos">189</span></a>
</span><span id="RepTools-190"><a href="#RepTools-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_feret_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools-191"><a href="#RepTools-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-192"><a href="#RepTools-192"><span class="linenos">192</span></a><span class="sd">        Compute the Feret diameter of a given contour.</span>
</span><span id="RepTools-193"><a href="#RepTools-193"><span class="linenos">193</span></a>
</span><span id="RepTools-194"><a href="#RepTools-194"><span class="linenos">194</span></a><span class="sd">        The Feret diameter is defined as the maximum pairwise Euclidean distance between points in the contour.</span>
</span><span id="RepTools-195"><a href="#RepTools-195"><span class="linenos">195</span></a>
</span><span id="RepTools-196"><a href="#RepTools-196"><span class="linenos">196</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-197"><a href="#RepTools-197"><span class="linenos">197</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-198"><a href="#RepTools-198"><span class="linenos">198</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools-199"><a href="#RepTools-199"><span class="linenos">199</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools-200"><a href="#RepTools-200"><span class="linenos">200</span></a>
</span><span id="RepTools-201"><a href="#RepTools-201"><span class="linenos">201</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-202"><a href="#RepTools-202"><span class="linenos">202</span></a><span class="sd">        -------</span>
</span><span id="RepTools-203"><a href="#RepTools-203"><span class="linenos">203</span></a><span class="sd">        float</span>
</span><span id="RepTools-204"><a href="#RepTools-204"><span class="linenos">204</span></a><span class="sd">            The maximum distance between any two points in the contour.</span>
</span><span id="RepTools-205"><a href="#RepTools-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-206"><a href="#RepTools-206"><span class="linenos">206</span></a>
</span><span id="RepTools-207"><a href="#RepTools-207"><span class="linenos">207</span></a>        <span class="n">rect</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools-208"><a href="#RepTools-208"><span class="linenos">208</span></a>        <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="RepTools-209"><a href="#RepTools-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span><span id="RepTools-210"><a href="#RepTools-210"><span class="linenos">210</span></a>
</span><span id="RepTools-211"><a href="#RepTools-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools-212"><a href="#RepTools-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-213"><a href="#RepTools-213"><span class="linenos">213</span></a><span class="sd">        Compute the perimeter of a contour.</span>
</span><span id="RepTools-214"><a href="#RepTools-214"><span class="linenos">214</span></a>
</span><span id="RepTools-215"><a href="#RepTools-215"><span class="linenos">215</span></a><span class="sd">        The perimeter is calculated as the sum of Euclidean distances between consecutive points in the contour.</span>
</span><span id="RepTools-216"><a href="#RepTools-216"><span class="linenos">216</span></a>
</span><span id="RepTools-217"><a href="#RepTools-217"><span class="linenos">217</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-218"><a href="#RepTools-218"><span class="linenos">218</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-219"><a href="#RepTools-219"><span class="linenos">219</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools-220"><a href="#RepTools-220"><span class="linenos">220</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools-221"><a href="#RepTools-221"><span class="linenos">221</span></a>
</span><span id="RepTools-222"><a href="#RepTools-222"><span class="linenos">222</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-223"><a href="#RepTools-223"><span class="linenos">223</span></a><span class="sd">        -------</span>
</span><span id="RepTools-224"><a href="#RepTools-224"><span class="linenos">224</span></a><span class="sd">        float</span>
</span><span id="RepTools-225"><a href="#RepTools-225"><span class="linenos">225</span></a><span class="sd">            Perimeter length of the contour.</span>
</span><span id="RepTools-226"><a href="#RepTools-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-227"><a href="#RepTools-227"><span class="linenos">227</span></a>
</span><span id="RepTools-228"><a href="#RepTools-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="RepTools-229"><a href="#RepTools-229"><span class="linenos">229</span></a>
</span><span id="RepTools-230"><a href="#RepTools-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools-231"><a href="#RepTools-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-232"><a href="#RepTools-232"><span class="linenos">232</span></a><span class="sd">        Compute the circularity of a contour.</span>
</span><span id="RepTools-233"><a href="#RepTools-233"><span class="linenos">233</span></a>
</span><span id="RepTools-234"><a href="#RepTools-234"><span class="linenos">234</span></a><span class="sd">        Circularity is a measure of how close the shape is to a perfect circle.</span>
</span><span id="RepTools-235"><a href="#RepTools-235"><span class="linenos">235</span></a><span class="sd">        It is calculated as 4 * pi * (area / perimeter^2).</span>
</span><span id="RepTools-236"><a href="#RepTools-236"><span class="linenos">236</span></a>
</span><span id="RepTools-237"><a href="#RepTools-237"><span class="linenos">237</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-238"><a href="#RepTools-238"><span class="linenos">238</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-239"><a href="#RepTools-239"><span class="linenos">239</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools-240"><a href="#RepTools-240"><span class="linenos">240</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools-241"><a href="#RepTools-241"><span class="linenos">241</span></a>
</span><span id="RepTools-242"><a href="#RepTools-242"><span class="linenos">242</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-243"><a href="#RepTools-243"><span class="linenos">243</span></a><span class="sd">        -------</span>
</span><span id="RepTools-244"><a href="#RepTools-244"><span class="linenos">244</span></a><span class="sd">        float</span>
</span><span id="RepTools-245"><a href="#RepTools-245"><span class="linenos">245</span></a><span class="sd">            Circularity of the contour. Value ranges from 0 to 1, where 1 indicates a perfect circle.</span>
</span><span id="RepTools-246"><a href="#RepTools-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-247"><a href="#RepTools-247"><span class="linenos">247</span></a>        <span class="n">perimeter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_perimeter</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools-248"><a href="#RepTools-248"><span class="linenos">248</span></a>        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools-249"><a href="#RepTools-249"><span class="linenos">249</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">hull</span><span class="o">.</span><span class="n">volume</span>
</span><span id="RepTools-250"><a href="#RepTools-250"><span class="linenos">250</span></a>
</span><span id="RepTools-251"><a href="#RepTools-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="RepTools-252"><a href="#RepTools-252"><span class="linenos">252</span></a>
</span><span id="RepTools-253"><a href="#RepTools-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repairing_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
</span><span id="RepTools-254"><a href="#RepTools-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools-255"><a href="#RepTools-255"><span class="linenos">255</span></a><span class="sd">        Repair nuclei segmentation results by merging or removing outlier nuclei.</span>
</span><span id="RepTools-256"><a href="#RepTools-256"><span class="linenos">256</span></a>
</span><span id="RepTools-257"><a href="#RepTools-257"><span class="linenos">257</span></a><span class="sd">        This method adjusts nuclei detection results based on global and local thresholds, circularity, nearest neighbor relationships,</span>
</span><span id="RepTools-258"><a href="#RepTools-258"><span class="linenos">258</span></a><span class="sd">        and merges small or fragmented nuclei when appropriate. It also recalculates key morphological properties for merged nuclei.</span>
</span><span id="RepTools-259"><a href="#RepTools-259"><span class="linenos">259</span></a>
</span><span id="RepTools-260"><a href="#RepTools-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools-261"><a href="#RepTools-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="RepTools-262"><a href="#RepTools-262"><span class="linenos">262</span></a><span class="sd">        results : dict</span>
</span><span id="RepTools-263"><a href="#RepTools-263"><span class="linenos">263</span></a><span class="sd">            Dictionary where keys are image identifiers and values are dictionaries containing detected nuclei properties</span>
</span><span id="RepTools-264"><a href="#RepTools-264"><span class="linenos">264</span></a><span class="sd">            (e.g., &#39;area&#39;, &#39;coords&#39;, &#39;label&#39;, &#39;circularity&#39;, etc.).</span>
</span><span id="RepTools-265"><a href="#RepTools-265"><span class="linenos">265</span></a>
</span><span id="RepTools-266"><a href="#RepTools-266"><span class="linenos">266</span></a><span class="sd">        Returns</span>
</span><span id="RepTools-267"><a href="#RepTools-267"><span class="linenos">267</span></a><span class="sd">        -------</span>
</span><span id="RepTools-268"><a href="#RepTools-268"><span class="linenos">268</span></a><span class="sd">        dict</span>
</span><span id="RepTools-269"><a href="#RepTools-269"><span class="linenos">269</span></a><span class="sd">            A dictionary in the same structure as `results`, but with repaired nuclei information after merging or removing outliers.</span>
</span><span id="RepTools-270"><a href="#RepTools-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools-271"><a href="#RepTools-271"><span class="linenos">271</span></a>
</span><span id="RepTools-272"><a href="#RepTools-272"><span class="linenos">272</span></a>        <span class="c1"># repairing nuclei</span>
</span><span id="RepTools-273"><a href="#RepTools-273"><span class="linenos">273</span></a>        <span class="n">mean_sum_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-274"><a href="#RepTools-274"><span class="linenos">274</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-275"><a href="#RepTools-275"><span class="linenos">275</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-276"><a href="#RepTools-276"><span class="linenos">276</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="RepTools-277"><a href="#RepTools-277"><span class="linenos">277</span></a>            <span class="n">mean_sum_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="RepTools-278"><a href="#RepTools-278"><span class="linenos">278</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="RepTools-279"><a href="#RepTools-279"><span class="linenos">279</span></a>            <span class="n">im</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="RepTools-280"><a href="#RepTools-280"><span class="linenos">280</span></a>
</span><span id="RepTools-281"><a href="#RepTools-281"><span class="linenos">281</span></a>        <span class="n">mean_sum_area_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_sum_area</span><span class="p">)</span>
</span><span id="RepTools-282"><a href="#RepTools-282"><span class="linenos">282</span></a>
</span><span id="RepTools-283"><a href="#RepTools-283"><span class="linenos">283</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RepTools-284"><a href="#RepTools-284"><span class="linenos">284</span></a>
</span><span id="RepTools-285"><a href="#RepTools-285"><span class="linenos">285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image repairing:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RepTools-286"><a href="#RepTools-286"><span class="linenos">286</span></a>
</span><span id="RepTools-287"><a href="#RepTools-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="p">)):</span>
</span><span id="RepTools-288"><a href="#RepTools-288"><span class="linenos">288</span></a>
</span><span id="RepTools-289"><a href="#RepTools-289"><span class="linenos">289</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="RepTools-290"><a href="#RepTools-290"><span class="linenos">290</span></a>                <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="RepTools-291"><a href="#RepTools-291"><span class="linenos">291</span></a>                <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">mean_sum_area_sum</span>
</span><span id="RepTools-292"><a href="#RepTools-292"><span class="linenos">292</span></a>                <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span>
</span><span id="RepTools-293"><a href="#RepTools-293"><span class="linenos">293</span></a>            <span class="p">):</span>
</span><span id="RepTools-294"><a href="#RepTools-294"><span class="linenos">294</span></a>                <span class="c1"># adjustment to global changes</span>
</span><span id="RepTools-295"><a href="#RepTools-295"><span class="linenos">295</span></a>
</span><span id="RepTools-296"><a href="#RepTools-296"><span class="linenos">296</span></a>                <span class="n">temporary_dict</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="RepTools-297"><a href="#RepTools-297"><span class="linenos">297</span></a>
</span><span id="RepTools-298"><a href="#RepTools-298"><span class="linenos">298</span></a>                <span class="n">check_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_outlires</span><span class="p">(</span>
</span><span id="RepTools-299"><a href="#RepTools-299"><span class="linenos">299</span></a>                    <span class="n">temporary_dict</span><span class="p">,</span>
</span><span id="RepTools-300"><a href="#RepTools-300"><span class="linenos">300</span></a>                    <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span>
</span><span id="RepTools-301"><a href="#RepTools-301"><span class="linenos">301</span></a>                        <span class="s2">&quot;FC_diff_local_intensity&quot;</span>
</span><span id="RepTools-302"><a href="#RepTools-302"><span class="linenos">302</span></a>                    <span class="p">],</span>
</span><span id="RepTools-303"><a href="#RepTools-303"><span class="linenos">303</span></a>                    <span class="n">circ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">],</span>
</span><span id="RepTools-304"><a href="#RepTools-304"><span class="linenos">304</span></a>                <span class="p">)</span>
</span><span id="RepTools-305"><a href="#RepTools-305"><span class="linenos">305</span></a>
</span><span id="RepTools-306"><a href="#RepTools-306"><span class="linenos">306</span></a>                <span class="n">to_final</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-307"><a href="#RepTools-307"><span class="linenos">307</span></a>                    <span class="n">x</span>
</span><span id="RepTools-308"><a href="#RepTools-308"><span class="linenos">308</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span>
</span><span id="RepTools-309"><a href="#RepTools-309"><span class="linenos">309</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_drop</span>
</span><span id="RepTools-310"><a href="#RepTools-310"><span class="linenos">310</span></a>                <span class="p">]</span>
</span><span id="RepTools-311"><a href="#RepTools-311"><span class="linenos">311</span></a>
</span><span id="RepTools-312"><a href="#RepTools-312"><span class="linenos">312</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">,</span> <span class="n">to_final</span><span class="p">)</span>
</span><span id="RepTools-313"><a href="#RepTools-313"><span class="linenos">313</span></a>
</span><span id="RepTools-314"><a href="#RepTools-314"><span class="linenos">314</span></a>                <span class="n">to_concat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools-315"><a href="#RepTools-315"><span class="linenos">315</span></a>
</span><span id="RepTools-316"><a href="#RepTools-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RepTools-317"><a href="#RepTools-317"><span class="linenos">317</span></a>
</span><span id="RepTools-318"><a href="#RepTools-318"><span class="linenos">318</span></a>                    <span class="n">results_nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="RepTools-319"><a href="#RepTools-319"><span class="linenos">319</span></a>
</span><span id="RepTools-320"><a href="#RepTools-320"><span class="linenos">320</span></a>                    <span class="k">for</span> <span class="n">kn</span> <span class="ow">in</span> <span class="n">results_nn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="RepTools-321"><a href="#RepTools-321"><span class="linenos">321</span></a>                        <span class="k">if</span> <span class="n">results_nn</span><span class="p">[</span><span class="n">kn</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nn_min&quot;</span><span class="p">]:</span>
</span><span id="RepTools-322"><a href="#RepTools-322"><span class="linenos">322</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; --&gt; .*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="RepTools-323"><a href="#RepTools-323"><span class="linenos">323</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.* --&gt; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="RepTools-324"><a href="#RepTools-324"><span class="linenos">324</span></a>
</span><span id="RepTools-325"><a href="#RepTools-325"><span class="linenos">325</span></a>                    <span class="n">to_concat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="RepTools-326"><a href="#RepTools-326"><span class="linenos">326</span></a>
</span><span id="RepTools-327"><a href="#RepTools-327"><span class="linenos">327</span></a>                    <span class="n">to_rest</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-328"><a href="#RepTools-328"><span class="linenos">328</span></a>                        <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_concat</span>
</span><span id="RepTools-329"><a href="#RepTools-329"><span class="linenos">329</span></a>                    <span class="p">]</span>
</span><span id="RepTools-330"><a href="#RepTools-330"><span class="linenos">330</span></a>
</span><span id="RepTools-331"><a href="#RepTools-331"><span class="linenos">331</span></a>                <span class="c1">#</span>
</span><span id="RepTools-332"><a href="#RepTools-332"><span class="linenos">332</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_concat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RepTools-333"><a href="#RepTools-333"><span class="linenos">333</span></a>                    <span class="n">to_concat_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_concat</span><span class="p">)</span>
</span><span id="RepTools-334"><a href="#RepTools-334"><span class="linenos">334</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])]</span>
</span><span id="RepTools-335"><a href="#RepTools-335"><span class="linenos">335</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])]</span>
</span><span id="RepTools-336"><a href="#RepTools-336"><span class="linenos">336</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])]</span>
</span><span id="RepTools-337"><a href="#RepTools-337"><span class="linenos">337</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">])]</span>
</span><span id="RepTools-338"><a href="#RepTools-338"><span class="linenos">338</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-339"><a href="#RepTools-339"><span class="linenos">339</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">])</span>
</span><span id="RepTools-340"><a href="#RepTools-340"><span class="linenos">340</span></a>                    <span class="p">]</span>
</span><span id="RepTools-341"><a href="#RepTools-341"><span class="linenos">341</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-342"><a href="#RepTools-342"><span class="linenos">342</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">])</span>
</span><span id="RepTools-343"><a href="#RepTools-343"><span class="linenos">343</span></a>                    <span class="p">]</span>
</span><span id="RepTools-344"><a href="#RepTools-344"><span class="linenos">344</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-345"><a href="#RepTools-345"><span class="linenos">345</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">])</span>
</span><span id="RepTools-346"><a href="#RepTools-346"><span class="linenos">346</span></a>                    <span class="p">]</span>
</span><span id="RepTools-347"><a href="#RepTools-347"><span class="linenos">347</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-348"><a href="#RepTools-348"><span class="linenos">348</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="RepTools-349"><a href="#RepTools-349"><span class="linenos">349</span></a>                    <span class="p">]</span>
</span><span id="RepTools-350"><a href="#RepTools-350"><span class="linenos">350</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-351"><a href="#RepTools-351"><span class="linenos">351</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">])</span>
</span><span id="RepTools-352"><a href="#RepTools-352"><span class="linenos">352</span></a>                    <span class="p">]</span>
</span><span id="RepTools-353"><a href="#RepTools-353"><span class="linenos">353</span></a>                    <span class="n">major</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_axes_length</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RepTools-354"><a href="#RepTools-354"><span class="linenos">354</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">major</span><span class="p">]</span>
</span><span id="RepTools-355"><a href="#RepTools-355"><span class="linenos">355</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span><span class="p">]</span>
</span><span id="RepTools-356"><a href="#RepTools-356"><span class="linenos">356</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span> <span class="o">/</span> <span class="n">major</span><span class="p">]</span>
</span><span id="RepTools-357"><a href="#RepTools-357"><span class="linenos">357</span></a>                    <span class="n">ecc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eccentricity</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RepTools-358"><a href="#RepTools-358"><span class="linenos">358</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecc</span><span class="p">]</span>
</span><span id="RepTools-359"><a href="#RepTools-359"><span class="linenos">359</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-360"><a href="#RepTools-360"><span class="linenos">360</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">])</span>
</span><span id="RepTools-361"><a href="#RepTools-361"><span class="linenos">361</span></a>                    <span class="p">]</span>
</span><span id="RepTools-362"><a href="#RepTools-362"><span class="linenos">362</span></a>                    <span class="n">feret_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_feret_diameter</span><span class="p">(</span>
</span><span id="RepTools-363"><a href="#RepTools-363"><span class="linenos">363</span></a>                        <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RepTools-364"><a href="#RepTools-364"><span class="linenos">364</span></a>                    <span class="p">)</span>
</span><span id="RepTools-365"><a href="#RepTools-365"><span class="linenos">365</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">feret_diameter</span><span class="p">]</span>
</span><span id="RepTools-366"><a href="#RepTools-366"><span class="linenos">366</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">])]</span>
</span><span id="RepTools-367"><a href="#RepTools-367"><span class="linenos">367</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">])]</span>
</span><span id="RepTools-368"><a href="#RepTools-368"><span class="linenos">368</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-369"><a href="#RepTools-369"><span class="linenos">369</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">])</span>
</span><span id="RepTools-370"><a href="#RepTools-370"><span class="linenos">370</span></a>                    <span class="p">]</span>
</span><span id="RepTools-371"><a href="#RepTools-371"><span class="linenos">371</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools-372"><a href="#RepTools-372"><span class="linenos">372</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">])</span>
</span><span id="RepTools-373"><a href="#RepTools-373"><span class="linenos">373</span></a>                    <span class="p">]</span>
</span><span id="RepTools-374"><a href="#RepTools-374"><span class="linenos">374</span></a>
</span><span id="RepTools-375"><a href="#RepTools-375"><span class="linenos">375</span></a>                    <span class="n">to_rest_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_rest</span><span class="p">)</span>
</span><span id="RepTools-376"><a href="#RepTools-376"><span class="linenos">376</span></a>
</span><span id="RepTools-377"><a href="#RepTools-377"><span class="linenos">377</span></a>                    <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="n">to_rest_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="RepTools-378"><a href="#RepTools-378"><span class="linenos">378</span></a>                        <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">+</span> <span class="n">to_concat_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span>
</span><span id="RepTools-379"><a href="#RepTools-379"><span class="linenos">379</span></a>
</span><span id="RepTools-380"><a href="#RepTools-380"><span class="linenos">380</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span>
</span><span id="RepTools-381"><a href="#RepTools-381"><span class="linenos">381</span></a>
</span><span id="RepTools-382"><a href="#RepTools-382"><span class="linenos">382</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="RepTools-383"><a href="#RepTools-383"><span class="linenos">383</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="RepTools-384"><a href="#RepTools-384"><span class="linenos">384</span></a>
</span><span id="RepTools-385"><a href="#RepTools-385"><span class="linenos">385</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="RepTools-386"><a href="#RepTools-386"><span class="linenos">386</span></a>                <span class="n">m</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="RepTools-387"><a href="#RepTools-387"><span class="linenos">387</span></a>                <span class="ow">and</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RepTools-388"><a href="#RepTools-388"><span class="linenos">388</span></a>                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span>
</span><span id="RepTools-389"><a href="#RepTools-389"><span class="linenos">389</span></a>            <span class="p">):</span>
</span><span id="RepTools-390"><a href="#RepTools-390"><span class="linenos">390</span></a>
</span><span id="RepTools-391"><a href="#RepTools-391"><span class="linenos">391</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="RepTools-392"><a href="#RepTools-392"><span class="linenos">392</span></a>
</span><span id="RepTools-393"><a href="#RepTools-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>A utility class for processing and repairing nuclei data.
Provides methods for extracting subsets, removing outliers, computing geometrical features,
and merging/splitting nuclei based on spatial and intensity criteria.</p>
</div>


                            <div id="RepTools.extract_dict_by_indices" class="classattr">
                                        <input id="RepTools.extract_dict_by_indices-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">extract_dict_by_indices</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">d</span>, </span><span class="param"><span class="n">indices</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.extract_dict_by_indices-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.extract_dict_by_indices"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.extract_dict_by_indices-53"><a href="#RepTools.extract_dict_by_indices-53"><span class="linenos">53</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">extract_dict_by_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
</span><span id="RepTools.extract_dict_by_indices-54"><a href="#RepTools.extract_dict_by_indices-54"><span class="linenos">54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.extract_dict_by_indices-55"><a href="#RepTools.extract_dict_by_indices-55"><span class="linenos">55</span></a><span class="sd">        Extracts elements from all dictionary lists using provided indices.</span>
</span><span id="RepTools.extract_dict_by_indices-56"><a href="#RepTools.extract_dict_by_indices-56"><span class="linenos">56</span></a>
</span><span id="RepTools.extract_dict_by_indices-57"><a href="#RepTools.extract_dict_by_indices-57"><span class="linenos">57</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.extract_dict_by_indices-58"><a href="#RepTools.extract_dict_by_indices-58"><span class="linenos">58</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.extract_dict_by_indices-59"><a href="#RepTools.extract_dict_by_indices-59"><span class="linenos">59</span></a><span class="sd">        d : dict</span>
</span><span id="RepTools.extract_dict_by_indices-60"><a href="#RepTools.extract_dict_by_indices-60"><span class="linenos">60</span></a><span class="sd">            Dictionary with list values.</span>
</span><span id="RepTools.extract_dict_by_indices-61"><a href="#RepTools.extract_dict_by_indices-61"><span class="linenos">61</span></a>
</span><span id="RepTools.extract_dict_by_indices-62"><a href="#RepTools.extract_dict_by_indices-62"><span class="linenos">62</span></a><span class="sd">        indices : list</span>
</span><span id="RepTools.extract_dict_by_indices-63"><a href="#RepTools.extract_dict_by_indices-63"><span class="linenos">63</span></a><span class="sd">            List of indices to extract from each dictionary entry.</span>
</span><span id="RepTools.extract_dict_by_indices-64"><a href="#RepTools.extract_dict_by_indices-64"><span class="linenos">64</span></a>
</span><span id="RepTools.extract_dict_by_indices-65"><a href="#RepTools.extract_dict_by_indices-65"><span class="linenos">65</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.extract_dict_by_indices-66"><a href="#RepTools.extract_dict_by_indices-66"><span class="linenos">66</span></a><span class="sd">        -------</span>
</span><span id="RepTools.extract_dict_by_indices-67"><a href="#RepTools.extract_dict_by_indices-67"><span class="linenos">67</span></a><span class="sd">        dict</span>
</span><span id="RepTools.extract_dict_by_indices-68"><a href="#RepTools.extract_dict_by_indices-68"><span class="linenos">68</span></a><span class="sd">            Dictionary containing only the selected elements.</span>
</span><span id="RepTools.extract_dict_by_indices-69"><a href="#RepTools.extract_dict_by_indices-69"><span class="linenos">69</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.extract_dict_by_indices-70"><a href="#RepTools.extract_dict_by_indices-70"><span class="linenos">70</span></a>
</span><span id="RepTools.extract_dict_by_indices-71"><a href="#RepTools.extract_dict_by_indices-71"><span class="linenos">71</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="RepTools.extract_dict_by_indices-72"><a href="#RepTools.extract_dict_by_indices-72"><span class="linenos">72</span></a>            <span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)]</span>
</span><span id="RepTools.extract_dict_by_indices-73"><a href="#RepTools.extract_dict_by_indices-73"><span class="linenos">73</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="RepTools.extract_dict_by_indices-74"><a href="#RepTools.extract_dict_by_indices-74"><span class="linenos">74</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Extracts elements from all dictionary lists using provided indices.</p>

<h2 id="parameters">Parameters</h2>

<p>d : dict
    Dictionary with list values.</p>

<p>indices : list
    List of indices to extract from each dictionary entry.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary containing only the selected elements.</p>
</div>


                            </div>
                            <div id="RepTools.drop_outlires" class="classattr">
                                        <input id="RepTools.drop_outlires-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">drop_outlires</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">row</span>, </span><span class="param"><span class="n">diff_FC_intensity</span><span class="o">=</span><span class="mf">0.95</span>, </span><span class="param"><span class="n">circ</span><span class="o">=</span><span class="mf">0.6</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.drop_outlires-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.drop_outlires"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.drop_outlires-76"><a href="#RepTools.drop_outlires-76"><span class="linenos"> 76</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">drop_outlires</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">circ</span><span class="o">=</span><span class="mf">0.6</span><span class="p">):</span>
</span><span id="RepTools.drop_outlires-77"><a href="#RepTools.drop_outlires-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.drop_outlires-78"><a href="#RepTools.drop_outlires-78"><span class="linenos"> 78</span></a><span class="sd">        Identify indices of nuclei that are considered outliers based on circularity and intensity.</span>
</span><span id="RepTools.drop_outlires-79"><a href="#RepTools.drop_outlires-79"><span class="linenos"> 79</span></a>
</span><span id="RepTools.drop_outlires-80"><a href="#RepTools.drop_outlires-80"><span class="linenos"> 80</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.drop_outlires-81"><a href="#RepTools.drop_outlires-81"><span class="linenos"> 81</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.drop_outlires-82"><a href="#RepTools.drop_outlires-82"><span class="linenos"> 82</span></a><span class="sd">        row : dict</span>
</span><span id="RepTools.drop_outlires-83"><a href="#RepTools.drop_outlires-83"><span class="linenos"> 83</span></a><span class="sd">            Dictionary containing nuclei properties, including &#39;circularity&#39; and &#39;intensity_mean&#39;.</span>
</span><span id="RepTools.drop_outlires-84"><a href="#RepTools.drop_outlires-84"><span class="linenos"> 84</span></a>
</span><span id="RepTools.drop_outlires-85"><a href="#RepTools.drop_outlires-85"><span class="linenos"> 85</span></a><span class="sd">        diff_FC_intensity : float</span>
</span><span id="RepTools.drop_outlires-86"><a href="#RepTools.drop_outlires-86"><span class="linenos"> 86</span></a><span class="sd">            Fraction of mean intensity below which a nucleus is considered an outlier.</span>
</span><span id="RepTools.drop_outlires-87"><a href="#RepTools.drop_outlires-87"><span class="linenos"> 87</span></a>
</span><span id="RepTools.drop_outlires-88"><a href="#RepTools.drop_outlires-88"><span class="linenos"> 88</span></a><span class="sd">        circ : float</span>
</span><span id="RepTools.drop_outlires-89"><a href="#RepTools.drop_outlires-89"><span class="linenos"> 89</span></a><span class="sd">            Minimum circularity threshold for nuclei to be considered.</span>
</span><span id="RepTools.drop_outlires-90"><a href="#RepTools.drop_outlires-90"><span class="linenos"> 90</span></a>
</span><span id="RepTools.drop_outlires-91"><a href="#RepTools.drop_outlires-91"><span class="linenos"> 91</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.drop_outlires-92"><a href="#RepTools.drop_outlires-92"><span class="linenos"> 92</span></a><span class="sd">        -------</span>
</span><span id="RepTools.drop_outlires-93"><a href="#RepTools.drop_outlires-93"><span class="linenos"> 93</span></a><span class="sd">        list</span>
</span><span id="RepTools.drop_outlires-94"><a href="#RepTools.drop_outlires-94"><span class="linenos"> 94</span></a><span class="sd">            List of indices to drop as outliers.</span>
</span><span id="RepTools.drop_outlires-95"><a href="#RepTools.drop_outlires-95"><span class="linenos"> 95</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.drop_outlires-96"><a href="#RepTools.drop_outlires-96"><span class="linenos"> 96</span></a>
</span><span id="RepTools.drop_outlires-97"><a href="#RepTools.drop_outlires-97"><span class="linenos"> 97</span></a>        <span class="n">cd</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.drop_outlires-98"><a href="#RepTools.drop_outlires-98"><span class="linenos"> 98</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]):</span>
</span><span id="RepTools.drop_outlires-99"><a href="#RepTools.drop_outlires-99"><span class="linenos"> 99</span></a>            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">circ</span><span class="p">:</span>
</span><span id="RepTools.drop_outlires-100"><a href="#RepTools.drop_outlires-100"><span class="linenos">100</span></a>                <span class="n">cd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="RepTools.drop_outlires-101"><a href="#RepTools.drop_outlires-101"><span class="linenos">101</span></a>
</span><span id="RepTools.drop_outlires-102"><a href="#RepTools.drop_outlires-102"><span class="linenos">102</span></a>        <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">cd</span><span class="p">)</span>
</span><span id="RepTools.drop_outlires-103"><a href="#RepTools.drop_outlires-103"><span class="linenos">103</span></a>
</span><span id="RepTools.drop_outlires-104"><a href="#RepTools.drop_outlires-104"><span class="linenos">104</span></a>        <span class="n">drop</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.drop_outlires-105"><a href="#RepTools.drop_outlires-105"><span class="linenos">105</span></a>        <span class="n">is_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="RepTools.drop_outlires-106"><a href="#RepTools.drop_outlires-106"><span class="linenos">106</span></a>
</span><span id="RepTools.drop_outlires-107"><a href="#RepTools.drop_outlires-107"><span class="linenos">107</span></a>        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]):</span>
</span><span id="RepTools.drop_outlires-108"><a href="#RepTools.drop_outlires-108"><span class="linenos">108</span></a>            <span class="n">FC_mean</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">/</span> <span class="n">is_mean</span>
</span><span id="RepTools.drop_outlires-109"><a href="#RepTools.drop_outlires-109"><span class="linenos">109</span></a>            <span class="k">if</span> <span class="n">FC_mean</span> <span class="o">&lt;</span> <span class="n">diff_FC_intensity</span><span class="p">:</span>
</span><span id="RepTools.drop_outlires-110"><a href="#RepTools.drop_outlires-110"><span class="linenos">110</span></a>                <span class="n">drop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="RepTools.drop_outlires-111"><a href="#RepTools.drop_outlires-111"><span class="linenos">111</span></a>
</span><span id="RepTools.drop_outlires-112"><a href="#RepTools.drop_outlires-112"><span class="linenos">112</span></a>        <span class="k">return</span> <span class="n">drop</span>
</span></pre></div>


            <div class="docstring"><p>Identify indices of nuclei that are considered outliers based on circularity and intensity.</p>

<h2 id="parameters">Parameters</h2>

<p>row : dict
    Dictionary containing nuclei properties, including 'circularity' and 'intensity_mean'.</p>

<p>diff_FC_intensity : float
    Fraction of mean intensity below which a nucleus is considered an outlier.</p>

<p>circ : float
    Minimum circularity threshold for nuclei to be considered.</p>

<h2 id="returns">Returns</h2>

<p>list
    List of indices to drop as outliers.</p>
</div>


                            </div>
                            <div id="RepTools.nn" class="classattr">
                                        <input id="RepTools.nn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">coords</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.nn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.nn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.nn-114"><a href="#RepTools.nn-114"><span class="linenos">114</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coords</span><span class="p">):</span>
</span><span id="RepTools.nn-115"><a href="#RepTools.nn-115"><span class="linenos">115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.nn-116"><a href="#RepTools.nn-116"><span class="linenos">116</span></a><span class="sd">        Compute close neighbors between nuclei coordinates using a threshold distance.</span>
</span><span id="RepTools.nn-117"><a href="#RepTools.nn-117"><span class="linenos">117</span></a>
</span><span id="RepTools.nn-118"><a href="#RepTools.nn-118"><span class="linenos">118</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.nn-119"><a href="#RepTools.nn-119"><span class="linenos">119</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.nn-120"><a href="#RepTools.nn-120"><span class="linenos">120</span></a><span class="sd">        coords : list</span>
</span><span id="RepTools.nn-121"><a href="#RepTools.nn-121"><span class="linenos">121</span></a><span class="sd">            List of numpy arrays, each containing coordinates for a nucleus.</span>
</span><span id="RepTools.nn-122"><a href="#RepTools.nn-122"><span class="linenos">122</span></a>
</span><span id="RepTools.nn-123"><a href="#RepTools.nn-123"><span class="linenos">123</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.nn-124"><a href="#RepTools.nn-124"><span class="linenos">124</span></a><span class="sd">        -------</span>
</span><span id="RepTools.nn-125"><a href="#RepTools.nn-125"><span class="linenos">125</span></a><span class="sd">        dict</span>
</span><span id="RepTools.nn-126"><a href="#RepTools.nn-126"><span class="linenos">126</span></a><span class="sd">            Dictionary mapping pairs of nuclei indices to the number of close neighbors.</span>
</span><span id="RepTools.nn-127"><a href="#RepTools.nn-127"><span class="linenos">127</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.nn-128"><a href="#RepTools.nn-128"><span class="linenos">128</span></a>
</span><span id="RepTools.nn-129"><a href="#RepTools.nn-129"><span class="linenos">129</span></a>        <span class="n">full_list</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RepTools.nn-130"><a href="#RepTools.nn-130"><span class="linenos">130</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="RepTools.nn-131"><a href="#RepTools.nn-131"><span class="linenos">131</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
</span><span id="RepTools.nn-132"><a href="#RepTools.nn-132"><span class="linenos">132</span></a>                <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span><span class="p">:</span>
</span><span id="RepTools.nn-133"><a href="#RepTools.nn-133"><span class="linenos">133</span></a>
</span><span id="RepTools.nn-134"><a href="#RepTools.nn-134"><span class="linenos">134</span></a>                    <span class="n">tree1</span> <span class="o">=</span> <span class="n">cKDTree</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="RepTools.nn-135"><a href="#RepTools.nn-135"><span class="linenos">135</span></a>
</span><span id="RepTools.nn-136"><a href="#RepTools.nn-136"><span class="linenos">136</span></a>                    <span class="n">distances</span><span class="p">,</span> <span class="n">indices</span> <span class="o">=</span> <span class="n">tree1</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
</span><span id="RepTools.nn-137"><a href="#RepTools.nn-137"><span class="linenos">137</span></a>
</span><span id="RepTools.nn-138"><a href="#RepTools.nn-138"><span class="linenos">138</span></a>                    <span class="n">threshold</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="RepTools.nn-139"><a href="#RepTools.nn-139"><span class="linenos">139</span></a>                    <span class="n">close_neighbors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">distances</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">)</span>
</span><span id="RepTools.nn-140"><a href="#RepTools.nn-140"><span class="linenos">140</span></a>
</span><span id="RepTools.nn-141"><a href="#RepTools.nn-141"><span class="linenos">141</span></a>                    <span class="n">full_list</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> --&gt; </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">close_neighbors</span>
</span><span id="RepTools.nn-142"><a href="#RepTools.nn-142"><span class="linenos">142</span></a>
</span><span id="RepTools.nn-143"><a href="#RepTools.nn-143"><span class="linenos">143</span></a>        <span class="k">return</span> <span class="n">full_list</span>
</span></pre></div>


            <div class="docstring"><p>Compute close neighbors between nuclei coordinates using a threshold distance.</p>

<h2 id="parameters">Parameters</h2>

<p>coords : list
    List of numpy arrays, each containing coordinates for a nucleus.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary mapping pairs of nuclei indices to the number of close neighbors.</p>
</div>


                            </div>
                            <div id="RepTools.compute_axes_length" class="classattr">
                                        <input id="RepTools.compute_axes_length-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_axes_length</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contour</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.compute_axes_length-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.compute_axes_length"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.compute_axes_length-145"><a href="#RepTools.compute_axes_length-145"><span class="linenos">145</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_axes_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools.compute_axes_length-146"><a href="#RepTools.compute_axes_length-146"><span class="linenos">146</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.compute_axes_length-147"><a href="#RepTools.compute_axes_length-147"><span class="linenos">147</span></a><span class="sd">        Compute major and minor axis lengths of a nucleus from its contour.</span>
</span><span id="RepTools.compute_axes_length-148"><a href="#RepTools.compute_axes_length-148"><span class="linenos">148</span></a>
</span><span id="RepTools.compute_axes_length-149"><a href="#RepTools.compute_axes_length-149"><span class="linenos">149</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.compute_axes_length-150"><a href="#RepTools.compute_axes_length-150"><span class="linenos">150</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.compute_axes_length-151"><a href="#RepTools.compute_axes_length-151"><span class="linenos">151</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools.compute_axes_length-152"><a href="#RepTools.compute_axes_length-152"><span class="linenos">152</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="RepTools.compute_axes_length-153"><a href="#RepTools.compute_axes_length-153"><span class="linenos">153</span></a>
</span><span id="RepTools.compute_axes_length-154"><a href="#RepTools.compute_axes_length-154"><span class="linenos">154</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.compute_axes_length-155"><a href="#RepTools.compute_axes_length-155"><span class="linenos">155</span></a><span class="sd">        -------</span>
</span><span id="RepTools.compute_axes_length-156"><a href="#RepTools.compute_axes_length-156"><span class="linenos">156</span></a><span class="sd">        tuple</span>
</span><span id="RepTools.compute_axes_length-157"><a href="#RepTools.compute_axes_length-157"><span class="linenos">157</span></a><span class="sd">            Major and minor axis lengths.</span>
</span><span id="RepTools.compute_axes_length-158"><a href="#RepTools.compute_axes_length-158"><span class="linenos">158</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.compute_axes_length-159"><a href="#RepTools.compute_axes_length-159"><span class="linenos">159</span></a>
</span><span id="RepTools.compute_axes_length-160"><a href="#RepTools.compute_axes_length-160"><span class="linenos">160</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="RepTools.compute_axes_length-161"><a href="#RepTools.compute_axes_length-161"><span class="linenos">161</span></a>
</span><span id="RepTools.compute_axes_length-162"><a href="#RepTools.compute_axes_length-162"><span class="linenos">162</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="RepTools.compute_axes_length-163"><a href="#RepTools.compute_axes_length-163"><span class="linenos">163</span></a>
</span><span id="RepTools.compute_axes_length-164"><a href="#RepTools.compute_axes_length-164"><span class="linenos">164</span></a>        <span class="n">axis_major_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span id="RepTools.compute_axes_length-165"><a href="#RepTools.compute_axes_length-165"><span class="linenos">165</span></a>        <span class="n">axis_minor_length</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
</span><span id="RepTools.compute_axes_length-166"><a href="#RepTools.compute_axes_length-166"><span class="linenos">166</span></a>
</span><span id="RepTools.compute_axes_length-167"><a href="#RepTools.compute_axes_length-167"><span class="linenos">167</span></a>        <span class="k">return</span> <span class="n">axis_major_length</span><span class="p">,</span> <span class="n">axis_minor_length</span>
</span></pre></div>


            <div class="docstring"><p>Compute major and minor axis lengths of a nucleus from its contour.</p>

<h2 id="parameters">Parameters</h2>

<p>contour : np.ndarray
    Coordinates of nucleus contour points.</p>

<h2 id="returns">Returns</h2>

<p>tuple
    Major and minor axis lengths.</p>
</div>


                            </div>
                            <div id="RepTools.compute_eccentricity" class="classattr">
                                        <input id="RepTools.compute_eccentricity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_eccentricity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contour</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.compute_eccentricity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.compute_eccentricity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.compute_eccentricity-169"><a href="#RepTools.compute_eccentricity-169"><span class="linenos">169</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_eccentricity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools.compute_eccentricity-170"><a href="#RepTools.compute_eccentricity-170"><span class="linenos">170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.compute_eccentricity-171"><a href="#RepTools.compute_eccentricity-171"><span class="linenos">171</span></a><span class="sd">        Compute eccentricity of a nucleus from its contour.</span>
</span><span id="RepTools.compute_eccentricity-172"><a href="#RepTools.compute_eccentricity-172"><span class="linenos">172</span></a>
</span><span id="RepTools.compute_eccentricity-173"><a href="#RepTools.compute_eccentricity-173"><span class="linenos">173</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.compute_eccentricity-174"><a href="#RepTools.compute_eccentricity-174"><span class="linenos">174</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.compute_eccentricity-175"><a href="#RepTools.compute_eccentricity-175"><span class="linenos">175</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools.compute_eccentricity-176"><a href="#RepTools.compute_eccentricity-176"><span class="linenos">176</span></a><span class="sd">            Coordinates of nucleus contour points.</span>
</span><span id="RepTools.compute_eccentricity-177"><a href="#RepTools.compute_eccentricity-177"><span class="linenos">177</span></a>
</span><span id="RepTools.compute_eccentricity-178"><a href="#RepTools.compute_eccentricity-178"><span class="linenos">178</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.compute_eccentricity-179"><a href="#RepTools.compute_eccentricity-179"><span class="linenos">179</span></a><span class="sd">        -------</span>
</span><span id="RepTools.compute_eccentricity-180"><a href="#RepTools.compute_eccentricity-180"><span class="linenos">180</span></a><span class="sd">        float</span>
</span><span id="RepTools.compute_eccentricity-181"><a href="#RepTools.compute_eccentricity-181"><span class="linenos">181</span></a><span class="sd">            Eccentricity of the nucleus.</span>
</span><span id="RepTools.compute_eccentricity-182"><a href="#RepTools.compute_eccentricity-182"><span class="linenos">182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.compute_eccentricity-183"><a href="#RepTools.compute_eccentricity-183"><span class="linenos">183</span></a>
</span><span id="RepTools.compute_eccentricity-184"><a href="#RepTools.compute_eccentricity-184"><span class="linenos">184</span></a>        <span class="n">cov</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">contour</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</span><span id="RepTools.compute_eccentricity-185"><a href="#RepTools.compute_eccentricity-185"><span class="linenos">185</span></a>        <span class="n">eigvals</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">cov</span><span class="p">)</span>
</span><span id="RepTools.compute_eccentricity-186"><a href="#RepTools.compute_eccentricity-186"><span class="linenos">186</span></a>
</span><span id="RepTools.compute_eccentricity-187"><a href="#RepTools.compute_eccentricity-187"><span class="linenos">187</span></a>        <span class="n">eccentricity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">eigvals</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="n">eigvals</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
</span><span id="RepTools.compute_eccentricity-188"><a href="#RepTools.compute_eccentricity-188"><span class="linenos">188</span></a>        <span class="k">return</span> <span class="n">eccentricity</span>
</span></pre></div>


            <div class="docstring"><p>Compute eccentricity of a nucleus from its contour.</p>

<h2 id="parameters">Parameters</h2>

<p>contour : np.ndarray
    Coordinates of nucleus contour points.</p>

<h2 id="returns">Returns</h2>

<p>float
    Eccentricity of the nucleus.</p>
</div>


                            </div>
                            <div id="RepTools.compute_feret_diameter" class="classattr">
                                        <input id="RepTools.compute_feret_diameter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_feret_diameter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contour</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.compute_feret_diameter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.compute_feret_diameter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.compute_feret_diameter-190"><a href="#RepTools.compute_feret_diameter-190"><span class="linenos">190</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_feret_diameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools.compute_feret_diameter-191"><a href="#RepTools.compute_feret_diameter-191"><span class="linenos">191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.compute_feret_diameter-192"><a href="#RepTools.compute_feret_diameter-192"><span class="linenos">192</span></a><span class="sd">        Compute the Feret diameter of a given contour.</span>
</span><span id="RepTools.compute_feret_diameter-193"><a href="#RepTools.compute_feret_diameter-193"><span class="linenos">193</span></a>
</span><span id="RepTools.compute_feret_diameter-194"><a href="#RepTools.compute_feret_diameter-194"><span class="linenos">194</span></a><span class="sd">        The Feret diameter is defined as the maximum pairwise Euclidean distance between points in the contour.</span>
</span><span id="RepTools.compute_feret_diameter-195"><a href="#RepTools.compute_feret_diameter-195"><span class="linenos">195</span></a>
</span><span id="RepTools.compute_feret_diameter-196"><a href="#RepTools.compute_feret_diameter-196"><span class="linenos">196</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.compute_feret_diameter-197"><a href="#RepTools.compute_feret_diameter-197"><span class="linenos">197</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.compute_feret_diameter-198"><a href="#RepTools.compute_feret_diameter-198"><span class="linenos">198</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools.compute_feret_diameter-199"><a href="#RepTools.compute_feret_diameter-199"><span class="linenos">199</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools.compute_feret_diameter-200"><a href="#RepTools.compute_feret_diameter-200"><span class="linenos">200</span></a>
</span><span id="RepTools.compute_feret_diameter-201"><a href="#RepTools.compute_feret_diameter-201"><span class="linenos">201</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.compute_feret_diameter-202"><a href="#RepTools.compute_feret_diameter-202"><span class="linenos">202</span></a><span class="sd">        -------</span>
</span><span id="RepTools.compute_feret_diameter-203"><a href="#RepTools.compute_feret_diameter-203"><span class="linenos">203</span></a><span class="sd">        float</span>
</span><span id="RepTools.compute_feret_diameter-204"><a href="#RepTools.compute_feret_diameter-204"><span class="linenos">204</span></a><span class="sd">            The maximum distance between any two points in the contour.</span>
</span><span id="RepTools.compute_feret_diameter-205"><a href="#RepTools.compute_feret_diameter-205"><span class="linenos">205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.compute_feret_diameter-206"><a href="#RepTools.compute_feret_diameter-206"><span class="linenos">206</span></a>
</span><span id="RepTools.compute_feret_diameter-207"><a href="#RepTools.compute_feret_diameter-207"><span class="linenos">207</span></a>        <span class="n">rect</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">minAreaRect</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools.compute_feret_diameter-208"><a href="#RepTools.compute_feret_diameter-208"><span class="linenos">208</span></a>        <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">=</span> <span class="n">rect</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="RepTools.compute_feret_diameter-209"><a href="#RepTools.compute_feret_diameter-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the Feret diameter of a given contour.</p>

<p>The Feret diameter is defined as the maximum pairwise Euclidean distance between points in the contour.</p>

<h2 id="parameters">Parameters</h2>

<p>contour : np.ndarray
    Array of shape (N, 2) representing the contour coordinates.</p>

<h2 id="returns">Returns</h2>

<p>float
    The maximum distance between any two points in the contour.</p>
</div>


                            </div>
                            <div id="RepTools.compute_perimeter" class="classattr">
                                        <input id="RepTools.compute_perimeter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_perimeter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contour</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.compute_perimeter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.compute_perimeter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.compute_perimeter-211"><a href="#RepTools.compute_perimeter-211"><span class="linenos">211</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_perimeter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools.compute_perimeter-212"><a href="#RepTools.compute_perimeter-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.compute_perimeter-213"><a href="#RepTools.compute_perimeter-213"><span class="linenos">213</span></a><span class="sd">        Compute the perimeter of a contour.</span>
</span><span id="RepTools.compute_perimeter-214"><a href="#RepTools.compute_perimeter-214"><span class="linenos">214</span></a>
</span><span id="RepTools.compute_perimeter-215"><a href="#RepTools.compute_perimeter-215"><span class="linenos">215</span></a><span class="sd">        The perimeter is calculated as the sum of Euclidean distances between consecutive points in the contour.</span>
</span><span id="RepTools.compute_perimeter-216"><a href="#RepTools.compute_perimeter-216"><span class="linenos">216</span></a>
</span><span id="RepTools.compute_perimeter-217"><a href="#RepTools.compute_perimeter-217"><span class="linenos">217</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.compute_perimeter-218"><a href="#RepTools.compute_perimeter-218"><span class="linenos">218</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.compute_perimeter-219"><a href="#RepTools.compute_perimeter-219"><span class="linenos">219</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools.compute_perimeter-220"><a href="#RepTools.compute_perimeter-220"><span class="linenos">220</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools.compute_perimeter-221"><a href="#RepTools.compute_perimeter-221"><span class="linenos">221</span></a>
</span><span id="RepTools.compute_perimeter-222"><a href="#RepTools.compute_perimeter-222"><span class="linenos">222</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.compute_perimeter-223"><a href="#RepTools.compute_perimeter-223"><span class="linenos">223</span></a><span class="sd">        -------</span>
</span><span id="RepTools.compute_perimeter-224"><a href="#RepTools.compute_perimeter-224"><span class="linenos">224</span></a><span class="sd">        float</span>
</span><span id="RepTools.compute_perimeter-225"><a href="#RepTools.compute_perimeter-225"><span class="linenos">225</span></a><span class="sd">            Perimeter length of the contour.</span>
</span><span id="RepTools.compute_perimeter-226"><a href="#RepTools.compute_perimeter-226"><span class="linenos">226</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.compute_perimeter-227"><a href="#RepTools.compute_perimeter-227"><span class="linenos">227</span></a>
</span><span id="RepTools.compute_perimeter-228"><a href="#RepTools.compute_perimeter-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Compute the perimeter of a contour.</p>

<p>The perimeter is calculated as the sum of Euclidean distances between consecutive points in the contour.</p>

<h2 id="parameters">Parameters</h2>

<p>contour : np.ndarray
    Array of shape (N, 2) representing the contour coordinates.</p>

<h2 id="returns">Returns</h2>

<p>float
    Perimeter length of the contour.</p>
</div>


                            </div>
                            <div id="RepTools.compute_circularity" class="classattr">
                                        <input id="RepTools.compute_circularity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compute_circularity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contour</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.compute_circularity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.compute_circularity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.compute_circularity-230"><a href="#RepTools.compute_circularity-230"><span class="linenos">230</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">compute_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contour</span><span class="p">):</span>
</span><span id="RepTools.compute_circularity-231"><a href="#RepTools.compute_circularity-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.compute_circularity-232"><a href="#RepTools.compute_circularity-232"><span class="linenos">232</span></a><span class="sd">        Compute the circularity of a contour.</span>
</span><span id="RepTools.compute_circularity-233"><a href="#RepTools.compute_circularity-233"><span class="linenos">233</span></a>
</span><span id="RepTools.compute_circularity-234"><a href="#RepTools.compute_circularity-234"><span class="linenos">234</span></a><span class="sd">        Circularity is a measure of how close the shape is to a perfect circle.</span>
</span><span id="RepTools.compute_circularity-235"><a href="#RepTools.compute_circularity-235"><span class="linenos">235</span></a><span class="sd">        It is calculated as 4 * pi * (area / perimeter^2).</span>
</span><span id="RepTools.compute_circularity-236"><a href="#RepTools.compute_circularity-236"><span class="linenos">236</span></a>
</span><span id="RepTools.compute_circularity-237"><a href="#RepTools.compute_circularity-237"><span class="linenos">237</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.compute_circularity-238"><a href="#RepTools.compute_circularity-238"><span class="linenos">238</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.compute_circularity-239"><a href="#RepTools.compute_circularity-239"><span class="linenos">239</span></a><span class="sd">        contour : np.ndarray</span>
</span><span id="RepTools.compute_circularity-240"><a href="#RepTools.compute_circularity-240"><span class="linenos">240</span></a><span class="sd">            Array of shape (N, 2) representing the contour coordinates.</span>
</span><span id="RepTools.compute_circularity-241"><a href="#RepTools.compute_circularity-241"><span class="linenos">241</span></a>
</span><span id="RepTools.compute_circularity-242"><a href="#RepTools.compute_circularity-242"><span class="linenos">242</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.compute_circularity-243"><a href="#RepTools.compute_circularity-243"><span class="linenos">243</span></a><span class="sd">        -------</span>
</span><span id="RepTools.compute_circularity-244"><a href="#RepTools.compute_circularity-244"><span class="linenos">244</span></a><span class="sd">        float</span>
</span><span id="RepTools.compute_circularity-245"><a href="#RepTools.compute_circularity-245"><span class="linenos">245</span></a><span class="sd">            Circularity of the contour. Value ranges from 0 to 1, where 1 indicates a perfect circle.</span>
</span><span id="RepTools.compute_circularity-246"><a href="#RepTools.compute_circularity-246"><span class="linenos">246</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.compute_circularity-247"><a href="#RepTools.compute_circularity-247"><span class="linenos">247</span></a>        <span class="n">perimeter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_perimeter</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools.compute_circularity-248"><a href="#RepTools.compute_circularity-248"><span class="linenos">248</span></a>        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
</span><span id="RepTools.compute_circularity-249"><a href="#RepTools.compute_circularity-249"><span class="linenos">249</span></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">hull</span><span class="o">.</span><span class="n">volume</span>
</span><span id="RepTools.compute_circularity-250"><a href="#RepTools.compute_circularity-250"><span class="linenos">250</span></a>
</span><span id="RepTools.compute_circularity-251"><a href="#RepTools.compute_circularity-251"><span class="linenos">251</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the circularity of a contour.</p>

<p>Circularity is a measure of how close the shape is to a perfect circle.
It is calculated as 4 * pi * (area / perimeter^2).</p>

<h2 id="parameters">Parameters</h2>

<p>contour : np.ndarray
    Array of shape (N, 2) representing the contour coordinates.</p>

<h2 id="returns">Returns</h2>

<p>float
    Circularity of the contour. Value ranges from 0 to 1, where 1 indicates a perfect circle.</p>
</div>


                            </div>
                            <div id="RepTools.repairing_nuclei" class="classattr">
                                        <input id="RepTools.repairing_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">repairing_nuclei</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">results</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="RepTools.repairing_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#RepTools.repairing_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="RepTools.repairing_nuclei-253"><a href="#RepTools.repairing_nuclei-253"><span class="linenos">253</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">repairing_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">):</span>
</span><span id="RepTools.repairing_nuclei-254"><a href="#RepTools.repairing_nuclei-254"><span class="linenos">254</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="RepTools.repairing_nuclei-255"><a href="#RepTools.repairing_nuclei-255"><span class="linenos">255</span></a><span class="sd">        Repair nuclei segmentation results by merging or removing outlier nuclei.</span>
</span><span id="RepTools.repairing_nuclei-256"><a href="#RepTools.repairing_nuclei-256"><span class="linenos">256</span></a>
</span><span id="RepTools.repairing_nuclei-257"><a href="#RepTools.repairing_nuclei-257"><span class="linenos">257</span></a><span class="sd">        This method adjusts nuclei detection results based on global and local thresholds, circularity, nearest neighbor relationships,</span>
</span><span id="RepTools.repairing_nuclei-258"><a href="#RepTools.repairing_nuclei-258"><span class="linenos">258</span></a><span class="sd">        and merges small or fragmented nuclei when appropriate. It also recalculates key morphological properties for merged nuclei.</span>
</span><span id="RepTools.repairing_nuclei-259"><a href="#RepTools.repairing_nuclei-259"><span class="linenos">259</span></a>
</span><span id="RepTools.repairing_nuclei-260"><a href="#RepTools.repairing_nuclei-260"><span class="linenos">260</span></a><span class="sd">        Parameters</span>
</span><span id="RepTools.repairing_nuclei-261"><a href="#RepTools.repairing_nuclei-261"><span class="linenos">261</span></a><span class="sd">        ----------</span>
</span><span id="RepTools.repairing_nuclei-262"><a href="#RepTools.repairing_nuclei-262"><span class="linenos">262</span></a><span class="sd">        results : dict</span>
</span><span id="RepTools.repairing_nuclei-263"><a href="#RepTools.repairing_nuclei-263"><span class="linenos">263</span></a><span class="sd">            Dictionary where keys are image identifiers and values are dictionaries containing detected nuclei properties</span>
</span><span id="RepTools.repairing_nuclei-264"><a href="#RepTools.repairing_nuclei-264"><span class="linenos">264</span></a><span class="sd">            (e.g., &#39;area&#39;, &#39;coords&#39;, &#39;label&#39;, &#39;circularity&#39;, etc.).</span>
</span><span id="RepTools.repairing_nuclei-265"><a href="#RepTools.repairing_nuclei-265"><span class="linenos">265</span></a>
</span><span id="RepTools.repairing_nuclei-266"><a href="#RepTools.repairing_nuclei-266"><span class="linenos">266</span></a><span class="sd">        Returns</span>
</span><span id="RepTools.repairing_nuclei-267"><a href="#RepTools.repairing_nuclei-267"><span class="linenos">267</span></a><span class="sd">        -------</span>
</span><span id="RepTools.repairing_nuclei-268"><a href="#RepTools.repairing_nuclei-268"><span class="linenos">268</span></a><span class="sd">        dict</span>
</span><span id="RepTools.repairing_nuclei-269"><a href="#RepTools.repairing_nuclei-269"><span class="linenos">269</span></a><span class="sd">            A dictionary in the same structure as `results`, but with repaired nuclei information after merging or removing outliers.</span>
</span><span id="RepTools.repairing_nuclei-270"><a href="#RepTools.repairing_nuclei-270"><span class="linenos">270</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="RepTools.repairing_nuclei-271"><a href="#RepTools.repairing_nuclei-271"><span class="linenos">271</span></a>
</span><span id="RepTools.repairing_nuclei-272"><a href="#RepTools.repairing_nuclei-272"><span class="linenos">272</span></a>        <span class="c1"># repairing nuclei</span>
</span><span id="RepTools.repairing_nuclei-273"><a href="#RepTools.repairing_nuclei-273"><span class="linenos">273</span></a>        <span class="n">mean_sum_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.repairing_nuclei-274"><a href="#RepTools.repairing_nuclei-274"><span class="linenos">274</span></a>        <span class="n">im</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.repairing_nuclei-275"><a href="#RepTools.repairing_nuclei-275"><span class="linenos">275</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.repairing_nuclei-276"><a href="#RepTools.repairing_nuclei-276"><span class="linenos">276</span></a>        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="RepTools.repairing_nuclei-277"><a href="#RepTools.repairing_nuclei-277"><span class="linenos">277</span></a>            <span class="n">mean_sum_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="RepTools.repairing_nuclei-278"><a href="#RepTools.repairing_nuclei-278"><span class="linenos">278</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]))</span>
</span><span id="RepTools.repairing_nuclei-279"><a href="#RepTools.repairing_nuclei-279"><span class="linenos">279</span></a>            <span class="n">im</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-280"><a href="#RepTools.repairing_nuclei-280"><span class="linenos">280</span></a>
</span><span id="RepTools.repairing_nuclei-281"><a href="#RepTools.repairing_nuclei-281"><span class="linenos">281</span></a>        <span class="n">mean_sum_area_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_sum_area</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-282"><a href="#RepTools.repairing_nuclei-282"><span class="linenos">282</span></a>
</span><span id="RepTools.repairing_nuclei-283"><a href="#RepTools.repairing_nuclei-283"><span class="linenos">283</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="RepTools.repairing_nuclei-284"><a href="#RepTools.repairing_nuclei-284"><span class="linenos">284</span></a>
</span><span id="RepTools.repairing_nuclei-285"><a href="#RepTools.repairing_nuclei-285"><span class="linenos">285</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Image repairing:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-286"><a href="#RepTools.repairing_nuclei-286"><span class="linenos">286</span></a>
</span><span id="RepTools.repairing_nuclei-287"><a href="#RepTools.repairing_nuclei-287"><span class="linenos">287</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">im</span><span class="p">)):</span>
</span><span id="RepTools.repairing_nuclei-288"><a href="#RepTools.repairing_nuclei-288"><span class="linenos">288</span></a>
</span><span id="RepTools.repairing_nuclei-289"><a href="#RepTools.repairing_nuclei-289"><span class="linenos">289</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="RepTools.repairing_nuclei-290"><a href="#RepTools.repairing_nuclei-290"><span class="linenos">290</span></a>                <span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span>
</span><span id="RepTools.repairing_nuclei-291"><a href="#RepTools.repairing_nuclei-291"><span class="linenos">291</span></a>                <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">mean_sum_area_sum</span>
</span><span id="RepTools.repairing_nuclei-292"><a href="#RepTools.repairing_nuclei-292"><span class="linenos">292</span></a>                <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-293"><a href="#RepTools.repairing_nuclei-293"><span class="linenos">293</span></a>            <span class="p">):</span>
</span><span id="RepTools.repairing_nuclei-294"><a href="#RepTools.repairing_nuclei-294"><span class="linenos">294</span></a>                <span class="c1"># adjustment to global changes</span>
</span><span id="RepTools.repairing_nuclei-295"><a href="#RepTools.repairing_nuclei-295"><span class="linenos">295</span></a>
</span><span id="RepTools.repairing_nuclei-296"><a href="#RepTools.repairing_nuclei-296"><span class="linenos">296</span></a>                <span class="n">temporary_dict</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-297"><a href="#RepTools.repairing_nuclei-297"><span class="linenos">297</span></a>
</span><span id="RepTools.repairing_nuclei-298"><a href="#RepTools.repairing_nuclei-298"><span class="linenos">298</span></a>                <span class="n">check_drop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_outlires</span><span class="p">(</span>
</span><span id="RepTools.repairing_nuclei-299"><a href="#RepTools.repairing_nuclei-299"><span class="linenos">299</span></a>                    <span class="n">temporary_dict</span><span class="p">,</span>
</span><span id="RepTools.repairing_nuclei-300"><a href="#RepTools.repairing_nuclei-300"><span class="linenos">300</span></a>                    <span class="n">diff_FC_intensity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-301"><a href="#RepTools.repairing_nuclei-301"><span class="linenos">301</span></a>                        <span class="s2">&quot;FC_diff_local_intensity&quot;</span>
</span><span id="RepTools.repairing_nuclei-302"><a href="#RepTools.repairing_nuclei-302"><span class="linenos">302</span></a>                    <span class="p">],</span>
</span><span id="RepTools.repairing_nuclei-303"><a href="#RepTools.repairing_nuclei-303"><span class="linenos">303</span></a>                    <span class="n">circ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">],</span>
</span><span id="RepTools.repairing_nuclei-304"><a href="#RepTools.repairing_nuclei-304"><span class="linenos">304</span></a>                <span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-305"><a href="#RepTools.repairing_nuclei-305"><span class="linenos">305</span></a>
</span><span id="RepTools.repairing_nuclei-306"><a href="#RepTools.repairing_nuclei-306"><span class="linenos">306</span></a>                <span class="n">to_final</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-307"><a href="#RepTools.repairing_nuclei-307"><span class="linenos">307</span></a>                    <span class="n">x</span>
</span><span id="RepTools.repairing_nuclei-308"><a href="#RepTools.repairing_nuclei-308"><span class="linenos">308</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span>
</span><span id="RepTools.repairing_nuclei-309"><a href="#RepTools.repairing_nuclei-309"><span class="linenos">309</span></a>                    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">check_drop</span>
</span><span id="RepTools.repairing_nuclei-310"><a href="#RepTools.repairing_nuclei-310"><span class="linenos">310</span></a>                <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-311"><a href="#RepTools.repairing_nuclei-311"><span class="linenos">311</span></a>
</span><span id="RepTools.repairing_nuclei-312"><a href="#RepTools.repairing_nuclei-312"><span class="linenos">312</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">temporary_dict</span><span class="p">,</span> <span class="n">to_final</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-313"><a href="#RepTools.repairing_nuclei-313"><span class="linenos">313</span></a>
</span><span id="RepTools.repairing_nuclei-314"><a href="#RepTools.repairing_nuclei-314"><span class="linenos">314</span></a>                <span class="n">to_concat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="RepTools.repairing_nuclei-315"><a href="#RepTools.repairing_nuclei-315"><span class="linenos">315</span></a>
</span><span id="RepTools.repairing_nuclei-316"><a href="#RepTools.repairing_nuclei-316"><span class="linenos">316</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RepTools.repairing_nuclei-317"><a href="#RepTools.repairing_nuclei-317"><span class="linenos">317</span></a>
</span><span id="RepTools.repairing_nuclei-318"><a href="#RepTools.repairing_nuclei-318"><span class="linenos">318</span></a>                    <span class="n">results_nn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-319"><a href="#RepTools.repairing_nuclei-319"><span class="linenos">319</span></a>
</span><span id="RepTools.repairing_nuclei-320"><a href="#RepTools.repairing_nuclei-320"><span class="linenos">320</span></a>                    <span class="k">for</span> <span class="n">kn</span> <span class="ow">in</span> <span class="n">results_nn</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="RepTools.repairing_nuclei-321"><a href="#RepTools.repairing_nuclei-321"><span class="linenos">321</span></a>                        <span class="k">if</span> <span class="n">results_nn</span><span class="p">[</span><span class="n">kn</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nn_min&quot;</span><span class="p">]:</span>
</span><span id="RepTools.repairing_nuclei-322"><a href="#RepTools.repairing_nuclei-322"><span class="linenos">322</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; --&gt; .*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="RepTools.repairing_nuclei-323"><a href="#RepTools.repairing_nuclei-323"><span class="linenos">323</span></a>                            <span class="n">to_concat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.* --&gt; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">kn</span><span class="p">)))</span>
</span><span id="RepTools.repairing_nuclei-324"><a href="#RepTools.repairing_nuclei-324"><span class="linenos">324</span></a>
</span><span id="RepTools.repairing_nuclei-325"><a href="#RepTools.repairing_nuclei-325"><span class="linenos">325</span></a>                    <span class="n">to_concat</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_concat</span><span class="p">))</span>
</span><span id="RepTools.repairing_nuclei-326"><a href="#RepTools.repairing_nuclei-326"><span class="linenos">326</span></a>
</span><span id="RepTools.repairing_nuclei-327"><a href="#RepTools.repairing_nuclei-327"><span class="linenos">327</span></a>                    <span class="n">to_rest</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-328"><a href="#RepTools.repairing_nuclei-328"><span class="linenos">328</span></a>                        <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])))</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_concat</span>
</span><span id="RepTools.repairing_nuclei-329"><a href="#RepTools.repairing_nuclei-329"><span class="linenos">329</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-330"><a href="#RepTools.repairing_nuclei-330"><span class="linenos">330</span></a>
</span><span id="RepTools.repairing_nuclei-331"><a href="#RepTools.repairing_nuclei-331"><span class="linenos">331</span></a>                <span class="c1">#</span>
</span><span id="RepTools.repairing_nuclei-332"><a href="#RepTools.repairing_nuclei-332"><span class="linenos">332</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_concat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="RepTools.repairing_nuclei-333"><a href="#RepTools.repairing_nuclei-333"><span class="linenos">333</span></a>                    <span class="n">to_concat_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_concat</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-334"><a href="#RepTools.repairing_nuclei-334"><span class="linenos">334</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-335"><a href="#RepTools.repairing_nuclei-335"><span class="linenos">335</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-336"><a href="#RepTools.repairing_nuclei-336"><span class="linenos">336</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-337"><a href="#RepTools.repairing_nuclei-337"><span class="linenos">337</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-338"><a href="#RepTools.repairing_nuclei-338"><span class="linenos">338</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-339"><a href="#RepTools.repairing_nuclei-339"><span class="linenos">339</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-340"><a href="#RepTools.repairing_nuclei-340"><span class="linenos">340</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-341"><a href="#RepTools.repairing_nuclei-341"><span class="linenos">341</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-342"><a href="#RepTools.repairing_nuclei-342"><span class="linenos">342</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-343"><a href="#RepTools.repairing_nuclei-343"><span class="linenos">343</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-344"><a href="#RepTools.repairing_nuclei-344"><span class="linenos">344</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-345"><a href="#RepTools.repairing_nuclei-345"><span class="linenos">345</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-346"><a href="#RepTools.repairing_nuclei-346"><span class="linenos">346</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-347"><a href="#RepTools.repairing_nuclei-347"><span class="linenos">347</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-348"><a href="#RepTools.repairing_nuclei-348"><span class="linenos">348</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-349"><a href="#RepTools.repairing_nuclei-349"><span class="linenos">349</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-350"><a href="#RepTools.repairing_nuclei-350"><span class="linenos">350</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-351"><a href="#RepTools.repairing_nuclei-351"><span class="linenos">351</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-352"><a href="#RepTools.repairing_nuclei-352"><span class="linenos">352</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-353"><a href="#RepTools.repairing_nuclei-353"><span class="linenos">353</span></a>                    <span class="n">major</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_axes_length</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-354"><a href="#RepTools.repairing_nuclei-354"><span class="linenos">354</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">major</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-355"><a href="#RepTools.repairing_nuclei-355"><span class="linenos">355</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-356"><a href="#RepTools.repairing_nuclei-356"><span class="linenos">356</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">minor</span> <span class="o">/</span> <span class="n">major</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-357"><a href="#RepTools.repairing_nuclei-357"><span class="linenos">357</span></a>                    <span class="n">ecc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_eccentricity</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-358"><a href="#RepTools.repairing_nuclei-358"><span class="linenos">358</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ecc</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-359"><a href="#RepTools.repairing_nuclei-359"><span class="linenos">359</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-360"><a href="#RepTools.repairing_nuclei-360"><span class="linenos">360</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-361"><a href="#RepTools.repairing_nuclei-361"><span class="linenos">361</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-362"><a href="#RepTools.repairing_nuclei-362"><span class="linenos">362</span></a>                    <span class="n">feret_diameter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_feret_diameter</span><span class="p">(</span>
</span><span id="RepTools.repairing_nuclei-363"><a href="#RepTools.repairing_nuclei-363"><span class="linenos">363</span></a>                        <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-364"><a href="#RepTools.repairing_nuclei-364"><span class="linenos">364</span></a>                    <span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-365"><a href="#RepTools.repairing_nuclei-365"><span class="linenos">365</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">feret_diameter</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-366"><a href="#RepTools.repairing_nuclei-366"><span class="linenos">366</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-367"><a href="#RepTools.repairing_nuclei-367"><span class="linenos">367</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">])]</span>
</span><span id="RepTools.repairing_nuclei-368"><a href="#RepTools.repairing_nuclei-368"><span class="linenos">368</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-369"><a href="#RepTools.repairing_nuclei-369"><span class="linenos">369</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-370"><a href="#RepTools.repairing_nuclei-370"><span class="linenos">370</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-371"><a href="#RepTools.repairing_nuclei-371"><span class="linenos">371</span></a>                    <span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="RepTools.repairing_nuclei-372"><a href="#RepTools.repairing_nuclei-372"><span class="linenos">372</span></a>                        <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">to_concat_dict</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">])</span>
</span><span id="RepTools.repairing_nuclei-373"><a href="#RepTools.repairing_nuclei-373"><span class="linenos">373</span></a>                    <span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-374"><a href="#RepTools.repairing_nuclei-374"><span class="linenos">374</span></a>
</span><span id="RepTools.repairing_nuclei-375"><a href="#RepTools.repairing_nuclei-375"><span class="linenos">375</span></a>                    <span class="n">to_rest_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_dict_by_indices</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">to_rest</span><span class="p">)</span>
</span><span id="RepTools.repairing_nuclei-376"><a href="#RepTools.repairing_nuclei-376"><span class="linenos">376</span></a>
</span><span id="RepTools.repairing_nuclei-377"><a href="#RepTools.repairing_nuclei-377"><span class="linenos">377</span></a>                    <span class="k">for</span> <span class="n">ik</span> <span class="ow">in</span> <span class="n">to_rest_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="RepTools.repairing_nuclei-378"><a href="#RepTools.repairing_nuclei-378"><span class="linenos">378</span></a>                        <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span> <span class="o">+</span> <span class="n">to_concat_dict</span><span class="p">[</span><span class="n">ik</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-379"><a href="#RepTools.repairing_nuclei-379"><span class="linenos">379</span></a>
</span><span id="RepTools.repairing_nuclei-380"><a href="#RepTools.repairing_nuclei-380"><span class="linenos">380</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_rest_dict</span>
</span><span id="RepTools.repairing_nuclei-381"><a href="#RepTools.repairing_nuclei-381"><span class="linenos">381</span></a>
</span><span id="RepTools.repairing_nuclei-382"><a href="#RepTools.repairing_nuclei-382"><span class="linenos">382</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="RepTools.repairing_nuclei-383"><a href="#RepTools.repairing_nuclei-383"><span class="linenos">383</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</span><span id="RepTools.repairing_nuclei-384"><a href="#RepTools.repairing_nuclei-384"><span class="linenos">384</span></a>
</span><span id="RepTools.repairing_nuclei-385"><a href="#RepTools.repairing_nuclei-385"><span class="linenos">385</span></a>            <span class="k">elif</span> <span class="p">(</span>
</span><span id="RepTools.repairing_nuclei-386"><a href="#RepTools.repairing_nuclei-386"><span class="linenos">386</span></a>                <span class="n">m</span> <span class="o">==</span> <span class="mi">1</span>
</span><span id="RepTools.repairing_nuclei-387"><a href="#RepTools.repairing_nuclei-387"><span class="linenos">387</span></a>                <span class="ow">and</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-388"><a href="#RepTools.repairing_nuclei-388"><span class="linenos">388</span></a>                <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-389"><a href="#RepTools.repairing_nuclei-389"><span class="linenos">389</span></a>            <span class="p">):</span>
</span><span id="RepTools.repairing_nuclei-390"><a href="#RepTools.repairing_nuclei-390"><span class="linenos">390</span></a>
</span><span id="RepTools.repairing_nuclei-391"><a href="#RepTools.repairing_nuclei-391"><span class="linenos">391</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="RepTools.repairing_nuclei-392"><a href="#RepTools.repairing_nuclei-392"><span class="linenos">392</span></a>
</span><span id="RepTools.repairing_nuclei-393"><a href="#RepTools.repairing_nuclei-393"><span class="linenos">393</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>Repair nuclei segmentation results by merging or removing outlier nuclei.</p>

<p>This method adjusts nuclei detection results based on global and local thresholds, circularity, nearest neighbor relationships,
and merges small or fragmented nuclei when appropriate. It also recalculates key morphological properties for merged nuclei.</p>

<h2 id="parameters">Parameters</h2>

<p>results : dict
    Dictionary where keys are image identifiers and values are dictionaries containing detected nuclei properties
    (e.g., 'area', 'coords', 'label', 'circularity', etc.).</p>

<h2 id="returns">Returns</h2>

<p>dict
    A dictionary in the same structure as <code>results</code>, but with repaired nuclei information after merging or removing outliers.</p>
</div>


                            </div>
                </section>
                <section id="ImagesManagement">
                            <input id="ImagesManagement-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ImagesManagement</span>:

                <label class="view-source-button" for="ImagesManagement-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement-396"><a href="#ImagesManagement-396"><span class="linenos">396</span></a><span class="k">class</span><span class="w"> </span><span class="nc">ImagesManagement</span><span class="p">:</span>
</span><span id="ImagesManagement-397"><a href="#ImagesManagement-397"><span class="linenos">397</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-398"><a href="#ImagesManagement-398"><span class="linenos">398</span></a><span class="sd">    A class for managing, preprocessing, merging, stitching, saving, and loading</span>
</span><span id="ImagesManagement-399"><a href="#ImagesManagement-399"><span class="linenos">399</span></a><span class="sd">    microscopy or flow cytometry images used in NucleiFinder-based analyses.</span>
</span><span id="ImagesManagement-400"><a href="#ImagesManagement-400"><span class="linenos">400</span></a>
</span><span id="ImagesManagement-401"><a href="#ImagesManagement-401"><span class="linenos">401</span></a><span class="sd">    This class provides a unified interface for:</span>
</span><span id="ImagesManagement-402"><a href="#ImagesManagement-402"><span class="linenos">402</span></a>
</span><span id="ImagesManagement-403"><a href="#ImagesManagement-403"><span class="linenos">403</span></a><span class="sd">    - loading image data,</span>
</span><span id="ImagesManagement-404"><a href="#ImagesManagement-404"><span class="linenos">404</span></a><span class="sd">    - selecting images by IDs,</span>
</span><span id="ImagesManagement-405"><a href="#ImagesManagement-405"><span class="linenos">405</span></a><span class="sd">    - preprocessing images (equalization, CLAHE, gamma/contrast/brightness adjustment),</span>
</span><span id="ImagesManagement-406"><a href="#ImagesManagement-406"><span class="linenos">406</span></a><span class="sd">    - merging images with user-defined intensity ratios,</span>
</span><span id="ImagesManagement-407"><a href="#ImagesManagement-407"><span class="linenos">407</span></a><span class="sd">    - stitching images horizontally,</span>
</span><span id="ImagesManagement-408"><a href="#ImagesManagement-408"><span class="linenos">408</span></a><span class="sd">    - retrieving and saving processed image sets.</span>
</span><span id="ImagesManagement-409"><a href="#ImagesManagement-409"><span class="linenos">409</span></a>
</span><span id="ImagesManagement-410"><a href="#ImagesManagement-410"><span class="linenos">410</span></a><span class="sd">    The class stores original or loaded data in the ``results_images`` attribute,</span>
</span><span id="ImagesManagement-411"><a href="#ImagesManagement-411"><span class="linenos">411</span></a><span class="sd">    and all processed images in ``prepared_images`` under user-defined acronyms.</span>
</span><span id="ImagesManagement-412"><a href="#ImagesManagement-412"><span class="linenos">412</span></a><span class="sd">    These acronyms allow flexible retrieval with ``get_prepared_images()``</span>
</span><span id="ImagesManagement-413"><a href="#ImagesManagement-413"><span class="linenos">413</span></a><span class="sd">    and exporting via ``save_prepared_images()``.</span>
</span><span id="ImagesManagement-414"><a href="#ImagesManagement-414"><span class="linenos">414</span></a>
</span><span id="ImagesManagement-415"><a href="#ImagesManagement-415"><span class="linenos">415</span></a><span class="sd">    Parameters</span>
</span><span id="ImagesManagement-416"><a href="#ImagesManagement-416"><span class="linenos">416</span></a><span class="sd">    ----------</span>
</span><span id="ImagesManagement-417"><a href="#ImagesManagement-417"><span class="linenos">417</span></a><span class="sd">    images_ids : list[int]</span>
</span><span id="ImagesManagement-418"><a href="#ImagesManagement-418"><span class="linenos">418</span></a><span class="sd">        List of selected image identifiers.</span>
</span><span id="ImagesManagement-419"><a href="#ImagesManagement-419"><span class="linenos">419</span></a>
</span><span id="ImagesManagement-420"><a href="#ImagesManagement-420"><span class="linenos">420</span></a><span class="sd">    result_dict : dict or None</span>
</span><span id="ImagesManagement-421"><a href="#ImagesManagement-421"><span class="linenos">421</span></a><span class="sd">        Dictionary containing raw or preprocessed images.</span>
</span><span id="ImagesManagement-422"><a href="#ImagesManagement-422"><span class="linenos">422</span></a><span class="sd">        If ``None``, images may later be loaded or processed from file.</span>
</span><span id="ImagesManagement-423"><a href="#ImagesManagement-423"><span class="linenos">423</span></a>
</span><span id="ImagesManagement-424"><a href="#ImagesManagement-424"><span class="linenos">424</span></a><span class="sd">    experiment_name : str</span>
</span><span id="ImagesManagement-425"><a href="#ImagesManagement-425"><span class="linenos">425</span></a><span class="sd">        Name of the experiment. Used for saving and structuring output.</span>
</span><span id="ImagesManagement-426"><a href="#ImagesManagement-426"><span class="linenos">426</span></a>
</span><span id="ImagesManagement-427"><a href="#ImagesManagement-427"><span class="linenos">427</span></a><span class="sd">    Attributes</span>
</span><span id="ImagesManagement-428"><a href="#ImagesManagement-428"><span class="linenos">428</span></a><span class="sd">    ----------</span>
</span><span id="ImagesManagement-429"><a href="#ImagesManagement-429"><span class="linenos">429</span></a><span class="sd">    images_ids : list[int]</span>
</span><span id="ImagesManagement-430"><a href="#ImagesManagement-430"><span class="linenos">430</span></a><span class="sd">        IDs of images managed by the class.</span>
</span><span id="ImagesManagement-431"><a href="#ImagesManagement-431"><span class="linenos">431</span></a>
</span><span id="ImagesManagement-432"><a href="#ImagesManagement-432"><span class="linenos">432</span></a><span class="sd">    results_images : dict or None</span>
</span><span id="ImagesManagement-433"><a href="#ImagesManagement-433"><span class="linenos">433</span></a><span class="sd">        Dictionary containing raw or analysis-derived images.</span>
</span><span id="ImagesManagement-434"><a href="#ImagesManagement-434"><span class="linenos">434</span></a>
</span><span id="ImagesManagement-435"><a href="#ImagesManagement-435"><span class="linenos">435</span></a><span class="sd">    experiment_name : str</span>
</span><span id="ImagesManagement-436"><a href="#ImagesManagement-436"><span class="linenos">436</span></a><span class="sd">        Name of the experiment. Used in saved filenames.</span>
</span><span id="ImagesManagement-437"><a href="#ImagesManagement-437"><span class="linenos">437</span></a>
</span><span id="ImagesManagement-438"><a href="#ImagesManagement-438"><span class="linenos">438</span></a><span class="sd">    prepared_images : dict</span>
</span><span id="ImagesManagement-439"><a href="#ImagesManagement-439"><span class="linenos">439</span></a><span class="sd">        Container for processed/adjusted/merged/stitched images,</span>
</span><span id="ImagesManagement-440"><a href="#ImagesManagement-440"><span class="linenos">440</span></a><span class="sd">        indexed by user-defined acronyms.</span>
</span><span id="ImagesManagement-441"><a href="#ImagesManagement-441"><span class="linenos">441</span></a>
</span><span id="ImagesManagement-442"><a href="#ImagesManagement-442"><span class="linenos">442</span></a><span class="sd">    Notes</span>
</span><span id="ImagesManagement-443"><a href="#ImagesManagement-443"><span class="linenos">443</span></a><span class="sd">    -----</span>
</span><span id="ImagesManagement-444"><a href="#ImagesManagement-444"><span class="linenos">444</span></a><span class="sd">    Processed images are stored only in memory until saved explicitly with</span>
</span><span id="ImagesManagement-445"><a href="#ImagesManagement-445"><span class="linenos">445</span></a><span class="sd">    ``save_prepared_images()``.</span>
</span><span id="ImagesManagement-446"><a href="#ImagesManagement-446"><span class="linenos">446</span></a>
</span><span id="ImagesManagement-447"><a href="#ImagesManagement-447"><span class="linenos">447</span></a><span class="sd">    Raw images loaded from NucleiFinder analyses can be saved for later reuse</span>
</span><span id="ImagesManagement-448"><a href="#ImagesManagement-448"><span class="linenos">448</span></a><span class="sd">    in a serialized `.inuc` format using ``save_raw()``.</span>
</span><span id="ImagesManagement-449"><a href="#ImagesManagement-449"><span class="linenos">449</span></a>
</span><span id="ImagesManagement-450"><a href="#ImagesManagement-450"><span class="linenos">450</span></a><span class="sd">    Examples</span>
</span><span id="ImagesManagement-451"><a href="#ImagesManagement-451"><span class="linenos">451</span></a><span class="sd">    --------</span>
</span><span id="ImagesManagement-452"><a href="#ImagesManagement-452"><span class="linenos">452</span></a><span class="sd">    Load image results from an analysis:</span>
</span><span id="ImagesManagement-453"><a href="#ImagesManagement-453"><span class="linenos">453</span></a>
</span><span id="ImagesManagement-454"><a href="#ImagesManagement-454"><span class="linenos">454</span></a><span class="sd">    &gt;&gt;&gt; manager = ImagesManagement.load_experimental_images(results, &quot;experiment1&quot;)</span>
</span><span id="ImagesManagement-455"><a href="#ImagesManagement-455"><span class="linenos">455</span></a>
</span><span id="ImagesManagement-456"><a href="#ImagesManagement-456"><span class="linenos">456</span></a><span class="sd">    Adjust selected images:</span>
</span><span id="ImagesManagement-457"><a href="#ImagesManagement-457"><span class="linenos">457</span></a>
</span><span id="ImagesManagement-458"><a href="#ImagesManagement-458"><span class="linenos">458</span></a><span class="sd">    &gt;&gt;&gt; manager.adjust_images(</span>
</span><span id="ImagesManagement-459"><a href="#ImagesManagement-459"><span class="linenos">459</span></a><span class="sd">    ...     acronyme=&quot;adj&quot;,</span>
</span><span id="ImagesManagement-460"><a href="#ImagesManagement-460"><span class="linenos">460</span></a><span class="sd">    ...     path_to_images=&quot;path/to/imgs&quot;,</span>
</span><span id="ImagesManagement-461"><a href="#ImagesManagement-461"><span class="linenos">461</span></a><span class="sd">    ...     eq=True,</span>
</span><span id="ImagesManagement-462"><a href="#ImagesManagement-462"><span class="linenos">462</span></a><span class="sd">    ...     clahe=True</span>
</span><span id="ImagesManagement-463"><a href="#ImagesManagement-463"><span class="linenos">463</span></a><span class="sd">    ... )</span>
</span><span id="ImagesManagement-464"><a href="#ImagesManagement-464"><span class="linenos">464</span></a>
</span><span id="ImagesManagement-465"><a href="#ImagesManagement-465"><span class="linenos">465</span></a><span class="sd">    Merge multiple prepared sets:</span>
</span><span id="ImagesManagement-466"><a href="#ImagesManagement-466"><span class="linenos">466</span></a>
</span><span id="ImagesManagement-467"><a href="#ImagesManagement-467"><span class="linenos">467</span></a><span class="sd">    &gt;&gt;&gt; manager.image_merging([&quot;adj&quot;, &quot;other&quot;], ratio_list=[0.7, 0.3])</span>
</span><span id="ImagesManagement-468"><a href="#ImagesManagement-468"><span class="linenos">468</span></a>
</span><span id="ImagesManagement-469"><a href="#ImagesManagement-469"><span class="linenos">469</span></a><span class="sd">    Retrieve processed images:</span>
</span><span id="ImagesManagement-470"><a href="#ImagesManagement-470"><span class="linenos">470</span></a>
</span><span id="ImagesManagement-471"><a href="#ImagesManagement-471"><span class="linenos">471</span></a><span class="sd">    &gt;&gt;&gt; imgs = manager.get_prepared_images(&quot;adj&quot;)</span>
</span><span id="ImagesManagement-472"><a href="#ImagesManagement-472"><span class="linenos">472</span></a>
</span><span id="ImagesManagement-473"><a href="#ImagesManagement-473"><span class="linenos">473</span></a><span class="sd">    Save stitched images to disk:</span>
</span><span id="ImagesManagement-474"><a href="#ImagesManagement-474"><span class="linenos">474</span></a>
</span><span id="ImagesManagement-475"><a href="#ImagesManagement-475"><span class="linenos">475</span></a><span class="sd">    &gt;&gt;&gt; manager.save_prepared_images(&quot;stitched_adj_other&quot;, &quot;./output/&quot;)</span>
</span><span id="ImagesManagement-476"><a href="#ImagesManagement-476"><span class="linenos">476</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-477"><a href="#ImagesManagement-477"><span class="linenos">477</span></a>
</span><span id="ImagesManagement-478"><a href="#ImagesManagement-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
</span><span id="ImagesManagement-479"><a href="#ImagesManagement-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-480"><a href="#ImagesManagement-480"><span class="linenos">480</span></a><span class="sd">        Initialize the ImagesManagement object.</span>
</span><span id="ImagesManagement-481"><a href="#ImagesManagement-481"><span class="linenos">481</span></a>
</span><span id="ImagesManagement-482"><a href="#ImagesManagement-482"><span class="linenos">482</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-483"><a href="#ImagesManagement-483"><span class="linenos">483</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-484"><a href="#ImagesManagement-484"><span class="linenos">484</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="ImagesManagement-485"><a href="#ImagesManagement-485"><span class="linenos">485</span></a><span class="sd">            List of image identifiers.</span>
</span><span id="ImagesManagement-486"><a href="#ImagesManagement-486"><span class="linenos">486</span></a>
</span><span id="ImagesManagement-487"><a href="#ImagesManagement-487"><span class="linenos">487</span></a><span class="sd">        result_dict : dict or None</span>
</span><span id="ImagesManagement-488"><a href="#ImagesManagement-488"><span class="linenos">488</span></a><span class="sd">            Dictionary containing processed images.</span>
</span><span id="ImagesManagement-489"><a href="#ImagesManagement-489"><span class="linenos">489</span></a>
</span><span id="ImagesManagement-490"><a href="#ImagesManagement-490"><span class="linenos">490</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement-491"><a href="#ImagesManagement-491"><span class="linenos">491</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement-492"><a href="#ImagesManagement-492"><span class="linenos">492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-493"><a href="#ImagesManagement-493"><span class="linenos">493</span></a>
</span><span id="ImagesManagement-494"><a href="#ImagesManagement-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span> <span class="o">=</span> <span class="n">images_ids</span>
</span><span id="ImagesManagement-495"><a href="#ImagesManagement-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the list of image IDs managed by this instance.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-496"><a href="#ImagesManagement-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span> <span class="o">=</span> <span class="n">result_dict</span>
</span><span id="ImagesManagement-497"><a href="#ImagesManagement-497"><span class="linenos">497</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores dictionary containing processed images.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-498"><a href="#ImagesManagement-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="ImagesManagement-499"><a href="#ImagesManagement-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the experiment name for file naming and organizational purposes.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-500"><a href="#ImagesManagement-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement-501"><a href="#ImagesManagement-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary for storing processed images (adjusted, merged, stitched),</span>
</span><span id="ImagesManagement-502"><a href="#ImagesManagement-502"><span class="linenos">502</span></a><span class="sd">        indexed by user-defined acronyms for flexible retrieval.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-503"><a href="#ImagesManagement-503"><span class="linenos">503</span></a>
</span><span id="ImagesManagement-504"><a href="#ImagesManagement-504"><span class="linenos">504</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement-505"><a href="#ImagesManagement-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement-506"><a href="#ImagesManagement-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-507"><a href="#ImagesManagement-507"><span class="linenos">507</span></a><span class="sd">        Load an ImagesManagement instance from a `.inuc` serialized dictionary.</span>
</span><span id="ImagesManagement-508"><a href="#ImagesManagement-508"><span class="linenos">508</span></a>
</span><span id="ImagesManagement-509"><a href="#ImagesManagement-509"><span class="linenos">509</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-510"><a href="#ImagesManagement-510"><span class="linenos">510</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-511"><a href="#ImagesManagement-511"><span class="linenos">511</span></a><span class="sd">        path : str</span>
</span><span id="ImagesManagement-512"><a href="#ImagesManagement-512"><span class="linenos">512</span></a><span class="sd">            Path to the `.inuc` file exported with `save_raw()`.</span>
</span><span id="ImagesManagement-513"><a href="#ImagesManagement-513"><span class="linenos">513</span></a>
</span><span id="ImagesManagement-514"><a href="#ImagesManagement-514"><span class="linenos">514</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement-515"><a href="#ImagesManagement-515"><span class="linenos">515</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement-516"><a href="#ImagesManagement-516"><span class="linenos">516</span></a>
</span><span id="ImagesManagement-517"><a href="#ImagesManagement-517"><span class="linenos">517</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-518"><a href="#ImagesManagement-518"><span class="linenos">518</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-519"><a href="#ImagesManagement-519"><span class="linenos">519</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement-520"><a href="#ImagesManagement-520"><span class="linenos">520</span></a><span class="sd">            A reconstructed ImagesManagement object.</span>
</span><span id="ImagesManagement-521"><a href="#ImagesManagement-521"><span class="linenos">521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-522"><a href="#ImagesManagement-522"><span class="linenos">522</span></a>
</span><span id="ImagesManagement-523"><a href="#ImagesManagement-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="s2">&quot;.inuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="ImagesManagement-524"><a href="#ImagesManagement-524"><span class="linenos">524</span></a>
</span><span id="ImagesManagement-525"><a href="#ImagesManagement-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="ImagesManagement-526"><a href="#ImagesManagement-526"><span class="linenos">526</span></a>
</span><span id="ImagesManagement-527"><a href="#ImagesManagement-527"><span class="linenos">527</span></a>                <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ImagesManagement-528"><a href="#ImagesManagement-528"><span class="linenos">528</span></a>                <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">loaded_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loaded_data</span><span class="p">}</span>
</span><span id="ImagesManagement-529"><a href="#ImagesManagement-529"><span class="linenos">529</span></a>
</span><span id="ImagesManagement-530"><a href="#ImagesManagement-530"><span class="linenos">530</span></a>                <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement-531"><a href="#ImagesManagement-531"><span class="linenos">531</span></a>
</span><span id="ImagesManagement-532"><a href="#ImagesManagement-532"><span class="linenos">532</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement-533"><a href="#ImagesManagement-533"><span class="linenos">533</span></a>                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="ImagesManagement-534"><a href="#ImagesManagement-534"><span class="linenos">534</span></a>
</span><span id="ImagesManagement-535"><a href="#ImagesManagement-535"><span class="linenos">535</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="ImagesManagement-536"><a href="#ImagesManagement-536"><span class="linenos">536</span></a>
</span><span id="ImagesManagement-537"><a href="#ImagesManagement-537"><span class="linenos">537</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-538"><a href="#ImagesManagement-538"><span class="linenos">538</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-539"><a href="#ImagesManagement-539"><span class="linenos">539</span></a>
</span><span id="ImagesManagement-540"><a href="#ImagesManagement-540"><span class="linenos">540</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-541"><a href="#ImagesManagement-541"><span class="linenos">541</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement-542"><a href="#ImagesManagement-542"><span class="linenos">542</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .inuc extension!&quot;</span>
</span><span id="ImagesManagement-543"><a href="#ImagesManagement-543"><span class="linenos">543</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement-544"><a href="#ImagesManagement-544"><span class="linenos">544</span></a>
</span><span id="ImagesManagement-545"><a href="#ImagesManagement-545"><span class="linenos">545</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement-546"><a href="#ImagesManagement-546"><span class="linenos">546</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_experimental_images</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement-547"><a href="#ImagesManagement-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-548"><a href="#ImagesManagement-548"><span class="linenos">548</span></a><span class="sd">        Load results exported from NucleiFinder series analysis.</span>
</span><span id="ImagesManagement-549"><a href="#ImagesManagement-549"><span class="linenos">549</span></a>
</span><span id="ImagesManagement-550"><a href="#ImagesManagement-550"><span class="linenos">550</span></a><span class="sd">        Initialize the object with results from series_analysis_nuclei()</span>
</span><span id="ImagesManagement-551"><a href="#ImagesManagement-551"><span class="linenos">551</span></a><span class="sd">        or series_analysis_chromatinization() of the NucleiFinder class.</span>
</span><span id="ImagesManagement-552"><a href="#ImagesManagement-552"><span class="linenos">552</span></a>
</span><span id="ImagesManagement-553"><a href="#ImagesManagement-553"><span class="linenos">553</span></a>
</span><span id="ImagesManagement-554"><a href="#ImagesManagement-554"><span class="linenos">554</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-555"><a href="#ImagesManagement-555"><span class="linenos">555</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-556"><a href="#ImagesManagement-556"><span class="linenos">556</span></a><span class="sd">        results_dict : dict</span>
</span><span id="ImagesManagement-557"><a href="#ImagesManagement-557"><span class="linenos">557</span></a><span class="sd">            Dictionary returned by `series_analysis_nuclei()` or</span>
</span><span id="ImagesManagement-558"><a href="#ImagesManagement-558"><span class="linenos">558</span></a><span class="sd">            `series_analysis_chromatinization()`.</span>
</span><span id="ImagesManagement-559"><a href="#ImagesManagement-559"><span class="linenos">559</span></a>
</span><span id="ImagesManagement-560"><a href="#ImagesManagement-560"><span class="linenos">560</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement-561"><a href="#ImagesManagement-561"><span class="linenos">561</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement-562"><a href="#ImagesManagement-562"><span class="linenos">562</span></a>
</span><span id="ImagesManagement-563"><a href="#ImagesManagement-563"><span class="linenos">563</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-564"><a href="#ImagesManagement-564"><span class="linenos">564</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-565"><a href="#ImagesManagement-565"><span class="linenos">565</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement-566"><a href="#ImagesManagement-566"><span class="linenos">566</span></a>
</span><span id="ImagesManagement-567"><a href="#ImagesManagement-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-568"><a href="#ImagesManagement-568"><span class="linenos">568</span></a>
</span><span id="ImagesManagement-569"><a href="#ImagesManagement-569"><span class="linenos">569</span></a>        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement-570"><a href="#ImagesManagement-570"><span class="linenos">570</span></a>        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement-571"><a href="#ImagesManagement-571"><span class="linenos">571</span></a>
</span><span id="ImagesManagement-572"><a href="#ImagesManagement-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="ImagesManagement-573"><a href="#ImagesManagement-573"><span class="linenos">573</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="ImagesManagement-574"><a href="#ImagesManagement-574"><span class="linenos">574</span></a>        <span class="p">):</span>
</span><span id="ImagesManagement-575"><a href="#ImagesManagement-575"><span class="linenos">575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement-576"><a href="#ImagesManagement-576"><span class="linenos">576</span></a>                <span class="s2">&quot;Incorrect data provided. The data must come from series_analysis_nuclei() &quot;</span>
</span><span id="ImagesManagement-577"><a href="#ImagesManagement-577"><span class="linenos">577</span></a>                <span class="s2">&quot;or series_analysis_chromatinization() of the NucleiFinder class.&quot;</span>
</span><span id="ImagesManagement-578"><a href="#ImagesManagement-578"><span class="linenos">578</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement-579"><a href="#ImagesManagement-579"><span class="linenos">579</span></a>
</span><span id="ImagesManagement-580"><a href="#ImagesManagement-580"><span class="linenos">580</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement-581"><a href="#ImagesManagement-581"><span class="linenos">581</span></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="ImagesManagement-582"><a href="#ImagesManagement-582"><span class="linenos">582</span></a>            <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="ImagesManagement-583"><a href="#ImagesManagement-583"><span class="linenos">583</span></a>
</span><span id="ImagesManagement-584"><a href="#ImagesManagement-584"><span class="linenos">584</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">res_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="ImagesManagement-585"><a href="#ImagesManagement-585"><span class="linenos">585</span></a>
</span><span id="ImagesManagement-586"><a href="#ImagesManagement-586"><span class="linenos">586</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement-587"><a href="#ImagesManagement-587"><span class="linenos">587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_images_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement-588"><a href="#ImagesManagement-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-589"><a href="#ImagesManagement-589"><span class="linenos">589</span></a><span class="sd">        Initialize the object with list of images IDs for porcesing.</span>
</span><span id="ImagesManagement-590"><a href="#ImagesManagement-590"><span class="linenos">590</span></a>
</span><span id="ImagesManagement-591"><a href="#ImagesManagement-591"><span class="linenos">591</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-592"><a href="#ImagesManagement-592"><span class="linenos">592</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-593"><a href="#ImagesManagement-593"><span class="linenos">593</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="ImagesManagement-594"><a href="#ImagesManagement-594"><span class="linenos">594</span></a><span class="sd">            List of selected image IDs.</span>
</span><span id="ImagesManagement-595"><a href="#ImagesManagement-595"><span class="linenos">595</span></a>
</span><span id="ImagesManagement-596"><a href="#ImagesManagement-596"><span class="linenos">596</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement-597"><a href="#ImagesManagement-597"><span class="linenos">597</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement-598"><a href="#ImagesManagement-598"><span class="linenos">598</span></a>
</span><span id="ImagesManagement-599"><a href="#ImagesManagement-599"><span class="linenos">599</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-600"><a href="#ImagesManagement-600"><span class="linenos">600</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-601"><a href="#ImagesManagement-601"><span class="linenos">601</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement-602"><a href="#ImagesManagement-602"><span class="linenos">602</span></a>
</span><span id="ImagesManagement-603"><a href="#ImagesManagement-603"><span class="linenos">603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-604"><a href="#ImagesManagement-604"><span class="linenos">604</span></a>
</span><span id="ImagesManagement-605"><a href="#ImagesManagement-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-606"><a href="#ImagesManagement-606"><span class="linenos">606</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement-607"><a href="#ImagesManagement-607"><span class="linenos">607</span></a>                <span class="s2">&quot;Incorrect data provided. There must be a list of image IDs.&quot;</span>
</span><span id="ImagesManagement-608"><a href="#ImagesManagement-608"><span class="linenos">608</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement-609"><a href="#ImagesManagement-609"><span class="linenos">609</span></a>
</span><span id="ImagesManagement-610"><a href="#ImagesManagement-610"><span class="linenos">610</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">images_ids</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="ImagesManagement-611"><a href="#ImagesManagement-611"><span class="linenos">611</span></a>
</span><span id="ImagesManagement-612"><a href="#ImagesManagement-612"><span class="linenos">612</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_included_acronyms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ImagesManagement-613"><a href="#ImagesManagement-613"><span class="linenos">613</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-614"><a href="#ImagesManagement-614"><span class="linenos">614</span></a><span class="sd">        Print the data acronyms for adjusted images, processed using the</span>
</span><span id="ImagesManagement-615"><a href="#ImagesManagement-615"><span class="linenos">615</span></a><span class="sd">        self.adjust_images(), self.image_merging(), and self.image_stitching() methods.</span>
</span><span id="ImagesManagement-616"><a href="#ImagesManagement-616"><span class="linenos">616</span></a>
</span><span id="ImagesManagement-617"><a href="#ImagesManagement-617"><span class="linenos">617</span></a><span class="sd">        Acronym information is essential for retrieving and saving data using</span>
</span><span id="ImagesManagement-618"><a href="#ImagesManagement-618"><span class="linenos">618</span></a><span class="sd">        the self.get_prepared_images() and self.save_prepared_images() methods.</span>
</span><span id="ImagesManagement-619"><a href="#ImagesManagement-619"><span class="linenos">619</span></a>
</span><span id="ImagesManagement-620"><a href="#ImagesManagement-620"><span class="linenos">620</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement-621"><a href="#ImagesManagement-621"><span class="linenos">621</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement-622"><a href="#ImagesManagement-622"><span class="linenos">622</span></a><span class="sd">        This method prints the list of available acronyms but does not return it.</span>
</span><span id="ImagesManagement-623"><a href="#ImagesManagement-623"><span class="linenos">623</span></a>
</span><span id="ImagesManagement-624"><a href="#ImagesManagement-624"><span class="linenos">624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-625"><a href="#ImagesManagement-625"><span class="linenos">625</span></a>
</span><span id="ImagesManagement-626"><a href="#ImagesManagement-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-627"><a href="#ImagesManagement-627"><span class="linenos">627</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Avaiable stored images:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-628"><a href="#ImagesManagement-628"><span class="linenos">628</span></a>            <span class="k">for</span> <span class="n">kd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement-629"><a href="#ImagesManagement-629"><span class="linenos">629</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">kd</span><span class="p">)</span>
</span><span id="ImagesManagement-630"><a href="#ImagesManagement-630"><span class="linenos">630</span></a>
</span><span id="ImagesManagement-631"><a href="#ImagesManagement-631"><span class="linenos">631</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-632"><a href="#ImagesManagement-632"><span class="linenos">632</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-633"><a href="#ImagesManagement-633"><span class="linenos">633</span></a>
</span><span id="ImagesManagement-634"><a href="#ImagesManagement-634"><span class="linenos">634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ImagesManagement-635"><a href="#ImagesManagement-635"><span class="linenos">635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-636"><a href="#ImagesManagement-636"><span class="linenos">636</span></a><span class="sd">        Retrieves the prepared images (returned from preapre_selected_img()) stored in the object.</span>
</span><span id="ImagesManagement-637"><a href="#ImagesManagement-637"><span class="linenos">637</span></a>
</span><span id="ImagesManagement-638"><a href="#ImagesManagement-638"><span class="linenos">638</span></a>
</span><span id="ImagesManagement-639"><a href="#ImagesManagement-639"><span class="linenos">639</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-640"><a href="#ImagesManagement-640"><span class="linenos">640</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-641"><a href="#ImagesManagement-641"><span class="linenos">641</span></a><span class="sd">        acronyme : str or None</span>
</span><span id="ImagesManagement-642"><a href="#ImagesManagement-642"><span class="linenos">642</span></a><span class="sd">            Acronym identifying a processed image set. If None, prints available keys.</span>
</span><span id="ImagesManagement-643"><a href="#ImagesManagement-643"><span class="linenos">643</span></a>
</span><span id="ImagesManagement-644"><a href="#ImagesManagement-644"><span class="linenos">644</span></a>
</span><span id="ImagesManagement-645"><a href="#ImagesManagement-645"><span class="linenos">645</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-646"><a href="#ImagesManagement-646"><span class="linenos">646</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-647"><a href="#ImagesManagement-647"><span class="linenos">647</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement-648"><a href="#ImagesManagement-648"><span class="linenos">648</span></a><span class="sd">            Dictionary of prepared images.</span>
</span><span id="ImagesManagement-649"><a href="#ImagesManagement-649"><span class="linenos">649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-650"><a href="#ImagesManagement-650"><span class="linenos">650</span></a>
</span><span id="ImagesManagement-651"><a href="#ImagesManagement-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ImagesManagement-652"><a href="#ImagesManagement-652"><span class="linenos">652</span></a>
</span><span id="ImagesManagement-653"><a href="#ImagesManagement-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="ImagesManagement-654"><a href="#ImagesManagement-654"><span class="linenos">654</span></a>
</span><span id="ImagesManagement-655"><a href="#ImagesManagement-655"><span class="linenos">655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-656"><a href="#ImagesManagement-656"><span class="linenos">656</span></a>
</span><span id="ImagesManagement-657"><a href="#ImagesManagement-657"><span class="linenos">657</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement-658"><a href="#ImagesManagement-658"><span class="linenos">658</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span>
</span><span id="ImagesManagement-659"><a href="#ImagesManagement-659"><span class="linenos">659</span></a>
</span><span id="ImagesManagement-660"><a href="#ImagesManagement-660"><span class="linenos">660</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-661"><a href="#ImagesManagement-661"><span class="linenos">661</span></a>
</span><span id="ImagesManagement-662"><a href="#ImagesManagement-662"><span class="linenos">662</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="ImagesManagement-663"><a href="#ImagesManagement-663"><span class="linenos">663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-664"><a href="#ImagesManagement-664"><span class="linenos">664</span></a><span class="sd">        Saves prepared images (returned from preapre_selected_img() method) to the specified directory.</span>
</span><span id="ImagesManagement-665"><a href="#ImagesManagement-665"><span class="linenos">665</span></a>
</span><span id="ImagesManagement-666"><a href="#ImagesManagement-666"><span class="linenos">666</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-667"><a href="#ImagesManagement-667"><span class="linenos">667</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-668"><a href="#ImagesManagement-668"><span class="linenos">668</span></a><span class="sd">        path_to_save : str</span>
</span><span id="ImagesManagement-669"><a href="#ImagesManagement-669"><span class="linenos">669</span></a><span class="sd">            Directory path where the images will be saved. Default is the current working directory.</span>
</span><span id="ImagesManagement-670"><a href="#ImagesManagement-670"><span class="linenos">670</span></a>
</span><span id="ImagesManagement-671"><a href="#ImagesManagement-671"><span class="linenos">671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-672"><a href="#ImagesManagement-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ImagesManagement-673"><a href="#ImagesManagement-673"><span class="linenos">673</span></a>
</span><span id="ImagesManagement-674"><a href="#ImagesManagement-674"><span class="linenos">674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="ImagesManagement-675"><a href="#ImagesManagement-675"><span class="linenos">675</span></a>
</span><span id="ImagesManagement-676"><a href="#ImagesManagement-676"><span class="linenos">676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-677"><a href="#ImagesManagement-677"><span class="linenos">677</span></a>
</span><span id="ImagesManagement-678"><a href="#ImagesManagement-678"><span class="linenos">678</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement-679"><a href="#ImagesManagement-679"><span class="linenos">679</span></a>
</span><span id="ImagesManagement-680"><a href="#ImagesManagement-680"><span class="linenos">680</span></a>                <span class="n">path_to_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="ImagesManagement-681"><a href="#ImagesManagement-681"><span class="linenos">681</span></a>                    <span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">acronyme</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ImagesManagement-682"><a href="#ImagesManagement-682"><span class="linenos">682</span></a>                <span class="p">)</span>
</span><span id="ImagesManagement-683"><a href="#ImagesManagement-683"><span class="linenos">683</span></a>
</span><span id="ImagesManagement-684"><a href="#ImagesManagement-684"><span class="linenos">684</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">):</span>
</span><span id="ImagesManagement-685"><a href="#ImagesManagement-685"><span class="linenos">685</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ImagesManagement-686"><a href="#ImagesManagement-686"><span class="linenos">686</span></a>
</span><span id="ImagesManagement-687"><a href="#ImagesManagement-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement-688"><a href="#ImagesManagement-688"><span class="linenos">688</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
</span><span id="ImagesManagement-689"><a href="#ImagesManagement-689"><span class="linenos">689</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">),</span>
</span><span id="ImagesManagement-690"><a href="#ImagesManagement-690"><span class="linenos">690</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="ImagesManagement-691"><a href="#ImagesManagement-691"><span class="linenos">691</span></a>                    <span class="p">)</span>
</span><span id="ImagesManagement-692"><a href="#ImagesManagement-692"><span class="linenos">692</span></a>
</span><span id="ImagesManagement-693"><a href="#ImagesManagement-693"><span class="linenos">693</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement-694"><a href="#ImagesManagement-694"><span class="linenos">694</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-695"><a href="#ImagesManagement-695"><span class="linenos">695</span></a>
</span><span id="ImagesManagement-696"><a href="#ImagesManagement-696"><span class="linenos">696</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjust_images</span><span class="p">(</span>
</span><span id="ImagesManagement-697"><a href="#ImagesManagement-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ImagesManagement-698"><a href="#ImagesManagement-698"><span class="linenos">698</span></a>        <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ImagesManagement-699"><a href="#ImagesManagement-699"><span class="linenos">699</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ImagesManagement-700"><a href="#ImagesManagement-700"><span class="linenos">700</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tif&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement-701"><a href="#ImagesManagement-701"><span class="linenos">701</span></a>        <span class="n">eq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ImagesManagement-702"><a href="#ImagesManagement-702"><span class="linenos">702</span></a>        <span class="n">clahe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ImagesManagement-703"><a href="#ImagesManagement-703"><span class="linenos">703</span></a>        <span class="n">kernal</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span><span id="ImagesManagement-704"><a href="#ImagesManagement-704"><span class="linenos">704</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement-705"><a href="#ImagesManagement-705"><span class="linenos">705</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement-706"><a href="#ImagesManagement-706"><span class="linenos">706</span></a>        <span class="n">max_intensity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
</span><span id="ImagesManagement-707"><a href="#ImagesManagement-707"><span class="linenos">707</span></a>        <span class="n">min_intenisty</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ImagesManagement-708"><a href="#ImagesManagement-708"><span class="linenos">708</span></a>        <span class="n">brightness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="ImagesManagement-709"><a href="#ImagesManagement-709"><span class="linenos">709</span></a>        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ImagesManagement-710"><a href="#ImagesManagement-710"><span class="linenos">710</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ImagesManagement-711"><a href="#ImagesManagement-711"><span class="linenos">711</span></a>        <span class="n">img_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ImagesManagement-712"><a href="#ImagesManagement-712"><span class="linenos">712</span></a>    <span class="p">):</span>
</span><span id="ImagesManagement-713"><a href="#ImagesManagement-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-714"><a href="#ImagesManagement-714"><span class="linenos">714</span></a><span class="sd">        Prepares selected images for processing, applying histogram equalization and CLAHE, if required.</span>
</span><span id="ImagesManagement-715"><a href="#ImagesManagement-715"><span class="linenos">715</span></a>
</span><span id="ImagesManagement-716"><a href="#ImagesManagement-716"><span class="linenos">716</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-717"><a href="#ImagesManagement-717"><span class="linenos">717</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-718"><a href="#ImagesManagement-718"><span class="linenos">718</span></a><span class="sd">        acronyme : str</span>
</span><span id="ImagesManagement-719"><a href="#ImagesManagement-719"><span class="linenos">719</span></a><span class="sd">            Name of images being adjusted in this run.</span>
</span><span id="ImagesManagement-720"><a href="#ImagesManagement-720"><span class="linenos">720</span></a>
</span><span id="ImagesManagement-721"><a href="#ImagesManagement-721"><span class="linenos">721</span></a><span class="sd">        path_to_images : str</span>
</span><span id="ImagesManagement-722"><a href="#ImagesManagement-722"><span class="linenos">722</span></a><span class="sd">            Path to the directory containing images.</span>
</span><span id="ImagesManagement-723"><a href="#ImagesManagement-723"><span class="linenos">723</span></a>
</span><span id="ImagesManagement-724"><a href="#ImagesManagement-724"><span class="linenos">724</span></a><span class="sd">        file_extension : str</span>
</span><span id="ImagesManagement-725"><a href="#ImagesManagement-725"><span class="linenos">725</span></a><span class="sd">            Image file extension. Default is &#39;tiff&#39;.</span>
</span><span id="ImagesManagement-726"><a href="#ImagesManagement-726"><span class="linenos">726</span></a>
</span><span id="ImagesManagement-727"><a href="#ImagesManagement-727"><span class="linenos">727</span></a><span class="sd">        eq : bool</span>
</span><span id="ImagesManagement-728"><a href="#ImagesManagement-728"><span class="linenos">728</span></a><span class="sd">            Whether to apply histogram equalization. Default is True.</span>
</span><span id="ImagesManagement-729"><a href="#ImagesManagement-729"><span class="linenos">729</span></a>
</span><span id="ImagesManagement-730"><a href="#ImagesManagement-730"><span class="linenos">730</span></a><span class="sd">        clahe : bool</span>
</span><span id="ImagesManagement-731"><a href="#ImagesManagement-731"><span class="linenos">731</span></a><span class="sd">            Whether to apply CLAHE. Default is True.</span>
</span><span id="ImagesManagement-732"><a href="#ImagesManagement-732"><span class="linenos">732</span></a>
</span><span id="ImagesManagement-733"><a href="#ImagesManagement-733"><span class="linenos">733</span></a><span class="sd">        kernal : tuple</span>
</span><span id="ImagesManagement-734"><a href="#ImagesManagement-734"><span class="linenos">734</span></a><span class="sd">            Kernel size for CLAHE. Default is (50, 50).</span>
</span><span id="ImagesManagement-735"><a href="#ImagesManagement-735"><span class="linenos">735</span></a>
</span><span id="ImagesManagement-736"><a href="#ImagesManagement-736"><span class="linenos">736</span></a><span class="sd">        fille_name_part : str</span>
</span><span id="ImagesManagement-737"><a href="#ImagesManagement-737"><span class="linenos">737</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="ImagesManagement-738"><a href="#ImagesManagement-738"><span class="linenos">738</span></a>
</span><span id="ImagesManagement-739"><a href="#ImagesManagement-739"><span class="linenos">739</span></a><span class="sd">        color : str</span>
</span><span id="ImagesManagement-740"><a href="#ImagesManagement-740"><span class="linenos">740</span></a><span class="sd">            Color space to use. Default is &#39;gray&#39;.</span>
</span><span id="ImagesManagement-741"><a href="#ImagesManagement-741"><span class="linenos">741</span></a>
</span><span id="ImagesManagement-742"><a href="#ImagesManagement-742"><span class="linenos">742</span></a><span class="sd">        max_intensity : int</span>
</span><span id="ImagesManagement-743"><a href="#ImagesManagement-743"><span class="linenos">743</span></a><span class="sd">            Maximum intensity for image adjustment. Default is 65535.</span>
</span><span id="ImagesManagement-744"><a href="#ImagesManagement-744"><span class="linenos">744</span></a>
</span><span id="ImagesManagement-745"><a href="#ImagesManagement-745"><span class="linenos">745</span></a><span class="sd">        min_intenisty : int</span>
</span><span id="ImagesManagement-746"><a href="#ImagesManagement-746"><span class="linenos">746</span></a><span class="sd">            Minimum intensity for image adjustment. Default is 0.</span>
</span><span id="ImagesManagement-747"><a href="#ImagesManagement-747"><span class="linenos">747</span></a>
</span><span id="ImagesManagement-748"><a href="#ImagesManagement-748"><span class="linenos">748</span></a><span class="sd">        brightness : int</span>
</span><span id="ImagesManagement-749"><a href="#ImagesManagement-749"><span class="linenos">749</span></a><span class="sd">            Brightness adjustment value. Default is 1000.</span>
</span><span id="ImagesManagement-750"><a href="#ImagesManagement-750"><span class="linenos">750</span></a>
</span><span id="ImagesManagement-751"><a href="#ImagesManagement-751"><span class="linenos">751</span></a><span class="sd">        contrast : float</span>
</span><span id="ImagesManagement-752"><a href="#ImagesManagement-752"><span class="linenos">752</span></a><span class="sd">            Contrast adjustment factor. Default is 1.0.</span>
</span><span id="ImagesManagement-753"><a href="#ImagesManagement-753"><span class="linenos">753</span></a>
</span><span id="ImagesManagement-754"><a href="#ImagesManagement-754"><span class="linenos">754</span></a><span class="sd">        gamma : float</span>
</span><span id="ImagesManagement-755"><a href="#ImagesManagement-755"><span class="linenos">755</span></a><span class="sd">            Gamma correction factor. Default is 1.0.</span>
</span><span id="ImagesManagement-756"><a href="#ImagesManagement-756"><span class="linenos">756</span></a>
</span><span id="ImagesManagement-757"><a href="#ImagesManagement-757"><span class="linenos">757</span></a><span class="sd">        img_n : int</span>
</span><span id="ImagesManagement-758"><a href="#ImagesManagement-758"><span class="linenos">758</span></a><span class="sd">            Number of images to process. Default is 0, which means all images.</span>
</span><span id="ImagesManagement-759"><a href="#ImagesManagement-759"><span class="linenos">759</span></a>
</span><span id="ImagesManagement-760"><a href="#ImagesManagement-760"><span class="linenos">760</span></a>
</span><span id="ImagesManagement-761"><a href="#ImagesManagement-761"><span class="linenos">761</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-762"><a href="#ImagesManagement-762"><span class="linenos">762</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-763"><a href="#ImagesManagement-763"><span class="linenos">763</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement-764"><a href="#ImagesManagement-764"><span class="linenos">764</span></a><span class="sd">            Dictionary containing the processed images.</span>
</span><span id="ImagesManagement-765"><a href="#ImagesManagement-765"><span class="linenos">765</span></a>
</span><span id="ImagesManagement-766"><a href="#ImagesManagement-766"><span class="linenos">766</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement-767"><a href="#ImagesManagement-767"><span class="linenos">767</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement-768"><a href="#ImagesManagement-768"><span class="linenos">768</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement-769"><a href="#ImagesManagement-769"><span class="linenos">769</span></a>
</span><span id="ImagesManagement-770"><a href="#ImagesManagement-770"><span class="linenos">770</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement-771"><a href="#ImagesManagement-771"><span class="linenos">771</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-772"><a href="#ImagesManagement-772"><span class="linenos">772</span></a>
</span><span id="ImagesManagement-773"><a href="#ImagesManagement-773"><span class="linenos">773</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement-774"><a href="#ImagesManagement-774"><span class="linenos">774</span></a>
</span><span id="ImagesManagement-775"><a href="#ImagesManagement-775"><span class="linenos">775</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="ImagesManagement-776"><a href="#ImagesManagement-776"><span class="linenos">776</span></a>
</span><span id="ImagesManagement-777"><a href="#ImagesManagement-777"><span class="linenos">777</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-778"><a href="#ImagesManagement-778"><span class="linenos">778</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="ImagesManagement-779"><a href="#ImagesManagement-779"><span class="linenos">779</span></a>
</span><span id="ImagesManagement-780"><a href="#ImagesManagement-780"><span class="linenos">780</span></a>        <span class="n">selected_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span>
</span><span id="ImagesManagement-781"><a href="#ImagesManagement-781"><span class="linenos">781</span></a>
</span><span id="ImagesManagement-782"><a href="#ImagesManagement-782"><span class="linenos">782</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-783"><a href="#ImagesManagement-783"><span class="linenos">783</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="ImagesManagement-784"><a href="#ImagesManagement-784"><span class="linenos">784</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement-785"><a href="#ImagesManagement-785"><span class="linenos">785</span></a>                <span class="n">x</span>
</span><span id="ImagesManagement-786"><a href="#ImagesManagement-786"><span class="linenos">786</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="ImagesManagement-787"><a href="#ImagesManagement-787"><span class="linenos">787</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="ImagesManagement-788"><a href="#ImagesManagement-788"><span class="linenos">788</span></a>            <span class="p">]</span>
</span><span id="ImagesManagement-789"><a href="#ImagesManagement-789"><span class="linenos">789</span></a>
</span><span id="ImagesManagement-790"><a href="#ImagesManagement-790"><span class="linenos">790</span></a>        <span class="k">if</span> <span class="n">img_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-791"><a href="#ImagesManagement-791"><span class="linenos">791</span></a>
</span><span id="ImagesManagement-792"><a href="#ImagesManagement-792"><span class="linenos">792</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">img_n</span><span class="p">)</span>
</span><span id="ImagesManagement-793"><a href="#ImagesManagement-793"><span class="linenos">793</span></a>
</span><span id="ImagesManagement-794"><a href="#ImagesManagement-794"><span class="linenos">794</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="ImagesManagement-795"><a href="#ImagesManagement-795"><span class="linenos">795</span></a>
</span><span id="ImagesManagement-796"><a href="#ImagesManagement-796"><span class="linenos">796</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="ImagesManagement-797"><a href="#ImagesManagement-797"><span class="linenos">797</span></a>
</span><span id="ImagesManagement-798"><a href="#ImagesManagement-798"><span class="linenos">798</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ImagesManagement-799"><a href="#ImagesManagement-799"><span class="linenos">799</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="ImagesManagement-800"><a href="#ImagesManagement-800"><span class="linenos">800</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="ImagesManagement-801"><a href="#ImagesManagement-801"><span class="linenos">801</span></a>                <span class="k">pass</span>
</span><span id="ImagesManagement-802"><a href="#ImagesManagement-802"><span class="linenos">802</span></a>
</span><span id="ImagesManagement-803"><a href="#ImagesManagement-803"><span class="linenos">803</span></a>            <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ImagesManagement-804"><a href="#ImagesManagement-804"><span class="linenos">804</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">equalizeHist_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="ImagesManagement-805"><a href="#ImagesManagement-805"><span class="linenos">805</span></a>
</span><span id="ImagesManagement-806"><a href="#ImagesManagement-806"><span class="linenos">806</span></a>            <span class="k">if</span> <span class="n">clahe</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ImagesManagement-807"><a href="#ImagesManagement-807"><span class="linenos">807</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">clahe_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernal</span><span class="o">=</span><span class="n">kernal</span><span class="p">)</span>
</span><span id="ImagesManagement-808"><a href="#ImagesManagement-808"><span class="linenos">808</span></a>
</span><span id="ImagesManagement-809"><a href="#ImagesManagement-809"><span class="linenos">809</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="ImagesManagement-810"><a href="#ImagesManagement-810"><span class="linenos">810</span></a>                <span class="n">img</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="ImagesManagement-811"><a href="#ImagesManagement-811"><span class="linenos">811</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="ImagesManagement-812"><a href="#ImagesManagement-812"><span class="linenos">812</span></a>                <span class="n">max_intensity</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">,</span>
</span><span id="ImagesManagement-813"><a href="#ImagesManagement-813"><span class="linenos">813</span></a>                <span class="n">min_intenisty</span><span class="o">=</span><span class="n">min_intenisty</span><span class="p">,</span>
</span><span id="ImagesManagement-814"><a href="#ImagesManagement-814"><span class="linenos">814</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="n">brightness</span><span class="p">,</span>
</span><span id="ImagesManagement-815"><a href="#ImagesManagement-815"><span class="linenos">815</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
</span><span id="ImagesManagement-816"><a href="#ImagesManagement-816"><span class="linenos">816</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="ImagesManagement-817"><a href="#ImagesManagement-817"><span class="linenos">817</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement-818"><a href="#ImagesManagement-818"><span class="linenos">818</span></a>
</span><span id="ImagesManagement-819"><a href="#ImagesManagement-819"><span class="linenos">819</span></a>            <span class="n">results_dict</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="ImagesManagement-820"><a href="#ImagesManagement-820"><span class="linenos">820</span></a>
</span><span id="ImagesManagement-821"><a href="#ImagesManagement-821"><span class="linenos">821</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span>
</span><span id="ImagesManagement-822"><a href="#ImagesManagement-822"><span class="linenos">822</span></a>
</span><span id="ImagesManagement-823"><a href="#ImagesManagement-823"><span class="linenos">823</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_merging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ratio_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ImagesManagement-824"><a href="#ImagesManagement-824"><span class="linenos">824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-825"><a href="#ImagesManagement-825"><span class="linenos">825</span></a><span class="sd">        Merge previously prepared images stored in `self.prepared_images`,</span>
</span><span id="ImagesManagement-826"><a href="#ImagesManagement-826"><span class="linenos">826</span></a><span class="sd">        adjusted based on the image ratios. The used ratios adjust relative image intensity.</span>
</span><span id="ImagesManagement-827"><a href="#ImagesManagement-827"><span class="linenos">827</span></a>
</span><span id="ImagesManagement-828"><a href="#ImagesManagement-828"><span class="linenos">828</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-829"><a href="#ImagesManagement-829"><span class="linenos">829</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-830"><a href="#ImagesManagement-830"><span class="linenos">830</span></a><span class="sd">        acronyme : list</span>
</span><span id="ImagesManagement-831"><a href="#ImagesManagement-831"><span class="linenos">831</span></a><span class="sd">            List of image names to be merged.</span>
</span><span id="ImagesManagement-832"><a href="#ImagesManagement-832"><span class="linenos">832</span></a>
</span><span id="ImagesManagement-833"><a href="#ImagesManagement-833"><span class="linenos">833</span></a><span class="sd">        ratio_list : list[float]</span>
</span><span id="ImagesManagement-834"><a href="#ImagesManagement-834"><span class="linenos">834</span></a><span class="sd">            List of ratio intensity values (0.0–1.0) for the merged image.</span>
</span><span id="ImagesManagement-835"><a href="#ImagesManagement-835"><span class="linenos">835</span></a><span class="sd">            The `acronyme` list and `ratio_list` must be of the same length.</span>
</span><span id="ImagesManagement-836"><a href="#ImagesManagement-836"><span class="linenos">836</span></a>
</span><span id="ImagesManagement-837"><a href="#ImagesManagement-837"><span class="linenos">837</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-838"><a href="#ImagesManagement-838"><span class="linenos">838</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-839"><a href="#ImagesManagement-839"><span class="linenos">839</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement-840"><a href="#ImagesManagement-840"><span class="linenos">840</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="ImagesManagement-841"><a href="#ImagesManagement-841"><span class="linenos">841</span></a>
</span><span id="ImagesManagement-842"><a href="#ImagesManagement-842"><span class="linenos">842</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement-843"><a href="#ImagesManagement-843"><span class="linenos">843</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement-844"><a href="#ImagesManagement-844"><span class="linenos">844</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement-845"><a href="#ImagesManagement-845"><span class="linenos">845</span></a>
</span><span id="ImagesManagement-846"><a href="#ImagesManagement-846"><span class="linenos">846</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement-847"><a href="#ImagesManagement-847"><span class="linenos">847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-848"><a href="#ImagesManagement-848"><span class="linenos">848</span></a>
</span><span id="ImagesManagement-849"><a href="#ImagesManagement-849"><span class="linenos">849</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement-850"><a href="#ImagesManagement-850"><span class="linenos">850</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement-851"><a href="#ImagesManagement-851"><span class="linenos">851</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-852"><a href="#ImagesManagement-852"><span class="linenos">852</span></a>
</span><span id="ImagesManagement-853"><a href="#ImagesManagement-853"><span class="linenos">853</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement-854"><a href="#ImagesManagement-854"><span class="linenos">854</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">:</span>
</span><span id="ImagesManagement-855"><a href="#ImagesManagement-855"><span class="linenos">855</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement-856"><a href="#ImagesManagement-856"><span class="linenos">856</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement-857"><a href="#ImagesManagement-857"><span class="linenos">857</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement-858"><a href="#ImagesManagement-858"><span class="linenos">858</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement-859"><a href="#ImagesManagement-859"><span class="linenos">859</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement-860"><a href="#ImagesManagement-860"><span class="linenos">860</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement-861"><a href="#ImagesManagement-861"><span class="linenos">861</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement-862"><a href="#ImagesManagement-862"><span class="linenos">862</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-863"><a href="#ImagesManagement-863"><span class="linenos">863</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-864"><a href="#ImagesManagement-864"><span class="linenos">864</span></a>                    <span class="k">break</span>
</span><span id="ImagesManagement-865"><a href="#ImagesManagement-865"><span class="linenos">865</span></a>
</span><span id="ImagesManagement-866"><a href="#ImagesManagement-866"><span class="linenos">866</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement-867"><a href="#ImagesManagement-867"><span class="linenos">867</span></a>
</span><span id="ImagesManagement-868"><a href="#ImagesManagement-868"><span class="linenos">868</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="ImagesManagement-869"><a href="#ImagesManagement-869"><span class="linenos">869</span></a>                <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="ImagesManagement-870"><a href="#ImagesManagement-870"><span class="linenos">870</span></a>                    <span class="n">img_list</span><span class="p">,</span> <span class="n">ratio_list</span>
</span><span id="ImagesManagement-871"><a href="#ImagesManagement-871"><span class="linenos">871</span></a>                <span class="p">)</span>
</span><span id="ImagesManagement-872"><a href="#ImagesManagement-872"><span class="linenos">872</span></a>
</span><span id="ImagesManagement-873"><a href="#ImagesManagement-873"><span class="linenos">873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="ImagesManagement-874"><a href="#ImagesManagement-874"><span class="linenos">874</span></a>
</span><span id="ImagesManagement-875"><a href="#ImagesManagement-875"><span class="linenos">875</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span><span id="ImagesManagement-876"><a href="#ImagesManagement-876"><span class="linenos">876</span></a>
</span><span id="ImagesManagement-877"><a href="#ImagesManagement-877"><span class="linenos">877</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_stitching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">to_results_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="ImagesManagement-878"><a href="#ImagesManagement-878"><span class="linenos">878</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-879"><a href="#ImagesManagement-879"><span class="linenos">879</span></a><span class="sd">        Stitch (horizontally) previously prepared images stored in `self.prepared_images`.</span>
</span><span id="ImagesManagement-880"><a href="#ImagesManagement-880"><span class="linenos">880</span></a>
</span><span id="ImagesManagement-881"><a href="#ImagesManagement-881"><span class="linenos">881</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-882"><a href="#ImagesManagement-882"><span class="linenos">882</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-883"><a href="#ImagesManagement-883"><span class="linenos">883</span></a><span class="sd">        acronyme : list</span>
</span><span id="ImagesManagement-884"><a href="#ImagesManagement-884"><span class="linenos">884</span></a><span class="sd">            List of image names to be stitched.</span>
</span><span id="ImagesManagement-885"><a href="#ImagesManagement-885"><span class="linenos">885</span></a>
</span><span id="ImagesManagement-886"><a href="#ImagesManagement-886"><span class="linenos">886</span></a><span class="sd">        to_results_image : bool</span>
</span><span id="ImagesManagement-887"><a href="#ImagesManagement-887"><span class="linenos">887</span></a><span class="sd">            Boolean value indicating whether images obtained from the</span>
</span><span id="ImagesManagement-888"><a href="#ImagesManagement-888"><span class="linenos">888</span></a><span class="sd">            `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="ImagesManagement-889"><a href="#ImagesManagement-889"><span class="linenos">889</span></a><span class="sd">            methods of the `NucleiFinder` class should be stitched to the right</span>
</span><span id="ImagesManagement-890"><a href="#ImagesManagement-890"><span class="linenos">890</span></a><span class="sd">            side of the images in the `acronyme` list.</span>
</span><span id="ImagesManagement-891"><a href="#ImagesManagement-891"><span class="linenos">891</span></a>
</span><span id="ImagesManagement-892"><a href="#ImagesManagement-892"><span class="linenos">892</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement-893"><a href="#ImagesManagement-893"><span class="linenos">893</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement-894"><a href="#ImagesManagement-894"><span class="linenos">894</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement-895"><a href="#ImagesManagement-895"><span class="linenos">895</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="ImagesManagement-896"><a href="#ImagesManagement-896"><span class="linenos">896</span></a>
</span><span id="ImagesManagement-897"><a href="#ImagesManagement-897"><span class="linenos">897</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement-898"><a href="#ImagesManagement-898"><span class="linenos">898</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement-899"><a href="#ImagesManagement-899"><span class="linenos">899</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement-900"><a href="#ImagesManagement-900"><span class="linenos">900</span></a>
</span><span id="ImagesManagement-901"><a href="#ImagesManagement-901"><span class="linenos">901</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement-902"><a href="#ImagesManagement-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-903"><a href="#ImagesManagement-903"><span class="linenos">903</span></a>
</span><span id="ImagesManagement-904"><a href="#ImagesManagement-904"><span class="linenos">904</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement-905"><a href="#ImagesManagement-905"><span class="linenos">905</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement-906"><a href="#ImagesManagement-906"><span class="linenos">906</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-907"><a href="#ImagesManagement-907"><span class="linenos">907</span></a>
</span><span id="ImagesManagement-908"><a href="#ImagesManagement-908"><span class="linenos">908</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement-909"><a href="#ImagesManagement-909"><span class="linenos">909</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">):</span>
</span><span id="ImagesManagement-910"><a href="#ImagesManagement-910"><span class="linenos">910</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement-911"><a href="#ImagesManagement-911"><span class="linenos">911</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement-912"><a href="#ImagesManagement-912"><span class="linenos">912</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement-913"><a href="#ImagesManagement-913"><span class="linenos">913</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement-914"><a href="#ImagesManagement-914"><span class="linenos">914</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement-915"><a href="#ImagesManagement-915"><span class="linenos">915</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement-916"><a href="#ImagesManagement-916"><span class="linenos">916</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement-917"><a href="#ImagesManagement-917"><span class="linenos">917</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-918"><a href="#ImagesManagement-918"><span class="linenos">918</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-919"><a href="#ImagesManagement-919"><span class="linenos">919</span></a>                    <span class="k">break</span>
</span><span id="ImagesManagement-920"><a href="#ImagesManagement-920"><span class="linenos">920</span></a>
</span><span id="ImagesManagement-921"><a href="#ImagesManagement-921"><span class="linenos">921</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement-922"><a href="#ImagesManagement-922"><span class="linenos">922</span></a>
</span><span id="ImagesManagement-923"><a href="#ImagesManagement-923"><span class="linenos">923</span></a>            <span class="k">if</span> <span class="n">to_results_image</span><span class="p">:</span>
</span><span id="ImagesManagement-924"><a href="#ImagesManagement-924"><span class="linenos">924</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement-925"><a href="#ImagesManagement-925"><span class="linenos">925</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement-926"><a href="#ImagesManagement-926"><span class="linenos">926</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement-927"><a href="#ImagesManagement-927"><span class="linenos">927</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement-928"><a href="#ImagesManagement-928"><span class="linenos">928</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement-929"><a href="#ImagesManagement-929"><span class="linenos">929</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement-930"><a href="#ImagesManagement-930"><span class="linenos">930</span></a>                    <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">[</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement-931"><a href="#ImagesManagement-931"><span class="linenos">931</span></a>
</span><span id="ImagesManagement-932"><a href="#ImagesManagement-932"><span class="linenos">932</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ImagesManagement-933"><a href="#ImagesManagement-933"><span class="linenos">933</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">_res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="ImagesManagement-934"><a href="#ImagesManagement-934"><span class="linenos">934</span></a>
</span><span id="ImagesManagement-935"><a href="#ImagesManagement-935"><span class="linenos">935</span></a>            <span class="k">elif</span> <span class="n">to_results_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="ImagesManagement-936"><a href="#ImagesManagement-936"><span class="linenos">936</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="ImagesManagement-937"><a href="#ImagesManagement-937"><span class="linenos">937</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="ImagesManagement-938"><a href="#ImagesManagement-938"><span class="linenos">938</span></a>
</span><span id="ImagesManagement-939"><a href="#ImagesManagement-939"><span class="linenos">939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="ImagesManagement-940"><a href="#ImagesManagement-940"><span class="linenos">940</span></a>
</span><span id="ImagesManagement-941"><a href="#ImagesManagement-941"><span class="linenos">941</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span><span id="ImagesManagement-942"><a href="#ImagesManagement-942"><span class="linenos">942</span></a>
</span><span id="ImagesManagement-943"><a href="#ImagesManagement-943"><span class="linenos">943</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="ImagesManagement-944"><a href="#ImagesManagement-944"><span class="linenos">944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement-945"><a href="#ImagesManagement-945"><span class="linenos">945</span></a><span class="sd">        Save `self.results_images` loaded by the `self.load_experimental_images()` method,</span>
</span><span id="ImagesManagement-946"><a href="#ImagesManagement-946"><span class="linenos">946</span></a><span class="sd">        obtained from the `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="ImagesManagement-947"><a href="#ImagesManagement-947"><span class="linenos">947</span></a><span class="sd">        methods of the `NucleiFinder` class for later usage with cls.load_from_dict() method.</span>
</span><span id="ImagesManagement-948"><a href="#ImagesManagement-948"><span class="linenos">948</span></a><span class="sd">        The data will be saved with a `.inuc` extension.</span>
</span><span id="ImagesManagement-949"><a href="#ImagesManagement-949"><span class="linenos">949</span></a>
</span><span id="ImagesManagement-950"><a href="#ImagesManagement-950"><span class="linenos">950</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement-951"><a href="#ImagesManagement-951"><span class="linenos">951</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement-952"><a href="#ImagesManagement-952"><span class="linenos">952</span></a><span class="sd">        path_to_save : str</span>
</span><span id="ImagesManagement-953"><a href="#ImagesManagement-953"><span class="linenos">953</span></a><span class="sd">            The directory path where the images will be saved.</span>
</span><span id="ImagesManagement-954"><a href="#ImagesManagement-954"><span class="linenos">954</span></a><span class="sd">            Default is the current working directory.</span>
</span><span id="ImagesManagement-955"><a href="#ImagesManagement-955"><span class="linenos">955</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement-956"><a href="#ImagesManagement-956"><span class="linenos">956</span></a>
</span><span id="ImagesManagement-957"><a href="#ImagesManagement-957"><span class="linenos">957</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.inuc&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement-958"><a href="#ImagesManagement-958"><span class="linenos">958</span></a>
</span><span id="ImagesManagement-959"><a href="#ImagesManagement-959"><span class="linenos">959</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A class for managing, preprocessing, merging, stitching, saving, and loading
microscopy or flow cytometry images used in NucleiFinder-based analyses.</p>

<p>This class provides a unified interface for:</p>

<ul>
<li>loading image data,</li>
<li>selecting images by IDs,</li>
<li>preprocessing images (equalization, CLAHE, gamma/contrast/brightness adjustment),</li>
<li>merging images with user-defined intensity ratios,</li>
<li>stitching images horizontally,</li>
<li>retrieving and saving processed image sets.</li>
</ul>

<p>The class stores original or loaded data in the <code><a href="#ImagesManagement.results_images">results_images</a></code> attribute,
and all processed images in <code><a href="#ImagesManagement.prepared_images">prepared_images</a></code> under user-defined acronyms.
These acronyms allow flexible retrieval with <code><a href="#ImagesManagement.get_prepared_images">get_prepared_images()</a></code>
and exporting via <code><a href="#ImagesManagement.save_prepared_images">save_prepared_images()</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<p>images_ids : list[int]
    List of selected image identifiers.</p>

<p>result_dict : dict or None
    Dictionary containing raw or preprocessed images.
    If <code>None</code>, images may later be loaded or processed from file.</p>

<p>experiment_name : str
    Name of the experiment. Used for saving and structuring output.</p>

<h2 id="attributes">Attributes</h2>

<p>images_ids : list[int]
    IDs of images managed by the class.</p>

<p>results_images : dict or None
    Dictionary containing raw or analysis-derived images.</p>

<p>experiment_name : str
    Name of the experiment. Used in saved filenames.</p>

<p>prepared_images : dict
    Container for processed/adjusted/merged/stitched images,
    indexed by user-defined acronyms.</p>

<h2 id="notes">Notes</h2>

<p>Processed images are stored only in memory until saved explicitly with
<code><a href="#ImagesManagement.save_prepared_images">save_prepared_images()</a></code>.</p>

<p>Raw images loaded from NucleiFinder analyses can be saved for later reuse
in a serialized <code>.inuc</code> format using <code><a href="#ImagesManagement.save_raw">save_raw()</a></code>.</p>

<h2 id="examples">Examples</h2>

<p>Load image results from an analysis:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">manager</span> <span class="o">=</span> <span class="n"><a href="#ImagesManagement.load_experimental_images">ImagesManagement.load_experimental_images</a></span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="s2">&quot;experiment1&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Adjust selected images:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">manager</span><span class="o">.</span><span class="n">adjust_images</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">acronyme</span><span class="o">=</span><span class="s2">&quot;adj&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">path_to_images</span><span class="o">=</span><span class="s2">&quot;path/to/imgs&quot;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">eq</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">clahe</span><span class="o">=</span><span class="kc">True</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>

<p>Merge multiple prepared sets:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">manager</span><span class="o">.</span><span class="n">image_merging</span><span class="p">([</span><span class="s2">&quot;adj&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">],</span> <span class="n">ratio_list</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
</code></pre>
</div>

<p>Retrieve processed images:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">imgs</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">get_prepared_images</span><span class="p">(</span><span class="s2">&quot;adj&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>Save stitched images to disk:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">manager</span><span class="o">.</span><span class="n">save_prepared_images</span><span class="p">(</span><span class="s2">&quot;stitched_adj_other&quot;</span><span class="p">,</span> <span class="s2">&quot;./output/&quot;</span><span class="p">)</span>
</code></pre>
</div>
</div>


                            <div id="ImagesManagement.__init__" class="classattr">
                                        <input id="ImagesManagement.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ImagesManagement</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">images_ids</span>, </span><span class="param"><span class="n">result_dict</span>, </span><span class="param"><span class="n">experiment_name</span></span>)</span>

                <label class="view-source-button" for="ImagesManagement.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.__init__-478"><a href="#ImagesManagement.__init__-478"><span class="linenos">478</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">,</span> <span class="n">result_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">):</span>
</span><span id="ImagesManagement.__init__-479"><a href="#ImagesManagement.__init__-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.__init__-480"><a href="#ImagesManagement.__init__-480"><span class="linenos">480</span></a><span class="sd">        Initialize the ImagesManagement object.</span>
</span><span id="ImagesManagement.__init__-481"><a href="#ImagesManagement.__init__-481"><span class="linenos">481</span></a>
</span><span id="ImagesManagement.__init__-482"><a href="#ImagesManagement.__init__-482"><span class="linenos">482</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.__init__-483"><a href="#ImagesManagement.__init__-483"><span class="linenos">483</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.__init__-484"><a href="#ImagesManagement.__init__-484"><span class="linenos">484</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="ImagesManagement.__init__-485"><a href="#ImagesManagement.__init__-485"><span class="linenos">485</span></a><span class="sd">            List of image identifiers.</span>
</span><span id="ImagesManagement.__init__-486"><a href="#ImagesManagement.__init__-486"><span class="linenos">486</span></a>
</span><span id="ImagesManagement.__init__-487"><a href="#ImagesManagement.__init__-487"><span class="linenos">487</span></a><span class="sd">        result_dict : dict or None</span>
</span><span id="ImagesManagement.__init__-488"><a href="#ImagesManagement.__init__-488"><span class="linenos">488</span></a><span class="sd">            Dictionary containing processed images.</span>
</span><span id="ImagesManagement.__init__-489"><a href="#ImagesManagement.__init__-489"><span class="linenos">489</span></a>
</span><span id="ImagesManagement.__init__-490"><a href="#ImagesManagement.__init__-490"><span class="linenos">490</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement.__init__-491"><a href="#ImagesManagement.__init__-491"><span class="linenos">491</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement.__init__-492"><a href="#ImagesManagement.__init__-492"><span class="linenos">492</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.__init__-493"><a href="#ImagesManagement.__init__-493"><span class="linenos">493</span></a>
</span><span id="ImagesManagement.__init__-494"><a href="#ImagesManagement.__init__-494"><span class="linenos">494</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span> <span class="o">=</span> <span class="n">images_ids</span>
</span><span id="ImagesManagement.__init__-495"><a href="#ImagesManagement.__init__-495"><span class="linenos">495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the list of image IDs managed by this instance.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.__init__-496"><a href="#ImagesManagement.__init__-496"><span class="linenos">496</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span> <span class="o">=</span> <span class="n">result_dict</span>
</span><span id="ImagesManagement.__init__-497"><a href="#ImagesManagement.__init__-497"><span class="linenos">497</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores dictionary containing processed images.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.__init__-498"><a href="#ImagesManagement.__init__-498"><span class="linenos">498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="ImagesManagement.__init__-499"><a href="#ImagesManagement.__init__-499"><span class="linenos">499</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stores the experiment name for file naming and organizational purposes.&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.__init__-500"><a href="#ImagesManagement.__init__-500"><span class="linenos">500</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement.__init__-501"><a href="#ImagesManagement.__init__-501"><span class="linenos">501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary for storing processed images (adjusted, merged, stitched),</span>
</span><span id="ImagesManagement.__init__-502"><a href="#ImagesManagement.__init__-502"><span class="linenos">502</span></a><span class="sd">        indexed by user-defined acronyms for flexible retrieval.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the ImagesManagement object.</p>

<h2 id="parameters">Parameters</h2>

<p>images_ids : list[int]
    List of image identifiers.</p>

<p>result_dict : dict or None
    Dictionary containing processed images.</p>

<p>experiment_name : str
    Name of the experiment.</p>
</div>


                            </div>
                            <div id="ImagesManagement.images_ids" class="classattr">
                                <div class="attr variable">
            <span class="name">images_ids</span>

        
    </div>
    <a class="headerlink" href="#ImagesManagement.images_ids"></a>
    
            <div class="docstring"><p>Stores the list of image IDs managed by this instance.</p>
</div>


                            </div>
                            <div id="ImagesManagement.results_images" class="classattr">
                                <div class="attr variable">
            <span class="name">results_images</span>

        
    </div>
    <a class="headerlink" href="#ImagesManagement.results_images"></a>
    
            <div class="docstring"><p>Stores dictionary containing processed images.</p>
</div>


                            </div>
                            <div id="ImagesManagement.experiment_name" class="classattr">
                                <div class="attr variable">
            <span class="name">experiment_name</span>

        
    </div>
    <a class="headerlink" href="#ImagesManagement.experiment_name"></a>
    
            <div class="docstring"><p>Stores the experiment name for file naming and organizational purposes.</p>
</div>


                            </div>
                            <div id="ImagesManagement.prepared_images" class="classattr">
                                <div class="attr variable">
            <span class="name">prepared_images</span>

        
    </div>
    <a class="headerlink" href="#ImagesManagement.prepared_images"></a>
    
            <div class="docstring"><p>Dictionary for storing processed images (adjusted, merged, stitched),
indexed by user-defined acronyms for flexible retrieval.</p>
</div>


                            </div>
                            <div id="ImagesManagement.load_from_dict" class="classattr">
                                        <input id="ImagesManagement.load_from_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_from_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.load_from_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.load_from_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.load_from_dict-504"><a href="#ImagesManagement.load_from_dict-504"><span class="linenos">504</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement.load_from_dict-505"><a href="#ImagesManagement.load_from_dict-505"><span class="linenos">505</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_from_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement.load_from_dict-506"><a href="#ImagesManagement.load_from_dict-506"><span class="linenos">506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_from_dict-507"><a href="#ImagesManagement.load_from_dict-507"><span class="linenos">507</span></a><span class="sd">        Load an ImagesManagement instance from a `.inuc` serialized dictionary.</span>
</span><span id="ImagesManagement.load_from_dict-508"><a href="#ImagesManagement.load_from_dict-508"><span class="linenos">508</span></a>
</span><span id="ImagesManagement.load_from_dict-509"><a href="#ImagesManagement.load_from_dict-509"><span class="linenos">509</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.load_from_dict-510"><a href="#ImagesManagement.load_from_dict-510"><span class="linenos">510</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.load_from_dict-511"><a href="#ImagesManagement.load_from_dict-511"><span class="linenos">511</span></a><span class="sd">        path : str</span>
</span><span id="ImagesManagement.load_from_dict-512"><a href="#ImagesManagement.load_from_dict-512"><span class="linenos">512</span></a><span class="sd">            Path to the `.inuc` file exported with `save_raw()`.</span>
</span><span id="ImagesManagement.load_from_dict-513"><a href="#ImagesManagement.load_from_dict-513"><span class="linenos">513</span></a>
</span><span id="ImagesManagement.load_from_dict-514"><a href="#ImagesManagement.load_from_dict-514"><span class="linenos">514</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement.load_from_dict-515"><a href="#ImagesManagement.load_from_dict-515"><span class="linenos">515</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement.load_from_dict-516"><a href="#ImagesManagement.load_from_dict-516"><span class="linenos">516</span></a>
</span><span id="ImagesManagement.load_from_dict-517"><a href="#ImagesManagement.load_from_dict-517"><span class="linenos">517</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.load_from_dict-518"><a href="#ImagesManagement.load_from_dict-518"><span class="linenos">518</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.load_from_dict-519"><a href="#ImagesManagement.load_from_dict-519"><span class="linenos">519</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement.load_from_dict-520"><a href="#ImagesManagement.load_from_dict-520"><span class="linenos">520</span></a><span class="sd">            A reconstructed ImagesManagement object.</span>
</span><span id="ImagesManagement.load_from_dict-521"><a href="#ImagesManagement.load_from_dict-521"><span class="linenos">521</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_from_dict-522"><a href="#ImagesManagement.load_from_dict-522"><span class="linenos">522</span></a>
</span><span id="ImagesManagement.load_from_dict-523"><a href="#ImagesManagement.load_from_dict-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="s2">&quot;.inuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="ImagesManagement.load_from_dict-524"><a href="#ImagesManagement.load_from_dict-524"><span class="linenos">524</span></a>
</span><span id="ImagesManagement.load_from_dict-525"><a href="#ImagesManagement.load_from_dict-525"><span class="linenos">525</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="ImagesManagement.load_from_dict-526"><a href="#ImagesManagement.load_from_dict-526"><span class="linenos">526</span></a>
</span><span id="ImagesManagement.load_from_dict-527"><a href="#ImagesManagement.load_from_dict-527"><span class="linenos">527</span></a>                <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="ImagesManagement.load_from_dict-528"><a href="#ImagesManagement.load_from_dict-528"><span class="linenos">528</span></a>                <span class="n">data_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">loaded_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loaded_data</span><span class="p">}</span>
</span><span id="ImagesManagement.load_from_dict-529"><a href="#ImagesManagement.load_from_dict-529"><span class="linenos">529</span></a>
</span><span id="ImagesManagement.load_from_dict-530"><a href="#ImagesManagement.load_from_dict-530"><span class="linenos">530</span></a>                <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement.load_from_dict-531"><a href="#ImagesManagement.load_from_dict-531"><span class="linenos">531</span></a>
</span><span id="ImagesManagement.load_from_dict-532"><a href="#ImagesManagement.load_from_dict-532"><span class="linenos">532</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement.load_from_dict-533"><a href="#ImagesManagement.load_from_dict-533"><span class="linenos">533</span></a>                    <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="ImagesManagement.load_from_dict-534"><a href="#ImagesManagement.load_from_dict-534"><span class="linenos">534</span></a>
</span><span id="ImagesManagement.load_from_dict-535"><a href="#ImagesManagement.load_from_dict-535"><span class="linenos">535</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span><span id="ImagesManagement.load_from_dict-536"><a href="#ImagesManagement.load_from_dict-536"><span class="linenos">536</span></a>
</span><span id="ImagesManagement.load_from_dict-537"><a href="#ImagesManagement.load_from_dict-537"><span class="linenos">537</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.load_from_dict-538"><a href="#ImagesManagement.load_from_dict-538"><span class="linenos">538</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.load_from_dict-539"><a href="#ImagesManagement.load_from_dict-539"><span class="linenos">539</span></a>
</span><span id="ImagesManagement.load_from_dict-540"><a href="#ImagesManagement.load_from_dict-540"><span class="linenos">540</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.load_from_dict-541"><a href="#ImagesManagement.load_from_dict-541"><span class="linenos">541</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement.load_from_dict-542"><a href="#ImagesManagement.load_from_dict-542"><span class="linenos">542</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .inuc extension!&quot;</span>
</span><span id="ImagesManagement.load_from_dict-543"><a href="#ImagesManagement.load_from_dict-543"><span class="linenos">543</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load an ImagesManagement instance from a <code>.inuc</code> serialized dictionary.</p>

<h2 id="parameters">Parameters</h2>

<p>path : str
    Path to the <code>.inuc</code> file exported with <code><a href="#ImagesManagement.save_raw">save_raw()</a></code>.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<h2 id="returns">Returns</h2>

<p>ImagesManagement
    A reconstructed ImagesManagement object.</p>
</div>


                            </div>
                            <div id="ImagesManagement.load_experimental_images" class="classattr">
                                        <input id="ImagesManagement.load_experimental_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_experimental_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">results_dict</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.load_experimental_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.load_experimental_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.load_experimental_images-545"><a href="#ImagesManagement.load_experimental_images-545"><span class="linenos">545</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement.load_experimental_images-546"><a href="#ImagesManagement.load_experimental_images-546"><span class="linenos">546</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_experimental_images</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">results_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement.load_experimental_images-547"><a href="#ImagesManagement.load_experimental_images-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_experimental_images-548"><a href="#ImagesManagement.load_experimental_images-548"><span class="linenos">548</span></a><span class="sd">        Load results exported from NucleiFinder series analysis.</span>
</span><span id="ImagesManagement.load_experimental_images-549"><a href="#ImagesManagement.load_experimental_images-549"><span class="linenos">549</span></a>
</span><span id="ImagesManagement.load_experimental_images-550"><a href="#ImagesManagement.load_experimental_images-550"><span class="linenos">550</span></a><span class="sd">        Initialize the object with results from series_analysis_nuclei()</span>
</span><span id="ImagesManagement.load_experimental_images-551"><a href="#ImagesManagement.load_experimental_images-551"><span class="linenos">551</span></a><span class="sd">        or series_analysis_chromatinization() of the NucleiFinder class.</span>
</span><span id="ImagesManagement.load_experimental_images-552"><a href="#ImagesManagement.load_experimental_images-552"><span class="linenos">552</span></a>
</span><span id="ImagesManagement.load_experimental_images-553"><a href="#ImagesManagement.load_experimental_images-553"><span class="linenos">553</span></a>
</span><span id="ImagesManagement.load_experimental_images-554"><a href="#ImagesManagement.load_experimental_images-554"><span class="linenos">554</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.load_experimental_images-555"><a href="#ImagesManagement.load_experimental_images-555"><span class="linenos">555</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.load_experimental_images-556"><a href="#ImagesManagement.load_experimental_images-556"><span class="linenos">556</span></a><span class="sd">        results_dict : dict</span>
</span><span id="ImagesManagement.load_experimental_images-557"><a href="#ImagesManagement.load_experimental_images-557"><span class="linenos">557</span></a><span class="sd">            Dictionary returned by `series_analysis_nuclei()` or</span>
</span><span id="ImagesManagement.load_experimental_images-558"><a href="#ImagesManagement.load_experimental_images-558"><span class="linenos">558</span></a><span class="sd">            `series_analysis_chromatinization()`.</span>
</span><span id="ImagesManagement.load_experimental_images-559"><a href="#ImagesManagement.load_experimental_images-559"><span class="linenos">559</span></a>
</span><span id="ImagesManagement.load_experimental_images-560"><a href="#ImagesManagement.load_experimental_images-560"><span class="linenos">560</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement.load_experimental_images-561"><a href="#ImagesManagement.load_experimental_images-561"><span class="linenos">561</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement.load_experimental_images-562"><a href="#ImagesManagement.load_experimental_images-562"><span class="linenos">562</span></a>
</span><span id="ImagesManagement.load_experimental_images-563"><a href="#ImagesManagement.load_experimental_images-563"><span class="linenos">563</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.load_experimental_images-564"><a href="#ImagesManagement.load_experimental_images-564"><span class="linenos">564</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.load_experimental_images-565"><a href="#ImagesManagement.load_experimental_images-565"><span class="linenos">565</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement.load_experimental_images-566"><a href="#ImagesManagement.load_experimental_images-566"><span class="linenos">566</span></a>
</span><span id="ImagesManagement.load_experimental_images-567"><a href="#ImagesManagement.load_experimental_images-567"><span class="linenos">567</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_experimental_images-568"><a href="#ImagesManagement.load_experimental_images-568"><span class="linenos">568</span></a>
</span><span id="ImagesManagement.load_experimental_images-569"><a href="#ImagesManagement.load_experimental_images-569"><span class="linenos">569</span></a>        <span class="n">res_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement.load_experimental_images-570"><a href="#ImagesManagement.load_experimental_images-570"><span class="linenos">570</span></a>        <span class="n">id_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement.load_experimental_images-571"><a href="#ImagesManagement.load_experimental_images-571"><span class="linenos">571</span></a>
</span><span id="ImagesManagement.load_experimental_images-572"><a href="#ImagesManagement.load_experimental_images-572"><span class="linenos">572</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">results_dict</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="ImagesManagement.load_experimental_images-573"><a href="#ImagesManagement.load_experimental_images-573"><span class="linenos">573</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="ImagesManagement.load_experimental_images-574"><a href="#ImagesManagement.load_experimental_images-574"><span class="linenos">574</span></a>        <span class="p">):</span>
</span><span id="ImagesManagement.load_experimental_images-575"><a href="#ImagesManagement.load_experimental_images-575"><span class="linenos">575</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement.load_experimental_images-576"><a href="#ImagesManagement.load_experimental_images-576"><span class="linenos">576</span></a>                <span class="s2">&quot;Incorrect data provided. The data must come from series_analysis_nuclei() &quot;</span>
</span><span id="ImagesManagement.load_experimental_images-577"><a href="#ImagesManagement.load_experimental_images-577"><span class="linenos">577</span></a>                <span class="s2">&quot;or series_analysis_chromatinization() of the NucleiFinder class.&quot;</span>
</span><span id="ImagesManagement.load_experimental_images-578"><a href="#ImagesManagement.load_experimental_images-578"><span class="linenos">578</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement.load_experimental_images-579"><a href="#ImagesManagement.load_experimental_images-579"><span class="linenos">579</span></a>
</span><span id="ImagesManagement.load_experimental_images-580"><a href="#ImagesManagement.load_experimental_images-580"><span class="linenos">580</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">results_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement.load_experimental_images-581"><a href="#ImagesManagement.load_experimental_images-581"><span class="linenos">581</span></a>            <span class="n">res_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="ImagesManagement.load_experimental_images-582"><a href="#ImagesManagement.load_experimental_images-582"><span class="linenos">582</span></a>            <span class="n">id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>
</span><span id="ImagesManagement.load_experimental_images-583"><a href="#ImagesManagement.load_experimental_images-583"><span class="linenos">583</span></a>
</span><span id="ImagesManagement.load_experimental_images-584"><a href="#ImagesManagement.load_experimental_images-584"><span class="linenos">584</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">id_list</span><span class="p">,</span> <span class="n">res_dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load results exported from NucleiFinder series analysis.</p>

<p>Initialize the object with results from series_analysis_nuclei()
or series_analysis_chromatinization() of the NucleiFinder class.</p>

<h2 id="parameters">Parameters</h2>

<p>results_dict : dict
    Dictionary returned by <code>series_analysis_nuclei()</code> or
    <code>series_analysis_chromatinization()</code>.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<h2 id="returns">Returns</h2>

<p>ImagesManagement</p>
</div>


                            </div>
                            <div id="ImagesManagement.load_images_ids" class="classattr">
                                        <input id="ImagesManagement.load_images_ids-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_images_ids</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">images_ids</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.load_images_ids-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.load_images_ids"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.load_images_ids-586"><a href="#ImagesManagement.load_images_ids-586"><span class="linenos">586</span></a>    <span class="nd">@classmethod</span>
</span><span id="ImagesManagement.load_images_ids-587"><a href="#ImagesManagement.load_images_ids-587"><span class="linenos">587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_images_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">images_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ImagesManagement.load_images_ids-588"><a href="#ImagesManagement.load_images_ids-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_images_ids-589"><a href="#ImagesManagement.load_images_ids-589"><span class="linenos">589</span></a><span class="sd">        Initialize the object with list of images IDs for porcesing.</span>
</span><span id="ImagesManagement.load_images_ids-590"><a href="#ImagesManagement.load_images_ids-590"><span class="linenos">590</span></a>
</span><span id="ImagesManagement.load_images_ids-591"><a href="#ImagesManagement.load_images_ids-591"><span class="linenos">591</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.load_images_ids-592"><a href="#ImagesManagement.load_images_ids-592"><span class="linenos">592</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.load_images_ids-593"><a href="#ImagesManagement.load_images_ids-593"><span class="linenos">593</span></a><span class="sd">        images_ids : list[int]</span>
</span><span id="ImagesManagement.load_images_ids-594"><a href="#ImagesManagement.load_images_ids-594"><span class="linenos">594</span></a><span class="sd">            List of selected image IDs.</span>
</span><span id="ImagesManagement.load_images_ids-595"><a href="#ImagesManagement.load_images_ids-595"><span class="linenos">595</span></a>
</span><span id="ImagesManagement.load_images_ids-596"><a href="#ImagesManagement.load_images_ids-596"><span class="linenos">596</span></a><span class="sd">        experiment_name : str</span>
</span><span id="ImagesManagement.load_images_ids-597"><a href="#ImagesManagement.load_images_ids-597"><span class="linenos">597</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="ImagesManagement.load_images_ids-598"><a href="#ImagesManagement.load_images_ids-598"><span class="linenos">598</span></a>
</span><span id="ImagesManagement.load_images_ids-599"><a href="#ImagesManagement.load_images_ids-599"><span class="linenos">599</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.load_images_ids-600"><a href="#ImagesManagement.load_images_ids-600"><span class="linenos">600</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.load_images_ids-601"><a href="#ImagesManagement.load_images_ids-601"><span class="linenos">601</span></a><span class="sd">        ImagesManagement</span>
</span><span id="ImagesManagement.load_images_ids-602"><a href="#ImagesManagement.load_images_ids-602"><span class="linenos">602</span></a>
</span><span id="ImagesManagement.load_images_ids-603"><a href="#ImagesManagement.load_images_ids-603"><span class="linenos">603</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.load_images_ids-604"><a href="#ImagesManagement.load_images_ids-604"><span class="linenos">604</span></a>
</span><span id="ImagesManagement.load_images_ids-605"><a href="#ImagesManagement.load_images_ids-605"><span class="linenos">605</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">images_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.load_images_ids-606"><a href="#ImagesManagement.load_images_ids-606"><span class="linenos">606</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ImagesManagement.load_images_ids-607"><a href="#ImagesManagement.load_images_ids-607"><span class="linenos">607</span></a>                <span class="s2">&quot;Incorrect data provided. There must be a list of image IDs.&quot;</span>
</span><span id="ImagesManagement.load_images_ids-608"><a href="#ImagesManagement.load_images_ids-608"><span class="linenos">608</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement.load_images_ids-609"><a href="#ImagesManagement.load_images_ids-609"><span class="linenos">609</span></a>
</span><span id="ImagesManagement.load_images_ids-610"><a href="#ImagesManagement.load_images_ids-610"><span class="linenos">610</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">images_ids</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the object with list of images IDs for porcesing.</p>

<h2 id="parameters">Parameters</h2>

<p>images_ids : list[int]
    List of selected image IDs.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<h2 id="returns">Returns</h2>

<p>ImagesManagement</p>
</div>


                            </div>
                            <div id="ImagesManagement.get_included_acronyms" class="classattr">
                                        <input id="ImagesManagement.get_included_acronyms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_included_acronyms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.get_included_acronyms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.get_included_acronyms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.get_included_acronyms-612"><a href="#ImagesManagement.get_included_acronyms-612"><span class="linenos">612</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_included_acronyms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ImagesManagement.get_included_acronyms-613"><a href="#ImagesManagement.get_included_acronyms-613"><span class="linenos">613</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.get_included_acronyms-614"><a href="#ImagesManagement.get_included_acronyms-614"><span class="linenos">614</span></a><span class="sd">        Print the data acronyms for adjusted images, processed using the</span>
</span><span id="ImagesManagement.get_included_acronyms-615"><a href="#ImagesManagement.get_included_acronyms-615"><span class="linenos">615</span></a><span class="sd">        self.adjust_images(), self.image_merging(), and self.image_stitching() methods.</span>
</span><span id="ImagesManagement.get_included_acronyms-616"><a href="#ImagesManagement.get_included_acronyms-616"><span class="linenos">616</span></a>
</span><span id="ImagesManagement.get_included_acronyms-617"><a href="#ImagesManagement.get_included_acronyms-617"><span class="linenos">617</span></a><span class="sd">        Acronym information is essential for retrieving and saving data using</span>
</span><span id="ImagesManagement.get_included_acronyms-618"><a href="#ImagesManagement.get_included_acronyms-618"><span class="linenos">618</span></a><span class="sd">        the self.get_prepared_images() and self.save_prepared_images() methods.</span>
</span><span id="ImagesManagement.get_included_acronyms-619"><a href="#ImagesManagement.get_included_acronyms-619"><span class="linenos">619</span></a>
</span><span id="ImagesManagement.get_included_acronyms-620"><a href="#ImagesManagement.get_included_acronyms-620"><span class="linenos">620</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement.get_included_acronyms-621"><a href="#ImagesManagement.get_included_acronyms-621"><span class="linenos">621</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement.get_included_acronyms-622"><a href="#ImagesManagement.get_included_acronyms-622"><span class="linenos">622</span></a><span class="sd">        This method prints the list of available acronyms but does not return it.</span>
</span><span id="ImagesManagement.get_included_acronyms-623"><a href="#ImagesManagement.get_included_acronyms-623"><span class="linenos">623</span></a>
</span><span id="ImagesManagement.get_included_acronyms-624"><a href="#ImagesManagement.get_included_acronyms-624"><span class="linenos">624</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.get_included_acronyms-625"><a href="#ImagesManagement.get_included_acronyms-625"><span class="linenos">625</span></a>
</span><span id="ImagesManagement.get_included_acronyms-626"><a href="#ImagesManagement.get_included_acronyms-626"><span class="linenos">626</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.get_included_acronyms-627"><a href="#ImagesManagement.get_included_acronyms-627"><span class="linenos">627</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Avaiable stored images:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.get_included_acronyms-628"><a href="#ImagesManagement.get_included_acronyms-628"><span class="linenos">628</span></a>            <span class="k">for</span> <span class="n">kd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="ImagesManagement.get_included_acronyms-629"><a href="#ImagesManagement.get_included_acronyms-629"><span class="linenos">629</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">kd</span><span class="p">)</span>
</span><span id="ImagesManagement.get_included_acronyms-630"><a href="#ImagesManagement.get_included_acronyms-630"><span class="linenos">630</span></a>
</span><span id="ImagesManagement.get_included_acronyms-631"><a href="#ImagesManagement.get_included_acronyms-631"><span class="linenos">631</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.get_included_acronyms-632"><a href="#ImagesManagement.get_included_acronyms-632"><span class="linenos">632</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to return!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print the data acronyms for adjusted images, processed using the
self.adjust_images(), self.image_merging(), and self.image_stitching() methods.</p>

<p>Acronym information is essential for retrieving and saving data using
the self.get_prepared_images() and self.save_prepared_images() methods.</p>

<h2 id="notes">Notes</h2>

<p>This method prints the list of available acronyms but does not return it.</p>
</div>


                            </div>
                            <div id="ImagesManagement.get_prepared_images" class="classattr">
                                        <input id="ImagesManagement.get_prepared_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_prepared_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">acronyme</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.get_prepared_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.get_prepared_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.get_prepared_images-634"><a href="#ImagesManagement.get_prepared_images-634"><span class="linenos">634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="ImagesManagement.get_prepared_images-635"><a href="#ImagesManagement.get_prepared_images-635"><span class="linenos">635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.get_prepared_images-636"><a href="#ImagesManagement.get_prepared_images-636"><span class="linenos">636</span></a><span class="sd">        Retrieves the prepared images (returned from preapre_selected_img()) stored in the object.</span>
</span><span id="ImagesManagement.get_prepared_images-637"><a href="#ImagesManagement.get_prepared_images-637"><span class="linenos">637</span></a>
</span><span id="ImagesManagement.get_prepared_images-638"><a href="#ImagesManagement.get_prepared_images-638"><span class="linenos">638</span></a>
</span><span id="ImagesManagement.get_prepared_images-639"><a href="#ImagesManagement.get_prepared_images-639"><span class="linenos">639</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.get_prepared_images-640"><a href="#ImagesManagement.get_prepared_images-640"><span class="linenos">640</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.get_prepared_images-641"><a href="#ImagesManagement.get_prepared_images-641"><span class="linenos">641</span></a><span class="sd">        acronyme : str or None</span>
</span><span id="ImagesManagement.get_prepared_images-642"><a href="#ImagesManagement.get_prepared_images-642"><span class="linenos">642</span></a><span class="sd">            Acronym identifying a processed image set. If None, prints available keys.</span>
</span><span id="ImagesManagement.get_prepared_images-643"><a href="#ImagesManagement.get_prepared_images-643"><span class="linenos">643</span></a>
</span><span id="ImagesManagement.get_prepared_images-644"><a href="#ImagesManagement.get_prepared_images-644"><span class="linenos">644</span></a>
</span><span id="ImagesManagement.get_prepared_images-645"><a href="#ImagesManagement.get_prepared_images-645"><span class="linenos">645</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.get_prepared_images-646"><a href="#ImagesManagement.get_prepared_images-646"><span class="linenos">646</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.get_prepared_images-647"><a href="#ImagesManagement.get_prepared_images-647"><span class="linenos">647</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement.get_prepared_images-648"><a href="#ImagesManagement.get_prepared_images-648"><span class="linenos">648</span></a><span class="sd">            Dictionary of prepared images.</span>
</span><span id="ImagesManagement.get_prepared_images-649"><a href="#ImagesManagement.get_prepared_images-649"><span class="linenos">649</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.get_prepared_images-650"><a href="#ImagesManagement.get_prepared_images-650"><span class="linenos">650</span></a>
</span><span id="ImagesManagement.get_prepared_images-651"><a href="#ImagesManagement.get_prepared_images-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ImagesManagement.get_prepared_images-652"><a href="#ImagesManagement.get_prepared_images-652"><span class="linenos">652</span></a>
</span><span id="ImagesManagement.get_prepared_images-653"><a href="#ImagesManagement.get_prepared_images-653"><span class="linenos">653</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="ImagesManagement.get_prepared_images-654"><a href="#ImagesManagement.get_prepared_images-654"><span class="linenos">654</span></a>
</span><span id="ImagesManagement.get_prepared_images-655"><a href="#ImagesManagement.get_prepared_images-655"><span class="linenos">655</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.get_prepared_images-656"><a href="#ImagesManagement.get_prepared_images-656"><span class="linenos">656</span></a>
</span><span id="ImagesManagement.get_prepared_images-657"><a href="#ImagesManagement.get_prepared_images-657"><span class="linenos">657</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement.get_prepared_images-658"><a href="#ImagesManagement.get_prepared_images-658"><span class="linenos">658</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span>
</span><span id="ImagesManagement.get_prepared_images-659"><a href="#ImagesManagement.get_prepared_images-659"><span class="linenos">659</span></a>
</span><span id="ImagesManagement.get_prepared_images-660"><a href="#ImagesManagement.get_prepared_images-660"><span class="linenos">660</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieves the prepared images (returned from preapre_selected_img()) stored in the object.</p>

<h2 id="parameters">Parameters</h2>

<p>acronyme : str or None
    Acronym identifying a processed image set. If None, prints available keys.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary of prepared images.</p>
</div>


                            </div>
                            <div id="ImagesManagement.save_prepared_images" class="classattr">
                                        <input id="ImagesManagement.save_prepared_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_prepared_images</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.save_prepared_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.save_prepared_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.save_prepared_images-662"><a href="#ImagesManagement.save_prepared_images-662"><span class="linenos">662</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_prepared_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="ImagesManagement.save_prepared_images-663"><a href="#ImagesManagement.save_prepared_images-663"><span class="linenos">663</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.save_prepared_images-664"><a href="#ImagesManagement.save_prepared_images-664"><span class="linenos">664</span></a><span class="sd">        Saves prepared images (returned from preapre_selected_img() method) to the specified directory.</span>
</span><span id="ImagesManagement.save_prepared_images-665"><a href="#ImagesManagement.save_prepared_images-665"><span class="linenos">665</span></a>
</span><span id="ImagesManagement.save_prepared_images-666"><a href="#ImagesManagement.save_prepared_images-666"><span class="linenos">666</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.save_prepared_images-667"><a href="#ImagesManagement.save_prepared_images-667"><span class="linenos">667</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.save_prepared_images-668"><a href="#ImagesManagement.save_prepared_images-668"><span class="linenos">668</span></a><span class="sd">        path_to_save : str</span>
</span><span id="ImagesManagement.save_prepared_images-669"><a href="#ImagesManagement.save_prepared_images-669"><span class="linenos">669</span></a><span class="sd">            Directory path where the images will be saved. Default is the current working directory.</span>
</span><span id="ImagesManagement.save_prepared_images-670"><a href="#ImagesManagement.save_prepared_images-670"><span class="linenos">670</span></a>
</span><span id="ImagesManagement.save_prepared_images-671"><a href="#ImagesManagement.save_prepared_images-671"><span class="linenos">671</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.save_prepared_images-672"><a href="#ImagesManagement.save_prepared_images-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ImagesManagement.save_prepared_images-673"><a href="#ImagesManagement.save_prepared_images-673"><span class="linenos">673</span></a>
</span><span id="ImagesManagement.save_prepared_images-674"><a href="#ImagesManagement.save_prepared_images-674"><span class="linenos">674</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">get_included_acronyms</span><span class="p">()</span>
</span><span id="ImagesManagement.save_prepared_images-675"><a href="#ImagesManagement.save_prepared_images-675"><span class="linenos">675</span></a>
</span><span id="ImagesManagement.save_prepared_images-676"><a href="#ImagesManagement.save_prepared_images-676"><span class="linenos">676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.save_prepared_images-677"><a href="#ImagesManagement.save_prepared_images-677"><span class="linenos">677</span></a>
</span><span id="ImagesManagement.save_prepared_images-678"><a href="#ImagesManagement.save_prepared_images-678"><span class="linenos">678</span></a>            <span class="k">if</span> <span class="n">acronyme</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement.save_prepared_images-679"><a href="#ImagesManagement.save_prepared_images-679"><span class="linenos">679</span></a>
</span><span id="ImagesManagement.save_prepared_images-680"><a href="#ImagesManagement.save_prepared_images-680"><span class="linenos">680</span></a>                <span class="n">path_to_save</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="ImagesManagement.save_prepared_images-681"><a href="#ImagesManagement.save_prepared_images-681"><span class="linenos">681</span></a>                    <span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">acronyme</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ImagesManagement.save_prepared_images-682"><a href="#ImagesManagement.save_prepared_images-682"><span class="linenos">682</span></a>                <span class="p">)</span>
</span><span id="ImagesManagement.save_prepared_images-683"><a href="#ImagesManagement.save_prepared_images-683"><span class="linenos">683</span></a>
</span><span id="ImagesManagement.save_prepared_images-684"><a href="#ImagesManagement.save_prepared_images-684"><span class="linenos">684</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">):</span>
</span><span id="ImagesManagement.save_prepared_images-685"><a href="#ImagesManagement.save_prepared_images-685"><span class="linenos">685</span></a>                    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ImagesManagement.save_prepared_images-686"><a href="#ImagesManagement.save_prepared_images-686"><span class="linenos">686</span></a>
</span><span id="ImagesManagement.save_prepared_images-687"><a href="#ImagesManagement.save_prepared_images-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement.save_prepared_images-688"><a href="#ImagesManagement.save_prepared_images-688"><span class="linenos">688</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">imwrite</span><span class="p">(</span>
</span><span id="ImagesManagement.save_prepared_images-689"><a href="#ImagesManagement.save_prepared_images-689"><span class="linenos">689</span></a>                        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">),</span>
</span><span id="ImagesManagement.save_prepared_images-690"><a href="#ImagesManagement.save_prepared_images-690"><span class="linenos">690</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span id="ImagesManagement.save_prepared_images-691"><a href="#ImagesManagement.save_prepared_images-691"><span class="linenos">691</span></a>                    <span class="p">)</span>
</span><span id="ImagesManagement.save_prepared_images-692"><a href="#ImagesManagement.save_prepared_images-692"><span class="linenos">692</span></a>
</span><span id="ImagesManagement.save_prepared_images-693"><a href="#ImagesManagement.save_prepared_images-693"><span class="linenos">693</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ImagesManagement.save_prepared_images-694"><a href="#ImagesManagement.save_prepared_images-694"><span class="linenos">694</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect acronyme!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Saves prepared images (returned from preapre_selected_img() method) to the specified directory.</p>

<h2 id="parameters">Parameters</h2>

<p>path_to_save : str
    Directory path where the images will be saved. Default is the current working directory.</p>
</div>


                            </div>
                            <div id="ImagesManagement.adjust_images" class="classattr">
                                        <input id="ImagesManagement.adjust_images-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">adjust_images</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tif&#39;</span>,</span><span class="param">	<span class="n">eq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">clahe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">kernal</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>,</span><span class="param">	<span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span>,</span><span class="param">	<span class="n">max_intensity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span>,</span><span class="param">	<span class="n">min_intenisty</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">brightness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span>,</span><span class="param">	<span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">img_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.adjust_images-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.adjust_images"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.adjust_images-696"><a href="#ImagesManagement.adjust_images-696"><span class="linenos">696</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">adjust_images</span><span class="p">(</span>
</span><span id="ImagesManagement.adjust_images-697"><a href="#ImagesManagement.adjust_images-697"><span class="linenos">697</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-698"><a href="#ImagesManagement.adjust_images-698"><span class="linenos">698</span></a>        <span class="n">acronyme</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-699"><a href="#ImagesManagement.adjust_images-699"><span class="linenos">699</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-700"><a href="#ImagesManagement.adjust_images-700"><span class="linenos">700</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tif&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-701"><a href="#ImagesManagement.adjust_images-701"><span class="linenos">701</span></a>        <span class="n">eq</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-702"><a href="#ImagesManagement.adjust_images-702"><span class="linenos">702</span></a>        <span class="n">clahe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-703"><a href="#ImagesManagement.adjust_images-703"><span class="linenos">703</span></a>        <span class="n">kernal</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
</span><span id="ImagesManagement.adjust_images-704"><a href="#ImagesManagement.adjust_images-704"><span class="linenos">704</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-705"><a href="#ImagesManagement.adjust_images-705"><span class="linenos">705</span></a>        <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-706"><a href="#ImagesManagement.adjust_images-706"><span class="linenos">706</span></a>        <span class="n">max_intensity</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-707"><a href="#ImagesManagement.adjust_images-707"><span class="linenos">707</span></a>        <span class="n">min_intenisty</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-708"><a href="#ImagesManagement.adjust_images-708"><span class="linenos">708</span></a>        <span class="n">brightness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-709"><a href="#ImagesManagement.adjust_images-709"><span class="linenos">709</span></a>        <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-710"><a href="#ImagesManagement.adjust_images-710"><span class="linenos">710</span></a>        <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-711"><a href="#ImagesManagement.adjust_images-711"><span class="linenos">711</span></a>        <span class="n">img_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-712"><a href="#ImagesManagement.adjust_images-712"><span class="linenos">712</span></a>    <span class="p">):</span>
</span><span id="ImagesManagement.adjust_images-713"><a href="#ImagesManagement.adjust_images-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.adjust_images-714"><a href="#ImagesManagement.adjust_images-714"><span class="linenos">714</span></a><span class="sd">        Prepares selected images for processing, applying histogram equalization and CLAHE, if required.</span>
</span><span id="ImagesManagement.adjust_images-715"><a href="#ImagesManagement.adjust_images-715"><span class="linenos">715</span></a>
</span><span id="ImagesManagement.adjust_images-716"><a href="#ImagesManagement.adjust_images-716"><span class="linenos">716</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.adjust_images-717"><a href="#ImagesManagement.adjust_images-717"><span class="linenos">717</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.adjust_images-718"><a href="#ImagesManagement.adjust_images-718"><span class="linenos">718</span></a><span class="sd">        acronyme : str</span>
</span><span id="ImagesManagement.adjust_images-719"><a href="#ImagesManagement.adjust_images-719"><span class="linenos">719</span></a><span class="sd">            Name of images being adjusted in this run.</span>
</span><span id="ImagesManagement.adjust_images-720"><a href="#ImagesManagement.adjust_images-720"><span class="linenos">720</span></a>
</span><span id="ImagesManagement.adjust_images-721"><a href="#ImagesManagement.adjust_images-721"><span class="linenos">721</span></a><span class="sd">        path_to_images : str</span>
</span><span id="ImagesManagement.adjust_images-722"><a href="#ImagesManagement.adjust_images-722"><span class="linenos">722</span></a><span class="sd">            Path to the directory containing images.</span>
</span><span id="ImagesManagement.adjust_images-723"><a href="#ImagesManagement.adjust_images-723"><span class="linenos">723</span></a>
</span><span id="ImagesManagement.adjust_images-724"><a href="#ImagesManagement.adjust_images-724"><span class="linenos">724</span></a><span class="sd">        file_extension : str</span>
</span><span id="ImagesManagement.adjust_images-725"><a href="#ImagesManagement.adjust_images-725"><span class="linenos">725</span></a><span class="sd">            Image file extension. Default is &#39;tiff&#39;.</span>
</span><span id="ImagesManagement.adjust_images-726"><a href="#ImagesManagement.adjust_images-726"><span class="linenos">726</span></a>
</span><span id="ImagesManagement.adjust_images-727"><a href="#ImagesManagement.adjust_images-727"><span class="linenos">727</span></a><span class="sd">        eq : bool</span>
</span><span id="ImagesManagement.adjust_images-728"><a href="#ImagesManagement.adjust_images-728"><span class="linenos">728</span></a><span class="sd">            Whether to apply histogram equalization. Default is True.</span>
</span><span id="ImagesManagement.adjust_images-729"><a href="#ImagesManagement.adjust_images-729"><span class="linenos">729</span></a>
</span><span id="ImagesManagement.adjust_images-730"><a href="#ImagesManagement.adjust_images-730"><span class="linenos">730</span></a><span class="sd">        clahe : bool</span>
</span><span id="ImagesManagement.adjust_images-731"><a href="#ImagesManagement.adjust_images-731"><span class="linenos">731</span></a><span class="sd">            Whether to apply CLAHE. Default is True.</span>
</span><span id="ImagesManagement.adjust_images-732"><a href="#ImagesManagement.adjust_images-732"><span class="linenos">732</span></a>
</span><span id="ImagesManagement.adjust_images-733"><a href="#ImagesManagement.adjust_images-733"><span class="linenos">733</span></a><span class="sd">        kernal : tuple</span>
</span><span id="ImagesManagement.adjust_images-734"><a href="#ImagesManagement.adjust_images-734"><span class="linenos">734</span></a><span class="sd">            Kernel size for CLAHE. Default is (50, 50).</span>
</span><span id="ImagesManagement.adjust_images-735"><a href="#ImagesManagement.adjust_images-735"><span class="linenos">735</span></a>
</span><span id="ImagesManagement.adjust_images-736"><a href="#ImagesManagement.adjust_images-736"><span class="linenos">736</span></a><span class="sd">        fille_name_part : str</span>
</span><span id="ImagesManagement.adjust_images-737"><a href="#ImagesManagement.adjust_images-737"><span class="linenos">737</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="ImagesManagement.adjust_images-738"><a href="#ImagesManagement.adjust_images-738"><span class="linenos">738</span></a>
</span><span id="ImagesManagement.adjust_images-739"><a href="#ImagesManagement.adjust_images-739"><span class="linenos">739</span></a><span class="sd">        color : str</span>
</span><span id="ImagesManagement.adjust_images-740"><a href="#ImagesManagement.adjust_images-740"><span class="linenos">740</span></a><span class="sd">            Color space to use. Default is &#39;gray&#39;.</span>
</span><span id="ImagesManagement.adjust_images-741"><a href="#ImagesManagement.adjust_images-741"><span class="linenos">741</span></a>
</span><span id="ImagesManagement.adjust_images-742"><a href="#ImagesManagement.adjust_images-742"><span class="linenos">742</span></a><span class="sd">        max_intensity : int</span>
</span><span id="ImagesManagement.adjust_images-743"><a href="#ImagesManagement.adjust_images-743"><span class="linenos">743</span></a><span class="sd">            Maximum intensity for image adjustment. Default is 65535.</span>
</span><span id="ImagesManagement.adjust_images-744"><a href="#ImagesManagement.adjust_images-744"><span class="linenos">744</span></a>
</span><span id="ImagesManagement.adjust_images-745"><a href="#ImagesManagement.adjust_images-745"><span class="linenos">745</span></a><span class="sd">        min_intenisty : int</span>
</span><span id="ImagesManagement.adjust_images-746"><a href="#ImagesManagement.adjust_images-746"><span class="linenos">746</span></a><span class="sd">            Minimum intensity for image adjustment. Default is 0.</span>
</span><span id="ImagesManagement.adjust_images-747"><a href="#ImagesManagement.adjust_images-747"><span class="linenos">747</span></a>
</span><span id="ImagesManagement.adjust_images-748"><a href="#ImagesManagement.adjust_images-748"><span class="linenos">748</span></a><span class="sd">        brightness : int</span>
</span><span id="ImagesManagement.adjust_images-749"><a href="#ImagesManagement.adjust_images-749"><span class="linenos">749</span></a><span class="sd">            Brightness adjustment value. Default is 1000.</span>
</span><span id="ImagesManagement.adjust_images-750"><a href="#ImagesManagement.adjust_images-750"><span class="linenos">750</span></a>
</span><span id="ImagesManagement.adjust_images-751"><a href="#ImagesManagement.adjust_images-751"><span class="linenos">751</span></a><span class="sd">        contrast : float</span>
</span><span id="ImagesManagement.adjust_images-752"><a href="#ImagesManagement.adjust_images-752"><span class="linenos">752</span></a><span class="sd">            Contrast adjustment factor. Default is 1.0.</span>
</span><span id="ImagesManagement.adjust_images-753"><a href="#ImagesManagement.adjust_images-753"><span class="linenos">753</span></a>
</span><span id="ImagesManagement.adjust_images-754"><a href="#ImagesManagement.adjust_images-754"><span class="linenos">754</span></a><span class="sd">        gamma : float</span>
</span><span id="ImagesManagement.adjust_images-755"><a href="#ImagesManagement.adjust_images-755"><span class="linenos">755</span></a><span class="sd">            Gamma correction factor. Default is 1.0.</span>
</span><span id="ImagesManagement.adjust_images-756"><a href="#ImagesManagement.adjust_images-756"><span class="linenos">756</span></a>
</span><span id="ImagesManagement.adjust_images-757"><a href="#ImagesManagement.adjust_images-757"><span class="linenos">757</span></a><span class="sd">        img_n : int</span>
</span><span id="ImagesManagement.adjust_images-758"><a href="#ImagesManagement.adjust_images-758"><span class="linenos">758</span></a><span class="sd">            Number of images to process. Default is 0, which means all images.</span>
</span><span id="ImagesManagement.adjust_images-759"><a href="#ImagesManagement.adjust_images-759"><span class="linenos">759</span></a>
</span><span id="ImagesManagement.adjust_images-760"><a href="#ImagesManagement.adjust_images-760"><span class="linenos">760</span></a>
</span><span id="ImagesManagement.adjust_images-761"><a href="#ImagesManagement.adjust_images-761"><span class="linenos">761</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.adjust_images-762"><a href="#ImagesManagement.adjust_images-762"><span class="linenos">762</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.adjust_images-763"><a href="#ImagesManagement.adjust_images-763"><span class="linenos">763</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement.adjust_images-764"><a href="#ImagesManagement.adjust_images-764"><span class="linenos">764</span></a><span class="sd">            Dictionary containing the processed images.</span>
</span><span id="ImagesManagement.adjust_images-765"><a href="#ImagesManagement.adjust_images-765"><span class="linenos">765</span></a>
</span><span id="ImagesManagement.adjust_images-766"><a href="#ImagesManagement.adjust_images-766"><span class="linenos">766</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement.adjust_images-767"><a href="#ImagesManagement.adjust_images-767"><span class="linenos">767</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement.adjust_images-768"><a href="#ImagesManagement.adjust_images-768"><span class="linenos">768</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement.adjust_images-769"><a href="#ImagesManagement.adjust_images-769"><span class="linenos">769</span></a>
</span><span id="ImagesManagement.adjust_images-770"><a href="#ImagesManagement.adjust_images-770"><span class="linenos">770</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement.adjust_images-771"><a href="#ImagesManagement.adjust_images-771"><span class="linenos">771</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.adjust_images-772"><a href="#ImagesManagement.adjust_images-772"><span class="linenos">772</span></a>
</span><span id="ImagesManagement.adjust_images-773"><a href="#ImagesManagement.adjust_images-773"><span class="linenos">773</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement.adjust_images-774"><a href="#ImagesManagement.adjust_images-774"><span class="linenos">774</span></a>
</span><span id="ImagesManagement.adjust_images-775"><a href="#ImagesManagement.adjust_images-775"><span class="linenos">775</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="ImagesManagement.adjust_images-776"><a href="#ImagesManagement.adjust_images-776"><span class="linenos">776</span></a>
</span><span id="ImagesManagement.adjust_images-777"><a href="#ImagesManagement.adjust_images-777"><span class="linenos">777</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-778"><a href="#ImagesManagement.adjust_images-778"><span class="linenos">778</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="ImagesManagement.adjust_images-779"><a href="#ImagesManagement.adjust_images-779"><span class="linenos">779</span></a>
</span><span id="ImagesManagement.adjust_images-780"><a href="#ImagesManagement.adjust_images-780"><span class="linenos">780</span></a>        <span class="n">selected_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span>
</span><span id="ImagesManagement.adjust_images-781"><a href="#ImagesManagement.adjust_images-781"><span class="linenos">781</span></a>
</span><span id="ImagesManagement.adjust_images-782"><a href="#ImagesManagement.adjust_images-782"><span class="linenos">782</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-783"><a href="#ImagesManagement.adjust_images-783"><span class="linenos">783</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="ImagesManagement.adjust_images-784"><a href="#ImagesManagement.adjust_images-784"><span class="linenos">784</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement.adjust_images-785"><a href="#ImagesManagement.adjust_images-785"><span class="linenos">785</span></a>                <span class="n">x</span>
</span><span id="ImagesManagement.adjust_images-786"><a href="#ImagesManagement.adjust_images-786"><span class="linenos">786</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="ImagesManagement.adjust_images-787"><a href="#ImagesManagement.adjust_images-787"><span class="linenos">787</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="ImagesManagement.adjust_images-788"><a href="#ImagesManagement.adjust_images-788"><span class="linenos">788</span></a>            <span class="p">]</span>
</span><span id="ImagesManagement.adjust_images-789"><a href="#ImagesManagement.adjust_images-789"><span class="linenos">789</span></a>
</span><span id="ImagesManagement.adjust_images-790"><a href="#ImagesManagement.adjust_images-790"><span class="linenos">790</span></a>        <span class="k">if</span> <span class="n">img_n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-791"><a href="#ImagesManagement.adjust_images-791"><span class="linenos">791</span></a>
</span><span id="ImagesManagement.adjust_images-792"><a href="#ImagesManagement.adjust_images-792"><span class="linenos">792</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">img_n</span><span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-793"><a href="#ImagesManagement.adjust_images-793"><span class="linenos">793</span></a>
</span><span id="ImagesManagement.adjust_images-794"><a href="#ImagesManagement.adjust_images-794"><span class="linenos">794</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="ImagesManagement.adjust_images-795"><a href="#ImagesManagement.adjust_images-795"><span class="linenos">795</span></a>
</span><span id="ImagesManagement.adjust_images-796"><a href="#ImagesManagement.adjust_images-796"><span class="linenos">796</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-797"><a href="#ImagesManagement.adjust_images-797"><span class="linenos">797</span></a>
</span><span id="ImagesManagement.adjust_images-798"><a href="#ImagesManagement.adjust_images-798"><span class="linenos">798</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-799"><a href="#ImagesManagement.adjust_images-799"><span class="linenos">799</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-800"><a href="#ImagesManagement.adjust_images-800"><span class="linenos">800</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-801"><a href="#ImagesManagement.adjust_images-801"><span class="linenos">801</span></a>                <span class="k">pass</span>
</span><span id="ImagesManagement.adjust_images-802"><a href="#ImagesManagement.adjust_images-802"><span class="linenos">802</span></a>
</span><span id="ImagesManagement.adjust_images-803"><a href="#ImagesManagement.adjust_images-803"><span class="linenos">803</span></a>            <span class="k">if</span> <span class="n">eq</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-804"><a href="#ImagesManagement.adjust_images-804"><span class="linenos">804</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">equalizeHist_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-805"><a href="#ImagesManagement.adjust_images-805"><span class="linenos">805</span></a>
</span><span id="ImagesManagement.adjust_images-806"><a href="#ImagesManagement.adjust_images-806"><span class="linenos">806</span></a>            <span class="k">if</span> <span class="n">clahe</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="ImagesManagement.adjust_images-807"><a href="#ImagesManagement.adjust_images-807"><span class="linenos">807</span></a>                <span class="n">image</span> <span class="o">=</span> <span class="n">clahe_16bit</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">kernal</span><span class="o">=</span><span class="n">kernal</span><span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-808"><a href="#ImagesManagement.adjust_images-808"><span class="linenos">808</span></a>
</span><span id="ImagesManagement.adjust_images-809"><a href="#ImagesManagement.adjust_images-809"><span class="linenos">809</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="ImagesManagement.adjust_images-810"><a href="#ImagesManagement.adjust_images-810"><span class="linenos">810</span></a>                <span class="n">img</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-811"><a href="#ImagesManagement.adjust_images-811"><span class="linenos">811</span></a>                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-812"><a href="#ImagesManagement.adjust_images-812"><span class="linenos">812</span></a>                <span class="n">max_intensity</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-813"><a href="#ImagesManagement.adjust_images-813"><span class="linenos">813</span></a>                <span class="n">min_intenisty</span><span class="o">=</span><span class="n">min_intenisty</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-814"><a href="#ImagesManagement.adjust_images-814"><span class="linenos">814</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="n">brightness</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-815"><a href="#ImagesManagement.adjust_images-815"><span class="linenos">815</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="n">contrast</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-816"><a href="#ImagesManagement.adjust_images-816"><span class="linenos">816</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
</span><span id="ImagesManagement.adjust_images-817"><a href="#ImagesManagement.adjust_images-817"><span class="linenos">817</span></a>            <span class="p">)</span>
</span><span id="ImagesManagement.adjust_images-818"><a href="#ImagesManagement.adjust_images-818"><span class="linenos">818</span></a>
</span><span id="ImagesManagement.adjust_images-819"><a href="#ImagesManagement.adjust_images-819"><span class="linenos">819</span></a>            <span class="n">results_dict</span><span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">)]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="ImagesManagement.adjust_images-820"><a href="#ImagesManagement.adjust_images-820"><span class="linenos">820</span></a>
</span><span id="ImagesManagement.adjust_images-821"><a href="#ImagesManagement.adjust_images-821"><span class="linenos">821</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">acronyme</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>Prepares selected images for processing, applying histogram equalization and CLAHE, if required.</p>

<h2 id="parameters">Parameters</h2>

<p>acronyme : str
    Name of images being adjusted in this run.</p>

<p>path_to_images : str
    Path to the directory containing images.</p>

<p>file_extension : str
    Image file extension. Default is 'tiff'.</p>

<p>eq : bool
    Whether to apply histogram equalization. Default is True.</p>

<p>clahe : bool
    Whether to apply CLAHE. Default is True.</p>

<p>kernal : tuple
    Kernel size for CLAHE. Default is (50, 50).</p>

<p>fille_name_part : str
    Part of the file name to filter images. Default is an empty string.</p>

<p>color : str
    Color space to use. Default is 'gray'.</p>

<p>max_intensity : int
    Maximum intensity for image adjustment. Default is 65535.</p>

<p>min_intenisty : int
    Minimum intensity for image adjustment. Default is 0.</p>

<p>brightness : int
    Brightness adjustment value. Default is 1000.</p>

<p>contrast : float
    Contrast adjustment factor. Default is 1.0.</p>

<p>gamma : float
    Gamma correction factor. Default is 1.0.</p>

<p>img_n : int
    Number of images to process. Default is 0, which means all images.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary containing the processed images.</p>

<h2 id="notes">Notes</h2>

<p>To access the processed images, use the <code><a href="#ImagesManagement.get_prepared_images">get_prepared_images()</a></code> method.</p>

<p>To save the processed images to disk, use the <code><a href="#ImagesManagement.save_prepared_images">save_prepared_images()</a></code> method.</p>
</div>


                            </div>
                            <div id="ImagesManagement.image_merging" class="classattr">
                                        <input id="ImagesManagement.image_merging-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">image_merging</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">ratio_list</span><span class="p">:</span> <span class="nb">list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.image_merging-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.image_merging"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.image_merging-823"><a href="#ImagesManagement.image_merging-823"><span class="linenos">823</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_merging</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ratio_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ImagesManagement.image_merging-824"><a href="#ImagesManagement.image_merging-824"><span class="linenos">824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.image_merging-825"><a href="#ImagesManagement.image_merging-825"><span class="linenos">825</span></a><span class="sd">        Merge previously prepared images stored in `self.prepared_images`,</span>
</span><span id="ImagesManagement.image_merging-826"><a href="#ImagesManagement.image_merging-826"><span class="linenos">826</span></a><span class="sd">        adjusted based on the image ratios. The used ratios adjust relative image intensity.</span>
</span><span id="ImagesManagement.image_merging-827"><a href="#ImagesManagement.image_merging-827"><span class="linenos">827</span></a>
</span><span id="ImagesManagement.image_merging-828"><a href="#ImagesManagement.image_merging-828"><span class="linenos">828</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.image_merging-829"><a href="#ImagesManagement.image_merging-829"><span class="linenos">829</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.image_merging-830"><a href="#ImagesManagement.image_merging-830"><span class="linenos">830</span></a><span class="sd">        acronyme : list</span>
</span><span id="ImagesManagement.image_merging-831"><a href="#ImagesManagement.image_merging-831"><span class="linenos">831</span></a><span class="sd">            List of image names to be merged.</span>
</span><span id="ImagesManagement.image_merging-832"><a href="#ImagesManagement.image_merging-832"><span class="linenos">832</span></a>
</span><span id="ImagesManagement.image_merging-833"><a href="#ImagesManagement.image_merging-833"><span class="linenos">833</span></a><span class="sd">        ratio_list : list[float]</span>
</span><span id="ImagesManagement.image_merging-834"><a href="#ImagesManagement.image_merging-834"><span class="linenos">834</span></a><span class="sd">            List of ratio intensity values (0.0–1.0) for the merged image.</span>
</span><span id="ImagesManagement.image_merging-835"><a href="#ImagesManagement.image_merging-835"><span class="linenos">835</span></a><span class="sd">            The `acronyme` list and `ratio_list` must be of the same length.</span>
</span><span id="ImagesManagement.image_merging-836"><a href="#ImagesManagement.image_merging-836"><span class="linenos">836</span></a>
</span><span id="ImagesManagement.image_merging-837"><a href="#ImagesManagement.image_merging-837"><span class="linenos">837</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.image_merging-838"><a href="#ImagesManagement.image_merging-838"><span class="linenos">838</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.image_merging-839"><a href="#ImagesManagement.image_merging-839"><span class="linenos">839</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement.image_merging-840"><a href="#ImagesManagement.image_merging-840"><span class="linenos">840</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="ImagesManagement.image_merging-841"><a href="#ImagesManagement.image_merging-841"><span class="linenos">841</span></a>
</span><span id="ImagesManagement.image_merging-842"><a href="#ImagesManagement.image_merging-842"><span class="linenos">842</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement.image_merging-843"><a href="#ImagesManagement.image_merging-843"><span class="linenos">843</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement.image_merging-844"><a href="#ImagesManagement.image_merging-844"><span class="linenos">844</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement.image_merging-845"><a href="#ImagesManagement.image_merging-845"><span class="linenos">845</span></a>
</span><span id="ImagesManagement.image_merging-846"><a href="#ImagesManagement.image_merging-846"><span class="linenos">846</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement.image_merging-847"><a href="#ImagesManagement.image_merging-847"><span class="linenos">847</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.image_merging-848"><a href="#ImagesManagement.image_merging-848"><span class="linenos">848</span></a>
</span><span id="ImagesManagement.image_merging-849"><a href="#ImagesManagement.image_merging-849"><span class="linenos">849</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement.image_merging-850"><a href="#ImagesManagement.image_merging-850"><span class="linenos">850</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement.image_merging-851"><a href="#ImagesManagement.image_merging-851"><span class="linenos">851</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.image_merging-852"><a href="#ImagesManagement.image_merging-852"><span class="linenos">852</span></a>
</span><span id="ImagesManagement.image_merging-853"><a href="#ImagesManagement.image_merging-853"><span class="linenos">853</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement.image_merging-854"><a href="#ImagesManagement.image_merging-854"><span class="linenos">854</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">:</span>
</span><span id="ImagesManagement.image_merging-855"><a href="#ImagesManagement.image_merging-855"><span class="linenos">855</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement.image_merging-856"><a href="#ImagesManagement.image_merging-856"><span class="linenos">856</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement.image_merging-857"><a href="#ImagesManagement.image_merging-857"><span class="linenos">857</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement.image_merging-858"><a href="#ImagesManagement.image_merging-858"><span class="linenos">858</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement.image_merging-859"><a href="#ImagesManagement.image_merging-859"><span class="linenos">859</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement.image_merging-860"><a href="#ImagesManagement.image_merging-860"><span class="linenos">860</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement.image_merging-861"><a href="#ImagesManagement.image_merging-861"><span class="linenos">861</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement.image_merging-862"><a href="#ImagesManagement.image_merging-862"><span class="linenos">862</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.image_merging-863"><a href="#ImagesManagement.image_merging-863"><span class="linenos">863</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.image_merging-864"><a href="#ImagesManagement.image_merging-864"><span class="linenos">864</span></a>                    <span class="k">break</span>
</span><span id="ImagesManagement.image_merging-865"><a href="#ImagesManagement.image_merging-865"><span class="linenos">865</span></a>
</span><span id="ImagesManagement.image_merging-866"><a href="#ImagesManagement.image_merging-866"><span class="linenos">866</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement.image_merging-867"><a href="#ImagesManagement.image_merging-867"><span class="linenos">867</span></a>
</span><span id="ImagesManagement.image_merging-868"><a href="#ImagesManagement.image_merging-868"><span class="linenos">868</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="ImagesManagement.image_merging-869"><a href="#ImagesManagement.image_merging-869"><span class="linenos">869</span></a>                <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="ImagesManagement.image_merging-870"><a href="#ImagesManagement.image_merging-870"><span class="linenos">870</span></a>                    <span class="n">img_list</span><span class="p">,</span> <span class="n">ratio_list</span>
</span><span id="ImagesManagement.image_merging-871"><a href="#ImagesManagement.image_merging-871"><span class="linenos">871</span></a>                <span class="p">)</span>
</span><span id="ImagesManagement.image_merging-872"><a href="#ImagesManagement.image_merging-872"><span class="linenos">872</span></a>
</span><span id="ImagesManagement.image_merging-873"><a href="#ImagesManagement.image_merging-873"><span class="linenos">873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="ImagesManagement.image_merging-874"><a href="#ImagesManagement.image_merging-874"><span class="linenos">874</span></a>
</span><span id="ImagesManagement.image_merging-875"><a href="#ImagesManagement.image_merging-875"><span class="linenos">875</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;merged_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Merge previously prepared images stored in <code>self.prepared_images</code>,
adjusted based on the image ratios. The used ratios adjust relative image intensity.</p>

<h2 id="parameters">Parameters</h2>

<p>acronyme : list
    List of image names to be merged.</p>

<p>ratio_list : list[float]
    List of ratio intensity values (0.0–1.0) for the merged image.
    The <code>acronyme</code> list and <code>ratio_list</code> must be of the same length.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary of processed images.</p>

<h2 id="notes">Notes</h2>

<p>To access the processed images, use the <code><a href="#ImagesManagement.get_prepared_images">get_prepared_images()</a></code> method.</p>

<p>To save the processed images to disk, use the <code><a href="#ImagesManagement.save_prepared_images">save_prepared_images()</a></code> method.</p>
</div>


                            </div>
                            <div id="ImagesManagement.image_stitching" class="classattr">
                                        <input id="ImagesManagement.image_stitching-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">image_stitching</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span>, </span><span class="param"><span class="n">to_results_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.image_stitching-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.image_stitching"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.image_stitching-877"><a href="#ImagesManagement.image_stitching-877"><span class="linenos">877</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">image_stitching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acronyms</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">to_results_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="ImagesManagement.image_stitching-878"><a href="#ImagesManagement.image_stitching-878"><span class="linenos">878</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.image_stitching-879"><a href="#ImagesManagement.image_stitching-879"><span class="linenos">879</span></a><span class="sd">        Stitch (horizontally) previously prepared images stored in `self.prepared_images`.</span>
</span><span id="ImagesManagement.image_stitching-880"><a href="#ImagesManagement.image_stitching-880"><span class="linenos">880</span></a>
</span><span id="ImagesManagement.image_stitching-881"><a href="#ImagesManagement.image_stitching-881"><span class="linenos">881</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.image_stitching-882"><a href="#ImagesManagement.image_stitching-882"><span class="linenos">882</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.image_stitching-883"><a href="#ImagesManagement.image_stitching-883"><span class="linenos">883</span></a><span class="sd">        acronyme : list</span>
</span><span id="ImagesManagement.image_stitching-884"><a href="#ImagesManagement.image_stitching-884"><span class="linenos">884</span></a><span class="sd">            List of image names to be stitched.</span>
</span><span id="ImagesManagement.image_stitching-885"><a href="#ImagesManagement.image_stitching-885"><span class="linenos">885</span></a>
</span><span id="ImagesManagement.image_stitching-886"><a href="#ImagesManagement.image_stitching-886"><span class="linenos">886</span></a><span class="sd">        to_results_image : bool</span>
</span><span id="ImagesManagement.image_stitching-887"><a href="#ImagesManagement.image_stitching-887"><span class="linenos">887</span></a><span class="sd">            Boolean value indicating whether images obtained from the</span>
</span><span id="ImagesManagement.image_stitching-888"><a href="#ImagesManagement.image_stitching-888"><span class="linenos">888</span></a><span class="sd">            `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="ImagesManagement.image_stitching-889"><a href="#ImagesManagement.image_stitching-889"><span class="linenos">889</span></a><span class="sd">            methods of the `NucleiFinder` class should be stitched to the right</span>
</span><span id="ImagesManagement.image_stitching-890"><a href="#ImagesManagement.image_stitching-890"><span class="linenos">890</span></a><span class="sd">            side of the images in the `acronyme` list.</span>
</span><span id="ImagesManagement.image_stitching-891"><a href="#ImagesManagement.image_stitching-891"><span class="linenos">891</span></a>
</span><span id="ImagesManagement.image_stitching-892"><a href="#ImagesManagement.image_stitching-892"><span class="linenos">892</span></a><span class="sd">        Returns</span>
</span><span id="ImagesManagement.image_stitching-893"><a href="#ImagesManagement.image_stitching-893"><span class="linenos">893</span></a><span class="sd">        -------</span>
</span><span id="ImagesManagement.image_stitching-894"><a href="#ImagesManagement.image_stitching-894"><span class="linenos">894</span></a><span class="sd">        dict</span>
</span><span id="ImagesManagement.image_stitching-895"><a href="#ImagesManagement.image_stitching-895"><span class="linenos">895</span></a><span class="sd">            Dictionary of processed images.</span>
</span><span id="ImagesManagement.image_stitching-896"><a href="#ImagesManagement.image_stitching-896"><span class="linenos">896</span></a>
</span><span id="ImagesManagement.image_stitching-897"><a href="#ImagesManagement.image_stitching-897"><span class="linenos">897</span></a><span class="sd">        Notes</span>
</span><span id="ImagesManagement.image_stitching-898"><a href="#ImagesManagement.image_stitching-898"><span class="linenos">898</span></a><span class="sd">        -----</span>
</span><span id="ImagesManagement.image_stitching-899"><a href="#ImagesManagement.image_stitching-899"><span class="linenos">899</span></a><span class="sd">        To access the processed images, use the ``get_prepared_images()`` method.</span>
</span><span id="ImagesManagement.image_stitching-900"><a href="#ImagesManagement.image_stitching-900"><span class="linenos">900</span></a>
</span><span id="ImagesManagement.image_stitching-901"><a href="#ImagesManagement.image_stitching-901"><span class="linenos">901</span></a><span class="sd">        To save the processed images to disk, use the ``save_prepared_images()`` method.</span>
</span><span id="ImagesManagement.image_stitching-902"><a href="#ImagesManagement.image_stitching-902"><span class="linenos">902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.image_stitching-903"><a href="#ImagesManagement.image_stitching-903"><span class="linenos">903</span></a>
</span><span id="ImagesManagement.image_stitching-904"><a href="#ImagesManagement.image_stitching-904"><span class="linenos">904</span></a>        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-905"><a href="#ImagesManagement.image_stitching-905"><span class="linenos">905</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="ImagesManagement.image_stitching-906"><a href="#ImagesManagement.image_stitching-906"><span class="linenos">906</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> acronyme!&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-907"><a href="#ImagesManagement.image_stitching-907"><span class="linenos">907</span></a>
</span><span id="ImagesManagement.image_stitching-908"><a href="#ImagesManagement.image_stitching-908"><span class="linenos">908</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="ImagesManagement.image_stitching-909"><a href="#ImagesManagement.image_stitching-909"><span class="linenos">909</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images_ids</span><span class="p">):</span>
</span><span id="ImagesManagement.image_stitching-910"><a href="#ImagesManagement.image_stitching-910"><span class="linenos">910</span></a>            <span class="n">img_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="ImagesManagement.image_stitching-911"><a href="#ImagesManagement.image_stitching-911"><span class="linenos">911</span></a>            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acronyms</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-912"><a href="#ImagesManagement.image_stitching-912"><span class="linenos">912</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement.image_stitching-913"><a href="#ImagesManagement.image_stitching-913"><span class="linenos">913</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement.image_stitching-914"><a href="#ImagesManagement.image_stitching-914"><span class="linenos">914</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement.image_stitching-915"><a href="#ImagesManagement.image_stitching-915"><span class="linenos">915</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-916"><a href="#ImagesManagement.image_stitching-916"><span class="linenos">916</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement.image_stitching-917"><a href="#ImagesManagement.image_stitching-917"><span class="linenos">917</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-918"><a href="#ImagesManagement.image_stitching-918"><span class="linenos">918</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There were not images for </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> ids&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-919"><a href="#ImagesManagement.image_stitching-919"><span class="linenos">919</span></a>                    <span class="k">break</span>
</span><span id="ImagesManagement.image_stitching-920"><a href="#ImagesManagement.image_stitching-920"><span class="linenos">920</span></a>
</span><span id="ImagesManagement.image_stitching-921"><a href="#ImagesManagement.image_stitching-921"><span class="linenos">921</span></a>                <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement.image_stitching-922"><a href="#ImagesManagement.image_stitching-922"><span class="linenos">922</span></a>
</span><span id="ImagesManagement.image_stitching-923"><a href="#ImagesManagement.image_stitching-923"><span class="linenos">923</span></a>            <span class="k">if</span> <span class="n">to_results_image</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-924"><a href="#ImagesManagement.image_stitching-924"><span class="linenos">924</span></a>                <span class="n">nam</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ImagesManagement.image_stitching-925"><a href="#ImagesManagement.image_stitching-925"><span class="linenos">925</span></a>                    <span class="n">x</span>
</span><span id="ImagesManagement.image_stitching-926"><a href="#ImagesManagement.image_stitching-926"><span class="linenos">926</span></a>                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ImagesManagement.image_stitching-927"><a href="#ImagesManagement.image_stitching-927"><span class="linenos">927</span></a>                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-928"><a href="#ImagesManagement.image_stitching-928"><span class="linenos">928</span></a>                <span class="p">]</span>
</span><span id="ImagesManagement.image_stitching-929"><a href="#ImagesManagement.image_stitching-929"><span class="linenos">929</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nam</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-930"><a href="#ImagesManagement.image_stitching-930"><span class="linenos">930</span></a>                    <span class="n">img_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">[</span><span class="n">nam</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
</span><span id="ImagesManagement.image_stitching-931"><a href="#ImagesManagement.image_stitching-931"><span class="linenos">931</span></a>
</span><span id="ImagesManagement.image_stitching-932"><a href="#ImagesManagement.image_stitching-932"><span class="linenos">932</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-933"><a href="#ImagesManagement.image_stitching-933"><span class="linenos">933</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">_res&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-934"><a href="#ImagesManagement.image_stitching-934"><span class="linenos">934</span></a>
</span><span id="ImagesManagement.image_stitching-935"><a href="#ImagesManagement.image_stitching-935"><span class="linenos">935</span></a>            <span class="k">elif</span> <span class="n">to_results_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="ImagesManagement.image_stitching-936"><a href="#ImagesManagement.image_stitching-936"><span class="linenos">936</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">acronyms</span><span class="p">):</span>
</span><span id="ImagesManagement.image_stitching-937"><a href="#ImagesManagement.image_stitching-937"><span class="linenos">937</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">(</span><span class="n">img_list</span><span class="p">)</span>
</span><span id="ImagesManagement.image_stitching-938"><a href="#ImagesManagement.image_stitching-938"><span class="linenos">938</span></a>
</span><span id="ImagesManagement.image_stitching-939"><a href="#ImagesManagement.image_stitching-939"><span class="linenos">939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prepared_images</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_img</span>
</span><span id="ImagesManagement.image_stitching-940"><a href="#ImagesManagement.image_stitching-940"><span class="linenos">940</span></a>
</span><span id="ImagesManagement.image_stitching-941"><a href="#ImagesManagement.image_stitching-941"><span class="linenos">941</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Images stored in self.prepared_images[&quot;stitched_</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">acronyms</span><span class="p">)</span><span class="si">}</span><span class="s1">&quot;]&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Stitch (horizontally) previously prepared images stored in <code>self.prepared_images</code>.</p>

<h2 id="parameters">Parameters</h2>

<p>acronyme : list
    List of image names to be stitched.</p>

<p>to_results_image : bool
    Boolean value indicating whether images obtained from the
    <code>series_analysis_nuclei()</code> or <code>series_analysis_chromatinization()</code>
    methods of the <code><a href="#NucleiFinder">NucleiFinder</a></code> class should be stitched to the right
    side of the images in the <code>acronyme</code> list.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary of processed images.</p>

<h2 id="notes">Notes</h2>

<p>To access the processed images, use the <code><a href="#ImagesManagement.get_prepared_images">get_prepared_images()</a></code> method.</p>

<p>To save the processed images to disk, use the <code><a href="#ImagesManagement.save_prepared_images">save_prepared_images()</a></code> method.</p>
</div>


                            </div>
                            <div id="ImagesManagement.save_raw" class="classattr">
                                        <input id="ImagesManagement.save_raw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_raw</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ImagesManagement.save_raw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImagesManagement.save_raw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImagesManagement.save_raw-943"><a href="#ImagesManagement.save_raw-943"><span class="linenos">943</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_save</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="ImagesManagement.save_raw-944"><a href="#ImagesManagement.save_raw-944"><span class="linenos">944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ImagesManagement.save_raw-945"><a href="#ImagesManagement.save_raw-945"><span class="linenos">945</span></a><span class="sd">        Save `self.results_images` loaded by the `self.load_experimental_images()` method,</span>
</span><span id="ImagesManagement.save_raw-946"><a href="#ImagesManagement.save_raw-946"><span class="linenos">946</span></a><span class="sd">        obtained from the `series_analysis_nuclei()` or `series_analysis_chromatinization()`</span>
</span><span id="ImagesManagement.save_raw-947"><a href="#ImagesManagement.save_raw-947"><span class="linenos">947</span></a><span class="sd">        methods of the `NucleiFinder` class for later usage with cls.load_from_dict() method.</span>
</span><span id="ImagesManagement.save_raw-948"><a href="#ImagesManagement.save_raw-948"><span class="linenos">948</span></a><span class="sd">        The data will be saved with a `.inuc` extension.</span>
</span><span id="ImagesManagement.save_raw-949"><a href="#ImagesManagement.save_raw-949"><span class="linenos">949</span></a>
</span><span id="ImagesManagement.save_raw-950"><a href="#ImagesManagement.save_raw-950"><span class="linenos">950</span></a><span class="sd">        Parameters</span>
</span><span id="ImagesManagement.save_raw-951"><a href="#ImagesManagement.save_raw-951"><span class="linenos">951</span></a><span class="sd">        ----------</span>
</span><span id="ImagesManagement.save_raw-952"><a href="#ImagesManagement.save_raw-952"><span class="linenos">952</span></a><span class="sd">        path_to_save : str</span>
</span><span id="ImagesManagement.save_raw-953"><a href="#ImagesManagement.save_raw-953"><span class="linenos">953</span></a><span class="sd">            The directory path where the images will be saved.</span>
</span><span id="ImagesManagement.save_raw-954"><a href="#ImagesManagement.save_raw-954"><span class="linenos">954</span></a><span class="sd">            Default is the current working directory.</span>
</span><span id="ImagesManagement.save_raw-955"><a href="#ImagesManagement.save_raw-955"><span class="linenos">955</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ImagesManagement.save_raw-956"><a href="#ImagesManagement.save_raw-956"><span class="linenos">956</span></a>
</span><span id="ImagesManagement.save_raw-957"><a href="#ImagesManagement.save_raw-957"><span class="linenos">957</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_save</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.inuc&quot;</span><span class="p">)</span>
</span><span id="ImagesManagement.save_raw-958"><a href="#ImagesManagement.save_raw-958"><span class="linenos">958</span></a>
</span><span id="ImagesManagement.save_raw-959"><a href="#ImagesManagement.save_raw-959"><span class="linenos">959</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">results_images</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save <code>self.results_images</code> loaded by the <code>self.load_experimental_images()</code> method,
obtained from the <code>series_analysis_nuclei()</code> or <code>series_analysis_chromatinization()</code>
methods of the <code><a href="#NucleiFinder">NucleiFinder</a></code> class for later usage with cls.load_from_dict() method.
The data will be saved with a <code>.inuc</code> extension.</p>

<h2 id="parameters">Parameters</h2>

<p>path_to_save : str
    The directory path where the images will be saved.
    Default is the current working directory.</p>
</div>


                            </div>
                </section>
                <section id="NucleiFinder">
                            <input id="NucleiFinder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NucleiFinder</span><wbr>(<span class="base"><a href="utils.html#ImageTools">jimg_ncd.utils.ImageTools</a></span>, <span class="base"><a href="#RepTools">RepTools</a></span>):

                <label class="view-source-button" for="NucleiFinder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder-962"><a href="#NucleiFinder-962"><span class="linenos"> 962</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NucleiFinder</span><span class="p">(</span><span class="n">ImageTools</span><span class="p">,</span> <span class="n">RepTools</span><span class="p">):</span>
</span><span id="NucleiFinder-963"><a href="#NucleiFinder-963"><span class="linenos"> 963</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-964"><a href="#NucleiFinder-964"><span class="linenos"> 964</span></a><span class="sd">    Implements a comprehensive pipeline for automated segmentation,</span>
</span><span id="NucleiFinder-965"><a href="#NucleiFinder-965"><span class="linenos"> 965</span></a><span class="sd">    selection, and analysis of cell nuclei and their internal chromatin structure</span>
</span><span id="NucleiFinder-966"><a href="#NucleiFinder-966"><span class="linenos"> 966</span></a><span class="sd">    in microscopy images.</span>
</span><span id="NucleiFinder-967"><a href="#NucleiFinder-967"><span class="linenos"> 967</span></a>
</span><span id="NucleiFinder-968"><a href="#NucleiFinder-968"><span class="linenos"> 968</span></a><span class="sd">    It utilizes a pre-trained deep learning model (StarDist2D) for initial</span>
</span><span id="NucleiFinder-969"><a href="#NucleiFinder-969"><span class="linenos"> 969</span></a><span class="sd">    nuclear identification, followed by the application of advanced morphological</span>
</span><span id="NucleiFinder-970"><a href="#NucleiFinder-970"><span class="linenos"> 970</span></a><span class="sd">    and intensity filters, and a dedicated algorithm for quantifying chromatinization.</span>
</span><span id="NucleiFinder-971"><a href="#NucleiFinder-971"><span class="linenos"> 971</span></a><span class="sd">    The class provides detailed control over the hyperparameters for both the</span>
</span><span id="NucleiFinder-972"><a href="#NucleiFinder-972"><span class="linenos"> 972</span></a><span class="sd">    segmentation process and image preprocessing stages.</span>
</span><span id="NucleiFinder-973"><a href="#NucleiFinder-973"><span class="linenos"> 973</span></a>
</span><span id="NucleiFinder-974"><a href="#NucleiFinder-974"><span class="linenos"> 974</span></a><span class="sd">    Parameters</span>
</span><span id="NucleiFinder-975"><a href="#NucleiFinder-975"><span class="linenos"> 975</span></a><span class="sd">    ----------</span>
</span><span id="NucleiFinder-976"><a href="#NucleiFinder-976"><span class="linenos"> 976</span></a><span class="sd">    image : np.ndarray, optional</span>
</span><span id="NucleiFinder-977"><a href="#NucleiFinder-977"><span class="linenos"> 977</span></a><span class="sd">        The input image (typically 16-bit) for analysis.</span>
</span><span id="NucleiFinder-978"><a href="#NucleiFinder-978"><span class="linenos"> 978</span></a>
</span><span id="NucleiFinder-979"><a href="#NucleiFinder-979"><span class="linenos"> 979</span></a><span class="sd">    test_results : list, optional</span>
</span><span id="NucleiFinder-980"><a href="#NucleiFinder-980"><span class="linenos"> 980</span></a><span class="sd">        Plots resulting from parameter testing (e.g., NMS/Prob combinations).</span>
</span><span id="NucleiFinder-981"><a href="#NucleiFinder-981"><span class="linenos"> 981</span></a>
</span><span id="NucleiFinder-982"><a href="#NucleiFinder-982"><span class="linenos"> 982</span></a><span class="sd">    hyperparameter_nuclei : dict, optional</span>
</span><span id="NucleiFinder-983"><a href="#NucleiFinder-983"><span class="linenos"> 983</span></a><span class="sd">        Parameters for nuclei segmentation and filtering (e.g., &#39;nms&#39;, &#39;prob&#39;, &#39;min_size&#39;, &#39;circularity&#39;).</span>
</span><span id="NucleiFinder-984"><a href="#NucleiFinder-984"><span class="linenos"> 984</span></a>
</span><span id="NucleiFinder-985"><a href="#NucleiFinder-985"><span class="linenos"> 985</span></a><span class="sd">    hyperparameter_chromatinization : dict, optional</span>
</span><span id="NucleiFinder-986"><a href="#NucleiFinder-986"><span class="linenos"> 986</span></a><span class="sd">        Parameters for segmenting and filtering chromatin spots (e.g., &#39;cut_point&#39;, &#39;ratio&#39;).</span>
</span><span id="NucleiFinder-987"><a href="#NucleiFinder-987"><span class="linenos"> 987</span></a>
</span><span id="NucleiFinder-988"><a href="#NucleiFinder-988"><span class="linenos"> 988</span></a><span class="sd">    img_adj_par_chrom : dict, optional</span>
</span><span id="NucleiFinder-989"><a href="#NucleiFinder-989"><span class="linenos"> 989</span></a><span class="sd">        Image adjustment parameters (gamma, contrast) specifically for chromatin analysis.</span>
</span><span id="NucleiFinder-990"><a href="#NucleiFinder-990"><span class="linenos"> 990</span></a>
</span><span id="NucleiFinder-991"><a href="#NucleiFinder-991"><span class="linenos"> 991</span></a><span class="sd">    img_adj_par : dict, optional</span>
</span><span id="NucleiFinder-992"><a href="#NucleiFinder-992"><span class="linenos"> 992</span></a><span class="sd">        Image adjustment parameters for nuclei segmentation.</span>
</span><span id="NucleiFinder-993"><a href="#NucleiFinder-993"><span class="linenos"> 993</span></a>
</span><span id="NucleiFinder-994"><a href="#NucleiFinder-994"><span class="linenos"> 994</span></a><span class="sd">    show_plots : bool, optional</span>
</span><span id="NucleiFinder-995"><a href="#NucleiFinder-995"><span class="linenos"> 995</span></a><span class="sd">        Flag controlling the automatic display of visual results.</span>
</span><span id="NucleiFinder-996"><a href="#NucleiFinder-996"><span class="linenos"> 996</span></a>
</span><span id="NucleiFinder-997"><a href="#NucleiFinder-997"><span class="linenos"> 997</span></a><span class="sd">    nuclei_results : dict, optional</span>
</span><span id="NucleiFinder-998"><a href="#NucleiFinder-998"><span class="linenos"> 998</span></a><span class="sd">        A dictionary storing numerical data (features) extracted from the nuclei.</span>
</span><span id="NucleiFinder-999"><a href="#NucleiFinder-999"><span class="linenos"> 999</span></a>
</span><span id="NucleiFinder-1000"><a href="#NucleiFinder-1000"><span class="linenos">1000</span></a><span class="sd">    images : dict, optional</span>
</span><span id="NucleiFinder-1001"><a href="#NucleiFinder-1001"><span class="linenos">1001</span></a><span class="sd">        A dictionary storing output images and masks.</span>
</span><span id="NucleiFinder-1002"><a href="#NucleiFinder-1002"><span class="linenos">1002</span></a>
</span><span id="NucleiFinder-1003"><a href="#NucleiFinder-1003"><span class="linenos">1003</span></a><span class="sd">    Attributes</span>
</span><span id="NucleiFinder-1004"><a href="#NucleiFinder-1004"><span class="linenos">1004</span></a><span class="sd">    ----------</span>
</span><span id="NucleiFinder-1005"><a href="#NucleiFinder-1005"><span class="linenos">1005</span></a><span class="sd">    image : np.ndarray</span>
</span><span id="NucleiFinder-1006"><a href="#NucleiFinder-1006"><span class="linenos">1006</span></a><span class="sd">        The currently loaded image for analysis.</span>
</span><span id="NucleiFinder-1007"><a href="#NucleiFinder-1007"><span class="linenos">1007</span></a>
</span><span id="NucleiFinder-1008"><a href="#NucleiFinder-1008"><span class="linenos">1008</span></a><span class="sd">    test_results : list</span>
</span><span id="NucleiFinder-1009"><a href="#NucleiFinder-1009"><span class="linenos">1009</span></a><span class="sd">        The visual outcomes of NMS/Prob parameter tests.</span>
</span><span id="NucleiFinder-1010"><a href="#NucleiFinder-1010"><span class="linenos">1010</span></a>
</span><span id="NucleiFinder-1011"><a href="#NucleiFinder-1011"><span class="linenos">1011</span></a><span class="sd">    hyperparameter_nuclei : dict</span>
</span><span id="NucleiFinder-1012"><a href="#NucleiFinder-1012"><span class="linenos">1012</span></a><span class="sd">        A dictionary of active parameters used by the `find_nuclei()` and `select_nuclei()` methods.</span>
</span><span id="NucleiFinder-1013"><a href="#NucleiFinder-1013"><span class="linenos">1013</span></a>
</span><span id="NucleiFinder-1014"><a href="#NucleiFinder-1014"><span class="linenos">1014</span></a><span class="sd">    hyperparameter_chromatinization : dict</span>
</span><span id="NucleiFinder-1015"><a href="#NucleiFinder-1015"><span class="linenos">1015</span></a><span class="sd">        A dictionary of active parameters used by the `nuclei_chromatinization()` method.</span>
</span><span id="NucleiFinder-1016"><a href="#NucleiFinder-1016"><span class="linenos">1016</span></a>
</span><span id="NucleiFinder-1017"><a href="#NucleiFinder-1017"><span class="linenos">1017</span></a><span class="sd">    img_adj_par : dict</span>
</span><span id="NucleiFinder-1018"><a href="#NucleiFinder-1018"><span class="linenos">1018</span></a><span class="sd">        Image correction parameters for nuclei segmentation.</span>
</span><span id="NucleiFinder-1019"><a href="#NucleiFinder-1019"><span class="linenos">1019</span></a>
</span><span id="NucleiFinder-1020"><a href="#NucleiFinder-1020"><span class="linenos">1020</span></a><span class="sd">    img_adj_par_chrom : dict</span>
</span><span id="NucleiFinder-1021"><a href="#NucleiFinder-1021"><span class="linenos">1021</span></a><span class="sd">        Image correction parameters for chromatin analysis.</span>
</span><span id="NucleiFinder-1022"><a href="#NucleiFinder-1022"><span class="linenos">1022</span></a>
</span><span id="NucleiFinder-1023"><a href="#NucleiFinder-1023"><span class="linenos">1023</span></a><span class="sd">    show_plots : bool</span>
</span><span id="NucleiFinder-1024"><a href="#NucleiFinder-1024"><span class="linenos">1024</span></a><span class="sd">        The state of the plot display flag.</span>
</span><span id="NucleiFinder-1025"><a href="#NucleiFinder-1025"><span class="linenos">1025</span></a>
</span><span id="NucleiFinder-1026"><a href="#NucleiFinder-1026"><span class="linenos">1026</span></a><span class="sd">    nuclei_results : dict</span>
</span><span id="NucleiFinder-1027"><a href="#NucleiFinder-1027"><span class="linenos">1027</span></a><span class="sd">        Stores feature dictionaries for: all detected (&#39;nuclei&#39;), selected (&#39;nuclei_reduced&#39;),</span>
</span><span id="NucleiFinder-1028"><a href="#NucleiFinder-1028"><span class="linenos">1028</span></a><span class="sd">        and chromatinization data (&#39;nuclei_chromatinization&#39;).</span>
</span><span id="NucleiFinder-1029"><a href="#NucleiFinder-1029"><span class="linenos">1029</span></a>
</span><span id="NucleiFinder-1030"><a href="#NucleiFinder-1030"><span class="linenos">1030</span></a><span class="sd">    images : dict</span>
</span><span id="NucleiFinder-1031"><a href="#NucleiFinder-1031"><span class="linenos">1031</span></a><span class="sd">        Stores masks and images visualizing the results.</span>
</span><span id="NucleiFinder-1032"><a href="#NucleiFinder-1032"><span class="linenos">1032</span></a>
</span><span id="NucleiFinder-1033"><a href="#NucleiFinder-1033"><span class="linenos">1033</span></a><span class="sd">    series_im : bool</span>
</span><span id="NucleiFinder-1034"><a href="#NucleiFinder-1034"><span class="linenos">1034</span></a><span class="sd">        Flag indicating if the class is operating in a batch or series processing mode.</span>
</span><span id="NucleiFinder-1035"><a href="#NucleiFinder-1035"><span class="linenos">1035</span></a>
</span><span id="NucleiFinder-1036"><a href="#NucleiFinder-1036"><span class="linenos">1036</span></a><span class="sd">    Methods</span>
</span><span id="NucleiFinder-1037"><a href="#NucleiFinder-1037"><span class="linenos">1037</span></a><span class="sd">    -------</span>
</span><span id="NucleiFinder-1038"><a href="#NucleiFinder-1038"><span class="linenos">1038</span></a><span class="sd">    set_nms(nms)</span>
</span><span id="NucleiFinder-1039"><a href="#NucleiFinder-1039"><span class="linenos">1039</span></a><span class="sd">        Sets the Non-Maximum Suppression (NMS) threshold.</span>
</span><span id="NucleiFinder-1040"><a href="#NucleiFinder-1040"><span class="linenos">1040</span></a>
</span><span id="NucleiFinder-1041"><a href="#NucleiFinder-1041"><span class="linenos">1041</span></a><span class="sd">    set_prob(prob)</span>
</span><span id="NucleiFinder-1042"><a href="#NucleiFinder-1042"><span class="linenos">1042</span></a><span class="sd">        Sets the segmentation probability threshold.</span>
</span><span id="NucleiFinder-1043"><a href="#NucleiFinder-1043"><span class="linenos">1043</span></a>
</span><span id="NucleiFinder-1044"><a href="#NucleiFinder-1044"><span class="linenos">1044</span></a><span class="sd">    set_nuclei_circularity(circ)</span>
</span><span id="NucleiFinder-1045"><a href="#NucleiFinder-1045"><span class="linenos">1045</span></a><span class="sd">        Sets the minimum required circularity for a nucleus.</span>
</span><span id="NucleiFinder-1046"><a href="#NucleiFinder-1046"><span class="linenos">1046</span></a>
</span><span id="NucleiFinder-1047"><a href="#NucleiFinder-1047"><span class="linenos">1047</span></a><span class="sd">    set_nuclei_local_intenisty_FC(local_FC)</span>
</span><span id="NucleiFinder-1048"><a href="#NucleiFinder-1048"><span class="linenos">1048</span></a><span class="sd">        Sets the factor used for removing false positives based on local intensity differences.</span>
</span><span id="NucleiFinder-1049"><a href="#NucleiFinder-1049"><span class="linenos">1049</span></a>
</span><span id="NucleiFinder-1050"><a href="#NucleiFinder-1050"><span class="linenos">1050</span></a><span class="sd">    set_nuclei_global_area_FC(global_FC)</span>
</span><span id="NucleiFinder-1051"><a href="#NucleiFinder-1051"><span class="linenos">1051</span></a><span class="sd">        Sets the factor used for removing size-based outlier false positives.</span>
</span><span id="NucleiFinder-1052"><a href="#NucleiFinder-1052"><span class="linenos">1052</span></a>
</span><span id="NucleiFinder-1053"><a href="#NucleiFinder-1053"><span class="linenos">1053</span></a><span class="sd">    set_nuclei_size(size)</span>
</span><span id="NucleiFinder-1054"><a href="#NucleiFinder-1054"><span class="linenos">1054</span></a><span class="sd">        Sets the minimum and maximum area (in pixels) for nuclei selection.</span>
</span><span id="NucleiFinder-1055"><a href="#NucleiFinder-1055"><span class="linenos">1055</span></a>
</span><span id="NucleiFinder-1056"><a href="#NucleiFinder-1056"><span class="linenos">1056</span></a><span class="sd">    set_nuclei_min_mean_intensity(intensity)</span>
</span><span id="NucleiFinder-1057"><a href="#NucleiFinder-1057"><span class="linenos">1057</span></a><span class="sd">        Sets the minimum required mean intensity value for a nucleus.</span>
</span><span id="NucleiFinder-1058"><a href="#NucleiFinder-1058"><span class="linenos">1058</span></a>
</span><span id="NucleiFinder-1059"><a href="#NucleiFinder-1059"><span class="linenos">1059</span></a><span class="sd">    set_chromatinization_size(size)</span>
</span><span id="NucleiFinder-1060"><a href="#NucleiFinder-1060"><span class="linenos">1060</span></a><span class="sd">        Sets the minimum and maximum area (in pixels) for chromatin spot selection.</span>
</span><span id="NucleiFinder-1061"><a href="#NucleiFinder-1061"><span class="linenos">1061</span></a>
</span><span id="NucleiFinder-1062"><a href="#NucleiFinder-1062"><span class="linenos">1062</span></a><span class="sd">    set_chromatinization_cut_point(cut_point)</span>
</span><span id="NucleiFinder-1063"><a href="#NucleiFinder-1063"><span class="linenos">1063</span></a><span class="sd">        Sets the factor used to adjust the chromatin segmentation threshold (Otsu&#39;s method).</span>
</span><span id="NucleiFinder-1064"><a href="#NucleiFinder-1064"><span class="linenos">1064</span></a>
</span><span id="NucleiFinder-1065"><a href="#NucleiFinder-1065"><span class="linenos">1065</span></a><span class="sd">    set_adj_image_gamma(gamma)</span>
</span><span id="NucleiFinder-1066"><a href="#NucleiFinder-1066"><span class="linenos">1066</span></a><span class="sd">        Sets the gamma correction for the nuclei image.</span>
</span><span id="NucleiFinder-1067"><a href="#NucleiFinder-1067"><span class="linenos">1067</span></a>
</span><span id="NucleiFinder-1068"><a href="#NucleiFinder-1068"><span class="linenos">1068</span></a><span class="sd">    set_adj_chrom_contrast(contrast)</span>
</span><span id="NucleiFinder-1069"><a href="#NucleiFinder-1069"><span class="linenos">1069</span></a><span class="sd">        Sets the contrast adjustment for the chromatinization image.</span>
</span><span id="NucleiFinder-1070"><a href="#NucleiFinder-1070"><span class="linenos">1070</span></a>
</span><span id="NucleiFinder-1071"><a href="#NucleiFinder-1071"><span class="linenos">1071</span></a><span class="sd">    current_parameters_nuclei (property)</span>
</span><span id="NucleiFinder-1072"><a href="#NucleiFinder-1072"><span class="linenos">1072</span></a><span class="sd">        Returns the active nuclei segmentation and filtering parameters.</span>
</span><span id="NucleiFinder-1073"><a href="#NucleiFinder-1073"><span class="linenos">1073</span></a>
</span><span id="NucleiFinder-1074"><a href="#NucleiFinder-1074"><span class="linenos">1074</span></a><span class="sd">    find_nuclei()</span>
</span><span id="NucleiFinder-1075"><a href="#NucleiFinder-1075"><span class="linenos">1075</span></a><span class="sd">        Performs nuclei segmentation using StarDist and extracts initial features.</span>
</span><span id="NucleiFinder-1076"><a href="#NucleiFinder-1076"><span class="linenos">1076</span></a>
</span><span id="NucleiFinder-1077"><a href="#NucleiFinder-1077"><span class="linenos">1077</span></a><span class="sd">    select_nuclei()</span>
</span><span id="NucleiFinder-1078"><a href="#NucleiFinder-1078"><span class="linenos">1078</span></a><span class="sd">        Filters the detected nuclei based on set morphological and intensity criteria.</span>
</span><span id="NucleiFinder-1079"><a href="#NucleiFinder-1079"><span class="linenos">1079</span></a>
</span><span id="NucleiFinder-1080"><a href="#NucleiFinder-1080"><span class="linenos">1080</span></a><span class="sd">    nuclei_chromatinization()</span>
</span><span id="NucleiFinder-1081"><a href="#NucleiFinder-1081"><span class="linenos">1081</span></a><span class="sd">        Performs quantitative and morphological analysis of chromatin spots in selected nuclei.</span>
</span><span id="NucleiFinder-1082"><a href="#NucleiFinder-1082"><span class="linenos">1082</span></a>
</span><span id="NucleiFinder-1083"><a href="#NucleiFinder-1083"><span class="linenos">1083</span></a><span class="sd">    get_features(model_out, image)</span>
</span><span id="NucleiFinder-1084"><a href="#NucleiFinder-1084"><span class="linenos">1084</span></a><span class="sd">        Calculates geometric and intensity features from a segmented mask (label image).</span>
</span><span id="NucleiFinder-1085"><a href="#NucleiFinder-1085"><span class="linenos">1085</span></a>
</span><span id="NucleiFinder-1086"><a href="#NucleiFinder-1086"><span class="linenos">1086</span></a><span class="sd">    Notes</span>
</span><span id="NucleiFinder-1087"><a href="#NucleiFinder-1087"><span class="linenos">1087</span></a><span class="sd">    -----</span>
</span><span id="NucleiFinder-1088"><a href="#NucleiFinder-1088"><span class="linenos">1088</span></a><span class="sd">    The typical analysis workflow follows this order:</span>
</span><span id="NucleiFinder-1089"><a href="#NucleiFinder-1089"><span class="linenos">1089</span></a><span class="sd">    1. `input_image()`</span>
</span><span id="NucleiFinder-1090"><a href="#NucleiFinder-1090"><span class="linenos">1090</span></a><span class="sd">    2. `find_nuclei()`</span>
</span><span id="NucleiFinder-1091"><a href="#NucleiFinder-1091"><span class="linenos">1091</span></a><span class="sd">    3. `select_nuclei()` (Optional)</span>
</span><span id="NucleiFinder-1092"><a href="#NucleiFinder-1092"><span class="linenos">1092</span></a><span class="sd">    4. `nuclei_chromatinization()` (Optional)</span>
</span><span id="NucleiFinder-1093"><a href="#NucleiFinder-1093"><span class="linenos">1093</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1094"><a href="#NucleiFinder-1094"><span class="linenos">1094</span></a>
</span><span id="NucleiFinder-1095"><a href="#NucleiFinder-1095"><span class="linenos">1095</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NucleiFinder-1096"><a href="#NucleiFinder-1096"><span class="linenos">1096</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder-1097"><a href="#NucleiFinder-1097"><span class="linenos">1097</span></a>        <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1098"><a href="#NucleiFinder-1098"><span class="linenos">1098</span></a>        <span class="n">test_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1099"><a href="#NucleiFinder-1099"><span class="linenos">1099</span></a>        <span class="n">hyperparameter_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1100"><a href="#NucleiFinder-1100"><span class="linenos">1100</span></a>        <span class="n">hyperparameter_chromatinization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1101"><a href="#NucleiFinder-1101"><span class="linenos">1101</span></a>        <span class="n">img_adj_par_chrom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1102"><a href="#NucleiFinder-1102"><span class="linenos">1102</span></a>        <span class="n">img_adj_par</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1103"><a href="#NucleiFinder-1103"><span class="linenos">1103</span></a>        <span class="n">show_plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1104"><a href="#NucleiFinder-1104"><span class="linenos">1104</span></a>        <span class="n">nuclei_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1105"><a href="#NucleiFinder-1105"><span class="linenos">1105</span></a>        <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1106"><a href="#NucleiFinder-1106"><span class="linenos">1106</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder-1107"><a href="#NucleiFinder-1107"><span class="linenos">1107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1108"><a href="#NucleiFinder-1108"><span class="linenos">1108</span></a><span class="sd">        The main class for the detection and analysis of cell nuclei and their chromatinization</span>
</span><span id="NucleiFinder-1109"><a href="#NucleiFinder-1109"><span class="linenos">1109</span></a><span class="sd">        in microscopy or flow cytometry images, utilizing the StarDist segmentation model.</span>
</span><span id="NucleiFinder-1110"><a href="#NucleiFinder-1110"><span class="linenos">1110</span></a>
</span><span id="NucleiFinder-1111"><a href="#NucleiFinder-1111"><span class="linenos">1111</span></a><span class="sd">        This class inherits functionality for image processing (ImageTools) and</span>
</span><span id="NucleiFinder-1112"><a href="#NucleiFinder-1112"><span class="linenos">1112</span></a><span class="sd">        results handling (RepTools).</span>
</span><span id="NucleiFinder-1113"><a href="#NucleiFinder-1113"><span class="linenos">1113</span></a>
</span><span id="NucleiFinder-1114"><a href="#NucleiFinder-1114"><span class="linenos">1114</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1115"><a href="#NucleiFinder-1115"><span class="linenos">1115</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1116"><a href="#NucleiFinder-1116"><span class="linenos">1116</span></a><span class="sd">        image : np.ndarray, optional</span>
</span><span id="NucleiFinder-1117"><a href="#NucleiFinder-1117"><span class="linenos">1117</span></a><span class="sd">            The input image for analysis.</span>
</span><span id="NucleiFinder-1118"><a href="#NucleiFinder-1118"><span class="linenos">1118</span></a><span class="sd">            Default: None.</span>
</span><span id="NucleiFinder-1119"><a href="#NucleiFinder-1119"><span class="linenos">1119</span></a>
</span><span id="NucleiFinder-1120"><a href="#NucleiFinder-1120"><span class="linenos">1120</span></a><span class="sd">        test_results : list, optional</span>
</span><span id="NucleiFinder-1121"><a href="#NucleiFinder-1121"><span class="linenos">1121</span></a><span class="sd">            A list of plots or images resulting from parameter testing.</span>
</span><span id="NucleiFinder-1122"><a href="#NucleiFinder-1122"><span class="linenos">1122</span></a><span class="sd">            Default: None.</span>
</span><span id="NucleiFinder-1123"><a href="#NucleiFinder-1123"><span class="linenos">1123</span></a>
</span><span id="NucleiFinder-1124"><a href="#NucleiFinder-1124"><span class="linenos">1124</span></a><span class="sd">        hyperparameter_nuclei : dict, optional</span>
</span><span id="NucleiFinder-1125"><a href="#NucleiFinder-1125"><span class="linenos">1125</span></a><span class="sd">            The segmentation parameters for nuclei detection.</span>
</span><span id="NucleiFinder-1126"><a href="#NucleiFinder-1126"><span class="linenos">1126</span></a><span class="sd">            Default:</span>
</span><span id="NucleiFinder-1127"><a href="#NucleiFinder-1127"><span class="linenos">1127</span></a><span class="sd">            {&#39;nms&#39;: 0.8, &#39;prob&#39;: 0.4, &#39;max_size&#39;: 1000, &#39;min_size&#39;: 20,</span>
</span><span id="NucleiFinder-1128"><a href="#NucleiFinder-1128"><span class="linenos">1128</span></a><span class="sd">             &#39;circularity&#39;: 0.6, &#39;intensity_mean&#39;: 6553.5, &#39;nn_min&#39;: 10,</span>
</span><span id="NucleiFinder-1129"><a href="#NucleiFinder-1129"><span class="linenos">1129</span></a><span class="sd">             &#39;FC_diff_global&#39;: 1.5, &#39;FC_diff_local_intensity&#39;: 0.6}</span>
</span><span id="NucleiFinder-1130"><a href="#NucleiFinder-1130"><span class="linenos">1130</span></a>
</span><span id="NucleiFinder-1131"><a href="#NucleiFinder-1131"><span class="linenos">1131</span></a><span class="sd">        hyperparameter_chromatinization : dict, optional</span>
</span><span id="NucleiFinder-1132"><a href="#NucleiFinder-1132"><span class="linenos">1132</span></a><span class="sd">            The analysis parameters for chromatin spots within the nuclei.</span>
</span><span id="NucleiFinder-1133"><a href="#NucleiFinder-1133"><span class="linenos">1133</span></a><span class="sd">            Default:</span>
</span><span id="NucleiFinder-1134"><a href="#NucleiFinder-1134"><span class="linenos">1134</span></a><span class="sd">            {&#39;max_size&#39;: 800, &#39;min_size&#39;: 2, &#39;ratio&#39;: 0.1, &#39;cut_point&#39;: 0.95}</span>
</span><span id="NucleiFinder-1135"><a href="#NucleiFinder-1135"><span class="linenos">1135</span></a>
</span><span id="NucleiFinder-1136"><a href="#NucleiFinder-1136"><span class="linenos">1136</span></a><span class="sd">        img_adj_par_chrom : dict, optional</span>
</span><span id="NucleiFinder-1137"><a href="#NucleiFinder-1137"><span class="linenos">1137</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for chromatin analysis.</span>
</span><span id="NucleiFinder-1138"><a href="#NucleiFinder-1138"><span class="linenos">1138</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.25, &#39;contrast&#39;: 5, &#39;brightness&#39;: 950}</span>
</span><span id="NucleiFinder-1139"><a href="#NucleiFinder-1139"><span class="linenos">1139</span></a>
</span><span id="NucleiFinder-1140"><a href="#NucleiFinder-1140"><span class="linenos">1140</span></a><span class="sd">        img_adj_par : dict, optional</span>
</span><span id="NucleiFinder-1141"><a href="#NucleiFinder-1141"><span class="linenos">1141</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for nuclei segmentation.</span>
</span><span id="NucleiFinder-1142"><a href="#NucleiFinder-1142"><span class="linenos">1142</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.9, &#39;contrast&#39;: 2, &#39;brightness&#39;: 1000}</span>
</span><span id="NucleiFinder-1143"><a href="#NucleiFinder-1143"><span class="linenos">1143</span></a>
</span><span id="NucleiFinder-1144"><a href="#NucleiFinder-1144"><span class="linenos">1144</span></a><span class="sd">        show_plots : bool, optional</span>
</span><span id="NucleiFinder-1145"><a href="#NucleiFinder-1145"><span class="linenos">1145</span></a><span class="sd">            Flag to determine whether results and plots should be displayed automatically.</span>
</span><span id="NucleiFinder-1146"><a href="#NucleiFinder-1146"><span class="linenos">1146</span></a><span class="sd">            Default: True.</span>
</span><span id="NucleiFinder-1147"><a href="#NucleiFinder-1147"><span class="linenos">1147</span></a>
</span><span id="NucleiFinder-1148"><a href="#NucleiFinder-1148"><span class="linenos">1148</span></a><span class="sd">        nuclei_results : dict, optional</span>
</span><span id="NucleiFinder-1149"><a href="#NucleiFinder-1149"><span class="linenos">1149</span></a><span class="sd">            A dictionary storing the numerical results of the analysis.</span>
</span><span id="NucleiFinder-1150"><a href="#NucleiFinder-1150"><span class="linenos">1150</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="NucleiFinder-1151"><a href="#NucleiFinder-1151"><span class="linenos">1151</span></a>
</span><span id="NucleiFinder-1152"><a href="#NucleiFinder-1152"><span class="linenos">1152</span></a><span class="sd">        images : dict, optional</span>
</span><span id="NucleiFinder-1153"><a href="#NucleiFinder-1153"><span class="linenos">1153</span></a><span class="sd">            A dictionary storing the output images (e.g., masks).</span>
</span><span id="NucleiFinder-1154"><a href="#NucleiFinder-1154"><span class="linenos">1154</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="NucleiFinder-1155"><a href="#NucleiFinder-1155"><span class="linenos">1155</span></a>
</span><span id="NucleiFinder-1156"><a href="#NucleiFinder-1156"><span class="linenos">1156</span></a><span class="sd">        Attributes</span>
</span><span id="NucleiFinder-1157"><a href="#NucleiFinder-1157"><span class="linenos">1157</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1158"><a href="#NucleiFinder-1158"><span class="linenos">1158</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="NucleiFinder-1159"><a href="#NucleiFinder-1159"><span class="linenos">1159</span></a><span class="sd">            The currently loaded image for analysis.</span>
</span><span id="NucleiFinder-1160"><a href="#NucleiFinder-1160"><span class="linenos">1160</span></a>
</span><span id="NucleiFinder-1161"><a href="#NucleiFinder-1161"><span class="linenos">1161</span></a><span class="sd">        hyperparameter_nuclei : dict</span>
</span><span id="NucleiFinder-1162"><a href="#NucleiFinder-1162"><span class="linenos">1162</span></a><span class="sd">            Active nuclei segmentation parameters.</span>
</span><span id="NucleiFinder-1163"><a href="#NucleiFinder-1163"><span class="linenos">1163</span></a>
</span><span id="NucleiFinder-1164"><a href="#NucleiFinder-1164"><span class="linenos">1164</span></a><span class="sd">        hyperparameter_chromatinization : dict</span>
</span><span id="NucleiFinder-1165"><a href="#NucleiFinder-1165"><span class="linenos">1165</span></a><span class="sd">            Active chromatinization analysis parameters.</span>
</span><span id="NucleiFinder-1166"><a href="#NucleiFinder-1166"><span class="linenos">1166</span></a>
</span><span id="NucleiFinder-1167"><a href="#NucleiFinder-1167"><span class="linenos">1167</span></a><span class="sd">        img_adj_par : dict</span>
</span><span id="NucleiFinder-1168"><a href="#NucleiFinder-1168"><span class="linenos">1168</span></a><span class="sd">            Active image correction parameters for nuclei segmentation.</span>
</span><span id="NucleiFinder-1169"><a href="#NucleiFinder-1169"><span class="linenos">1169</span></a>
</span><span id="NucleiFinder-1170"><a href="#NucleiFinder-1170"><span class="linenos">1170</span></a><span class="sd">        img_adj_par_chrom : dict</span>
</span><span id="NucleiFinder-1171"><a href="#NucleiFinder-1171"><span class="linenos">1171</span></a><span class="sd">            Active image correction parameters for chromatin analysis.</span>
</span><span id="NucleiFinder-1172"><a href="#NucleiFinder-1172"><span class="linenos">1172</span></a>
</span><span id="NucleiFinder-1173"><a href="#NucleiFinder-1173"><span class="linenos">1173</span></a><span class="sd">        show_plots : bool</span>
</span><span id="NucleiFinder-1174"><a href="#NucleiFinder-1174"><span class="linenos">1174</span></a><span class="sd">            The current state of the plot display flag.</span>
</span><span id="NucleiFinder-1175"><a href="#NucleiFinder-1175"><span class="linenos">1175</span></a>
</span><span id="NucleiFinder-1176"><a href="#NucleiFinder-1176"><span class="linenos">1176</span></a><span class="sd">        series_im : bool</span>
</span><span id="NucleiFinder-1177"><a href="#NucleiFinder-1177"><span class="linenos">1177</span></a><span class="sd">            Flag indicating if a series of images is being processed.</span>
</span><span id="NucleiFinder-1178"><a href="#NucleiFinder-1178"><span class="linenos">1178</span></a>
</span><span id="NucleiFinder-1179"><a href="#NucleiFinder-1179"><span class="linenos">1179</span></a><span class="sd">        Notes</span>
</span><span id="NucleiFinder-1180"><a href="#NucleiFinder-1180"><span class="linenos">1180</span></a><span class="sd">        -----</span>
</span><span id="NucleiFinder-1181"><a href="#NucleiFinder-1181"><span class="linenos">1181</span></a><span class="sd">        The default value for &#39;intensity_mean&#39; in hyperparameter_nuclei is calculated</span>
</span><span id="NucleiFinder-1182"><a href="#NucleiFinder-1182"><span class="linenos">1182</span></a><span class="sd">        as $(2^{16} - 1) / 10$, which represents 10% of the maximum 16-bit value (65535 / 10 = 6553.5).</span>
</span><span id="NucleiFinder-1183"><a href="#NucleiFinder-1183"><span class="linenos">1183</span></a>
</span><span id="NucleiFinder-1184"><a href="#NucleiFinder-1184"><span class="linenos">1184</span></a><span class="sd">        The image adjustment parameters are crucial for optimizing contrast and brightness</span>
</span><span id="NucleiFinder-1185"><a href="#NucleiFinder-1185"><span class="linenos">1185</span></a><span class="sd">        to improve the performance of both the StarDist model and the subsequent</span>
</span><span id="NucleiFinder-1186"><a href="#NucleiFinder-1186"><span class="linenos">1186</span></a><span class="sd">        chromatin thresholding.</span>
</span><span id="NucleiFinder-1187"><a href="#NucleiFinder-1187"><span class="linenos">1187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1188"><a href="#NucleiFinder-1188"><span class="linenos">1188</span></a>
</span><span id="NucleiFinder-1189"><a href="#NucleiFinder-1189"><span class="linenos">1189</span></a>        <span class="c1"># Use default values if parameters are None</span>
</span><span id="NucleiFinder-1190"><a href="#NucleiFinder-1190"><span class="linenos">1190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1191"><a href="#NucleiFinder-1191"><span class="linenos">1191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loaded input image.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1192"><a href="#NucleiFinder-1192"><span class="linenos">1192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">test_results</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1193"><a href="#NucleiFinder-1193"><span class="linenos">1193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Results of parameter tests.</span>
</span><span id="NucleiFinder-1194"><a href="#NucleiFinder-1194"><span class="linenos">1194</span></a>
</span><span id="NucleiFinder-1195"><a href="#NucleiFinder-1195"><span class="linenos">1195</span></a><span class="sd">            This attribute or method stores the outcomes of parameter testing procedures.</span>
</span><span id="NucleiFinder-1196"><a href="#NucleiFinder-1196"><span class="linenos">1196</span></a><span class="sd">            For interactive browsing and inspection of the results, use the </span>
</span><span id="NucleiFinder-1197"><a href="#NucleiFinder-1197"><span class="linenos">1197</span></a><span class="sd">            `browser_test(self)` method.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1198"><a href="#NucleiFinder-1198"><span class="linenos">1198</span></a>
</span><span id="NucleiFinder-1199"><a href="#NucleiFinder-1199"><span class="linenos">1199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span> <span class="o">=</span> <span class="n">hyperparameter_nuclei</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1200"><a href="#NucleiFinder-1200"><span class="linenos">1200</span></a>            <span class="s2">&quot;nms&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="NucleiFinder-1201"><a href="#NucleiFinder-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="NucleiFinder-1202"><a href="#NucleiFinder-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="NucleiFinder-1203"><a href="#NucleiFinder-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="NucleiFinder-1204"><a href="#NucleiFinder-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="NucleiFinder-1205"><a href="#NucleiFinder-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NucleiFinder-1206"><a href="#NucleiFinder-1206"><span class="linenos">1206</span></a>            <span class="s2">&quot;nn_min&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NucleiFinder-1207"><a href="#NucleiFinder-1207"><span class="linenos">1207</span></a>            <span class="s2">&quot;FC_diff_global&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="NucleiFinder-1208"><a href="#NucleiFinder-1208"><span class="linenos">1208</span></a>            <span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="NucleiFinder-1209"><a href="#NucleiFinder-1209"><span class="linenos">1209</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1210"><a href="#NucleiFinder-1210"><span class="linenos">1210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active nuclei segmentation/filter parameters.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1211"><a href="#NucleiFinder-1211"><span class="linenos">1211</span></a>
</span><span id="NucleiFinder-1212"><a href="#NucleiFinder-1212"><span class="linenos">1212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span> <span class="o">=</span> <span class="n">hyperparameter_chromatinization</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1213"><a href="#NucleiFinder-1213"><span class="linenos">1213</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="NucleiFinder-1214"><a href="#NucleiFinder-1214"><span class="linenos">1214</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="NucleiFinder-1215"><a href="#NucleiFinder-1215"><span class="linenos">1215</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="NucleiFinder-1216"><a href="#NucleiFinder-1216"><span class="linenos">1216</span></a>            <span class="s2">&quot;cut_point&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
</span><span id="NucleiFinder-1217"><a href="#NucleiFinder-1217"><span class="linenos">1217</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1218"><a href="#NucleiFinder-1218"><span class="linenos">1218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active chromatin analysis parameters.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1219"><a href="#NucleiFinder-1219"><span class="linenos">1219</span></a>
</span><span id="NucleiFinder-1220"><a href="#NucleiFinder-1220"><span class="linenos">1220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span> <span class="o">=</span> <span class="n">img_adj_par_chrom</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1221"><a href="#NucleiFinder-1221"><span class="linenos">1221</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="NucleiFinder-1222"><a href="#NucleiFinder-1222"><span class="linenos">1222</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="NucleiFinder-1223"><a href="#NucleiFinder-1223"><span class="linenos">1223</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">950</span><span class="p">,</span>
</span><span id="NucleiFinder-1224"><a href="#NucleiFinder-1224"><span class="linenos">1224</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1225"><a href="#NucleiFinder-1225"><span class="linenos">1225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for chromatin analysis.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1226"><a href="#NucleiFinder-1226"><span class="linenos">1226</span></a>
</span><span id="NucleiFinder-1227"><a href="#NucleiFinder-1227"><span class="linenos">1227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span> <span class="o">=</span> <span class="n">img_adj_par</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1228"><a href="#NucleiFinder-1228"><span class="linenos">1228</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="NucleiFinder-1229"><a href="#NucleiFinder-1229"><span class="linenos">1229</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="NucleiFinder-1230"><a href="#NucleiFinder-1230"><span class="linenos">1230</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="NucleiFinder-1231"><a href="#NucleiFinder-1231"><span class="linenos">1231</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1232"><a href="#NucleiFinder-1232"><span class="linenos">1232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for nuclei segmentation.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1233"><a href="#NucleiFinder-1233"><span class="linenos">1233</span></a>
</span><span id="NucleiFinder-1234"><a href="#NucleiFinder-1234"><span class="linenos">1234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span> <span class="ow">or</span> <span class="kc">True</span>
</span><span id="NucleiFinder-1235"><a href="#NucleiFinder-1235"><span class="linenos">1235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag controlling plot display.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1236"><a href="#NucleiFinder-1236"><span class="linenos">1236</span></a>
</span><span id="NucleiFinder-1237"><a href="#NucleiFinder-1237"><span class="linenos">1237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span> <span class="o">=</span> <span class="n">nuclei_results</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1238"><a href="#NucleiFinder-1238"><span class="linenos">1238</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1239"><a href="#NucleiFinder-1239"><span class="linenos">1239</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1240"><a href="#NucleiFinder-1240"><span class="linenos">1240</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1241"><a href="#NucleiFinder-1241"><span class="linenos">1241</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1242"><a href="#NucleiFinder-1242"><span class="linenos">1242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of nuclei analysis results.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1243"><a href="#NucleiFinder-1243"><span class="linenos">1243</span></a>
</span><span id="NucleiFinder-1244"><a href="#NucleiFinder-1244"><span class="linenos">1244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder-1245"><a href="#NucleiFinder-1245"><span class="linenos">1245</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1246"><a href="#NucleiFinder-1246"><span class="linenos">1246</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1247"><a href="#NucleiFinder-1247"><span class="linenos">1247</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder-1248"><a href="#NucleiFinder-1248"><span class="linenos">1248</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1249"><a href="#NucleiFinder-1249"><span class="linenos">1249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of images from nuclei analysis.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1250"><a href="#NucleiFinder-1250"><span class="linenos">1250</span></a>
</span><span id="NucleiFinder-1251"><a href="#NucleiFinder-1251"><span class="linenos">1251</span></a>        <span class="c1"># sereies images</span>
</span><span id="NucleiFinder-1252"><a href="#NucleiFinder-1252"><span class="linenos">1252</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-1253"><a href="#NucleiFinder-1253"><span class="linenos">1253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag for batch/series image processing.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1254"><a href="#NucleiFinder-1254"><span class="linenos">1254</span></a>
</span><span id="NucleiFinder-1255"><a href="#NucleiFinder-1255"><span class="linenos">1255</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nms</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1256"><a href="#NucleiFinder-1256"><span class="linenos">1256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1257"><a href="#NucleiFinder-1257"><span class="linenos">1257</span></a><span class="sd">        Set the Non-Maximum Suppression (NMS) threshold.</span>
</span><span id="NucleiFinder-1258"><a href="#NucleiFinder-1258"><span class="linenos">1258</span></a>
</span><span id="NucleiFinder-1259"><a href="#NucleiFinder-1259"><span class="linenos">1259</span></a><span class="sd">        The NMS threshold controls how aggressively overlapping detections are suppressed.</span>
</span><span id="NucleiFinder-1260"><a href="#NucleiFinder-1260"><span class="linenos">1260</span></a><span class="sd">        A lower value reduces the probability of overlapping nuclei being kept.</span>
</span><span id="NucleiFinder-1261"><a href="#NucleiFinder-1261"><span class="linenos">1261</span></a>
</span><span id="NucleiFinder-1262"><a href="#NucleiFinder-1262"><span class="linenos">1262</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1263"><a href="#NucleiFinder-1263"><span class="linenos">1263</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1264"><a href="#NucleiFinder-1264"><span class="linenos">1264</span></a><span class="sd">        nms : float</span>
</span><span id="NucleiFinder-1265"><a href="#NucleiFinder-1265"><span class="linenos">1265</span></a><span class="sd">            The NMS IoU threshold value.</span>
</span><span id="NucleiFinder-1266"><a href="#NucleiFinder-1266"><span class="linenos">1266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1267"><a href="#NucleiFinder-1267"><span class="linenos">1267</span></a>
</span><span id="NucleiFinder-1268"><a href="#NucleiFinder-1268"><span class="linenos">1268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nms</span>
</span><span id="NucleiFinder-1269"><a href="#NucleiFinder-1269"><span class="linenos">1269</span></a>
</span><span id="NucleiFinder-1270"><a href="#NucleiFinder-1270"><span class="linenos">1270</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1271"><a href="#NucleiFinder-1271"><span class="linenos">1271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1272"><a href="#NucleiFinder-1272"><span class="linenos">1272</span></a><span class="sd">        Set the probability threshold used in segmentation.</span>
</span><span id="NucleiFinder-1273"><a href="#NucleiFinder-1273"><span class="linenos">1273</span></a>
</span><span id="NucleiFinder-1274"><a href="#NucleiFinder-1274"><span class="linenos">1274</span></a><span class="sd">        The probability threshold determines the minimum confidence required for an object</span>
</span><span id="NucleiFinder-1275"><a href="#NucleiFinder-1275"><span class="linenos">1275</span></a><span class="sd">        (e.g., a nucleus) to be classified as a segmented entity. Higher values result in</span>
</span><span id="NucleiFinder-1276"><a href="#NucleiFinder-1276"><span class="linenos">1276</span></a><span class="sd">        fewer segmented objects, as only detections with strong confidence scores are kept.</span>
</span><span id="NucleiFinder-1277"><a href="#NucleiFinder-1277"><span class="linenos">1277</span></a><span class="sd">        This may lead to omission of weaker or less distinct structures.</span>
</span><span id="NucleiFinder-1278"><a href="#NucleiFinder-1278"><span class="linenos">1278</span></a>
</span><span id="NucleiFinder-1279"><a href="#NucleiFinder-1279"><span class="linenos">1279</span></a><span class="sd">        Because optimal values depend on image characteristics, it is important to visually</span>
</span><span id="NucleiFinder-1280"><a href="#NucleiFinder-1280"><span class="linenos">1280</span></a><span class="sd">        inspect segmentation results produced with different thresholds to determine the</span>
</span><span id="NucleiFinder-1281"><a href="#NucleiFinder-1281"><span class="linenos">1281</span></a><span class="sd">        most suitable setting.</span>
</span><span id="NucleiFinder-1282"><a href="#NucleiFinder-1282"><span class="linenos">1282</span></a>
</span><span id="NucleiFinder-1283"><a href="#NucleiFinder-1283"><span class="linenos">1283</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1284"><a href="#NucleiFinder-1284"><span class="linenos">1284</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1285"><a href="#NucleiFinder-1285"><span class="linenos">1285</span></a><span class="sd">        prob : float</span>
</span><span id="NucleiFinder-1286"><a href="#NucleiFinder-1286"><span class="linenos">1286</span></a><span class="sd">            The probability threshold value.</span>
</span><span id="NucleiFinder-1287"><a href="#NucleiFinder-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1288"><a href="#NucleiFinder-1288"><span class="linenos">1288</span></a>
</span><span id="NucleiFinder-1289"><a href="#NucleiFinder-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span>
</span><span id="NucleiFinder-1290"><a href="#NucleiFinder-1290"><span class="linenos">1290</span></a>
</span><span id="NucleiFinder-1291"><a href="#NucleiFinder-1291"><span class="linenos">1291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circ</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1292"><a href="#NucleiFinder-1292"><span class="linenos">1292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1293"><a href="#NucleiFinder-1293"><span class="linenos">1293</span></a><span class="sd">        This method sets &#39;circ&#39; parameter. The circ is a parameter used for adjust minimal nucleus circularity.</span>
</span><span id="NucleiFinder-1294"><a href="#NucleiFinder-1294"><span class="linenos">1294</span></a>
</span><span id="NucleiFinder-1295"><a href="#NucleiFinder-1295"><span class="linenos">1295</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1296"><a href="#NucleiFinder-1296"><span class="linenos">1296</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1297"><a href="#NucleiFinder-1297"><span class="linenos">1297</span></a><span class="sd">        circ : float</span>
</span><span id="NucleiFinder-1298"><a href="#NucleiFinder-1298"><span class="linenos">1298</span></a><span class="sd">            Nuclei circularity value.</span>
</span><span id="NucleiFinder-1299"><a href="#NucleiFinder-1299"><span class="linenos">1299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1300"><a href="#NucleiFinder-1300"><span class="linenos">1300</span></a>
</span><span id="NucleiFinder-1301"><a href="#NucleiFinder-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circ</span>
</span><span id="NucleiFinder-1302"><a href="#NucleiFinder-1302"><span class="linenos">1302</span></a>
</span><span id="NucleiFinder-1303"><a href="#NucleiFinder-1303"><span class="linenos">1303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_local_intenisty_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1304"><a href="#NucleiFinder-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1305"><a href="#NucleiFinder-1305"><span class="linenos">1305</span></a><span class="sd">        This method sets the &#39;FC_diff_local_intensity&#39; parameter. The &#39;local_FC&#39; is used to remove false positive multiple nuclei that were detected in single image.</span>
</span><span id="NucleiFinder-1306"><a href="#NucleiFinder-1306"><span class="linenos">1306</span></a>
</span><span id="NucleiFinder-1307"><a href="#NucleiFinder-1307"><span class="linenos">1307</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1308"><a href="#NucleiFinder-1308"><span class="linenos">1308</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1309"><a href="#NucleiFinder-1309"><span class="linenos">1309</span></a><span class="sd">        local_FC : float</span>
</span><span id="NucleiFinder-1310"><a href="#NucleiFinder-1310"><span class="linenos">1310</span></a><span class="sd">            local_FC value.</span>
</span><span id="NucleiFinder-1311"><a href="#NucleiFinder-1311"><span class="linenos">1311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1312"><a href="#NucleiFinder-1312"><span class="linenos">1312</span></a>
</span><span id="NucleiFinder-1313"><a href="#NucleiFinder-1313"><span class="linenos">1313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_FC</span>
</span><span id="NucleiFinder-1314"><a href="#NucleiFinder-1314"><span class="linenos">1314</span></a>
</span><span id="NucleiFinder-1315"><a href="#NucleiFinder-1315"><span class="linenos">1315</span></a>    <span class="c1"># change</span>
</span><span id="NucleiFinder-1316"><a href="#NucleiFinder-1316"><span class="linenos">1316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_global_area_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1317"><a href="#NucleiFinder-1317"><span class="linenos">1317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1318"><a href="#NucleiFinder-1318"><span class="linenos">1318</span></a><span class="sd">        This method sets the &#39;FC_diff_global&#39; parameter. The &#39;global_FC&#39; is used to remove false positive multiple nuclei that were detected in a single image and are outliers from the global mean area size.</span>
</span><span id="NucleiFinder-1319"><a href="#NucleiFinder-1319"><span class="linenos">1319</span></a>
</span><span id="NucleiFinder-1320"><a href="#NucleiFinder-1320"><span class="linenos">1320</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1321"><a href="#NucleiFinder-1321"><span class="linenos">1321</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1322"><a href="#NucleiFinder-1322"><span class="linenos">1322</span></a><span class="sd">        FC_diff_global : float</span>
</span><span id="NucleiFinder-1323"><a href="#NucleiFinder-1323"><span class="linenos">1323</span></a><span class="sd">            global_FC value.</span>
</span><span id="NucleiFinder-1324"><a href="#NucleiFinder-1324"><span class="linenos">1324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1325"><a href="#NucleiFinder-1325"><span class="linenos">1325</span></a>
</span><span id="NucleiFinder-1326"><a href="#NucleiFinder-1326"><span class="linenos">1326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_FC</span>
</span><span id="NucleiFinder-1327"><a href="#NucleiFinder-1327"><span class="linenos">1327</span></a>
</span><span id="NucleiFinder-1328"><a href="#NucleiFinder-1328"><span class="linenos">1328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="NucleiFinder-1329"><a href="#NucleiFinder-1329"><span class="linenos">1329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1330"><a href="#NucleiFinder-1330"><span class="linenos">1330</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal nucleus area (px).</span>
</span><span id="NucleiFinder-1331"><a href="#NucleiFinder-1331"><span class="linenos">1331</span></a>
</span><span id="NucleiFinder-1332"><a href="#NucleiFinder-1332"><span class="linenos">1332</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1333"><a href="#NucleiFinder-1333"><span class="linenos">1333</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1334"><a href="#NucleiFinder-1334"><span class="linenos">1334</span></a><span class="sd">        size : tuple</span>
</span><span id="NucleiFinder-1335"><a href="#NucleiFinder-1335"><span class="linenos">1335</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="NucleiFinder-1336"><a href="#NucleiFinder-1336"><span class="linenos">1336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1337"><a href="#NucleiFinder-1337"><span class="linenos">1337</span></a>
</span><span id="NucleiFinder-1338"><a href="#NucleiFinder-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-1339"><a href="#NucleiFinder-1339"><span class="linenos">1339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-1340"><a href="#NucleiFinder-1340"><span class="linenos">1340</span></a>
</span><span id="NucleiFinder-1341"><a href="#NucleiFinder-1341"><span class="linenos">1341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_min_mean_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder-1342"><a href="#NucleiFinder-1342"><span class="linenos">1342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1343"><a href="#NucleiFinder-1343"><span class="linenos">1343</span></a><span class="sd">        This method sets &#39;intensity&#39; parameter. The &#39;intensity&#39; parameter is used to adjust the minimum mean intensity of all pixel intensities within the nucleus.</span>
</span><span id="NucleiFinder-1344"><a href="#NucleiFinder-1344"><span class="linenos">1344</span></a>
</span><span id="NucleiFinder-1345"><a href="#NucleiFinder-1345"><span class="linenos">1345</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1346"><a href="#NucleiFinder-1346"><span class="linenos">1346</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1347"><a href="#NucleiFinder-1347"><span class="linenos">1347</span></a><span class="sd">        intensity : int</span>
</span><span id="NucleiFinder-1348"><a href="#NucleiFinder-1348"><span class="linenos">1348</span></a><span class="sd">            intensity value.</span>
</span><span id="NucleiFinder-1349"><a href="#NucleiFinder-1349"><span class="linenos">1349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1350"><a href="#NucleiFinder-1350"><span class="linenos">1350</span></a>
</span><span id="NucleiFinder-1351"><a href="#NucleiFinder-1351"><span class="linenos">1351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
</span><span id="NucleiFinder-1352"><a href="#NucleiFinder-1352"><span class="linenos">1352</span></a>
</span><span id="NucleiFinder-1353"><a href="#NucleiFinder-1353"><span class="linenos">1353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="NucleiFinder-1354"><a href="#NucleiFinder-1354"><span class="linenos">1354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1355"><a href="#NucleiFinder-1355"><span class="linenos">1355</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal chromanitization spot area (px) within the nucleus.</span>
</span><span id="NucleiFinder-1356"><a href="#NucleiFinder-1356"><span class="linenos">1356</span></a>
</span><span id="NucleiFinder-1357"><a href="#NucleiFinder-1357"><span class="linenos">1357</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1358"><a href="#NucleiFinder-1358"><span class="linenos">1358</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1359"><a href="#NucleiFinder-1359"><span class="linenos">1359</span></a><span class="sd">        size : tuple</span>
</span><span id="NucleiFinder-1360"><a href="#NucleiFinder-1360"><span class="linenos">1360</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="NucleiFinder-1361"><a href="#NucleiFinder-1361"><span class="linenos">1361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1362"><a href="#NucleiFinder-1362"><span class="linenos">1362</span></a>
</span><span id="NucleiFinder-1363"><a href="#NucleiFinder-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-1364"><a href="#NucleiFinder-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-1365"><a href="#NucleiFinder-1365"><span class="linenos">1365</span></a>
</span><span id="NucleiFinder-1366"><a href="#NucleiFinder-1366"><span class="linenos">1366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder-1367"><a href="#NucleiFinder-1367"><span class="linenos">1367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1368"><a href="#NucleiFinder-1368"><span class="linenos">1368</span></a><span class="sd">        This method sets the &#39;ratio&#39; parameter. In this case, the &#39;ratio&#39; parameter is similar to &#39;circularity&#39; as it describes the ratio between the maximum lengths in the x and y dimensions of the nucleus chromatinization.</span>
</span><span id="NucleiFinder-1369"><a href="#NucleiFinder-1369"><span class="linenos">1369</span></a>
</span><span id="NucleiFinder-1370"><a href="#NucleiFinder-1370"><span class="linenos">1370</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1371"><a href="#NucleiFinder-1371"><span class="linenos">1371</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1372"><a href="#NucleiFinder-1372"><span class="linenos">1372</span></a><span class="sd">        ratio : float</span>
</span><span id="NucleiFinder-1373"><a href="#NucleiFinder-1373"><span class="linenos">1373</span></a><span class="sd">            ratio value.</span>
</span><span id="NucleiFinder-1374"><a href="#NucleiFinder-1374"><span class="linenos">1374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1375"><a href="#NucleiFinder-1375"><span class="linenos">1375</span></a>
</span><span id="NucleiFinder-1376"><a href="#NucleiFinder-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>
</span><span id="NucleiFinder-1377"><a href="#NucleiFinder-1377"><span class="linenos">1377</span></a>
</span><span id="NucleiFinder-1378"><a href="#NucleiFinder-1378"><span class="linenos">1378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_cut_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cut_point</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder-1379"><a href="#NucleiFinder-1379"><span class="linenos">1379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1380"><a href="#NucleiFinder-1380"><span class="linenos">1380</span></a><span class="sd">        This method sets the &#39;cut_point&#39; parameter. The &#39;cut_point&#39; parameter is a factor used to adjust the threshold for separating the background from chromatin spots.</span>
</span><span id="NucleiFinder-1381"><a href="#NucleiFinder-1381"><span class="linenos">1381</span></a>
</span><span id="NucleiFinder-1382"><a href="#NucleiFinder-1382"><span class="linenos">1382</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1383"><a href="#NucleiFinder-1383"><span class="linenos">1383</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1384"><a href="#NucleiFinder-1384"><span class="linenos">1384</span></a><span class="sd">        cut_point : int</span>
</span><span id="NucleiFinder-1385"><a href="#NucleiFinder-1385"><span class="linenos">1385</span></a><span class="sd">            cut_point value.</span>
</span><span id="NucleiFinder-1386"><a href="#NucleiFinder-1386"><span class="linenos">1386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1387"><a href="#NucleiFinder-1387"><span class="linenos">1387</span></a>
</span><span id="NucleiFinder-1388"><a href="#NucleiFinder-1388"><span class="linenos">1388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut_point</span>
</span><span id="NucleiFinder-1389"><a href="#NucleiFinder-1389"><span class="linenos">1389</span></a>
</span><span id="NucleiFinder-1390"><a href="#NucleiFinder-1390"><span class="linenos">1390</span></a>    <span class="c1">#</span>
</span><span id="NucleiFinder-1391"><a href="#NucleiFinder-1391"><span class="linenos">1391</span></a>
</span><span id="NucleiFinder-1392"><a href="#NucleiFinder-1392"><span class="linenos">1392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1393"><a href="#NucleiFinder-1393"><span class="linenos">1393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1394"><a href="#NucleiFinder-1394"><span class="linenos">1394</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus image.</span>
</span><span id="NucleiFinder-1395"><a href="#NucleiFinder-1395"><span class="linenos">1395</span></a>
</span><span id="NucleiFinder-1396"><a href="#NucleiFinder-1396"><span class="linenos">1396</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1397"><a href="#NucleiFinder-1397"><span class="linenos">1397</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1398"><a href="#NucleiFinder-1398"><span class="linenos">1398</span></a><span class="sd">        gamma : float</span>
</span><span id="NucleiFinder-1399"><a href="#NucleiFinder-1399"><span class="linenos">1399</span></a><span class="sd">            gamma value.</span>
</span><span id="NucleiFinder-1400"><a href="#NucleiFinder-1400"><span class="linenos">1400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1401"><a href="#NucleiFinder-1401"><span class="linenos">1401</span></a>
</span><span id="NucleiFinder-1402"><a href="#NucleiFinder-1402"><span class="linenos">1402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="NucleiFinder-1403"><a href="#NucleiFinder-1403"><span class="linenos">1403</span></a>
</span><span id="NucleiFinder-1404"><a href="#NucleiFinder-1404"><span class="linenos">1404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1405"><a href="#NucleiFinder-1405"><span class="linenos">1405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1406"><a href="#NucleiFinder-1406"><span class="linenos">1406</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus image.</span>
</span><span id="NucleiFinder-1407"><a href="#NucleiFinder-1407"><span class="linenos">1407</span></a>
</span><span id="NucleiFinder-1408"><a href="#NucleiFinder-1408"><span class="linenos">1408</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1409"><a href="#NucleiFinder-1409"><span class="linenos">1409</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1410"><a href="#NucleiFinder-1410"><span class="linenos">1410</span></a><span class="sd">        contrast : float</span>
</span><span id="NucleiFinder-1411"><a href="#NucleiFinder-1411"><span class="linenos">1411</span></a><span class="sd">            contrast value.</span>
</span><span id="NucleiFinder-1412"><a href="#NucleiFinder-1412"><span class="linenos">1412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1413"><a href="#NucleiFinder-1413"><span class="linenos">1413</span></a>
</span><span id="NucleiFinder-1414"><a href="#NucleiFinder-1414"><span class="linenos">1414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span><span id="NucleiFinder-1415"><a href="#NucleiFinder-1415"><span class="linenos">1415</span></a>
</span><span id="NucleiFinder-1416"><a href="#NucleiFinder-1416"><span class="linenos">1416</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1417"><a href="#NucleiFinder-1417"><span class="linenos">1417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1418"><a href="#NucleiFinder-1418"><span class="linenos">1418</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus image.</span>
</span><span id="NucleiFinder-1419"><a href="#NucleiFinder-1419"><span class="linenos">1419</span></a>
</span><span id="NucleiFinder-1420"><a href="#NucleiFinder-1420"><span class="linenos">1420</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1421"><a href="#NucleiFinder-1421"><span class="linenos">1421</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1422"><a href="#NucleiFinder-1422"><span class="linenos">1422</span></a><span class="sd">        brightness : float</span>
</span><span id="NucleiFinder-1423"><a href="#NucleiFinder-1423"><span class="linenos">1423</span></a><span class="sd">            brightness value.</span>
</span><span id="NucleiFinder-1424"><a href="#NucleiFinder-1424"><span class="linenos">1424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1425"><a href="#NucleiFinder-1425"><span class="linenos">1425</span></a>
</span><span id="NucleiFinder-1426"><a href="#NucleiFinder-1426"><span class="linenos">1426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span><span id="NucleiFinder-1427"><a href="#NucleiFinder-1427"><span class="linenos">1427</span></a>
</span><span id="NucleiFinder-1428"><a href="#NucleiFinder-1428"><span class="linenos">1428</span></a>    <span class="c1">#</span>
</span><span id="NucleiFinder-1429"><a href="#NucleiFinder-1429"><span class="linenos">1429</span></a>
</span><span id="NucleiFinder-1430"><a href="#NucleiFinder-1430"><span class="linenos">1430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1431"><a href="#NucleiFinder-1431"><span class="linenos">1431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1432"><a href="#NucleiFinder-1432"><span class="linenos">1432</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder-1433"><a href="#NucleiFinder-1433"><span class="linenos">1433</span></a>
</span><span id="NucleiFinder-1434"><a href="#NucleiFinder-1434"><span class="linenos">1434</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1435"><a href="#NucleiFinder-1435"><span class="linenos">1435</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1436"><a href="#NucleiFinder-1436"><span class="linenos">1436</span></a><span class="sd">        gamma : float</span>
</span><span id="NucleiFinder-1437"><a href="#NucleiFinder-1437"><span class="linenos">1437</span></a><span class="sd">            gamma value.</span>
</span><span id="NucleiFinder-1438"><a href="#NucleiFinder-1438"><span class="linenos">1438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1439"><a href="#NucleiFinder-1439"><span class="linenos">1439</span></a>
</span><span id="NucleiFinder-1440"><a href="#NucleiFinder-1440"><span class="linenos">1440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="NucleiFinder-1441"><a href="#NucleiFinder-1441"><span class="linenos">1441</span></a>
</span><span id="NucleiFinder-1442"><a href="#NucleiFinder-1442"><span class="linenos">1442</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1443"><a href="#NucleiFinder-1443"><span class="linenos">1443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1444"><a href="#NucleiFinder-1444"><span class="linenos">1444</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder-1445"><a href="#NucleiFinder-1445"><span class="linenos">1445</span></a>
</span><span id="NucleiFinder-1446"><a href="#NucleiFinder-1446"><span class="linenos">1446</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1447"><a href="#NucleiFinder-1447"><span class="linenos">1447</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1448"><a href="#NucleiFinder-1448"><span class="linenos">1448</span></a><span class="sd">        contrast : float</span>
</span><span id="NucleiFinder-1449"><a href="#NucleiFinder-1449"><span class="linenos">1449</span></a><span class="sd">            contrast value.</span>
</span><span id="NucleiFinder-1450"><a href="#NucleiFinder-1450"><span class="linenos">1450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1451"><a href="#NucleiFinder-1451"><span class="linenos">1451</span></a>
</span><span id="NucleiFinder-1452"><a href="#NucleiFinder-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span><span id="NucleiFinder-1453"><a href="#NucleiFinder-1453"><span class="linenos">1453</span></a>
</span><span id="NucleiFinder-1454"><a href="#NucleiFinder-1454"><span class="linenos">1454</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder-1455"><a href="#NucleiFinder-1455"><span class="linenos">1455</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1456"><a href="#NucleiFinder-1456"><span class="linenos">1456</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder-1457"><a href="#NucleiFinder-1457"><span class="linenos">1457</span></a>
</span><span id="NucleiFinder-1458"><a href="#NucleiFinder-1458"><span class="linenos">1458</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1459"><a href="#NucleiFinder-1459"><span class="linenos">1459</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1460"><a href="#NucleiFinder-1460"><span class="linenos">1460</span></a><span class="sd">        brightness : float</span>
</span><span id="NucleiFinder-1461"><a href="#NucleiFinder-1461"><span class="linenos">1461</span></a><span class="sd">            brightness value.</span>
</span><span id="NucleiFinder-1462"><a href="#NucleiFinder-1462"><span class="linenos">1462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1463"><a href="#NucleiFinder-1463"><span class="linenos">1463</span></a>
</span><span id="NucleiFinder-1464"><a href="#NucleiFinder-1464"><span class="linenos">1464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span><span id="NucleiFinder-1465"><a href="#NucleiFinder-1465"><span class="linenos">1465</span></a>
</span><span id="NucleiFinder-1466"><a href="#NucleiFinder-1466"><span class="linenos">1466</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder-1467"><a href="#NucleiFinder-1467"><span class="linenos">1467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1468"><a href="#NucleiFinder-1468"><span class="linenos">1468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1469"><a href="#NucleiFinder-1469"><span class="linenos">1469</span></a><span class="sd">        This method returns current nuclei analysis parameters.</span>
</span><span id="NucleiFinder-1470"><a href="#NucleiFinder-1470"><span class="linenos">1470</span></a>
</span><span id="NucleiFinder-1471"><a href="#NucleiFinder-1471"><span class="linenos">1471</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1472"><a href="#NucleiFinder-1472"><span class="linenos">1472</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1473"><a href="#NucleiFinder-1473"><span class="linenos">1473</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1474"><a href="#NucleiFinder-1474"><span class="linenos">1474</span></a><span class="sd">            Nuclei analysis parameters.</span>
</span><span id="NucleiFinder-1475"><a href="#NucleiFinder-1475"><span class="linenos">1475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1476"><a href="#NucleiFinder-1476"><span class="linenos">1476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">)</span>
</span><span id="NucleiFinder-1477"><a href="#NucleiFinder-1477"><span class="linenos">1477</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span>
</span><span id="NucleiFinder-1478"><a href="#NucleiFinder-1478"><span class="linenos">1478</span></a>
</span><span id="NucleiFinder-1479"><a href="#NucleiFinder-1479"><span class="linenos">1479</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder-1480"><a href="#NucleiFinder-1480"><span class="linenos">1480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1481"><a href="#NucleiFinder-1481"><span class="linenos">1481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1482"><a href="#NucleiFinder-1482"><span class="linenos">1482</span></a><span class="sd">        This method returns current nuclei chromatinization analysis parameters.</span>
</span><span id="NucleiFinder-1483"><a href="#NucleiFinder-1483"><span class="linenos">1483</span></a>
</span><span id="NucleiFinder-1484"><a href="#NucleiFinder-1484"><span class="linenos">1484</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1485"><a href="#NucleiFinder-1485"><span class="linenos">1485</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1486"><a href="#NucleiFinder-1486"><span class="linenos">1486</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1487"><a href="#NucleiFinder-1487"><span class="linenos">1487</span></a><span class="sd">            Nuclei chromatinization analysis parameters.</span>
</span><span id="NucleiFinder-1488"><a href="#NucleiFinder-1488"><span class="linenos">1488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1489"><a href="#NucleiFinder-1489"><span class="linenos">1489</span></a>
</span><span id="NucleiFinder-1490"><a href="#NucleiFinder-1490"><span class="linenos">1490</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">)</span>
</span><span id="NucleiFinder-1491"><a href="#NucleiFinder-1491"><span class="linenos">1491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span>
</span><span id="NucleiFinder-1492"><a href="#NucleiFinder-1492"><span class="linenos">1492</span></a>
</span><span id="NucleiFinder-1493"><a href="#NucleiFinder-1493"><span class="linenos">1493</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder-1494"><a href="#NucleiFinder-1494"><span class="linenos">1494</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1495"><a href="#NucleiFinder-1495"><span class="linenos">1495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1496"><a href="#NucleiFinder-1496"><span class="linenos">1496</span></a><span class="sd">        This method returns current nuclei image setup.</span>
</span><span id="NucleiFinder-1497"><a href="#NucleiFinder-1497"><span class="linenos">1497</span></a>
</span><span id="NucleiFinder-1498"><a href="#NucleiFinder-1498"><span class="linenos">1498</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1499"><a href="#NucleiFinder-1499"><span class="linenos">1499</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1500"><a href="#NucleiFinder-1500"><span class="linenos">1500</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1501"><a href="#NucleiFinder-1501"><span class="linenos">1501</span></a><span class="sd">            Nuclei image setup.</span>
</span><span id="NucleiFinder-1502"><a href="#NucleiFinder-1502"><span class="linenos">1502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1503"><a href="#NucleiFinder-1503"><span class="linenos">1503</span></a>
</span><span id="NucleiFinder-1504"><a href="#NucleiFinder-1504"><span class="linenos">1504</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">)</span>
</span><span id="NucleiFinder-1505"><a href="#NucleiFinder-1505"><span class="linenos">1505</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span>
</span><span id="NucleiFinder-1506"><a href="#NucleiFinder-1506"><span class="linenos">1506</span></a>
</span><span id="NucleiFinder-1507"><a href="#NucleiFinder-1507"><span class="linenos">1507</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder-1508"><a href="#NucleiFinder-1508"><span class="linenos">1508</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj_chro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1509"><a href="#NucleiFinder-1509"><span class="linenos">1509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1510"><a href="#NucleiFinder-1510"><span class="linenos">1510</span></a><span class="sd">        This method returns current nuclei chromatinization image setup.</span>
</span><span id="NucleiFinder-1511"><a href="#NucleiFinder-1511"><span class="linenos">1511</span></a>
</span><span id="NucleiFinder-1512"><a href="#NucleiFinder-1512"><span class="linenos">1512</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1513"><a href="#NucleiFinder-1513"><span class="linenos">1513</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1514"><a href="#NucleiFinder-1514"><span class="linenos">1514</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1515"><a href="#NucleiFinder-1515"><span class="linenos">1515</span></a><span class="sd">            Nuclei chromatinization image setup.</span>
</span><span id="NucleiFinder-1516"><a href="#NucleiFinder-1516"><span class="linenos">1516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1517"><a href="#NucleiFinder-1517"><span class="linenos">1517</span></a>
</span><span id="NucleiFinder-1518"><a href="#NucleiFinder-1518"><span class="linenos">1518</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">)</span>
</span><span id="NucleiFinder-1519"><a href="#NucleiFinder-1519"><span class="linenos">1519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span>
</span><span id="NucleiFinder-1520"><a href="#NucleiFinder-1520"><span class="linenos">1520</span></a>
</span><span id="NucleiFinder-1521"><a href="#NucleiFinder-1521"><span class="linenos">1521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1522"><a href="#NucleiFinder-1522"><span class="linenos">1522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1523"><a href="#NucleiFinder-1523"><span class="linenos">1523</span></a><span class="sd">        This function returns nuclei analysis results.</span>
</span><span id="NucleiFinder-1524"><a href="#NucleiFinder-1524"><span class="linenos">1524</span></a>
</span><span id="NucleiFinder-1525"><a href="#NucleiFinder-1525"><span class="linenos">1525</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1526"><a href="#NucleiFinder-1526"><span class="linenos">1526</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1527"><a href="#NucleiFinder-1527"><span class="linenos">1527</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1528"><a href="#NucleiFinder-1528"><span class="linenos">1528</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="NucleiFinder-1529"><a href="#NucleiFinder-1529"><span class="linenos">1529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1530"><a href="#NucleiFinder-1530"><span class="linenos">1530</span></a>
</span><span id="NucleiFinder-1531"><a href="#NucleiFinder-1531"><span class="linenos">1531</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-1532"><a href="#NucleiFinder-1532"><span class="linenos">1532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1533"><a href="#NucleiFinder-1533"><span class="linenos">1533</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1534"><a href="#NucleiFinder-1534"><span class="linenos">1534</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1535"><a href="#NucleiFinder-1535"><span class="linenos">1535</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1536"><a href="#NucleiFinder-1536"><span class="linenos">1536</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1537"><a href="#NucleiFinder-1537"><span class="linenos">1537</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-1538"><a href="#NucleiFinder-1538"><span class="linenos">1538</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-1539"><a href="#NucleiFinder-1539"><span class="linenos">1539</span></a>
</span><span id="NucleiFinder-1540"><a href="#NucleiFinder-1540"><span class="linenos">1540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1541"><a href="#NucleiFinder-1541"><span class="linenos">1541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1542"><a href="#NucleiFinder-1542"><span class="linenos">1542</span></a><span class="sd">        This function returns the results of the nuclei analysis following adjustments to the data selection thresholds.</span>
</span><span id="NucleiFinder-1543"><a href="#NucleiFinder-1543"><span class="linenos">1543</span></a>
</span><span id="NucleiFinder-1544"><a href="#NucleiFinder-1544"><span class="linenos">1544</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1545"><a href="#NucleiFinder-1545"><span class="linenos">1545</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1546"><a href="#NucleiFinder-1546"><span class="linenos">1546</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1547"><a href="#NucleiFinder-1547"><span class="linenos">1547</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="NucleiFinder-1548"><a href="#NucleiFinder-1548"><span class="linenos">1548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1549"><a href="#NucleiFinder-1549"><span class="linenos">1549</span></a>
</span><span id="NucleiFinder-1550"><a href="#NucleiFinder-1550"><span class="linenos">1550</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-1551"><a href="#NucleiFinder-1551"><span class="linenos">1551</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1552"><a href="#NucleiFinder-1552"><span class="linenos">1552</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1553"><a href="#NucleiFinder-1553"><span class="linenos">1553</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1554"><a href="#NucleiFinder-1554"><span class="linenos">1554</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1555"><a href="#NucleiFinder-1555"><span class="linenos">1555</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1556"><a href="#NucleiFinder-1556"><span class="linenos">1556</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder-1557"><a href="#NucleiFinder-1557"><span class="linenos">1557</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1558"><a href="#NucleiFinder-1558"><span class="linenos">1558</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-1559"><a href="#NucleiFinder-1559"><span class="linenos">1559</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-1560"><a href="#NucleiFinder-1560"><span class="linenos">1560</span></a>
</span><span id="NucleiFinder-1561"><a href="#NucleiFinder-1561"><span class="linenos">1561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1562"><a href="#NucleiFinder-1562"><span class="linenos">1562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1563"><a href="#NucleiFinder-1563"><span class="linenos">1563</span></a><span class="sd">        This function returns the results of the nuclei chromatinization analysis.</span>
</span><span id="NucleiFinder-1564"><a href="#NucleiFinder-1564"><span class="linenos">1564</span></a>
</span><span id="NucleiFinder-1565"><a href="#NucleiFinder-1565"><span class="linenos">1565</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1566"><a href="#NucleiFinder-1566"><span class="linenos">1566</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1567"><a href="#NucleiFinder-1567"><span class="linenos">1567</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder-1568"><a href="#NucleiFinder-1568"><span class="linenos">1568</span></a><span class="sd">            Nuclei chromatinization results in the dictionary format.</span>
</span><span id="NucleiFinder-1569"><a href="#NucleiFinder-1569"><span class="linenos">1569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1570"><a href="#NucleiFinder-1570"><span class="linenos">1570</span></a>
</span><span id="NucleiFinder-1571"><a href="#NucleiFinder-1571"><span class="linenos">1571</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-1572"><a href="#NucleiFinder-1572"><span class="linenos">1572</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1573"><a href="#NucleiFinder-1573"><span class="linenos">1573</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1574"><a href="#NucleiFinder-1574"><span class="linenos">1574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1575"><a href="#NucleiFinder-1575"><span class="linenos">1575</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1576"><a href="#NucleiFinder-1576"><span class="linenos">1576</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1577"><a href="#NucleiFinder-1577"><span class="linenos">1577</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1578"><a href="#NucleiFinder-1578"><span class="linenos">1578</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="NucleiFinder-1579"><a href="#NucleiFinder-1579"><span class="linenos">1579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1580"><a href="#NucleiFinder-1580"><span class="linenos">1580</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1581"><a href="#NucleiFinder-1581"><span class="linenos">1581</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1582"><a href="#NucleiFinder-1582"><span class="linenos">1582</span></a>
</span><span id="NucleiFinder-1583"><a href="#NucleiFinder-1583"><span class="linenos">1583</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plots</span><span class="p">):</span>
</span><span id="NucleiFinder-1584"><a href="#NucleiFinder-1584"><span class="linenos">1584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">plots</span>
</span><span id="NucleiFinder-1585"><a href="#NucleiFinder-1585"><span class="linenos">1585</span></a>
</span><span id="NucleiFinder-1586"><a href="#NucleiFinder-1586"><span class="linenos">1586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1587"><a href="#NucleiFinder-1587"><span class="linenos">1587</span></a><span class="sd">        Helper method.</span>
</span><span id="NucleiFinder-1588"><a href="#NucleiFinder-1588"><span class="linenos">1588</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1589"><a href="#NucleiFinder-1589"><span class="linenos">1589</span></a>
</span><span id="NucleiFinder-1590"><a href="#NucleiFinder-1590"><span class="linenos">1590</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="NucleiFinder-1591"><a href="#NucleiFinder-1591"><span class="linenos">1591</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1592"><a href="#NucleiFinder-1592"><span class="linenos">1592</span></a><span class="sd">        This method adds the image to the class for nuclei and/or chromatinization analysis.</span>
</span><span id="NucleiFinder-1593"><a href="#NucleiFinder-1593"><span class="linenos">1593</span></a>
</span><span id="NucleiFinder-1594"><a href="#NucleiFinder-1594"><span class="linenos">1594</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1595"><a href="#NucleiFinder-1595"><span class="linenos">1595</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1596"><a href="#NucleiFinder-1596"><span class="linenos">1596</span></a><span class="sd">        img : np.ndarray</span>
</span><span id="NucleiFinder-1597"><a href="#NucleiFinder-1597"><span class="linenos">1597</span></a><span class="sd">            Input image.</span>
</span><span id="NucleiFinder-1598"><a href="#NucleiFinder-1598"><span class="linenos">1598</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1599"><a href="#NucleiFinder-1599"><span class="linenos">1599</span></a>
</span><span id="NucleiFinder-1600"><a href="#NucleiFinder-1600"><span class="linenos">1600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
</span><span id="NucleiFinder-1601"><a href="#NucleiFinder-1601"><span class="linenos">1601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="NucleiFinder-1602"><a href="#NucleiFinder-1602"><span class="linenos">1602</span></a>
</span><span id="NucleiFinder-1603"><a href="#NucleiFinder-1603"><span class="linenos">1603</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_out</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="NucleiFinder-1604"><a href="#NucleiFinder-1604"><span class="linenos">1604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1605"><a href="#NucleiFinder-1605"><span class="linenos">1605</span></a><span class="sd">        Extracts numerical feature descriptors from model output for a given image.</span>
</span><span id="NucleiFinder-1606"><a href="#NucleiFinder-1606"><span class="linenos">1606</span></a>
</span><span id="NucleiFinder-1607"><a href="#NucleiFinder-1607"><span class="linenos">1607</span></a><span class="sd">        This method processes the output returned by a feature-extraction model</span>
</span><span id="NucleiFinder-1608"><a href="#NucleiFinder-1608"><span class="linenos">1608</span></a><span class="sd">        (e.g., CNN, encoder network, statistical model) and converts it into a</span>
</span><span id="NucleiFinder-1609"><a href="#NucleiFinder-1609"><span class="linenos">1609</span></a><span class="sd">        structured feature vector associated with the provided image.</span>
</span><span id="NucleiFinder-1610"><a href="#NucleiFinder-1610"><span class="linenos">1610</span></a><span class="sd">        Typically used for downstream analysis, classification, or clustering.</span>
</span><span id="NucleiFinder-1611"><a href="#NucleiFinder-1611"><span class="linenos">1611</span></a>
</span><span id="NucleiFinder-1612"><a href="#NucleiFinder-1612"><span class="linenos">1612</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-1613"><a href="#NucleiFinder-1613"><span class="linenos">1613</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-1614"><a href="#NucleiFinder-1614"><span class="linenos">1614</span></a><span class="sd">        model_out : any</span>
</span><span id="NucleiFinder-1615"><a href="#NucleiFinder-1615"><span class="linenos">1615</span></a><span class="sd">            Output returned by the feature-extraction model.</span>
</span><span id="NucleiFinder-1616"><a href="#NucleiFinder-1616"><span class="linenos">1616</span></a><span class="sd">            The expected format depends on the model (e.g., tensor, dict, list of arrays).</span>
</span><span id="NucleiFinder-1617"><a href="#NucleiFinder-1617"><span class="linenos">1617</span></a>
</span><span id="NucleiFinder-1618"><a href="#NucleiFinder-1618"><span class="linenos">1618</span></a><span class="sd">        image : ndarray</span>
</span><span id="NucleiFinder-1619"><a href="#NucleiFinder-1619"><span class="linenos">1619</span></a><span class="sd">            The input image (2D or 3D array) for which features are being extracted.</span>
</span><span id="NucleiFinder-1620"><a href="#NucleiFinder-1620"><span class="linenos">1620</span></a><span class="sd">            Provided for reference or for combining raw image metrics with model features.</span>
</span><span id="NucleiFinder-1621"><a href="#NucleiFinder-1621"><span class="linenos">1621</span></a>
</span><span id="NucleiFinder-1622"><a href="#NucleiFinder-1622"><span class="linenos">1622</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-1623"><a href="#NucleiFinder-1623"><span class="linenos">1623</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-1624"><a href="#NucleiFinder-1624"><span class="linenos">1624</span></a><span class="sd">        features : dict</span>
</span><span id="NucleiFinder-1625"><a href="#NucleiFinder-1625"><span class="linenos">1625</span></a><span class="sd">            Dictionary containing extracted features.</span>
</span><span id="NucleiFinder-1626"><a href="#NucleiFinder-1626"><span class="linenos">1626</span></a><span class="sd">            Keys correspond to feature names, and values are numerical descriptors.</span>
</span><span id="NucleiFinder-1627"><a href="#NucleiFinder-1627"><span class="linenos">1627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1628"><a href="#NucleiFinder-1628"><span class="linenos">1628</span></a>
</span><span id="NucleiFinder-1629"><a href="#NucleiFinder-1629"><span class="linenos">1629</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder-1630"><a href="#NucleiFinder-1630"><span class="linenos">1630</span></a>            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1631"><a href="#NucleiFinder-1631"><span class="linenos">1631</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1632"><a href="#NucleiFinder-1632"><span class="linenos">1632</span></a>            <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1633"><a href="#NucleiFinder-1633"><span class="linenos">1633</span></a>            <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1634"><a href="#NucleiFinder-1634"><span class="linenos">1634</span></a>            <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1635"><a href="#NucleiFinder-1635"><span class="linenos">1635</span></a>            <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1636"><a href="#NucleiFinder-1636"><span class="linenos">1636</span></a>            <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1637"><a href="#NucleiFinder-1637"><span class="linenos">1637</span></a>            <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1638"><a href="#NucleiFinder-1638"><span class="linenos">1638</span></a>            <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1639"><a href="#NucleiFinder-1639"><span class="linenos">1639</span></a>            <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1640"><a href="#NucleiFinder-1640"><span class="linenos">1640</span></a>            <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1641"><a href="#NucleiFinder-1641"><span class="linenos">1641</span></a>            <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1642"><a href="#NucleiFinder-1642"><span class="linenos">1642</span></a>            <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1643"><a href="#NucleiFinder-1643"><span class="linenos">1643</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1644"><a href="#NucleiFinder-1644"><span class="linenos">1644</span></a>            <span class="s2">&quot;intensity_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1645"><a href="#NucleiFinder-1645"><span class="linenos">1645</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1646"><a href="#NucleiFinder-1646"><span class="linenos">1646</span></a>            <span class="s2">&quot;intensity_min&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1647"><a href="#NucleiFinder-1647"><span class="linenos">1647</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1648"><a href="#NucleiFinder-1648"><span class="linenos">1648</span></a>            <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1649"><a href="#NucleiFinder-1649"><span class="linenos">1649</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder-1650"><a href="#NucleiFinder-1650"><span class="linenos">1650</span></a>
</span><span id="NucleiFinder-1651"><a href="#NucleiFinder-1651"><span class="linenos">1651</span></a>        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">skimage</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">model_out</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">image</span><span class="p">):</span>
</span><span id="NucleiFinder-1652"><a href="#NucleiFinder-1652"><span class="linenos">1652</span></a>
</span><span id="NucleiFinder-1653"><a href="#NucleiFinder-1653"><span class="linenos">1653</span></a>            <span class="c1"># Compute circularity</span>
</span><span id="NucleiFinder-1654"><a href="#NucleiFinder-1654"><span class="linenos">1654</span></a>            <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">perimeter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-1655"><a href="#NucleiFinder-1655"><span class="linenos">1655</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">region</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="NucleiFinder-1656"><a href="#NucleiFinder-1656"><span class="linenos">1656</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1657"><a href="#NucleiFinder-1657"><span class="linenos">1657</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder-1658"><a href="#NucleiFinder-1658"><span class="linenos">1658</span></a>
</span><span id="NucleiFinder-1659"><a href="#NucleiFinder-1659"><span class="linenos">1659</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="NucleiFinder-1660"><a href="#NucleiFinder-1660"><span class="linenos">1660</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder-1661"><a href="#NucleiFinder-1661"><span class="linenos">1661</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder-1662"><a href="#NucleiFinder-1662"><span class="linenos">1662</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder-1663"><a href="#NucleiFinder-1663"><span class="linenos">1663</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span><span class="p">)</span>
</span><span id="NucleiFinder-1664"><a href="#NucleiFinder-1664"><span class="linenos">1664</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span><span class="p">)</span>
</span><span id="NucleiFinder-1665"><a href="#NucleiFinder-1665"><span class="linenos">1665</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder-1666"><a href="#NucleiFinder-1666"><span class="linenos">1666</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span><span class="p">)</span>
</span><span id="NucleiFinder-1667"><a href="#NucleiFinder-1667"><span class="linenos">1667</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span><span class="p">)</span>
</span><span id="NucleiFinder-1668"><a href="#NucleiFinder-1668"><span class="linenos">1668</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="NucleiFinder-1669"><a href="#NucleiFinder-1669"><span class="linenos">1669</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder-1670"><a href="#NucleiFinder-1670"><span class="linenos">1670</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span><span class="p">)</span>
</span><span id="NucleiFinder-1671"><a href="#NucleiFinder-1671"><span class="linenos">1671</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="NucleiFinder-1672"><a href="#NucleiFinder-1672"><span class="linenos">1672</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="NucleiFinder-1673"><a href="#NucleiFinder-1673"><span class="linenos">1673</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circularity</span><span class="p">)</span>
</span><span id="NucleiFinder-1674"><a href="#NucleiFinder-1674"><span class="linenos">1674</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_max</span><span class="p">))</span>
</span><span id="NucleiFinder-1675"><a href="#NucleiFinder-1675"><span class="linenos">1675</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_min</span><span class="p">))</span>
</span><span id="NucleiFinder-1676"><a href="#NucleiFinder-1676"><span class="linenos">1676</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_mean</span><span class="p">))</span>
</span><span id="NucleiFinder-1677"><a href="#NucleiFinder-1677"><span class="linenos">1677</span></a>
</span><span id="NucleiFinder-1678"><a href="#NucleiFinder-1678"><span class="linenos">1678</span></a>        <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-1679"><a href="#NucleiFinder-1679"><span class="linenos">1679</span></a>
</span><span id="NucleiFinder-1680"><a href="#NucleiFinder-1680"><span class="linenos">1680</span></a>        <span class="c1"># Calculate the ratio for each pair of values</span>
</span><span id="NucleiFinder-1681"><a href="#NucleiFinder-1681"><span class="linenos">1681</span></a>        <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="NucleiFinder-1682"><a href="#NucleiFinder-1682"><span class="linenos">1682</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-1683"><a href="#NucleiFinder-1683"><span class="linenos">1683</span></a>        <span class="p">):</span>
</span><span id="NucleiFinder-1684"><a href="#NucleiFinder-1684"><span class="linenos">1684</span></a>            <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-1685"><a href="#NucleiFinder-1685"><span class="linenos">1685</span></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="NucleiFinder-1686"><a href="#NucleiFinder-1686"><span class="linenos">1686</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="NucleiFinder-1687"><a href="#NucleiFinder-1687"><span class="linenos">1687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1688"><a href="#NucleiFinder-1688"><span class="linenos">1688</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="NucleiFinder-1689"><a href="#NucleiFinder-1689"><span class="linenos">1689</span></a>
</span><span id="NucleiFinder-1690"><a href="#NucleiFinder-1690"><span class="linenos">1690</span></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="NucleiFinder-1691"><a href="#NucleiFinder-1691"><span class="linenos">1691</span></a>
</span><span id="NucleiFinder-1692"><a href="#NucleiFinder-1692"><span class="linenos">1692</span></a>        <span class="k">return</span> <span class="n">features</span>
</span><span id="NucleiFinder-1693"><a href="#NucleiFinder-1693"><span class="linenos">1693</span></a>
</span><span id="NucleiFinder-1694"><a href="#NucleiFinder-1694"><span class="linenos">1694</span></a>    <span class="c1"># repaired stat</span>
</span><span id="NucleiFinder-1695"><a href="#NucleiFinder-1695"><span class="linenos">1695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_finder_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1696"><a href="#NucleiFinder-1696"><span class="linenos">1696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1697"><a href="#NucleiFinder-1697"><span class="linenos">1697</span></a><span class="sd">        This method performs testing analysis of parameters (specified &#39;nms&#39; and &#39;prob&#39; parameters)</span>
</span><span id="NucleiFinder-1698"><a href="#NucleiFinder-1698"><span class="linenos">1698</span></a><span class="sd">        for the image provided by the input_image() method.</span>
</span><span id="NucleiFinder-1699"><a href="#NucleiFinder-1699"><span class="linenos">1699</span></a>
</span><span id="NucleiFinder-1700"><a href="#NucleiFinder-1700"><span class="linenos">1700</span></a><span class="sd">        This method evaluates the performance of the internal NucleiFinder</span>
</span><span id="NucleiFinder-1701"><a href="#NucleiFinder-1701"><span class="linenos">1701</span></a><span class="sd">        configuration using the currently loaded images, parameters, or model</span>
</span><span id="NucleiFinder-1702"><a href="#NucleiFinder-1702"><span class="linenos">1702</span></a><span class="sd">        settings. It is typically used to check whether the detection, segmentation</span>
</span><span id="NucleiFinder-1703"><a href="#NucleiFinder-1703"><span class="linenos">1703</span></a><span class="sd">        or preprocessing stages run correctly on sample data.</span>
</span><span id="NucleiFinder-1704"><a href="#NucleiFinder-1704"><span class="linenos">1704</span></a>
</span><span id="NucleiFinder-1705"><a href="#NucleiFinder-1705"><span class="linenos">1705</span></a><span class="sd">        Examples</span>
</span><span id="NucleiFinder-1706"><a href="#NucleiFinder-1706"><span class="linenos">1706</span></a><span class="sd">        --------</span>
</span><span id="NucleiFinder-1707"><a href="#NucleiFinder-1707"><span class="linenos">1707</span></a><span class="sd">        &gt;&gt;&gt; nf.nuclei_finder_test()</span>
</span><span id="NucleiFinder-1708"><a href="#NucleiFinder-1708"><span class="linenos">1708</span></a><span class="sd">        &gt;&gt;&gt; nf.browser_test()</span>
</span><span id="NucleiFinder-1709"><a href="#NucleiFinder-1709"><span class="linenos">1709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1710"><a href="#NucleiFinder-1710"><span class="linenos">1710</span></a>
</span><span id="NucleiFinder-1711"><a href="#NucleiFinder-1711"><span class="linenos">1711</span></a>        <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">()</span>
</span><span id="NucleiFinder-1712"><a href="#NucleiFinder-1712"><span class="linenos">1712</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1713"><a href="#NucleiFinder-1713"><span class="linenos">1713</span></a>
</span><span id="NucleiFinder-1714"><a href="#NucleiFinder-1714"><span class="linenos">1714</span></a>        <span class="n">nmst</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
</span><span id="NucleiFinder-1715"><a href="#NucleiFinder-1715"><span class="linenos">1715</span></a>        <span class="n">probt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="NucleiFinder-1716"><a href="#NucleiFinder-1716"><span class="linenos">1716</span></a>
</span><span id="NucleiFinder-1717"><a href="#NucleiFinder-1717"><span class="linenos">1717</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-1718"><a href="#NucleiFinder-1718"><span class="linenos">1718</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-1719"><a href="#NucleiFinder-1719"><span class="linenos">1719</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-1720"><a href="#NucleiFinder-1720"><span class="linenos">1720</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-1721"><a href="#NucleiFinder-1721"><span class="linenos">1721</span></a>
</span><span id="NucleiFinder-1722"><a href="#NucleiFinder-1722"><span class="linenos">1722</span></a>        <span class="n">plot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-1723"><a href="#NucleiFinder-1723"><span class="linenos">1723</span></a>
</span><span id="NucleiFinder-1724"><a href="#NucleiFinder-1724"><span class="linenos">1724</span></a>        <span class="c1"># adj img</span>
</span><span id="NucleiFinder-1725"><a href="#NucleiFinder-1725"><span class="linenos">1725</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-1726"><a href="#NucleiFinder-1726"><span class="linenos">1726</span></a>            <span class="n">img</span><span class="p">,</span>
</span><span id="NucleiFinder-1727"><a href="#NucleiFinder-1727"><span class="linenos">1727</span></a>            <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1728"><a href="#NucleiFinder-1728"><span class="linenos">1728</span></a>            <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1729"><a href="#NucleiFinder-1729"><span class="linenos">1729</span></a>            <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1730"><a href="#NucleiFinder-1730"><span class="linenos">1730</span></a>        <span class="p">)</span>
</span><span id="NucleiFinder-1731"><a href="#NucleiFinder-1731"><span class="linenos">1731</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-1732"><a href="#NucleiFinder-1732"><span class="linenos">1732</span></a>
</span><span id="NucleiFinder-1733"><a href="#NucleiFinder-1733"><span class="linenos">1733</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="NucleiFinder-1734"><a href="#NucleiFinder-1734"><span class="linenos">1734</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="NucleiFinder-1735"><a href="#NucleiFinder-1735"><span class="linenos">1735</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1736"><a href="#NucleiFinder-1736"><span class="linenos">1736</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="NucleiFinder-1737"><a href="#NucleiFinder-1737"><span class="linenos">1737</span></a>
</span><span id="NucleiFinder-1738"><a href="#NucleiFinder-1738"><span class="linenos">1738</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1739"><a href="#NucleiFinder-1739"><span class="linenos">1739</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1740"><a href="#NucleiFinder-1740"><span class="linenos">1740</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="NucleiFinder-1741"><a href="#NucleiFinder-1741"><span class="linenos">1741</span></a>
</span><span id="NucleiFinder-1742"><a href="#NucleiFinder-1742"><span class="linenos">1742</span></a>        <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="NucleiFinder-1743"><a href="#NucleiFinder-1743"><span class="linenos">1743</span></a>
</span><span id="NucleiFinder-1744"><a href="#NucleiFinder-1744"><span class="linenos">1744</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nmst</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loop 1: nmst&quot;</span><span class="p">):</span>
</span><span id="NucleiFinder-1745"><a href="#NucleiFinder-1745"><span class="linenos">1745</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">➡️ Starting outer loop for n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1746"><a href="#NucleiFinder-1746"><span class="linenos">1746</span></a>
</span><span id="NucleiFinder-1747"><a href="#NucleiFinder-1747"><span class="linenos">1747</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">probt</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;   ↳ Loop 2 for n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiFinder-1748"><a href="#NucleiFinder-1748"><span class="linenos">1748</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   → Starting inner loop for t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1749"><a href="#NucleiFinder-1749"><span class="linenos">1749</span></a>
</span><span id="NucleiFinder-1750"><a href="#NucleiFinder-1750"><span class="linenos">1750</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="NucleiFinder-1751"><a href="#NucleiFinder-1751"><span class="linenos">1751</span></a>                    <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span> <span class="n">nms_thresh</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">prob_thresh</span><span class="o">=</span><span class="n">t</span>
</span><span id="NucleiFinder-1752"><a href="#NucleiFinder-1752"><span class="linenos">1752</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-1753"><a href="#NucleiFinder-1753"><span class="linenos">1753</span></a>
</span><span id="NucleiFinder-1754"><a href="#NucleiFinder-1754"><span class="linenos">1754</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
</span><span id="NucleiFinder-1755"><a href="#NucleiFinder-1755"><span class="linenos">1755</span></a>
</span><span id="NucleiFinder-1756"><a href="#NucleiFinder-1756"><span class="linenos">1756</span></a>                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="NucleiFinder-1757"><a href="#NucleiFinder-1757"><span class="linenos">1757</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">render_label</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">))</span>
</span><span id="NucleiFinder-1758"><a href="#NucleiFinder-1758"><span class="linenos">1758</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1759"><a href="#NucleiFinder-1759"><span class="linenos">1759</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="NucleiFinder-1760"><a href="#NucleiFinder-1760"><span class="linenos">1760</span></a>                    <span class="sa">f</span><span class="s2">&quot;nms </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> &amp; prob </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> detected nuc: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1761"><a href="#NucleiFinder-1761"><span class="linenos">1761</span></a>                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
</span><span id="NucleiFinder-1762"><a href="#NucleiFinder-1762"><span class="linenos">1762</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-1763"><a href="#NucleiFinder-1763"><span class="linenos">1763</span></a>
</span><span id="NucleiFinder-1764"><a href="#NucleiFinder-1764"><span class="linenos">1764</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1765"><a href="#NucleiFinder-1765"><span class="linenos">1765</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1766"><a href="#NucleiFinder-1766"><span class="linenos">1766</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="NucleiFinder-1767"><a href="#NucleiFinder-1767"><span class="linenos">1767</span></a>
</span><span id="NucleiFinder-1768"><a href="#NucleiFinder-1768"><span class="linenos">1768</span></a>                <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="NucleiFinder-1769"><a href="#NucleiFinder-1769"><span class="linenos">1769</span></a>
</span><span id="NucleiFinder-1770"><a href="#NucleiFinder-1770"><span class="linenos">1770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</span><span id="NucleiFinder-1771"><a href="#NucleiFinder-1771"><span class="linenos">1771</span></a>
</span><span id="NucleiFinder-1772"><a href="#NucleiFinder-1772"><span class="linenos">1772</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1773"><a href="#NucleiFinder-1773"><span class="linenos">1773</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1774"><a href="#NucleiFinder-1774"><span class="linenos">1774</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="NucleiFinder-1775"><a href="#NucleiFinder-1775"><span class="linenos">1775</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder-1776"><a href="#NucleiFinder-1776"><span class="linenos">1776</span></a>
</span><span id="NucleiFinder-1777"><a href="#NucleiFinder-1777"><span class="linenos">1777</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder-1778"><a href="#NucleiFinder-1778"><span class="linenos">1778</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder-1779"><a href="#NucleiFinder-1779"><span class="linenos">1779</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder-1780"><a href="#NucleiFinder-1780"><span class="linenos">1780</span></a>
</span><span id="NucleiFinder-1781"><a href="#NucleiFinder-1781"><span class="linenos">1781</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder-1782"><a href="#NucleiFinder-1782"><span class="linenos">1782</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder-1783"><a href="#NucleiFinder-1783"><span class="linenos">1783</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder-1784"><a href="#NucleiFinder-1784"><span class="linenos">1784</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder-1785"><a href="#NucleiFinder-1785"><span class="linenos">1785</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder-1786"><a href="#NucleiFinder-1786"><span class="linenos">1786</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder-1787"><a href="#NucleiFinder-1787"><span class="linenos">1787</span></a>
</span><span id="NucleiFinder-1788"><a href="#NucleiFinder-1788"><span class="linenos">1788</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder-1789"><a href="#NucleiFinder-1789"><span class="linenos">1789</span></a><span class="sd">            - ``get_results_nuclei()``</span>
</span><span id="NucleiFinder-1790"><a href="#NucleiFinder-1790"><span class="linenos">1790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1791"><a href="#NucleiFinder-1791"><span class="linenos">1791</span></a>
</span><span id="NucleiFinder-1792"><a href="#NucleiFinder-1792"><span class="linenos">1792</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="NucleiFinder-1793"><a href="#NucleiFinder-1793"><span class="linenos">1793</span></a>
</span><span id="NucleiFinder-1794"><a href="#NucleiFinder-1794"><span class="linenos">1794</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1795"><a href="#NucleiFinder-1795"><span class="linenos">1795</span></a>
</span><span id="NucleiFinder-1796"><a href="#NucleiFinder-1796"><span class="linenos">1796</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-1797"><a href="#NucleiFinder-1797"><span class="linenos">1797</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-1798"><a href="#NucleiFinder-1798"><span class="linenos">1798</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-1799"><a href="#NucleiFinder-1799"><span class="linenos">1799</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-1800"><a href="#NucleiFinder-1800"><span class="linenos">1800</span></a>
</span><span id="NucleiFinder-1801"><a href="#NucleiFinder-1801"><span class="linenos">1801</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-1802"><a href="#NucleiFinder-1802"><span class="linenos">1802</span></a>                <span class="n">img</span><span class="p">,</span>
</span><span id="NucleiFinder-1803"><a href="#NucleiFinder-1803"><span class="linenos">1803</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1804"><a href="#NucleiFinder-1804"><span class="linenos">1804</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1805"><a href="#NucleiFinder-1805"><span class="linenos">1805</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1806"><a href="#NucleiFinder-1806"><span class="linenos">1806</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1807"><a href="#NucleiFinder-1807"><span class="linenos">1807</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-1808"><a href="#NucleiFinder-1808"><span class="linenos">1808</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="NucleiFinder-1809"><a href="#NucleiFinder-1809"><span class="linenos">1809</span></a>                <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
</span><span id="NucleiFinder-1810"><a href="#NucleiFinder-1810"><span class="linenos">1810</span></a>                <span class="n">nms_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1811"><a href="#NucleiFinder-1811"><span class="linenos">1811</span></a>                <span class="n">prob_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1812"><a href="#NucleiFinder-1812"><span class="linenos">1812</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1813"><a href="#NucleiFinder-1813"><span class="linenos">1813</span></a>
</span><span id="NucleiFinder-1814"><a href="#NucleiFinder-1814"><span class="linenos">1814</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span>
</span><span id="NucleiFinder-1815"><a href="#NucleiFinder-1815"><span class="linenos">1815</span></a>                <span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span>
</span><span id="NucleiFinder-1816"><a href="#NucleiFinder-1816"><span class="linenos">1816</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1817"><a href="#NucleiFinder-1817"><span class="linenos">1817</span></a>
</span><span id="NucleiFinder-1818"><a href="#NucleiFinder-1818"><span class="linenos">1818</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-1819"><a href="#NucleiFinder-1819"><span class="linenos">1819</span></a>
</span><span id="NucleiFinder-1820"><a href="#NucleiFinder-1820"><span class="linenos">1820</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1821"><a href="#NucleiFinder-1821"><span class="linenos">1821</span></a>
</span><span id="NucleiFinder-1822"><a href="#NucleiFinder-1822"><span class="linenos">1822</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="NucleiFinder-1823"><a href="#NucleiFinder-1823"><span class="linenos">1823</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder-1824"><a href="#NucleiFinder-1824"><span class="linenos">1824</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder-1825"><a href="#NucleiFinder-1825"><span class="linenos">1825</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1826"><a href="#NucleiFinder-1826"><span class="linenos">1826</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-1827"><a href="#NucleiFinder-1827"><span class="linenos">1827</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-1828"><a href="#NucleiFinder-1828"><span class="linenos">1828</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="n">oryginal</span><span class="p">),</span>
</span><span id="NucleiFinder-1829"><a href="#NucleiFinder-1829"><span class="linenos">1829</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-1830"><a href="#NucleiFinder-1830"><span class="linenos">1830</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder-1831"><a href="#NucleiFinder-1831"><span class="linenos">1831</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1832"><a href="#NucleiFinder-1832"><span class="linenos">1832</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-1833"><a href="#NucleiFinder-1833"><span class="linenos">1833</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder-1834"><a href="#NucleiFinder-1834"><span class="linenos">1834</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder-1835"><a href="#NucleiFinder-1835"><span class="linenos">1835</span></a>
</span><span id="NucleiFinder-1836"><a href="#NucleiFinder-1836"><span class="linenos">1836</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1837"><a href="#NucleiFinder-1837"><span class="linenos">1837</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1838"><a href="#NucleiFinder-1838"><span class="linenos">1838</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder-1839"><a href="#NucleiFinder-1839"><span class="linenos">1839</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1840"><a href="#NucleiFinder-1840"><span class="linenos">1840</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder-1841"><a href="#NucleiFinder-1841"><span class="linenos">1841</span></a>
</span><span id="NucleiFinder-1842"><a href="#NucleiFinder-1842"><span class="linenos">1842</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1843"><a href="#NucleiFinder-1843"><span class="linenos">1843</span></a>
</span><span id="NucleiFinder-1844"><a href="#NucleiFinder-1844"><span class="linenos">1844</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1845"><a href="#NucleiFinder-1845"><span class="linenos">1845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1846"><a href="#NucleiFinder-1846"><span class="linenos">1846</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1847"><a href="#NucleiFinder-1847"><span class="linenos">1847</span></a>
</span><span id="NucleiFinder-1848"><a href="#NucleiFinder-1848"><span class="linenos">1848</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nuclei not detected!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1849"><a href="#NucleiFinder-1849"><span class="linenos">1849</span></a>
</span><span id="NucleiFinder-1850"><a href="#NucleiFinder-1850"><span class="linenos">1850</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1851"><a href="#NucleiFinder-1851"><span class="linenos">1851</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Add image firstly!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1852"><a href="#NucleiFinder-1852"><span class="linenos">1852</span></a>
</span><span id="NucleiFinder-1853"><a href="#NucleiFinder-1853"><span class="linenos">1853</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1854"><a href="#NucleiFinder-1854"><span class="linenos">1854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1855"><a href="#NucleiFinder-1855"><span class="linenos">1855</span></a><span class="sd">        Selects data obtained from ``find_nuclei()`` based on the set threshold parameters.</span>
</span><span id="NucleiFinder-1856"><a href="#NucleiFinder-1856"><span class="linenos">1856</span></a>
</span><span id="NucleiFinder-1857"><a href="#NucleiFinder-1857"><span class="linenos">1857</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder-1858"><a href="#NucleiFinder-1858"><span class="linenos">1858</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder-1859"><a href="#NucleiFinder-1859"><span class="linenos">1859</span></a>
</span><span id="NucleiFinder-1860"><a href="#NucleiFinder-1860"><span class="linenos">1860</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder-1861"><a href="#NucleiFinder-1861"><span class="linenos">1861</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder-1862"><a href="#NucleiFinder-1862"><span class="linenos">1862</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder-1863"><a href="#NucleiFinder-1863"><span class="linenos">1863</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder-1864"><a href="#NucleiFinder-1864"><span class="linenos">1864</span></a>
</span><span id="NucleiFinder-1865"><a href="#NucleiFinder-1865"><span class="linenos">1865</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder-1866"><a href="#NucleiFinder-1866"><span class="linenos">1866</span></a><span class="sd">            - ``get_results_nuclei_selected()``</span>
</span><span id="NucleiFinder-1867"><a href="#NucleiFinder-1867"><span class="linenos">1867</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1868"><a href="#NucleiFinder-1868"><span class="linenos">1868</span></a>
</span><span id="NucleiFinder-1869"><a href="#NucleiFinder-1869"><span class="linenos">1869</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-1870"><a href="#NucleiFinder-1870"><span class="linenos">1870</span></a>            <span class="n">input_in</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1871"><a href="#NucleiFinder-1871"><span class="linenos">1871</span></a>
</span><span id="NucleiFinder-1872"><a href="#NucleiFinder-1872"><span class="linenos">1872</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-1873"><a href="#NucleiFinder-1873"><span class="linenos">1873</span></a>                <span class="n">input_in</span><span class="p">,</span>
</span><span id="NucleiFinder-1874"><a href="#NucleiFinder-1874"><span class="linenos">1874</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1875"><a href="#NucleiFinder-1875"><span class="linenos">1875</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1876"><a href="#NucleiFinder-1876"><span class="linenos">1876</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1877"><a href="#NucleiFinder-1877"><span class="linenos">1877</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1878"><a href="#NucleiFinder-1878"><span class="linenos">1878</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-1879"><a href="#NucleiFinder-1879"><span class="linenos">1879</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="NucleiFinder-1880"><a href="#NucleiFinder-1880"><span class="linenos">1880</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1881"><a href="#NucleiFinder-1881"><span class="linenos">1881</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1882"><a href="#NucleiFinder-1882"><span class="linenos">1882</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1883"><a href="#NucleiFinder-1883"><span class="linenos">1883</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1884"><a href="#NucleiFinder-1884"><span class="linenos">1884</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-1885"><a href="#NucleiFinder-1885"><span class="linenos">1885</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="NucleiFinder-1886"><a href="#NucleiFinder-1886"><span class="linenos">1886</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1887"><a href="#NucleiFinder-1887"><span class="linenos">1887</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-1888"><a href="#NucleiFinder-1888"><span class="linenos">1888</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1889"><a href="#NucleiFinder-1889"><span class="linenos">1889</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-1890"><a href="#NucleiFinder-1890"><span class="linenos">1890</span></a>
</span><span id="NucleiFinder-1891"><a href="#NucleiFinder-1891"><span class="linenos">1891</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-1892"><a href="#NucleiFinder-1892"><span class="linenos">1892</span></a>
</span><span id="NucleiFinder-1893"><a href="#NucleiFinder-1893"><span class="linenos">1893</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="NucleiFinder-1894"><a href="#NucleiFinder-1894"><span class="linenos">1894</span></a>
</span><span id="NucleiFinder-1895"><a href="#NucleiFinder-1895"><span class="linenos">1895</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-1896"><a href="#NucleiFinder-1896"><span class="linenos">1896</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-1897"><a href="#NucleiFinder-1897"><span class="linenos">1897</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-1898"><a href="#NucleiFinder-1898"><span class="linenos">1898</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-1899"><a href="#NucleiFinder-1899"><span class="linenos">1899</span></a>
</span><span id="NucleiFinder-1900"><a href="#NucleiFinder-1900"><span class="linenos">1900</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1901"><a href="#NucleiFinder-1901"><span class="linenos">1901</span></a>
</span><span id="NucleiFinder-1902"><a href="#NucleiFinder-1902"><span class="linenos">1902</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="NucleiFinder-1903"><a href="#NucleiFinder-1903"><span class="linenos">1903</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder-1904"><a href="#NucleiFinder-1904"><span class="linenos">1904</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder-1905"><a href="#NucleiFinder-1905"><span class="linenos">1905</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1906"><a href="#NucleiFinder-1906"><span class="linenos">1906</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-1907"><a href="#NucleiFinder-1907"><span class="linenos">1907</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-1908"><a href="#NucleiFinder-1908"><span class="linenos">1908</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder-1909"><a href="#NucleiFinder-1909"><span class="linenos">1909</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder-1910"><a href="#NucleiFinder-1910"><span class="linenos">1910</span></a>                            <span class="p">),</span>
</span><span id="NucleiFinder-1911"><a href="#NucleiFinder-1911"><span class="linenos">1911</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-1912"><a href="#NucleiFinder-1912"><span class="linenos">1912</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder-1913"><a href="#NucleiFinder-1913"><span class="linenos">1913</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-1914"><a href="#NucleiFinder-1914"><span class="linenos">1914</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-1915"><a href="#NucleiFinder-1915"><span class="linenos">1915</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder-1916"><a href="#NucleiFinder-1916"><span class="linenos">1916</span></a>
</span><span id="NucleiFinder-1917"><a href="#NucleiFinder-1917"><span class="linenos">1917</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder-1918"><a href="#NucleiFinder-1918"><span class="linenos">1918</span></a>
</span><span id="NucleiFinder-1919"><a href="#NucleiFinder-1919"><span class="linenos">1919</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-1920"><a href="#NucleiFinder-1920"><span class="linenos">1920</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-1921"><a href="#NucleiFinder-1921"><span class="linenos">1921</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder-1922"><a href="#NucleiFinder-1922"><span class="linenos">1922</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1923"><a href="#NucleiFinder-1923"><span class="linenos">1923</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder-1924"><a href="#NucleiFinder-1924"><span class="linenos">1924</span></a>
</span><span id="NucleiFinder-1925"><a href="#NucleiFinder-1925"><span class="linenos">1925</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1926"><a href="#NucleiFinder-1926"><span class="linenos">1926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1927"><a href="#NucleiFinder-1927"><span class="linenos">1927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1928"><a href="#NucleiFinder-1928"><span class="linenos">1928</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-1929"><a href="#NucleiFinder-1929"><span class="linenos">1929</span></a>
</span><span id="NucleiFinder-1930"><a href="#NucleiFinder-1930"><span class="linenos">1930</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected zero nuclei! Analysis stop!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1931"><a href="#NucleiFinder-1931"><span class="linenos">1931</span></a>
</span><span id="NucleiFinder-1932"><a href="#NucleiFinder-1932"><span class="linenos">1932</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1933"><a href="#NucleiFinder-1933"><span class="linenos">1933</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-1934"><a href="#NucleiFinder-1934"><span class="linenos">1934</span></a>
</span><span id="NucleiFinder-1935"><a href="#NucleiFinder-1935"><span class="linenos">1935</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-1936"><a href="#NucleiFinder-1936"><span class="linenos">1936</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1937"><a href="#NucleiFinder-1937"><span class="linenos">1937</span></a><span class="sd">        Performs chromatinization analysis of nuclei using data obtained from</span>
</span><span id="NucleiFinder-1938"><a href="#NucleiFinder-1938"><span class="linenos">1938</span></a><span class="sd">        ``find_nuclei()`` and/or ``select_nuclei()``.</span>
</span><span id="NucleiFinder-1939"><a href="#NucleiFinder-1939"><span class="linenos">1939</span></a>
</span><span id="NucleiFinder-1940"><a href="#NucleiFinder-1940"><span class="linenos">1940</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder-1941"><a href="#NucleiFinder-1941"><span class="linenos">1941</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="NucleiFinder-1942"><a href="#NucleiFinder-1942"><span class="linenos">1942</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="NucleiFinder-1943"><a href="#NucleiFinder-1943"><span class="linenos">1943</span></a>
</span><span id="NucleiFinder-1944"><a href="#NucleiFinder-1944"><span class="linenos">1944</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder-1945"><a href="#NucleiFinder-1945"><span class="linenos">1945</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="NucleiFinder-1946"><a href="#NucleiFinder-1946"><span class="linenos">1946</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="NucleiFinder-1947"><a href="#NucleiFinder-1947"><span class="linenos">1947</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="NucleiFinder-1948"><a href="#NucleiFinder-1948"><span class="linenos">1948</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="NucleiFinder-1949"><a href="#NucleiFinder-1949"><span class="linenos">1949</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="NucleiFinder-1950"><a href="#NucleiFinder-1950"><span class="linenos">1950</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="NucleiFinder-1951"><a href="#NucleiFinder-1951"><span class="linenos">1951</span></a>
</span><span id="NucleiFinder-1952"><a href="#NucleiFinder-1952"><span class="linenos">1952</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder-1953"><a href="#NucleiFinder-1953"><span class="linenos">1953</span></a><span class="sd">            - ``get_results_nuclei_chromatinization()``</span>
</span><span id="NucleiFinder-1954"><a href="#NucleiFinder-1954"><span class="linenos">1954</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-1955"><a href="#NucleiFinder-1955"><span class="linenos">1955</span></a>
</span><span id="NucleiFinder-1956"><a href="#NucleiFinder-1956"><span class="linenos">1956</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_lists</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="NucleiFinder-1957"><a href="#NucleiFinder-1957"><span class="linenos">1957</span></a>
</span><span id="NucleiFinder-1958"><a href="#NucleiFinder-1958"><span class="linenos">1958</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-1959"><a href="#NucleiFinder-1959"><span class="linenos">1959</span></a>            <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="NucleiFinder-1960"><a href="#NucleiFinder-1960"><span class="linenos">1960</span></a>
</span><span id="NucleiFinder-1961"><a href="#NucleiFinder-1961"><span class="linenos">1961</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="NucleiFinder-1962"><a href="#NucleiFinder-1962"><span class="linenos">1962</span></a>                <span class="n">f_elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder-1963"><a href="#NucleiFinder-1963"><span class="linenos">1963</span></a>                <span class="n">g_elem</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder-1964"><a href="#NucleiFinder-1964"><span class="linenos">1964</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_elem</span> <span class="o">+</span> <span class="n">g_elem</span><span class="p">)</span>
</span><span id="NucleiFinder-1965"><a href="#NucleiFinder-1965"><span class="linenos">1965</span></a>
</span><span id="NucleiFinder-1966"><a href="#NucleiFinder-1966"><span class="linenos">1966</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="NucleiFinder-1967"><a href="#NucleiFinder-1967"><span class="linenos">1967</span></a>
</span><span id="NucleiFinder-1968"><a href="#NucleiFinder-1968"><span class="linenos">1968</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="NucleiFinder-1969"><a href="#NucleiFinder-1969"><span class="linenos">1969</span></a>
</span><span id="NucleiFinder-1970"><a href="#NucleiFinder-1970"><span class="linenos">1970</span></a>            <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="NucleiFinder-1971"><a href="#NucleiFinder-1971"><span class="linenos">1971</span></a>
</span><span id="NucleiFinder-1972"><a href="#NucleiFinder-1972"><span class="linenos">1972</span></a>            <span class="n">zero</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
</span><span id="NucleiFinder-1973"><a href="#NucleiFinder-1973"><span class="linenos">1973</span></a>
</span><span id="NucleiFinder-1974"><a href="#NucleiFinder-1974"><span class="linenos">1974</span></a>            <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="NucleiFinder-1975"><a href="#NucleiFinder-1975"><span class="linenos">1975</span></a>
</span><span id="NucleiFinder-1976"><a href="#NucleiFinder-1976"><span class="linenos">1976</span></a>            <span class="k">return</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-1977"><a href="#NucleiFinder-1977"><span class="linenos">1977</span></a>
</span><span id="NucleiFinder-1978"><a href="#NucleiFinder-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="NucleiFinder-1979"><a href="#NucleiFinder-1979"><span class="linenos">1979</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-1980"><a href="#NucleiFinder-1980"><span class="linenos">1980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-1981"><a href="#NucleiFinder-1981"><span class="linenos">1981</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-1982"><a href="#NucleiFinder-1982"><span class="linenos">1982</span></a>
</span><span id="NucleiFinder-1983"><a href="#NucleiFinder-1983"><span class="linenos">1983</span></a>        <span class="k">if</span> <span class="n">nuclei_dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-1984"><a href="#NucleiFinder-1984"><span class="linenos">1984</span></a>            <span class="n">arrays_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-1985"><a href="#NucleiFinder-1985"><span class="linenos">1985</span></a>
</span><span id="NucleiFinder-1986"><a href="#NucleiFinder-1986"><span class="linenos">1986</span></a>            <span class="n">chromatione_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder-1987"><a href="#NucleiFinder-1987"><span class="linenos">1987</span></a>                <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1988"><a href="#NucleiFinder-1988"><span class="linenos">1988</span></a>                <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1989"><a href="#NucleiFinder-1989"><span class="linenos">1989</span></a>                <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1990"><a href="#NucleiFinder-1990"><span class="linenos">1990</span></a>                <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1991"><a href="#NucleiFinder-1991"><span class="linenos">1991</span></a>                <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1992"><a href="#NucleiFinder-1992"><span class="linenos">1992</span></a>                <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1993"><a href="#NucleiFinder-1993"><span class="linenos">1993</span></a>                <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1994"><a href="#NucleiFinder-1994"><span class="linenos">1994</span></a>                <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1995"><a href="#NucleiFinder-1995"><span class="linenos">1995</span></a>                <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1996"><a href="#NucleiFinder-1996"><span class="linenos">1996</span></a>                <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1997"><a href="#NucleiFinder-1997"><span class="linenos">1997</span></a>                <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1998"><a href="#NucleiFinder-1998"><span class="linenos">1998</span></a>                <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-1999"><a href="#NucleiFinder-1999"><span class="linenos">1999</span></a>                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2000"><a href="#NucleiFinder-2000"><span class="linenos">2000</span></a>            <span class="p">}</span>
</span><span id="NucleiFinder-2001"><a href="#NucleiFinder-2001"><span class="linenos">2001</span></a>
</span><span id="NucleiFinder-2002"><a href="#NucleiFinder-2002"><span class="linenos">2002</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="NucleiFinder-2003"><a href="#NucleiFinder-2003"><span class="linenos">2003</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">full_im</span><span class="p">)</span>
</span><span id="NucleiFinder-2004"><a href="#NucleiFinder-2004"><span class="linenos">2004</span></a>
</span><span id="NucleiFinder-2005"><a href="#NucleiFinder-2005"><span class="linenos">2005</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="NucleiFinder-2006"><a href="#NucleiFinder-2006"><span class="linenos">2006</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="NucleiFinder-2007"><a href="#NucleiFinder-2007"><span class="linenos">2007</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder-2008"><a href="#NucleiFinder-2008"><span class="linenos">2008</span></a>
</span><span id="NucleiFinder-2009"><a href="#NucleiFinder-2009"><span class="linenos">2009</span></a>                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">reverse_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="NucleiFinder-2010"><a href="#NucleiFinder-2010"><span class="linenos">2010</span></a>
</span><span id="NucleiFinder-2011"><a href="#NucleiFinder-2011"><span class="linenos">2011</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="NucleiFinder-2012"><a href="#NucleiFinder-2012"><span class="linenos">2012</span></a>
</span><span id="NucleiFinder-2013"><a href="#NucleiFinder-2013"><span class="linenos">2013</span></a>                <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2014"><a href="#NucleiFinder-2014"><span class="linenos">2014</span></a>
</span><span id="NucleiFinder-2015"><a href="#NucleiFinder-2015"><span class="linenos">2015</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">regions_chro2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2016"><a href="#NucleiFinder-2016"><span class="linenos">2016</span></a>
</span><span id="NucleiFinder-2017"><a href="#NucleiFinder-2017"><span class="linenos">2017</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-2018"><a href="#NucleiFinder-2018"><span class="linenos">2018</span></a>                    <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2019"><a href="#NucleiFinder-2019"><span class="linenos">2019</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-2020"><a href="#NucleiFinder-2020"><span class="linenos">2020</span></a>                    <span class="k">pass</span>
</span><span id="NucleiFinder-2021"><a href="#NucleiFinder-2021"><span class="linenos">2021</span></a>
</span><span id="NucleiFinder-2022"><a href="#NucleiFinder-2022"><span class="linenos">2022</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2023"><a href="#NucleiFinder-2023"><span class="linenos">2023</span></a>                    <span class="n">regions_chro2</span><span class="p">,</span>
</span><span id="NucleiFinder-2024"><a href="#NucleiFinder-2024"><span class="linenos">2024</span></a>                    <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2025"><a href="#NucleiFinder-2025"><span class="linenos">2025</span></a>                    <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2026"><a href="#NucleiFinder-2026"><span class="linenos">2026</span></a>                    <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2027"><a href="#NucleiFinder-2027"><span class="linenos">2027</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2028"><a href="#NucleiFinder-2028"><span class="linenos">2028</span></a>
</span><span id="NucleiFinder-2029"><a href="#NucleiFinder-2029"><span class="linenos">2029</span></a>                <span class="n">full_im</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="NucleiFinder-2030"><a href="#NucleiFinder-2030"><span class="linenos">2030</span></a>                    <span class="n">image_list</span><span class="o">=</span><span class="p">[</span><span class="n">full_im</span><span class="p">,</span> <span class="n">regions_chro2</span><span class="p">],</span> <span class="n">intensity_factors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-2031"><a href="#NucleiFinder-2031"><span class="linenos">2031</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2032"><a href="#NucleiFinder-2032"><span class="linenos">2032</span></a>
</span><span id="NucleiFinder-2033"><a href="#NucleiFinder-2033"><span class="linenos">2033</span></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
</span><span id="NucleiFinder-2034"><a href="#NucleiFinder-2034"><span class="linenos">2034</span></a>                    <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
</span><span id="NucleiFinder-2035"><a href="#NucleiFinder-2035"><span class="linenos">2035</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder-2036"><a href="#NucleiFinder-2036"><span class="linenos">2036</span></a>                    <span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="NucleiFinder-2037"><a href="#NucleiFinder-2037"><span class="linenos">2037</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
</span><span id="NucleiFinder-2038"><a href="#NucleiFinder-2038"><span class="linenos">2038</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2039"><a href="#NucleiFinder-2039"><span class="linenos">2039</span></a>
</span><span id="NucleiFinder-2040"><a href="#NucleiFinder-2040"><span class="linenos">2040</span></a>                <span class="n">regions_chro2</span><span class="p">[</span>
</span><span id="NucleiFinder-2041"><a href="#NucleiFinder-2041"><span class="linenos">2041</span></a>                    <span class="n">regions_chro2</span>
</span><span id="NucleiFinder-2042"><a href="#NucleiFinder-2042"><span class="linenos">2042</span></a>                    <span class="o">&lt;=</span> <span class="n">ret</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-2043"><a href="#NucleiFinder-2043"><span class="linenos">2043</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2044"><a href="#NucleiFinder-2044"><span class="linenos">2044</span></a>
</span><span id="NucleiFinder-2045"><a href="#NucleiFinder-2045"><span class="linenos">2045</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2046"><a href="#NucleiFinder-2046"><span class="linenos">2046</span></a>
</span><span id="NucleiFinder-2047"><a href="#NucleiFinder-2047"><span class="linenos">2047</span></a>                <span class="n">chromatione</span> <span class="o">=</span> <span class="n">regions_chro2</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2048"><a href="#NucleiFinder-2048"><span class="linenos">2048</span></a>
</span><span id="NucleiFinder-2049"><a href="#NucleiFinder-2049"><span class="linenos">2049</span></a>                <span class="n">labeled_cells</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">chromatione</span><span class="p">)</span>
</span><span id="NucleiFinder-2050"><a href="#NucleiFinder-2050"><span class="linenos">2050</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_cells</span><span class="p">)</span>
</span><span id="NucleiFinder-2051"><a href="#NucleiFinder-2051"><span class="linenos">2051</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span>
</span><span id="NucleiFinder-2052"><a href="#NucleiFinder-2052"><span class="linenos">2052</span></a>                    <span class="n">labeled_cells</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">regions_chro2</span>
</span><span id="NucleiFinder-2053"><a href="#NucleiFinder-2053"><span class="linenos">2053</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2054"><a href="#NucleiFinder-2054"><span class="linenos">2054</span></a>
</span><span id="NucleiFinder-2055"><a href="#NucleiFinder-2055"><span class="linenos">2055</span></a>                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
</span><span id="NucleiFinder-2056"><a href="#NucleiFinder-2056"><span class="linenos">2056</span></a>
</span><span id="NucleiFinder-2057"><a href="#NucleiFinder-2057"><span class="linenos">2057</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="NucleiFinder-2058"><a href="#NucleiFinder-2058"><span class="linenos">2058</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder-2059"><a href="#NucleiFinder-2059"><span class="linenos">2059</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder-2060"><a href="#NucleiFinder-2060"><span class="linenos">2060</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder-2061"><a href="#NucleiFinder-2061"><span class="linenos">2061</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2062"><a href="#NucleiFinder-2062"><span class="linenos">2062</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span>
</span><span id="NucleiFinder-2063"><a href="#NucleiFinder-2063"><span class="linenos">2063</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2064"><a href="#NucleiFinder-2064"><span class="linenos">2064</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2065"><a href="#NucleiFinder-2065"><span class="linenos">2065</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span>
</span><span id="NucleiFinder-2066"><a href="#NucleiFinder-2066"><span class="linenos">2066</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2067"><a href="#NucleiFinder-2067"><span class="linenos">2067</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder-2068"><a href="#NucleiFinder-2068"><span class="linenos">2068</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2069"><a href="#NucleiFinder-2069"><span class="linenos">2069</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span>
</span><span id="NucleiFinder-2070"><a href="#NucleiFinder-2070"><span class="linenos">2070</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2071"><a href="#NucleiFinder-2071"><span class="linenos">2071</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2072"><a href="#NucleiFinder-2072"><span class="linenos">2072</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span>
</span><span id="NucleiFinder-2073"><a href="#NucleiFinder-2073"><span class="linenos">2073</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2074"><a href="#NucleiFinder-2074"><span class="linenos">2074</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="NucleiFinder-2075"><a href="#NucleiFinder-2075"><span class="linenos">2075</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder-2076"><a href="#NucleiFinder-2076"><span class="linenos">2076</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2077"><a href="#NucleiFinder-2077"><span class="linenos">2077</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span>
</span><span id="NucleiFinder-2078"><a href="#NucleiFinder-2078"><span class="linenos">2078</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2079"><a href="#NucleiFinder-2079"><span class="linenos">2079</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="NucleiFinder-2080"><a href="#NucleiFinder-2080"><span class="linenos">2080</span></a>
</span><span id="NucleiFinder-2081"><a href="#NucleiFinder-2081"><span class="linenos">2081</span></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2082"><a href="#NucleiFinder-2082"><span class="linenos">2082</span></a>
</span><span id="NucleiFinder-2083"><a href="#NucleiFinder-2083"><span class="linenos">2083</span></a>            <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="NucleiFinder-2084"><a href="#NucleiFinder-2084"><span class="linenos">2084</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2085"><a href="#NucleiFinder-2085"><span class="linenos">2085</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2086"><a href="#NucleiFinder-2086"><span class="linenos">2086</span></a>            <span class="p">):</span>
</span><span id="NucleiFinder-2087"><a href="#NucleiFinder-2087"><span class="linenos">2087</span></a>                <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2088"><a href="#NucleiFinder-2088"><span class="linenos">2088</span></a>                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="NucleiFinder-2089"><a href="#NucleiFinder-2089"><span class="linenos">2089</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="NucleiFinder-2090"><a href="#NucleiFinder-2090"><span class="linenos">2090</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2091"><a href="#NucleiFinder-2091"><span class="linenos">2091</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="NucleiFinder-2092"><a href="#NucleiFinder-2092"><span class="linenos">2092</span></a>
</span><span id="NucleiFinder-2093"><a href="#NucleiFinder-2093"><span class="linenos">2093</span></a>            <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="NucleiFinder-2094"><a href="#NucleiFinder-2094"><span class="linenos">2094</span></a>
</span><span id="NucleiFinder-2095"><a href="#NucleiFinder-2095"><span class="linenos">2095</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2096"><a href="#NucleiFinder-2096"><span class="linenos">2096</span></a>                <span class="n">chromatione_info</span><span class="p">,</span>
</span><span id="NucleiFinder-2097"><a href="#NucleiFinder-2097"><span class="linenos">2097</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2098"><a href="#NucleiFinder-2098"><span class="linenos">2098</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2099"><a href="#NucleiFinder-2099"><span class="linenos">2099</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2100"><a href="#NucleiFinder-2100"><span class="linenos">2100</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2101"><a href="#NucleiFinder-2101"><span class="linenos">2101</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2102"><a href="#NucleiFinder-2102"><span class="linenos">2102</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder-2103"><a href="#NucleiFinder-2103"><span class="linenos">2103</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2104"><a href="#NucleiFinder-2104"><span class="linenos">2104</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2105"><a href="#NucleiFinder-2105"><span class="linenos">2105</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2106"><a href="#NucleiFinder-2106"><span class="linenos">2106</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2107"><a href="#NucleiFinder-2107"><span class="linenos">2107</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2108"><a href="#NucleiFinder-2108"><span class="linenos">2108</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder-2109"><a href="#NucleiFinder-2109"><span class="linenos">2109</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2110"><a href="#NucleiFinder-2110"><span class="linenos">2110</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2111"><a href="#NucleiFinder-2111"><span class="linenos">2111</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2112"><a href="#NucleiFinder-2112"><span class="linenos">2112</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2113"><a href="#NucleiFinder-2113"><span class="linenos">2113</span></a>
</span><span id="NucleiFinder-2114"><a href="#NucleiFinder-2114"><span class="linenos">2114</span></a>            <span class="n">arrays_list2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2115"><a href="#NucleiFinder-2115"><span class="linenos">2115</span></a>
</span><span id="NucleiFinder-2116"><a href="#NucleiFinder-2116"><span class="linenos">2116</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2117"><a href="#NucleiFinder-2117"><span class="linenos">2117</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2118"><a href="#NucleiFinder-2118"><span class="linenos">2118</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2119"><a href="#NucleiFinder-2119"><span class="linenos">2119</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2120"><a href="#NucleiFinder-2120"><span class="linenos">2120</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2121"><a href="#NucleiFinder-2121"><span class="linenos">2121</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2122"><a href="#NucleiFinder-2122"><span class="linenos">2122</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2123"><a href="#NucleiFinder-2123"><span class="linenos">2123</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2124"><a href="#NucleiFinder-2124"><span class="linenos">2124</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2125"><a href="#NucleiFinder-2125"><span class="linenos">2125</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2126"><a href="#NucleiFinder-2126"><span class="linenos">2126</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2127"><a href="#NucleiFinder-2127"><span class="linenos">2127</span></a>
</span><span id="NucleiFinder-2128"><a href="#NucleiFinder-2128"><span class="linenos">2128</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">):</span>
</span><span id="NucleiFinder-2129"><a href="#NucleiFinder-2129"><span class="linenos">2129</span></a>
</span><span id="NucleiFinder-2130"><a href="#NucleiFinder-2130"><span class="linenos">2130</span></a>                <span class="n">spot_size_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2131"><a href="#NucleiFinder-2131"><span class="linenos">2131</span></a>                <span class="n">spot_size_area_bbox</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2132"><a href="#NucleiFinder-2132"><span class="linenos">2132</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2133"><a href="#NucleiFinder-2133"><span class="linenos">2133</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2134"><a href="#NucleiFinder-2134"><span class="linenos">2134</span></a>                <span class="n">spot_size_area_filled</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2135"><a href="#NucleiFinder-2135"><span class="linenos">2135</span></a>                <span class="n">spot_axis_major_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2136"><a href="#NucleiFinder-2136"><span class="linenos">2136</span></a>                <span class="n">spot_axis_minor_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2137"><a href="#NucleiFinder-2137"><span class="linenos">2137</span></a>                <span class="n">spot_eccentricity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2138"><a href="#NucleiFinder-2138"><span class="linenos">2138</span></a>                <span class="n">spot_size_equivalent_diameter_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2139"><a href="#NucleiFinder-2139"><span class="linenos">2139</span></a>                <span class="n">spot_feret_diameter_max</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2140"><a href="#NucleiFinder-2140"><span class="linenos">2140</span></a>                <span class="n">spot_perimeter</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2141"><a href="#NucleiFinder-2141"><span class="linenos">2141</span></a>                <span class="n">spot_perimeter_crofton</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2142"><a href="#NucleiFinder-2142"><span class="linenos">2142</span></a>
</span><span id="NucleiFinder-2143"><a href="#NucleiFinder-2143"><span class="linenos">2143</span></a>                <span class="c1"># Flatten the array,</span>
</span><span id="NucleiFinder-2144"><a href="#NucleiFinder-2144"><span class="linenos">2144</span></a>                <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="NucleiFinder-2145"><a href="#NucleiFinder-2145"><span class="linenos">2145</span></a>                <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder-2146"><a href="#NucleiFinder-2146"><span class="linenos">2146</span></a>                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder-2147"><a href="#NucleiFinder-2147"><span class="linenos">2147</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2148"><a href="#NucleiFinder-2148"><span class="linenos">2148</span></a>
</span><span id="NucleiFinder-2149"><a href="#NucleiFinder-2149"><span class="linenos">2149</span></a>                <span class="n">counter_tmp</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2150"><a href="#NucleiFinder-2150"><span class="linenos">2150</span></a>
</span><span id="NucleiFinder-2151"><a href="#NucleiFinder-2151"><span class="linenos">2151</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list2</span><span class="p">):</span>
</span><span id="NucleiFinder-2152"><a href="#NucleiFinder-2152"><span class="linenos">2152</span></a>                    <span class="n">df_tmp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
</span><span id="NucleiFinder-2153"><a href="#NucleiFinder-2153"><span class="linenos">2153</span></a>                    <span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder-2154"><a href="#NucleiFinder-2154"><span class="linenos">2154</span></a>                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder-2155"><a href="#NucleiFinder-2155"><span class="linenos">2155</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2156"><a href="#NucleiFinder-2156"><span class="linenos">2156</span></a>
</span><span id="NucleiFinder-2157"><a href="#NucleiFinder-2157"><span class="linenos">2157</span></a>                    <span class="n">counter_tmp2</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2158"><a href="#NucleiFinder-2158"><span class="linenos">2158</span></a>                    <span class="n">intersection_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">counter_tmp2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="NucleiFinder-2159"><a href="#NucleiFinder-2159"><span class="linenos">2159</span></a>                    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp2</span><span class="p">))</span>
</span><span id="NucleiFinder-2160"><a href="#NucleiFinder-2160"><span class="linenos">2160</span></a>
</span><span id="NucleiFinder-2161"><a href="#NucleiFinder-2161"><span class="linenos">2161</span></a>                    <span class="k">if</span> <span class="n">intersection_length</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="NucleiFinder-2162"><a href="#NucleiFinder-2162"><span class="linenos">2162</span></a>
</span><span id="NucleiFinder-2163"><a href="#NucleiFinder-2163"><span class="linenos">2163</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="NucleiFinder-2164"><a href="#NucleiFinder-2164"><span class="linenos">2164</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2165"><a href="#NucleiFinder-2165"><span class="linenos">2165</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2166"><a href="#NucleiFinder-2166"><span class="linenos">2166</span></a>                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="NucleiFinder-2167"><a href="#NucleiFinder-2167"><span class="linenos">2167</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2168"><a href="#NucleiFinder-2168"><span class="linenos">2168</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2169"><a href="#NucleiFinder-2169"><span class="linenos">2169</span></a>                        <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="NucleiFinder-2170"><a href="#NucleiFinder-2170"><span class="linenos">2170</span></a>                            <span class="n">spot_size_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2171"><a href="#NucleiFinder-2171"><span class="linenos">2171</span></a>                            <span class="n">spot_size_area_bbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2172"><a href="#NucleiFinder-2172"><span class="linenos">2172</span></a>                            <span class="n">spot_size_area_convex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2173"><a href="#NucleiFinder-2173"><span class="linenos">2173</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2174"><a href="#NucleiFinder-2174"><span class="linenos">2174</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2175"><a href="#NucleiFinder-2175"><span class="linenos">2175</span></a>                            <span class="n">spot_size_area_filled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2176"><a href="#NucleiFinder-2176"><span class="linenos">2176</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2177"><a href="#NucleiFinder-2177"><span class="linenos">2177</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2178"><a href="#NucleiFinder-2178"><span class="linenos">2178</span></a>                            <span class="n">spot_axis_major_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2179"><a href="#NucleiFinder-2179"><span class="linenos">2179</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2180"><a href="#NucleiFinder-2180"><span class="linenos">2180</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2181"><a href="#NucleiFinder-2181"><span class="linenos">2181</span></a>                            <span class="n">spot_axis_minor_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2182"><a href="#NucleiFinder-2182"><span class="linenos">2182</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2183"><a href="#NucleiFinder-2183"><span class="linenos">2183</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2184"><a href="#NucleiFinder-2184"><span class="linenos">2184</span></a>                            <span class="n">spot_eccentricity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2185"><a href="#NucleiFinder-2185"><span class="linenos">2185</span></a>                            <span class="n">spot_size_equivalent_diameter_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2186"><a href="#NucleiFinder-2186"><span class="linenos">2186</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2187"><a href="#NucleiFinder-2187"><span class="linenos">2187</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2188"><a href="#NucleiFinder-2188"><span class="linenos">2188</span></a>                            <span class="n">spot_feret_diameter_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2189"><a href="#NucleiFinder-2189"><span class="linenos">2189</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2190"><a href="#NucleiFinder-2190"><span class="linenos">2190</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2191"><a href="#NucleiFinder-2191"><span class="linenos">2191</span></a>                            <span class="n">spot_perimeter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2192"><a href="#NucleiFinder-2192"><span class="linenos">2192</span></a>                            <span class="n">spot_perimeter_crofton</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2193"><a href="#NucleiFinder-2193"><span class="linenos">2193</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2194"><a href="#NucleiFinder-2194"><span class="linenos">2194</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2195"><a href="#NucleiFinder-2195"><span class="linenos">2195</span></a>
</span><span id="NucleiFinder-2196"><a href="#NucleiFinder-2196"><span class="linenos">2196</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area</span><span class="p">)</span>
</span><span id="NucleiFinder-2197"><a href="#NucleiFinder-2197"><span class="linenos">2197</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder-2198"><a href="#NucleiFinder-2198"><span class="linenos">2198</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder-2199"><a href="#NucleiFinder-2199"><span class="linenos">2199</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder-2200"><a href="#NucleiFinder-2200"><span class="linenos">2200</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2201"><a href="#NucleiFinder-2201"><span class="linenos">2201</span></a>                    <span class="n">spot_axis_major_length</span>
</span><span id="NucleiFinder-2202"><a href="#NucleiFinder-2202"><span class="linenos">2202</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2203"><a href="#NucleiFinder-2203"><span class="linenos">2203</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2204"><a href="#NucleiFinder-2204"><span class="linenos">2204</span></a>                    <span class="n">spot_axis_minor_length</span>
</span><span id="NucleiFinder-2205"><a href="#NucleiFinder-2205"><span class="linenos">2205</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2206"><a href="#NucleiFinder-2206"><span class="linenos">2206</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder-2207"><a href="#NucleiFinder-2207"><span class="linenos">2207</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2208"><a href="#NucleiFinder-2208"><span class="linenos">2208</span></a>                    <span class="n">spot_size_equivalent_diameter_area</span>
</span><span id="NucleiFinder-2209"><a href="#NucleiFinder-2209"><span class="linenos">2209</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2210"><a href="#NucleiFinder-2210"><span class="linenos">2210</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2211"><a href="#NucleiFinder-2211"><span class="linenos">2211</span></a>                    <span class="n">spot_feret_diameter_max</span>
</span><span id="NucleiFinder-2212"><a href="#NucleiFinder-2212"><span class="linenos">2212</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2213"><a href="#NucleiFinder-2213"><span class="linenos">2213</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder-2214"><a href="#NucleiFinder-2214"><span class="linenos">2214</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2215"><a href="#NucleiFinder-2215"><span class="linenos">2215</span></a>                    <span class="n">spot_perimeter_crofton</span>
</span><span id="NucleiFinder-2216"><a href="#NucleiFinder-2216"><span class="linenos">2216</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2217"><a href="#NucleiFinder-2217"><span class="linenos">2217</span></a>
</span><span id="NucleiFinder-2218"><a href="#NucleiFinder-2218"><span class="linenos">2218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromation_dic</span>
</span><span id="NucleiFinder-2219"><a href="#NucleiFinder-2219"><span class="linenos">2219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="NucleiFinder-2220"><a href="#NucleiFinder-2220"><span class="linenos">2220</span></a>
</span><span id="NucleiFinder-2221"><a href="#NucleiFinder-2221"><span class="linenos">2221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder-2222"><a href="#NucleiFinder-2222"><span class="linenos">2222</span></a>                <span class="n">chromation_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-2223"><a href="#NucleiFinder-2223"><span class="linenos">2223</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2224"><a href="#NucleiFinder-2224"><span class="linenos">2224</span></a>
</span><span id="NucleiFinder-2225"><a href="#NucleiFinder-2225"><span class="linenos">2225</span></a>            <span class="n">img_chrom</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2226"><a href="#NucleiFinder-2226"><span class="linenos">2226</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-2227"><a href="#NucleiFinder-2227"><span class="linenos">2227</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder-2228"><a href="#NucleiFinder-2228"><span class="linenos">2228</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-2229"><a href="#NucleiFinder-2229"><span class="linenos">2229</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder-2230"><a href="#NucleiFinder-2230"><span class="linenos">2230</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-2231"><a href="#NucleiFinder-2231"><span class="linenos">2231</span></a>                <span class="p">),</span>
</span><span id="NucleiFinder-2232"><a href="#NucleiFinder-2232"><span class="linenos">2232</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2233"><a href="#NucleiFinder-2233"><span class="linenos">2233</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2234"><a href="#NucleiFinder-2234"><span class="linenos">2234</span></a>
</span><span id="NucleiFinder-2235"><a href="#NucleiFinder-2235"><span class="linenos">2235</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="NucleiFinder-2236"><a href="#NucleiFinder-2236"><span class="linenos">2236</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2237"><a href="#NucleiFinder-2237"><span class="linenos">2237</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-2238"><a href="#NucleiFinder-2238"><span class="linenos">2238</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder-2239"><a href="#NucleiFinder-2239"><span class="linenos">2239</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder-2240"><a href="#NucleiFinder-2240"><span class="linenos">2240</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder-2241"><a href="#NucleiFinder-2241"><span class="linenos">2241</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-2242"><a href="#NucleiFinder-2242"><span class="linenos">2242</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder-2243"><a href="#NucleiFinder-2243"><span class="linenos">2243</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2244"><a href="#NucleiFinder-2244"><span class="linenos">2244</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2245"><a href="#NucleiFinder-2245"><span class="linenos">2245</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2246"><a href="#NucleiFinder-2246"><span class="linenos">2246</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2247"><a href="#NucleiFinder-2247"><span class="linenos">2247</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-2248"><a href="#NucleiFinder-2248"><span class="linenos">2248</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
</span><span id="NucleiFinder-2249"><a href="#NucleiFinder-2249"><span class="linenos">2249</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-2250"><a href="#NucleiFinder-2250"><span class="linenos">2250</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder-2251"><a href="#NucleiFinder-2251"><span class="linenos">2251</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2252"><a href="#NucleiFinder-2252"><span class="linenos">2252</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2253"><a href="#NucleiFinder-2253"><span class="linenos">2253</span></a>
</span><span id="NucleiFinder-2254"><a href="#NucleiFinder-2254"><span class="linenos">2254</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">([</span><span class="n">nuclei_mask</span><span class="p">,</span> <span class="n">img_chrom</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder-2255"><a href="#NucleiFinder-2255"><span class="linenos">2255</span></a>
</span><span id="NucleiFinder-2256"><a href="#NucleiFinder-2256"><span class="linenos">2256</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-2257"><a href="#NucleiFinder-2257"><span class="linenos">2257</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">full_im</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2258"><a href="#NucleiFinder-2258"><span class="linenos">2258</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-2259"><a href="#NucleiFinder-2259"><span class="linenos">2259</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">full_im</span>
</span><span id="NucleiFinder-2260"><a href="#NucleiFinder-2260"><span class="linenos">2260</span></a>
</span><span id="NucleiFinder-2261"><a href="#NucleiFinder-2261"><span class="linenos">2261</span></a>            <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2262"><a href="#NucleiFinder-2262"><span class="linenos">2262</span></a>
</span><span id="NucleiFinder-2263"><a href="#NucleiFinder-2263"><span class="linenos">2263</span></a>            <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder-2264"><a href="#NucleiFinder-2264"><span class="linenos">2264</span></a>
</span><span id="NucleiFinder-2265"><a href="#NucleiFinder-2265"><span class="linenos">2265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder-2266"><a href="#NucleiFinder-2266"><span class="linenos">2266</span></a>
</span><span id="NucleiFinder-2267"><a href="#NucleiFinder-2267"><span class="linenos">2267</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-2268"><a href="#NucleiFinder-2268"><span class="linenos">2268</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-2269"><a href="#NucleiFinder-2269"><span class="linenos">2269</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder-2270"><a href="#NucleiFinder-2270"><span class="linenos">2270</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span>
</span><span id="NucleiFinder-2271"><a href="#NucleiFinder-2271"><span class="linenos">2271</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-2272"><a href="#NucleiFinder-2272"><span class="linenos">2272</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder-2273"><a href="#NucleiFinder-2273"><span class="linenos">2273</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2274"><a href="#NucleiFinder-2274"><span class="linenos">2274</span></a>
</span><span id="NucleiFinder-2275"><a href="#NucleiFinder-2275"><span class="linenos">2275</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2276"><a href="#NucleiFinder-2276"><span class="linenos">2276</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2277"><a href="#NucleiFinder-2277"><span class="linenos">2277</span></a>
</span><span id="NucleiFinder-2278"><a href="#NucleiFinder-2278"><span class="linenos">2278</span></a>    <span class="c1"># separate function for chromatinization</span>
</span><span id="NucleiFinder-2279"><a href="#NucleiFinder-2279"><span class="linenos">2279</span></a>
</span><span id="NucleiFinder-2280"><a href="#NucleiFinder-2280"><span class="linenos">2280</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_nuclei_chromatinization_series</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">nuclei_data</span><span class="p">):</span>
</span><span id="NucleiFinder-2281"><a href="#NucleiFinder-2281"><span class="linenos">2281</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2282"><a href="#NucleiFinder-2282"><span class="linenos">2282</span></a><span class="sd">        Helper method for performing chromatinization analysis on nuclei detected in the provided image.</span>
</span><span id="NucleiFinder-2283"><a href="#NucleiFinder-2283"><span class="linenos">2283</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2284"><a href="#NucleiFinder-2284"><span class="linenos">2284</span></a>
</span><span id="NucleiFinder-2285"><a href="#NucleiFinder-2285"><span class="linenos">2285</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_lists</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="NucleiFinder-2286"><a href="#NucleiFinder-2286"><span class="linenos">2286</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2287"><a href="#NucleiFinder-2287"><span class="linenos">2287</span></a>            <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="NucleiFinder-2288"><a href="#NucleiFinder-2288"><span class="linenos">2288</span></a>
</span><span id="NucleiFinder-2289"><a href="#NucleiFinder-2289"><span class="linenos">2289</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="NucleiFinder-2290"><a href="#NucleiFinder-2290"><span class="linenos">2290</span></a>                <span class="n">f_elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder-2291"><a href="#NucleiFinder-2291"><span class="linenos">2291</span></a>                <span class="n">g_elem</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder-2292"><a href="#NucleiFinder-2292"><span class="linenos">2292</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_elem</span> <span class="o">+</span> <span class="n">g_elem</span><span class="p">)</span>
</span><span id="NucleiFinder-2293"><a href="#NucleiFinder-2293"><span class="linenos">2293</span></a>
</span><span id="NucleiFinder-2294"><a href="#NucleiFinder-2294"><span class="linenos">2294</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="NucleiFinder-2295"><a href="#NucleiFinder-2295"><span class="linenos">2295</span></a>
</span><span id="NucleiFinder-2296"><a href="#NucleiFinder-2296"><span class="linenos">2296</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="NucleiFinder-2297"><a href="#NucleiFinder-2297"><span class="linenos">2297</span></a>
</span><span id="NucleiFinder-2298"><a href="#NucleiFinder-2298"><span class="linenos">2298</span></a>            <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="NucleiFinder-2299"><a href="#NucleiFinder-2299"><span class="linenos">2299</span></a>
</span><span id="NucleiFinder-2300"><a href="#NucleiFinder-2300"><span class="linenos">2300</span></a>            <span class="n">zero</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
</span><span id="NucleiFinder-2301"><a href="#NucleiFinder-2301"><span class="linenos">2301</span></a>
</span><span id="NucleiFinder-2302"><a href="#NucleiFinder-2302"><span class="linenos">2302</span></a>            <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="NucleiFinder-2303"><a href="#NucleiFinder-2303"><span class="linenos">2303</span></a>
</span><span id="NucleiFinder-2304"><a href="#NucleiFinder-2304"><span class="linenos">2304</span></a>            <span class="k">return</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-2305"><a href="#NucleiFinder-2305"><span class="linenos">2305</span></a>
</span><span id="NucleiFinder-2306"><a href="#NucleiFinder-2306"><span class="linenos">2306</span></a>        <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="n">nuclei_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="NucleiFinder-2307"><a href="#NucleiFinder-2307"><span class="linenos">2307</span></a>
</span><span id="NucleiFinder-2308"><a href="#NucleiFinder-2308"><span class="linenos">2308</span></a>        <span class="k">if</span> <span class="n">nuclei_dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2309"><a href="#NucleiFinder-2309"><span class="linenos">2309</span></a>            <span class="n">arrays_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2310"><a href="#NucleiFinder-2310"><span class="linenos">2310</span></a>
</span><span id="NucleiFinder-2311"><a href="#NucleiFinder-2311"><span class="linenos">2311</span></a>            <span class="n">chromatione_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder-2312"><a href="#NucleiFinder-2312"><span class="linenos">2312</span></a>                <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2313"><a href="#NucleiFinder-2313"><span class="linenos">2313</span></a>                <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2314"><a href="#NucleiFinder-2314"><span class="linenos">2314</span></a>                <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2315"><a href="#NucleiFinder-2315"><span class="linenos">2315</span></a>                <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2316"><a href="#NucleiFinder-2316"><span class="linenos">2316</span></a>                <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2317"><a href="#NucleiFinder-2317"><span class="linenos">2317</span></a>                <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2318"><a href="#NucleiFinder-2318"><span class="linenos">2318</span></a>                <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2319"><a href="#NucleiFinder-2319"><span class="linenos">2319</span></a>                <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2320"><a href="#NucleiFinder-2320"><span class="linenos">2320</span></a>                <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2321"><a href="#NucleiFinder-2321"><span class="linenos">2321</span></a>                <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2322"><a href="#NucleiFinder-2322"><span class="linenos">2322</span></a>                <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2323"><a href="#NucleiFinder-2323"><span class="linenos">2323</span></a>                <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2324"><a href="#NucleiFinder-2324"><span class="linenos">2324</span></a>                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2325"><a href="#NucleiFinder-2325"><span class="linenos">2325</span></a>            <span class="p">}</span>
</span><span id="NucleiFinder-2326"><a href="#NucleiFinder-2326"><span class="linenos">2326</span></a>
</span><span id="NucleiFinder-2327"><a href="#NucleiFinder-2327"><span class="linenos">2327</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="NucleiFinder-2328"><a href="#NucleiFinder-2328"><span class="linenos">2328</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">full_im</span><span class="p">)</span>
</span><span id="NucleiFinder-2329"><a href="#NucleiFinder-2329"><span class="linenos">2329</span></a>
</span><span id="NucleiFinder-2330"><a href="#NucleiFinder-2330"><span class="linenos">2330</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="NucleiFinder-2331"><a href="#NucleiFinder-2331"><span class="linenos">2331</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="NucleiFinder-2332"><a href="#NucleiFinder-2332"><span class="linenos">2332</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder-2333"><a href="#NucleiFinder-2333"><span class="linenos">2333</span></a>
</span><span id="NucleiFinder-2334"><a href="#NucleiFinder-2334"><span class="linenos">2334</span></a>                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="NucleiFinder-2335"><a href="#NucleiFinder-2335"><span class="linenos">2335</span></a>
</span><span id="NucleiFinder-2336"><a href="#NucleiFinder-2336"><span class="linenos">2336</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="NucleiFinder-2337"><a href="#NucleiFinder-2337"><span class="linenos">2337</span></a>
</span><span id="NucleiFinder-2338"><a href="#NucleiFinder-2338"><span class="linenos">2338</span></a>                <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2339"><a href="#NucleiFinder-2339"><span class="linenos">2339</span></a>
</span><span id="NucleiFinder-2340"><a href="#NucleiFinder-2340"><span class="linenos">2340</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">regions_chro2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2341"><a href="#NucleiFinder-2341"><span class="linenos">2341</span></a>
</span><span id="NucleiFinder-2342"><a href="#NucleiFinder-2342"><span class="linenos">2342</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-2343"><a href="#NucleiFinder-2343"><span class="linenos">2343</span></a>                    <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2344"><a href="#NucleiFinder-2344"><span class="linenos">2344</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-2345"><a href="#NucleiFinder-2345"><span class="linenos">2345</span></a>                    <span class="k">pass</span>
</span><span id="NucleiFinder-2346"><a href="#NucleiFinder-2346"><span class="linenos">2346</span></a>
</span><span id="NucleiFinder-2347"><a href="#NucleiFinder-2347"><span class="linenos">2347</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2348"><a href="#NucleiFinder-2348"><span class="linenos">2348</span></a>                    <span class="n">regions_chro2</span><span class="p">,</span>
</span><span id="NucleiFinder-2349"><a href="#NucleiFinder-2349"><span class="linenos">2349</span></a>                    <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2350"><a href="#NucleiFinder-2350"><span class="linenos">2350</span></a>                    <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2351"><a href="#NucleiFinder-2351"><span class="linenos">2351</span></a>                    <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2352"><a href="#NucleiFinder-2352"><span class="linenos">2352</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2353"><a href="#NucleiFinder-2353"><span class="linenos">2353</span></a>
</span><span id="NucleiFinder-2354"><a href="#NucleiFinder-2354"><span class="linenos">2354</span></a>                <span class="n">full_im</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="NucleiFinder-2355"><a href="#NucleiFinder-2355"><span class="linenos">2355</span></a>                    <span class="n">image_list</span><span class="o">=</span><span class="p">[</span><span class="n">full_im</span><span class="p">,</span> <span class="n">regions_chro2</span><span class="p">],</span> <span class="n">intensity_factors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-2356"><a href="#NucleiFinder-2356"><span class="linenos">2356</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2357"><a href="#NucleiFinder-2357"><span class="linenos">2357</span></a>
</span><span id="NucleiFinder-2358"><a href="#NucleiFinder-2358"><span class="linenos">2358</span></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
</span><span id="NucleiFinder-2359"><a href="#NucleiFinder-2359"><span class="linenos">2359</span></a>                    <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
</span><span id="NucleiFinder-2360"><a href="#NucleiFinder-2360"><span class="linenos">2360</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder-2361"><a href="#NucleiFinder-2361"><span class="linenos">2361</span></a>                    <span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="NucleiFinder-2362"><a href="#NucleiFinder-2362"><span class="linenos">2362</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
</span><span id="NucleiFinder-2363"><a href="#NucleiFinder-2363"><span class="linenos">2363</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2364"><a href="#NucleiFinder-2364"><span class="linenos">2364</span></a>
</span><span id="NucleiFinder-2365"><a href="#NucleiFinder-2365"><span class="linenos">2365</span></a>                <span class="n">regions_chro2</span><span class="p">[</span>
</span><span id="NucleiFinder-2366"><a href="#NucleiFinder-2366"><span class="linenos">2366</span></a>                    <span class="n">regions_chro2</span>
</span><span id="NucleiFinder-2367"><a href="#NucleiFinder-2367"><span class="linenos">2367</span></a>                    <span class="o">&lt;=</span> <span class="n">ret</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-2368"><a href="#NucleiFinder-2368"><span class="linenos">2368</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2369"><a href="#NucleiFinder-2369"><span class="linenos">2369</span></a>
</span><span id="NucleiFinder-2370"><a href="#NucleiFinder-2370"><span class="linenos">2370</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2371"><a href="#NucleiFinder-2371"><span class="linenos">2371</span></a>
</span><span id="NucleiFinder-2372"><a href="#NucleiFinder-2372"><span class="linenos">2372</span></a>                <span class="n">chromatione</span> <span class="o">=</span> <span class="n">regions_chro2</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="NucleiFinder-2373"><a href="#NucleiFinder-2373"><span class="linenos">2373</span></a>
</span><span id="NucleiFinder-2374"><a href="#NucleiFinder-2374"><span class="linenos">2374</span></a>                <span class="n">labeled_cells</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">chromatione</span><span class="p">)</span>
</span><span id="NucleiFinder-2375"><a href="#NucleiFinder-2375"><span class="linenos">2375</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_cells</span><span class="p">)</span>
</span><span id="NucleiFinder-2376"><a href="#NucleiFinder-2376"><span class="linenos">2376</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span>
</span><span id="NucleiFinder-2377"><a href="#NucleiFinder-2377"><span class="linenos">2377</span></a>                    <span class="n">labeled_cells</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">regions_chro2</span>
</span><span id="NucleiFinder-2378"><a href="#NucleiFinder-2378"><span class="linenos">2378</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2379"><a href="#NucleiFinder-2379"><span class="linenos">2379</span></a>
</span><span id="NucleiFinder-2380"><a href="#NucleiFinder-2380"><span class="linenos">2380</span></a>                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
</span><span id="NucleiFinder-2381"><a href="#NucleiFinder-2381"><span class="linenos">2381</span></a>
</span><span id="NucleiFinder-2382"><a href="#NucleiFinder-2382"><span class="linenos">2382</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="NucleiFinder-2383"><a href="#NucleiFinder-2383"><span class="linenos">2383</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder-2384"><a href="#NucleiFinder-2384"><span class="linenos">2384</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder-2385"><a href="#NucleiFinder-2385"><span class="linenos">2385</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder-2386"><a href="#NucleiFinder-2386"><span class="linenos">2386</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2387"><a href="#NucleiFinder-2387"><span class="linenos">2387</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span>
</span><span id="NucleiFinder-2388"><a href="#NucleiFinder-2388"><span class="linenos">2388</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2389"><a href="#NucleiFinder-2389"><span class="linenos">2389</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2390"><a href="#NucleiFinder-2390"><span class="linenos">2390</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span>
</span><span id="NucleiFinder-2391"><a href="#NucleiFinder-2391"><span class="linenos">2391</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2392"><a href="#NucleiFinder-2392"><span class="linenos">2392</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder-2393"><a href="#NucleiFinder-2393"><span class="linenos">2393</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2394"><a href="#NucleiFinder-2394"><span class="linenos">2394</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span>
</span><span id="NucleiFinder-2395"><a href="#NucleiFinder-2395"><span class="linenos">2395</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2396"><a href="#NucleiFinder-2396"><span class="linenos">2396</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2397"><a href="#NucleiFinder-2397"><span class="linenos">2397</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span>
</span><span id="NucleiFinder-2398"><a href="#NucleiFinder-2398"><span class="linenos">2398</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2399"><a href="#NucleiFinder-2399"><span class="linenos">2399</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="NucleiFinder-2400"><a href="#NucleiFinder-2400"><span class="linenos">2400</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder-2401"><a href="#NucleiFinder-2401"><span class="linenos">2401</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2402"><a href="#NucleiFinder-2402"><span class="linenos">2402</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span>
</span><span id="NucleiFinder-2403"><a href="#NucleiFinder-2403"><span class="linenos">2403</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2404"><a href="#NucleiFinder-2404"><span class="linenos">2404</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="NucleiFinder-2405"><a href="#NucleiFinder-2405"><span class="linenos">2405</span></a>
</span><span id="NucleiFinder-2406"><a href="#NucleiFinder-2406"><span class="linenos">2406</span></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2407"><a href="#NucleiFinder-2407"><span class="linenos">2407</span></a>
</span><span id="NucleiFinder-2408"><a href="#NucleiFinder-2408"><span class="linenos">2408</span></a>            <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="NucleiFinder-2409"><a href="#NucleiFinder-2409"><span class="linenos">2409</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2410"><a href="#NucleiFinder-2410"><span class="linenos">2410</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2411"><a href="#NucleiFinder-2411"><span class="linenos">2411</span></a>            <span class="p">):</span>
</span><span id="NucleiFinder-2412"><a href="#NucleiFinder-2412"><span class="linenos">2412</span></a>                <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2413"><a href="#NucleiFinder-2413"><span class="linenos">2413</span></a>                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="NucleiFinder-2414"><a href="#NucleiFinder-2414"><span class="linenos">2414</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="NucleiFinder-2415"><a href="#NucleiFinder-2415"><span class="linenos">2415</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2416"><a href="#NucleiFinder-2416"><span class="linenos">2416</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="NucleiFinder-2417"><a href="#NucleiFinder-2417"><span class="linenos">2417</span></a>
</span><span id="NucleiFinder-2418"><a href="#NucleiFinder-2418"><span class="linenos">2418</span></a>            <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="NucleiFinder-2419"><a href="#NucleiFinder-2419"><span class="linenos">2419</span></a>
</span><span id="NucleiFinder-2420"><a href="#NucleiFinder-2420"><span class="linenos">2420</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2421"><a href="#NucleiFinder-2421"><span class="linenos">2421</span></a>                <span class="n">chromatione_info</span><span class="p">,</span>
</span><span id="NucleiFinder-2422"><a href="#NucleiFinder-2422"><span class="linenos">2422</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2423"><a href="#NucleiFinder-2423"><span class="linenos">2423</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2424"><a href="#NucleiFinder-2424"><span class="linenos">2424</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2425"><a href="#NucleiFinder-2425"><span class="linenos">2425</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2426"><a href="#NucleiFinder-2426"><span class="linenos">2426</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2427"><a href="#NucleiFinder-2427"><span class="linenos">2427</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder-2428"><a href="#NucleiFinder-2428"><span class="linenos">2428</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2429"><a href="#NucleiFinder-2429"><span class="linenos">2429</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2430"><a href="#NucleiFinder-2430"><span class="linenos">2430</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2431"><a href="#NucleiFinder-2431"><span class="linenos">2431</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2432"><a href="#NucleiFinder-2432"><span class="linenos">2432</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder-2433"><a href="#NucleiFinder-2433"><span class="linenos">2433</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder-2434"><a href="#NucleiFinder-2434"><span class="linenos">2434</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2435"><a href="#NucleiFinder-2435"><span class="linenos">2435</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder-2436"><a href="#NucleiFinder-2436"><span class="linenos">2436</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2437"><a href="#NucleiFinder-2437"><span class="linenos">2437</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2438"><a href="#NucleiFinder-2438"><span class="linenos">2438</span></a>
</span><span id="NucleiFinder-2439"><a href="#NucleiFinder-2439"><span class="linenos">2439</span></a>            <span class="n">arrays_list2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2440"><a href="#NucleiFinder-2440"><span class="linenos">2440</span></a>
</span><span id="NucleiFinder-2441"><a href="#NucleiFinder-2441"><span class="linenos">2441</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2442"><a href="#NucleiFinder-2442"><span class="linenos">2442</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2443"><a href="#NucleiFinder-2443"><span class="linenos">2443</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2444"><a href="#NucleiFinder-2444"><span class="linenos">2444</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2445"><a href="#NucleiFinder-2445"><span class="linenos">2445</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2446"><a href="#NucleiFinder-2446"><span class="linenos">2446</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2447"><a href="#NucleiFinder-2447"><span class="linenos">2447</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2448"><a href="#NucleiFinder-2448"><span class="linenos">2448</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2449"><a href="#NucleiFinder-2449"><span class="linenos">2449</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2450"><a href="#NucleiFinder-2450"><span class="linenos">2450</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2451"><a href="#NucleiFinder-2451"><span class="linenos">2451</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2452"><a href="#NucleiFinder-2452"><span class="linenos">2452</span></a>
</span><span id="NucleiFinder-2453"><a href="#NucleiFinder-2453"><span class="linenos">2453</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="NucleiFinder-2454"><a href="#NucleiFinder-2454"><span class="linenos">2454</span></a>
</span><span id="NucleiFinder-2455"><a href="#NucleiFinder-2455"><span class="linenos">2455</span></a>                <span class="n">spot_size_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2456"><a href="#NucleiFinder-2456"><span class="linenos">2456</span></a>                <span class="n">spot_size_area_bbox</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2457"><a href="#NucleiFinder-2457"><span class="linenos">2457</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2458"><a href="#NucleiFinder-2458"><span class="linenos">2458</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2459"><a href="#NucleiFinder-2459"><span class="linenos">2459</span></a>                <span class="n">spot_size_area_filled</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2460"><a href="#NucleiFinder-2460"><span class="linenos">2460</span></a>                <span class="n">spot_axis_major_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2461"><a href="#NucleiFinder-2461"><span class="linenos">2461</span></a>                <span class="n">spot_axis_minor_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2462"><a href="#NucleiFinder-2462"><span class="linenos">2462</span></a>                <span class="n">spot_eccentricity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2463"><a href="#NucleiFinder-2463"><span class="linenos">2463</span></a>                <span class="n">spot_size_equivalent_diameter_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2464"><a href="#NucleiFinder-2464"><span class="linenos">2464</span></a>                <span class="n">spot_feret_diameter_max</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2465"><a href="#NucleiFinder-2465"><span class="linenos">2465</span></a>                <span class="n">spot_perimeter</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2466"><a href="#NucleiFinder-2466"><span class="linenos">2466</span></a>                <span class="n">spot_perimeter_crofton</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder-2467"><a href="#NucleiFinder-2467"><span class="linenos">2467</span></a>
</span><span id="NucleiFinder-2468"><a href="#NucleiFinder-2468"><span class="linenos">2468</span></a>                <span class="c1"># Flatten the array,</span>
</span><span id="NucleiFinder-2469"><a href="#NucleiFinder-2469"><span class="linenos">2469</span></a>                <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="NucleiFinder-2470"><a href="#NucleiFinder-2470"><span class="linenos">2470</span></a>                <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder-2471"><a href="#NucleiFinder-2471"><span class="linenos">2471</span></a>                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder-2472"><a href="#NucleiFinder-2472"><span class="linenos">2472</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2473"><a href="#NucleiFinder-2473"><span class="linenos">2473</span></a>
</span><span id="NucleiFinder-2474"><a href="#NucleiFinder-2474"><span class="linenos">2474</span></a>                <span class="n">counter_tmp</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2475"><a href="#NucleiFinder-2475"><span class="linenos">2475</span></a>
</span><span id="NucleiFinder-2476"><a href="#NucleiFinder-2476"><span class="linenos">2476</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list2</span><span class="p">):</span>
</span><span id="NucleiFinder-2477"><a href="#NucleiFinder-2477"><span class="linenos">2477</span></a>                    <span class="n">df_tmp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
</span><span id="NucleiFinder-2478"><a href="#NucleiFinder-2478"><span class="linenos">2478</span></a>                    <span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder-2479"><a href="#NucleiFinder-2479"><span class="linenos">2479</span></a>                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder-2480"><a href="#NucleiFinder-2480"><span class="linenos">2480</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2481"><a href="#NucleiFinder-2481"><span class="linenos">2481</span></a>
</span><span id="NucleiFinder-2482"><a href="#NucleiFinder-2482"><span class="linenos">2482</span></a>                    <span class="n">counter_tmp2</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder-2483"><a href="#NucleiFinder-2483"><span class="linenos">2483</span></a>                    <span class="n">intersection_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">counter_tmp2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="NucleiFinder-2484"><a href="#NucleiFinder-2484"><span class="linenos">2484</span></a>                    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp2</span><span class="p">))</span>
</span><span id="NucleiFinder-2485"><a href="#NucleiFinder-2485"><span class="linenos">2485</span></a>
</span><span id="NucleiFinder-2486"><a href="#NucleiFinder-2486"><span class="linenos">2486</span></a>                    <span class="k">if</span> <span class="n">intersection_length</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="NucleiFinder-2487"><a href="#NucleiFinder-2487"><span class="linenos">2487</span></a>
</span><span id="NucleiFinder-2488"><a href="#NucleiFinder-2488"><span class="linenos">2488</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="NucleiFinder-2489"><a href="#NucleiFinder-2489"><span class="linenos">2489</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2490"><a href="#NucleiFinder-2490"><span class="linenos">2490</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2491"><a href="#NucleiFinder-2491"><span class="linenos">2491</span></a>                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="NucleiFinder-2492"><a href="#NucleiFinder-2492"><span class="linenos">2492</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2493"><a href="#NucleiFinder-2493"><span class="linenos">2493</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder-2494"><a href="#NucleiFinder-2494"><span class="linenos">2494</span></a>                        <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="NucleiFinder-2495"><a href="#NucleiFinder-2495"><span class="linenos">2495</span></a>                            <span class="n">spot_size_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2496"><a href="#NucleiFinder-2496"><span class="linenos">2496</span></a>                            <span class="n">spot_size_area_bbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2497"><a href="#NucleiFinder-2497"><span class="linenos">2497</span></a>                            <span class="n">spot_size_area_convex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2498"><a href="#NucleiFinder-2498"><span class="linenos">2498</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2499"><a href="#NucleiFinder-2499"><span class="linenos">2499</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2500"><a href="#NucleiFinder-2500"><span class="linenos">2500</span></a>                            <span class="n">spot_size_area_filled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2501"><a href="#NucleiFinder-2501"><span class="linenos">2501</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2502"><a href="#NucleiFinder-2502"><span class="linenos">2502</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2503"><a href="#NucleiFinder-2503"><span class="linenos">2503</span></a>                            <span class="n">spot_axis_major_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2504"><a href="#NucleiFinder-2504"><span class="linenos">2504</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2505"><a href="#NucleiFinder-2505"><span class="linenos">2505</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2506"><a href="#NucleiFinder-2506"><span class="linenos">2506</span></a>                            <span class="n">spot_axis_minor_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2507"><a href="#NucleiFinder-2507"><span class="linenos">2507</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2508"><a href="#NucleiFinder-2508"><span class="linenos">2508</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2509"><a href="#NucleiFinder-2509"><span class="linenos">2509</span></a>                            <span class="n">spot_eccentricity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2510"><a href="#NucleiFinder-2510"><span class="linenos">2510</span></a>                            <span class="n">spot_size_equivalent_diameter_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2511"><a href="#NucleiFinder-2511"><span class="linenos">2511</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2512"><a href="#NucleiFinder-2512"><span class="linenos">2512</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2513"><a href="#NucleiFinder-2513"><span class="linenos">2513</span></a>                            <span class="n">spot_feret_diameter_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2514"><a href="#NucleiFinder-2514"><span class="linenos">2514</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2515"><a href="#NucleiFinder-2515"><span class="linenos">2515</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2516"><a href="#NucleiFinder-2516"><span class="linenos">2516</span></a>                            <span class="n">spot_perimeter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder-2517"><a href="#NucleiFinder-2517"><span class="linenos">2517</span></a>                            <span class="n">spot_perimeter_crofton</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2518"><a href="#NucleiFinder-2518"><span class="linenos">2518</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder-2519"><a href="#NucleiFinder-2519"><span class="linenos">2519</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder-2520"><a href="#NucleiFinder-2520"><span class="linenos">2520</span></a>
</span><span id="NucleiFinder-2521"><a href="#NucleiFinder-2521"><span class="linenos">2521</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area</span><span class="p">)</span>
</span><span id="NucleiFinder-2522"><a href="#NucleiFinder-2522"><span class="linenos">2522</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder-2523"><a href="#NucleiFinder-2523"><span class="linenos">2523</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder-2524"><a href="#NucleiFinder-2524"><span class="linenos">2524</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder-2525"><a href="#NucleiFinder-2525"><span class="linenos">2525</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2526"><a href="#NucleiFinder-2526"><span class="linenos">2526</span></a>                    <span class="n">spot_axis_major_length</span>
</span><span id="NucleiFinder-2527"><a href="#NucleiFinder-2527"><span class="linenos">2527</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2528"><a href="#NucleiFinder-2528"><span class="linenos">2528</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2529"><a href="#NucleiFinder-2529"><span class="linenos">2529</span></a>                    <span class="n">spot_axis_minor_length</span>
</span><span id="NucleiFinder-2530"><a href="#NucleiFinder-2530"><span class="linenos">2530</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2531"><a href="#NucleiFinder-2531"><span class="linenos">2531</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder-2532"><a href="#NucleiFinder-2532"><span class="linenos">2532</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2533"><a href="#NucleiFinder-2533"><span class="linenos">2533</span></a>                    <span class="n">spot_size_equivalent_diameter_area</span>
</span><span id="NucleiFinder-2534"><a href="#NucleiFinder-2534"><span class="linenos">2534</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2535"><a href="#NucleiFinder-2535"><span class="linenos">2535</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2536"><a href="#NucleiFinder-2536"><span class="linenos">2536</span></a>                    <span class="n">spot_feret_diameter_max</span>
</span><span id="NucleiFinder-2537"><a href="#NucleiFinder-2537"><span class="linenos">2537</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2538"><a href="#NucleiFinder-2538"><span class="linenos">2538</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder-2539"><a href="#NucleiFinder-2539"><span class="linenos">2539</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder-2540"><a href="#NucleiFinder-2540"><span class="linenos">2540</span></a>                    <span class="n">spot_perimeter_crofton</span>
</span><span id="NucleiFinder-2541"><a href="#NucleiFinder-2541"><span class="linenos">2541</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2542"><a href="#NucleiFinder-2542"><span class="linenos">2542</span></a>
</span><span id="NucleiFinder-2543"><a href="#NucleiFinder-2543"><span class="linenos">2543</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromation_dic</span>
</span><span id="NucleiFinder-2544"><a href="#NucleiFinder-2544"><span class="linenos">2544</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="NucleiFinder-2545"><a href="#NucleiFinder-2545"><span class="linenos">2545</span></a>
</span><span id="NucleiFinder-2546"><a href="#NucleiFinder-2546"><span class="linenos">2546</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder-2547"><a href="#NucleiFinder-2547"><span class="linenos">2547</span></a>                <span class="n">chromation_dic</span><span class="p">,</span> <span class="n">image</span>
</span><span id="NucleiFinder-2548"><a href="#NucleiFinder-2548"><span class="linenos">2548</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2549"><a href="#NucleiFinder-2549"><span class="linenos">2549</span></a>
</span><span id="NucleiFinder-2550"><a href="#NucleiFinder-2550"><span class="linenos">2550</span></a>            <span class="n">img_chrom</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2551"><a href="#NucleiFinder-2551"><span class="linenos">2551</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-2552"><a href="#NucleiFinder-2552"><span class="linenos">2552</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">],</span> <span class="n">image</span><span class="p">),</span>
</span><span id="NucleiFinder-2553"><a href="#NucleiFinder-2553"><span class="linenos">2553</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-2554"><a href="#NucleiFinder-2554"><span class="linenos">2554</span></a>                <span class="p">),</span>
</span><span id="NucleiFinder-2555"><a href="#NucleiFinder-2555"><span class="linenos">2555</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2556"><a href="#NucleiFinder-2556"><span class="linenos">2556</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2557"><a href="#NucleiFinder-2557"><span class="linenos">2557</span></a>
</span><span id="NucleiFinder-2558"><a href="#NucleiFinder-2558"><span class="linenos">2558</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2559"><a href="#NucleiFinder-2559"><span class="linenos">2559</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">,</span> <span class="n">image</span><span class="p">),</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">),</span>
</span><span id="NucleiFinder-2560"><a href="#NucleiFinder-2560"><span class="linenos">2560</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2561"><a href="#NucleiFinder-2561"><span class="linenos">2561</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder-2562"><a href="#NucleiFinder-2562"><span class="linenos">2562</span></a>
</span><span id="NucleiFinder-2563"><a href="#NucleiFinder-2563"><span class="linenos">2563</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">([</span><span class="n">nuclei_mask</span><span class="p">,</span> <span class="n">img_chrom</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder-2564"><a href="#NucleiFinder-2564"><span class="linenos">2564</span></a>
</span><span id="NucleiFinder-2565"><a href="#NucleiFinder-2565"><span class="linenos">2565</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-2566"><a href="#NucleiFinder-2566"><span class="linenos">2566</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">full_im</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder-2567"><a href="#NucleiFinder-2567"><span class="linenos">2567</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-2568"><a href="#NucleiFinder-2568"><span class="linenos">2568</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">full_im</span>
</span><span id="NucleiFinder-2569"><a href="#NucleiFinder-2569"><span class="linenos">2569</span></a>
</span><span id="NucleiFinder-2570"><a href="#NucleiFinder-2570"><span class="linenos">2570</span></a>            <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2571"><a href="#NucleiFinder-2571"><span class="linenos">2571</span></a>
</span><span id="NucleiFinder-2572"><a href="#NucleiFinder-2572"><span class="linenos">2572</span></a>            <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder-2573"><a href="#NucleiFinder-2573"><span class="linenos">2573</span></a>
</span><span id="NucleiFinder-2574"><a href="#NucleiFinder-2574"><span class="linenos">2574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder-2575"><a href="#NucleiFinder-2575"><span class="linenos">2575</span></a>
</span><span id="NucleiFinder-2576"><a href="#NucleiFinder-2576"><span class="linenos">2576</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder-2577"><a href="#NucleiFinder-2577"><span class="linenos">2577</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder-2578"><a href="#NucleiFinder-2578"><span class="linenos">2578</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder-2579"><a href="#NucleiFinder-2579"><span class="linenos">2579</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span>
</span><span id="NucleiFinder-2580"><a href="#NucleiFinder-2580"><span class="linenos">2580</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder-2581"><a href="#NucleiFinder-2581"><span class="linenos">2581</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder-2582"><a href="#NucleiFinder-2582"><span class="linenos">2582</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder-2583"><a href="#NucleiFinder-2583"><span class="linenos">2583</span></a>
</span><span id="NucleiFinder-2584"><a href="#NucleiFinder-2584"><span class="linenos">2584</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2585"><a href="#NucleiFinder-2585"><span class="linenos">2585</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2586"><a href="#NucleiFinder-2586"><span class="linenos">2586</span></a>
</span><span id="NucleiFinder-2587"><a href="#NucleiFinder-2587"><span class="linenos">2587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">browser_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder-2588"><a href="#NucleiFinder-2588"><span class="linenos">2588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2589"><a href="#NucleiFinder-2589"><span class="linenos">2589</span></a><span class="sd">        Displays test results generated by the ``nuclei_finder_test()`` method</span>
</span><span id="NucleiFinder-2590"><a href="#NucleiFinder-2590"><span class="linenos">2590</span></a><span class="sd">        in the default web browser.</span>
</span><span id="NucleiFinder-2591"><a href="#NucleiFinder-2591"><span class="linenos">2591</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2592"><a href="#NucleiFinder-2592"><span class="linenos">2592</span></a>
</span><span id="NucleiFinder-2593"><a href="#NucleiFinder-2593"><span class="linenos">2593</span></a>        <span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder-2594"><a href="#NucleiFinder-2594"><span class="linenos">2594</span></a>
</span><span id="NucleiFinder-2595"><a href="#NucleiFinder-2595"><span class="linenos">2595</span></a>        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="p">:</span>
</span><span id="NucleiFinder-2596"><a href="#NucleiFinder-2596"><span class="linenos">2596</span></a>            <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="NucleiFinder-2597"><a href="#NucleiFinder-2597"><span class="linenos">2597</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2598"><a href="#NucleiFinder-2598"><span class="linenos">2598</span></a>            <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="NucleiFinder-2599"><a href="#NucleiFinder-2599"><span class="linenos">2599</span></a>
</span><span id="NucleiFinder-2600"><a href="#NucleiFinder-2600"><span class="linenos">2600</span></a>            <span class="n">img_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2601"><a href="#NucleiFinder-2601"><span class="linenos">2601</span></a>
</span><span id="NucleiFinder-2602"><a href="#NucleiFinder-2602"><span class="linenos">2602</span></a>            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">img_base64</span><span class="si">}</span><span class="s1">&quot; style=&quot;margin:10px;&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="NucleiFinder-2603"><a href="#NucleiFinder-2603"><span class="linenos">2603</span></a>
</span><span id="NucleiFinder-2604"><a href="#NucleiFinder-2604"><span class="linenos">2604</span></a>        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="NucleiFinder-2605"><a href="#NucleiFinder-2605"><span class="linenos">2605</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.html&quot;</span>
</span><span id="NucleiFinder-2606"><a href="#NucleiFinder-2606"><span class="linenos">2606</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
</span><span id="NucleiFinder-2607"><a href="#NucleiFinder-2607"><span class="linenos">2607</span></a>            <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="NucleiFinder-2608"><a href="#NucleiFinder-2608"><span class="linenos">2608</span></a>            <span class="n">tmp_filename</span> <span class="o">=</span> <span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="NucleiFinder-2609"><a href="#NucleiFinder-2609"><span class="linenos">2609</span></a>
</span><span id="NucleiFinder-2610"><a href="#NucleiFinder-2610"><span class="linenos">2610</span></a>        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">)</span>
</span><span id="NucleiFinder-2611"><a href="#NucleiFinder-2611"><span class="linenos">2611</span></a>
</span><span id="NucleiFinder-2612"><a href="#NucleiFinder-2612"><span class="linenos">2612</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_chromatinization</span><span class="p">(</span>
</span><span id="NucleiFinder-2613"><a href="#NucleiFinder-2613"><span class="linenos">2613</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder-2614"><a href="#NucleiFinder-2614"><span class="linenos">2614</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NucleiFinder-2615"><a href="#NucleiFinder-2615"><span class="linenos">2615</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2616"><a href="#NucleiFinder-2616"><span class="linenos">2616</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2617"><a href="#NucleiFinder-2617"><span class="linenos">2617</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2618"><a href="#NucleiFinder-2618"><span class="linenos">2618</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder-2619"><a href="#NucleiFinder-2619"><span class="linenos">2619</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder-2620"><a href="#NucleiFinder-2620"><span class="linenos">2620</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder-2621"><a href="#NucleiFinder-2621"><span class="linenos">2621</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder-2622"><a href="#NucleiFinder-2622"><span class="linenos">2622</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2623"><a href="#NucleiFinder-2623"><span class="linenos">2623</span></a><span class="sd">        Performs full analysis on images provided via the ``input_image()`` method</span>
</span><span id="NucleiFinder-2624"><a href="#NucleiFinder-2624"><span class="linenos">2624</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder-2625"><a href="#NucleiFinder-2625"><span class="linenos">2625</span></a>
</span><span id="NucleiFinder-2626"><a href="#NucleiFinder-2626"><span class="linenos">2626</span></a><span class="sd">        This method runs nuclei detection, nuclei selection, and chromatinization</span>
</span><span id="NucleiFinder-2627"><a href="#NucleiFinder-2627"><span class="linenos">2627</span></a><span class="sd">        analysis in a single pipeline. Users can adjust parameters for each step</span>
</span><span id="NucleiFinder-2628"><a href="#NucleiFinder-2628"><span class="linenos">2628</span></a><span class="sd">        before running the analysis.</span>
</span><span id="NucleiFinder-2629"><a href="#NucleiFinder-2629"><span class="linenos">2629</span></a>
</span><span id="NucleiFinder-2630"><a href="#NucleiFinder-2630"><span class="linenos">2630</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder-2631"><a href="#NucleiFinder-2631"><span class="linenos">2631</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder-2632"><a href="#NucleiFinder-2632"><span class="linenos">2632</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder-2633"><a href="#NucleiFinder-2633"><span class="linenos">2633</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="NucleiFinder-2634"><a href="#NucleiFinder-2634"><span class="linenos">2634</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="NucleiFinder-2635"><a href="#NucleiFinder-2635"><span class="linenos">2635</span></a>
</span><span id="NucleiFinder-2636"><a href="#NucleiFinder-2636"><span class="linenos">2636</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder-2637"><a href="#NucleiFinder-2637"><span class="linenos">2637</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder-2638"><a href="#NucleiFinder-2638"><span class="linenos">2638</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder-2639"><a href="#NucleiFinder-2639"><span class="linenos">2639</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder-2640"><a href="#NucleiFinder-2640"><span class="linenos">2640</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder-2641"><a href="#NucleiFinder-2641"><span class="linenos">2641</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder-2642"><a href="#NucleiFinder-2642"><span class="linenos">2642</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder-2643"><a href="#NucleiFinder-2643"><span class="linenos">2643</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder-2644"><a href="#NucleiFinder-2644"><span class="linenos">2644</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder-2645"><a href="#NucleiFinder-2645"><span class="linenos">2645</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="NucleiFinder-2646"><a href="#NucleiFinder-2646"><span class="linenos">2646</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="NucleiFinder-2647"><a href="#NucleiFinder-2647"><span class="linenos">2647</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="NucleiFinder-2648"><a href="#NucleiFinder-2648"><span class="linenos">2648</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="NucleiFinder-2649"><a href="#NucleiFinder-2649"><span class="linenos">2649</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="NucleiFinder-2650"><a href="#NucleiFinder-2650"><span class="linenos">2650</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="NucleiFinder-2651"><a href="#NucleiFinder-2651"><span class="linenos">2651</span></a>
</span><span id="NucleiFinder-2652"><a href="#NucleiFinder-2652"><span class="linenos">2652</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-2653"><a href="#NucleiFinder-2653"><span class="linenos">2653</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-2654"><a href="#NucleiFinder-2654"><span class="linenos">2654</span></a><span class="sd">        path_to_images : str</span>
</span><span id="NucleiFinder-2655"><a href="#NucleiFinder-2655"><span class="linenos">2655</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="NucleiFinder-2656"><a href="#NucleiFinder-2656"><span class="linenos">2656</span></a>
</span><span id="NucleiFinder-2657"><a href="#NucleiFinder-2657"><span class="linenos">2657</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="NucleiFinder-2658"><a href="#NucleiFinder-2658"><span class="linenos">2658</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="NucleiFinder-2659"><a href="#NucleiFinder-2659"><span class="linenos">2659</span></a>
</span><span id="NucleiFinder-2660"><a href="#NucleiFinder-2660"><span class="linenos">2660</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="NucleiFinder-2661"><a href="#NucleiFinder-2661"><span class="linenos">2661</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="NucleiFinder-2662"><a href="#NucleiFinder-2662"><span class="linenos">2662</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="NucleiFinder-2663"><a href="#NucleiFinder-2663"><span class="linenos">2663</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="NucleiFinder-2664"><a href="#NucleiFinder-2664"><span class="linenos">2664</span></a>
</span><span id="NucleiFinder-2665"><a href="#NucleiFinder-2665"><span class="linenos">2665</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="NucleiFinder-2666"><a href="#NucleiFinder-2666"><span class="linenos">2666</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="NucleiFinder-2667"><a href="#NucleiFinder-2667"><span class="linenos">2667</span></a>
</span><span id="NucleiFinder-2668"><a href="#NucleiFinder-2668"><span class="linenos">2668</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="NucleiFinder-2669"><a href="#NucleiFinder-2669"><span class="linenos">2669</span></a><span class="sd">            Whether to run ``select_nuclei()`` with the defined parameters. Default is True.</span>
</span><span id="NucleiFinder-2670"><a href="#NucleiFinder-2670"><span class="linenos">2670</span></a>
</span><span id="NucleiFinder-2671"><a href="#NucleiFinder-2671"><span class="linenos">2671</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="NucleiFinder-2672"><a href="#NucleiFinder-2672"><span class="linenos">2672</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="NucleiFinder-2673"><a href="#NucleiFinder-2673"><span class="linenos">2673</span></a>
</span><span id="NucleiFinder-2674"><a href="#NucleiFinder-2674"><span class="linenos">2674</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="NucleiFinder-2675"><a href="#NucleiFinder-2675"><span class="linenos">2675</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="NucleiFinder-2676"><a href="#NucleiFinder-2676"><span class="linenos">2676</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="NucleiFinder-2677"><a href="#NucleiFinder-2677"><span class="linenos">2677</span></a>
</span><span id="NucleiFinder-2678"><a href="#NucleiFinder-2678"><span class="linenos">2678</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-2679"><a href="#NucleiFinder-2679"><span class="linenos">2679</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-2680"><a href="#NucleiFinder-2680"><span class="linenos">2680</span></a><span class="sd">        results_dict : dict</span>
</span><span id="NucleiFinder-2681"><a href="#NucleiFinder-2681"><span class="linenos">2681</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="NucleiFinder-2682"><a href="#NucleiFinder-2682"><span class="linenos">2682</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="NucleiFinder-2683"><a href="#NucleiFinder-2683"><span class="linenos">2683</span></a>
</span><span id="NucleiFinder-2684"><a href="#NucleiFinder-2684"><span class="linenos">2684</span></a><span class="sd">        Notes</span>
</span><span id="NucleiFinder-2685"><a href="#NucleiFinder-2685"><span class="linenos">2685</span></a><span class="sd">        -----</span>
</span><span id="NucleiFinder-2686"><a href="#NucleiFinder-2686"><span class="linenos">2686</span></a><span class="sd">        This method runs the complete nuclei and chromatinization analysis pipeline.</span>
</span><span id="NucleiFinder-2687"><a href="#NucleiFinder-2687"><span class="linenos">2687</span></a>
</span><span id="NucleiFinder-2688"><a href="#NucleiFinder-2688"><span class="linenos">2688</span></a><span class="sd">        Parameters must be set appropriately before calling to ensure correct results.</span>
</span><span id="NucleiFinder-2689"><a href="#NucleiFinder-2689"><span class="linenos">2689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2690"><a href="#NucleiFinder-2690"><span class="linenos">2690</span></a>
</span><span id="NucleiFinder-2691"><a href="#NucleiFinder-2691"><span class="linenos">2691</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2692"><a href="#NucleiFinder-2692"><span class="linenos">2692</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2693"><a href="#NucleiFinder-2693"><span class="linenos">2693</span></a>        <span class="n">results_img_raw</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2694"><a href="#NucleiFinder-2694"><span class="linenos">2694</span></a>
</span><span id="NucleiFinder-2695"><a href="#NucleiFinder-2695"><span class="linenos">2695</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="NucleiFinder-2696"><a href="#NucleiFinder-2696"><span class="linenos">2696</span></a>
</span><span id="NucleiFinder-2697"><a href="#NucleiFinder-2697"><span class="linenos">2697</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2698"><a href="#NucleiFinder-2698"><span class="linenos">2698</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="NucleiFinder-2699"><a href="#NucleiFinder-2699"><span class="linenos">2699</span></a>
</span><span id="NucleiFinder-2700"><a href="#NucleiFinder-2700"><span class="linenos">2700</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2701"><a href="#NucleiFinder-2701"><span class="linenos">2701</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="NucleiFinder-2702"><a href="#NucleiFinder-2702"><span class="linenos">2702</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="NucleiFinder-2703"><a href="#NucleiFinder-2703"><span class="linenos">2703</span></a>                <span class="n">x</span>
</span><span id="NucleiFinder-2704"><a href="#NucleiFinder-2704"><span class="linenos">2704</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="NucleiFinder-2705"><a href="#NucleiFinder-2705"><span class="linenos">2705</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="NucleiFinder-2706"><a href="#NucleiFinder-2706"><span class="linenos">2706</span></a>            <span class="p">]</span>
</span><span id="NucleiFinder-2707"><a href="#NucleiFinder-2707"><span class="linenos">2707</span></a>
</span><span id="NucleiFinder-2708"><a href="#NucleiFinder-2708"><span class="linenos">2708</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2709"><a href="#NucleiFinder-2709"><span class="linenos">2709</span></a>
</span><span id="NucleiFinder-2710"><a href="#NucleiFinder-2710"><span class="linenos">2710</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="NucleiFinder-2711"><a href="#NucleiFinder-2711"><span class="linenos">2711</span></a>
</span><span id="NucleiFinder-2712"><a href="#NucleiFinder-2712"><span class="linenos">2712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-2713"><a href="#NucleiFinder-2713"><span class="linenos">2713</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder-2714"><a href="#NucleiFinder-2714"><span class="linenos">2714</span></a>
</span><span id="NucleiFinder-2715"><a href="#NucleiFinder-2715"><span class="linenos">2715</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2716"><a href="#NucleiFinder-2716"><span class="linenos">2716</span></a>
</span><span id="NucleiFinder-2717"><a href="#NucleiFinder-2717"><span class="linenos">2717</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="NucleiFinder-2718"><a href="#NucleiFinder-2718"><span class="linenos">2718</span></a>
</span><span id="NucleiFinder-2719"><a href="#NucleiFinder-2719"><span class="linenos">2719</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder-2720"><a href="#NucleiFinder-2720"><span class="linenos">2720</span></a>
</span><span id="NucleiFinder-2721"><a href="#NucleiFinder-2721"><span class="linenos">2721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-2722"><a href="#NucleiFinder-2722"><span class="linenos">2722</span></a>
</span><span id="NucleiFinder-2723"><a href="#NucleiFinder-2723"><span class="linenos">2723</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder-2724"><a href="#NucleiFinder-2724"><span class="linenos">2724</span></a>
</span><span id="NucleiFinder-2725"><a href="#NucleiFinder-2725"><span class="linenos">2725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="NucleiFinder-2726"><a href="#NucleiFinder-2726"><span class="linenos">2726</span></a>
</span><span id="NucleiFinder-2727"><a href="#NucleiFinder-2727"><span class="linenos">2727</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2728"><a href="#NucleiFinder-2728"><span class="linenos">2728</span></a>
</span><span id="NucleiFinder-2729"><a href="#NucleiFinder-2729"><span class="linenos">2729</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-2730"><a href="#NucleiFinder-2730"><span class="linenos">2730</span></a>
</span><span id="NucleiFinder-2731"><a href="#NucleiFinder-2731"><span class="linenos">2731</span></a>            <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder-2732"><a href="#NucleiFinder-2732"><span class="linenos">2732</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2733"><a href="#NucleiFinder-2733"><span class="linenos">2733</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="NucleiFinder-2734"><a href="#NucleiFinder-2734"><span class="linenos">2734</span></a>
</span><span id="NucleiFinder-2735"><a href="#NucleiFinder-2735"><span class="linenos">2735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2736"><a href="#NucleiFinder-2736"><span class="linenos">2736</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2737"><a href="#NucleiFinder-2737"><span class="linenos">2737</span></a>
</span><span id="NucleiFinder-2738"><a href="#NucleiFinder-2738"><span class="linenos">2738</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2739"><a href="#NucleiFinder-2739"><span class="linenos">2739</span></a>
</span><span id="NucleiFinder-2740"><a href="#NucleiFinder-2740"><span class="linenos">2740</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2741"><a href="#NucleiFinder-2741"><span class="linenos">2741</span></a>
</span><span id="NucleiFinder-2742"><a href="#NucleiFinder-2742"><span class="linenos">2742</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-2743"><a href="#NucleiFinder-2743"><span class="linenos">2743</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-2744"><a href="#NucleiFinder-2744"><span class="linenos">2744</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="NucleiFinder-2745"><a href="#NucleiFinder-2745"><span class="linenos">2745</span></a>                    <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder-2746"><a href="#NucleiFinder-2746"><span class="linenos">2746</span></a>                    <span class="k">del</span> <span class="n">image</span>
</span><span id="NucleiFinder-2747"><a href="#NucleiFinder-2747"><span class="linenos">2747</span></a>
</span><span id="NucleiFinder-2748"><a href="#NucleiFinder-2748"><span class="linenos">2748</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="NucleiFinder-2749"><a href="#NucleiFinder-2749"><span class="linenos">2749</span></a>
</span><span id="NucleiFinder-2750"><a href="#NucleiFinder-2750"><span class="linenos">2750</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2751"><a href="#NucleiFinder-2751"><span class="linenos">2751</span></a>
</span><span id="NucleiFinder-2752"><a href="#NucleiFinder-2752"><span class="linenos">2752</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chromatization searching:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2753"><a href="#NucleiFinder-2753"><span class="linenos">2753</span></a>
</span><span id="NucleiFinder-2754"><a href="#NucleiFinder-2754"><span class="linenos">2754</span></a>        <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="NucleiFinder-2755"><a href="#NucleiFinder-2755"><span class="linenos">2755</span></a>
</span><span id="NucleiFinder-2756"><a href="#NucleiFinder-2756"><span class="linenos">2756</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder-2757"><a href="#NucleiFinder-2757"><span class="linenos">2757</span></a>
</span><span id="NucleiFinder-2758"><a href="#NucleiFinder-2758"><span class="linenos">2758</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder-2759"><a href="#NucleiFinder-2759"><span class="linenos">2759</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei_chromatinization_series</span><span class="p">(</span>
</span><span id="NucleiFinder-2760"><a href="#NucleiFinder-2760"><span class="linenos">2760</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="NucleiFinder-2761"><a href="#NucleiFinder-2761"><span class="linenos">2761</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2762"><a href="#NucleiFinder-2762"><span class="linenos">2762</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_chromatinization</span><span class="p">()</span>
</span><span id="NucleiFinder-2763"><a href="#NucleiFinder-2763"><span class="linenos">2763</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder-2764"><a href="#NucleiFinder-2764"><span class="linenos">2764</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="n">ke</span><span class="si">}</span><span class="s2"> could not be processed.&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2765"><a href="#NucleiFinder-2765"><span class="linenos">2765</span></a>
</span><span id="NucleiFinder-2766"><a href="#NucleiFinder-2766"><span class="linenos">2766</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2767"><a href="#NucleiFinder-2767"><span class="linenos">2767</span></a>
</span><span id="NucleiFinder-2768"><a href="#NucleiFinder-2768"><span class="linenos">2768</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2769"><a href="#NucleiFinder-2769"><span class="linenos">2769</span></a>
</span><span id="NucleiFinder-2770"><a href="#NucleiFinder-2770"><span class="linenos">2770</span></a>                    <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2771"><a href="#NucleiFinder-2771"><span class="linenos">2771</span></a>
</span><span id="NucleiFinder-2772"><a href="#NucleiFinder-2772"><span class="linenos">2772</span></a>                    <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="NucleiFinder-2773"><a href="#NucleiFinder-2773"><span class="linenos">2773</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder-2774"><a href="#NucleiFinder-2774"><span class="linenos">2774</span></a>                            <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="NucleiFinder-2775"><a href="#NucleiFinder-2775"><span class="linenos">2775</span></a>                            <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
</span><span id="NucleiFinder-2776"><a href="#NucleiFinder-2776"><span class="linenos">2776</span></a>                        <span class="p">}</span>
</span><span id="NucleiFinder-2777"><a href="#NucleiFinder-2777"><span class="linenos">2777</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder-2778"><a href="#NucleiFinder-2778"><span class="linenos">2778</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2779"><a href="#NucleiFinder-2779"><span class="linenos">2779</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-2780"><a href="#NucleiFinder-2780"><span class="linenos">2780</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder-2781"><a href="#NucleiFinder-2781"><span class="linenos">2781</span></a>
</span><span id="NucleiFinder-2782"><a href="#NucleiFinder-2782"><span class="linenos">2782</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2783"><a href="#NucleiFinder-2783"><span class="linenos">2783</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2784"><a href="#NucleiFinder-2784"><span class="linenos">2784</span></a>
</span><span id="NucleiFinder-2785"><a href="#NucleiFinder-2785"><span class="linenos">2785</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder-2786"><a href="#NucleiFinder-2786"><span class="linenos">2786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-2787"><a href="#NucleiFinder-2787"><span class="linenos">2787</span></a>
</span><span id="NucleiFinder-2788"><a href="#NucleiFinder-2788"><span class="linenos">2788</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span><span id="NucleiFinder-2789"><a href="#NucleiFinder-2789"><span class="linenos">2789</span></a>
</span><span id="NucleiFinder-2790"><a href="#NucleiFinder-2790"><span class="linenos">2790</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_nuclei</span><span class="p">(</span>
</span><span id="NucleiFinder-2791"><a href="#NucleiFinder-2791"><span class="linenos">2791</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder-2792"><a href="#NucleiFinder-2792"><span class="linenos">2792</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NucleiFinder-2793"><a href="#NucleiFinder-2793"><span class="linenos">2793</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2794"><a href="#NucleiFinder-2794"><span class="linenos">2794</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="NucleiFinder-2795"><a href="#NucleiFinder-2795"><span class="linenos">2795</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2796"><a href="#NucleiFinder-2796"><span class="linenos">2796</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder-2797"><a href="#NucleiFinder-2797"><span class="linenos">2797</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder-2798"><a href="#NucleiFinder-2798"><span class="linenos">2798</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder-2799"><a href="#NucleiFinder-2799"><span class="linenos">2799</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder-2800"><a href="#NucleiFinder-2800"><span class="linenos">2800</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2801"><a href="#NucleiFinder-2801"><span class="linenos">2801</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="NucleiFinder-2802"><a href="#NucleiFinder-2802"><span class="linenos">2802</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder-2803"><a href="#NucleiFinder-2803"><span class="linenos">2803</span></a>
</span><span id="NucleiFinder-2804"><a href="#NucleiFinder-2804"><span class="linenos">2804</span></a><span class="sd">        This method runs nuclei detection and selection using the currently set</span>
</span><span id="NucleiFinder-2805"><a href="#NucleiFinder-2805"><span class="linenos">2805</span></a><span class="sd">        parameters. Users can adjust image preprocessing and nuclei detection</span>
</span><span id="NucleiFinder-2806"><a href="#NucleiFinder-2806"><span class="linenos">2806</span></a><span class="sd">        parameters before running the analysis.</span>
</span><span id="NucleiFinder-2807"><a href="#NucleiFinder-2807"><span class="linenos">2807</span></a>
</span><span id="NucleiFinder-2808"><a href="#NucleiFinder-2808"><span class="linenos">2808</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder-2809"><a href="#NucleiFinder-2809"><span class="linenos">2809</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder-2810"><a href="#NucleiFinder-2810"><span class="linenos">2810</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder-2811"><a href="#NucleiFinder-2811"><span class="linenos">2811</span></a>
</span><span id="NucleiFinder-2812"><a href="#NucleiFinder-2812"><span class="linenos">2812</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder-2813"><a href="#NucleiFinder-2813"><span class="linenos">2813</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder-2814"><a href="#NucleiFinder-2814"><span class="linenos">2814</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder-2815"><a href="#NucleiFinder-2815"><span class="linenos">2815</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder-2816"><a href="#NucleiFinder-2816"><span class="linenos">2816</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder-2817"><a href="#NucleiFinder-2817"><span class="linenos">2817</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder-2818"><a href="#NucleiFinder-2818"><span class="linenos">2818</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder-2819"><a href="#NucleiFinder-2819"><span class="linenos">2819</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder-2820"><a href="#NucleiFinder-2820"><span class="linenos">2820</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder-2821"><a href="#NucleiFinder-2821"><span class="linenos">2821</span></a>
</span><span id="NucleiFinder-2822"><a href="#NucleiFinder-2822"><span class="linenos">2822</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder-2823"><a href="#NucleiFinder-2823"><span class="linenos">2823</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder-2824"><a href="#NucleiFinder-2824"><span class="linenos">2824</span></a><span class="sd">        path_to_images : str</span>
</span><span id="NucleiFinder-2825"><a href="#NucleiFinder-2825"><span class="linenos">2825</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="NucleiFinder-2826"><a href="#NucleiFinder-2826"><span class="linenos">2826</span></a>
</span><span id="NucleiFinder-2827"><a href="#NucleiFinder-2827"><span class="linenos">2827</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="NucleiFinder-2828"><a href="#NucleiFinder-2828"><span class="linenos">2828</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="NucleiFinder-2829"><a href="#NucleiFinder-2829"><span class="linenos">2829</span></a>
</span><span id="NucleiFinder-2830"><a href="#NucleiFinder-2830"><span class="linenos">2830</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="NucleiFinder-2831"><a href="#NucleiFinder-2831"><span class="linenos">2831</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="NucleiFinder-2832"><a href="#NucleiFinder-2832"><span class="linenos">2832</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="NucleiFinder-2833"><a href="#NucleiFinder-2833"><span class="linenos">2833</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="NucleiFinder-2834"><a href="#NucleiFinder-2834"><span class="linenos">2834</span></a>
</span><span id="NucleiFinder-2835"><a href="#NucleiFinder-2835"><span class="linenos">2835</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="NucleiFinder-2836"><a href="#NucleiFinder-2836"><span class="linenos">2836</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="NucleiFinder-2837"><a href="#NucleiFinder-2837"><span class="linenos">2837</span></a>
</span><span id="NucleiFinder-2838"><a href="#NucleiFinder-2838"><span class="linenos">2838</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="NucleiFinder-2839"><a href="#NucleiFinder-2839"><span class="linenos">2839</span></a><span class="sd">            Whether to run the ``select_nuclei()`` method with the defined parameters.</span>
</span><span id="NucleiFinder-2840"><a href="#NucleiFinder-2840"><span class="linenos">2840</span></a><span class="sd">            Default is True.</span>
</span><span id="NucleiFinder-2841"><a href="#NucleiFinder-2841"><span class="linenos">2841</span></a>
</span><span id="NucleiFinder-2842"><a href="#NucleiFinder-2842"><span class="linenos">2842</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="NucleiFinder-2843"><a href="#NucleiFinder-2843"><span class="linenos">2843</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="NucleiFinder-2844"><a href="#NucleiFinder-2844"><span class="linenos">2844</span></a>
</span><span id="NucleiFinder-2845"><a href="#NucleiFinder-2845"><span class="linenos">2845</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="NucleiFinder-2846"><a href="#NucleiFinder-2846"><span class="linenos">2846</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="NucleiFinder-2847"><a href="#NucleiFinder-2847"><span class="linenos">2847</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="NucleiFinder-2848"><a href="#NucleiFinder-2848"><span class="linenos">2848</span></a>
</span><span id="NucleiFinder-2849"><a href="#NucleiFinder-2849"><span class="linenos">2849</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder-2850"><a href="#NucleiFinder-2850"><span class="linenos">2850</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder-2851"><a href="#NucleiFinder-2851"><span class="linenos">2851</span></a><span class="sd">        results_dict : dict</span>
</span><span id="NucleiFinder-2852"><a href="#NucleiFinder-2852"><span class="linenos">2852</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="NucleiFinder-2853"><a href="#NucleiFinder-2853"><span class="linenos">2853</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="NucleiFinder-2854"><a href="#NucleiFinder-2854"><span class="linenos">2854</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder-2855"><a href="#NucleiFinder-2855"><span class="linenos">2855</span></a>
</span><span id="NucleiFinder-2856"><a href="#NucleiFinder-2856"><span class="linenos">2856</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2857"><a href="#NucleiFinder-2857"><span class="linenos">2857</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2858"><a href="#NucleiFinder-2858"><span class="linenos">2858</span></a>
</span><span id="NucleiFinder-2859"><a href="#NucleiFinder-2859"><span class="linenos">2859</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="NucleiFinder-2860"><a href="#NucleiFinder-2860"><span class="linenos">2860</span></a>
</span><span id="NucleiFinder-2861"><a href="#NucleiFinder-2861"><span class="linenos">2861</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2862"><a href="#NucleiFinder-2862"><span class="linenos">2862</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="NucleiFinder-2863"><a href="#NucleiFinder-2863"><span class="linenos">2863</span></a>
</span><span id="NucleiFinder-2864"><a href="#NucleiFinder-2864"><span class="linenos">2864</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2865"><a href="#NucleiFinder-2865"><span class="linenos">2865</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="NucleiFinder-2866"><a href="#NucleiFinder-2866"><span class="linenos">2866</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="NucleiFinder-2867"><a href="#NucleiFinder-2867"><span class="linenos">2867</span></a>                <span class="n">x</span>
</span><span id="NucleiFinder-2868"><a href="#NucleiFinder-2868"><span class="linenos">2868</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="NucleiFinder-2869"><a href="#NucleiFinder-2869"><span class="linenos">2869</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="NucleiFinder-2870"><a href="#NucleiFinder-2870"><span class="linenos">2870</span></a>            <span class="p">]</span>
</span><span id="NucleiFinder-2871"><a href="#NucleiFinder-2871"><span class="linenos">2871</span></a>
</span><span id="NucleiFinder-2872"><a href="#NucleiFinder-2872"><span class="linenos">2872</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder-2873"><a href="#NucleiFinder-2873"><span class="linenos">2873</span></a>
</span><span id="NucleiFinder-2874"><a href="#NucleiFinder-2874"><span class="linenos">2874</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="NucleiFinder-2875"><a href="#NucleiFinder-2875"><span class="linenos">2875</span></a>
</span><span id="NucleiFinder-2876"><a href="#NucleiFinder-2876"><span class="linenos">2876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-2877"><a href="#NucleiFinder-2877"><span class="linenos">2877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder-2878"><a href="#NucleiFinder-2878"><span class="linenos">2878</span></a>
</span><span id="NucleiFinder-2879"><a href="#NucleiFinder-2879"><span class="linenos">2879</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2880"><a href="#NucleiFinder-2880"><span class="linenos">2880</span></a>
</span><span id="NucleiFinder-2881"><a href="#NucleiFinder-2881"><span class="linenos">2881</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="NucleiFinder-2882"><a href="#NucleiFinder-2882"><span class="linenos">2882</span></a>
</span><span id="NucleiFinder-2883"><a href="#NucleiFinder-2883"><span class="linenos">2883</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder-2884"><a href="#NucleiFinder-2884"><span class="linenos">2884</span></a>
</span><span id="NucleiFinder-2885"><a href="#NucleiFinder-2885"><span class="linenos">2885</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder-2886"><a href="#NucleiFinder-2886"><span class="linenos">2886</span></a>
</span><span id="NucleiFinder-2887"><a href="#NucleiFinder-2887"><span class="linenos">2887</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="NucleiFinder-2888"><a href="#NucleiFinder-2888"><span class="linenos">2888</span></a>
</span><span id="NucleiFinder-2889"><a href="#NucleiFinder-2889"><span class="linenos">2889</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2890"><a href="#NucleiFinder-2890"><span class="linenos">2890</span></a>
</span><span id="NucleiFinder-2891"><a href="#NucleiFinder-2891"><span class="linenos">2891</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2892"><a href="#NucleiFinder-2892"><span class="linenos">2892</span></a>
</span><span id="NucleiFinder-2893"><a href="#NucleiFinder-2893"><span class="linenos">2893</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="NucleiFinder-2894"><a href="#NucleiFinder-2894"><span class="linenos">2894</span></a>
</span><span id="NucleiFinder-2895"><a href="#NucleiFinder-2895"><span class="linenos">2895</span></a>                <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder-2896"><a href="#NucleiFinder-2896"><span class="linenos">2896</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2897"><a href="#NucleiFinder-2897"><span class="linenos">2897</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="NucleiFinder-2898"><a href="#NucleiFinder-2898"><span class="linenos">2898</span></a>
</span><span id="NucleiFinder-2899"><a href="#NucleiFinder-2899"><span class="linenos">2899</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2900"><a href="#NucleiFinder-2900"><span class="linenos">2900</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder-2901"><a href="#NucleiFinder-2901"><span class="linenos">2901</span></a>
</span><span id="NucleiFinder-2902"><a href="#NucleiFinder-2902"><span class="linenos">2902</span></a>                <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2903"><a href="#NucleiFinder-2903"><span class="linenos">2903</span></a>
</span><span id="NucleiFinder-2904"><a href="#NucleiFinder-2904"><span class="linenos">2904</span></a>                    <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder-2905"><a href="#NucleiFinder-2905"><span class="linenos">2905</span></a>
</span><span id="NucleiFinder-2906"><a href="#NucleiFinder-2906"><span class="linenos">2906</span></a>                        <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="NucleiFinder-2907"><a href="#NucleiFinder-2907"><span class="linenos">2907</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-2908"><a href="#NucleiFinder-2908"><span class="linenos">2908</span></a>                            <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder-2909"><a href="#NucleiFinder-2909"><span class="linenos">2909</span></a>
</span><span id="NucleiFinder-2910"><a href="#NucleiFinder-2910"><span class="linenos">2910</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder-2911"><a href="#NucleiFinder-2911"><span class="linenos">2911</span></a>
</span><span id="NucleiFinder-2912"><a href="#NucleiFinder-2912"><span class="linenos">2912</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2913"><a href="#NucleiFinder-2913"><span class="linenos">2913</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder-2914"><a href="#NucleiFinder-2914"><span class="linenos">2914</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder-2915"><a href="#NucleiFinder-2915"><span class="linenos">2915</span></a>
</span><span id="NucleiFinder-2916"><a href="#NucleiFinder-2916"><span class="linenos">2916</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2917"><a href="#NucleiFinder-2917"><span class="linenos">2917</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2918"><a href="#NucleiFinder-2918"><span class="linenos">2918</span></a>
</span><span id="NucleiFinder-2919"><a href="#NucleiFinder-2919"><span class="linenos">2919</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2920"><a href="#NucleiFinder-2920"><span class="linenos">2920</span></a>
</span><span id="NucleiFinder-2921"><a href="#NucleiFinder-2921"><span class="linenos">2921</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder-2922"><a href="#NucleiFinder-2922"><span class="linenos">2922</span></a>
</span><span id="NucleiFinder-2923"><a href="#NucleiFinder-2923"><span class="linenos">2923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder-2924"><a href="#NucleiFinder-2924"><span class="linenos">2924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder-2925"><a href="#NucleiFinder-2925"><span class="linenos">2925</span></a>
</span><span id="NucleiFinder-2926"><a href="#NucleiFinder-2926"><span class="linenos">2926</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="NucleiFinder-2927"><a href="#NucleiFinder-2927"><span class="linenos">2927</span></a>
</span><span id="NucleiFinder-2928"><a href="#NucleiFinder-2928"><span class="linenos">2928</span></a>        <span class="k">if</span> <span class="n">include_img</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NucleiFinder-2929"><a href="#NucleiFinder-2929"><span class="linenos">2929</span></a>
</span><span id="NucleiFinder-2930"><a href="#NucleiFinder-2930"><span class="linenos">2930</span></a>            <span class="k">return</span> <span class="n">results_dict_tmp</span>
</span><span id="NucleiFinder-2931"><a href="#NucleiFinder-2931"><span class="linenos">2931</span></a>
</span><span id="NucleiFinder-2932"><a href="#NucleiFinder-2932"><span class="linenos">2932</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder-2933"><a href="#NucleiFinder-2933"><span class="linenos">2933</span></a>
</span><span id="NucleiFinder-2934"><a href="#NucleiFinder-2934"><span class="linenos">2934</span></a>            <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder-2935"><a href="#NucleiFinder-2935"><span class="linenos">2935</span></a>
</span><span id="NucleiFinder-2936"><a href="#NucleiFinder-2936"><span class="linenos">2936</span></a>            <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiFinder-2937"><a href="#NucleiFinder-2937"><span class="linenos">2937</span></a>
</span><span id="NucleiFinder-2938"><a href="#NucleiFinder-2938"><span class="linenos">2938</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder-2939"><a href="#NucleiFinder-2939"><span class="linenos">2939</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder-2940"><a href="#NucleiFinder-2940"><span class="linenos">2940</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">]),</span>
</span><span id="NucleiFinder-2941"><a href="#NucleiFinder-2941"><span class="linenos">2941</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder-2942"><a href="#NucleiFinder-2942"><span class="linenos">2942</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder-2943"><a href="#NucleiFinder-2943"><span class="linenos">2943</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder-2944"><a href="#NucleiFinder-2944"><span class="linenos">2944</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder-2945"><a href="#NucleiFinder-2945"><span class="linenos">2945</span></a>                <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder-2946"><a href="#NucleiFinder-2946"><span class="linenos">2946</span></a>
</span><span id="NucleiFinder-2947"><a href="#NucleiFinder-2947"><span class="linenos">2947</span></a>                <span class="n">cred</span> <span class="o">=</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="NucleiFinder-2948"><a href="#NucleiFinder-2948"><span class="linenos">2948</span></a>                <span class="c1"># cred.pop(&#39;coords&#39;)</span>
</span><span id="NucleiFinder-2949"><a href="#NucleiFinder-2949"><span class="linenos">2949</span></a>
</span><span id="NucleiFinder-2950"><a href="#NucleiFinder-2950"><span class="linenos">2950</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">cred</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">concatenated_image</span><span class="p">}</span>
</span><span id="NucleiFinder-2951"><a href="#NucleiFinder-2951"><span class="linenos">2951</span></a>
</span><span id="NucleiFinder-2952"><a href="#NucleiFinder-2952"><span class="linenos">2952</span></a>            <span class="k">return</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>Implements a comprehensive pipeline for automated segmentation,
selection, and analysis of cell nuclei and their internal chromatin structure
in microscopy images.</p>

<p>It utilizes a pre-trained deep learning model (StarDist2D) for initial
nuclear identification, followed by the application of advanced morphological
and intensity filters, and a dedicated algorithm for quantifying chromatinization.
The class provides detailed control over the hyperparameters for both the
segmentation process and image preprocessing stages.</p>

<h2 id="parameters">Parameters</h2>

<p>image : np.ndarray, optional
    The input image (typically 16-bit) for analysis.</p>

<p>test_results : list, optional
    Plots resulting from parameter testing (e.g., NMS/Prob combinations).</p>

<p>hyperparameter_nuclei : dict, optional
    Parameters for nuclei segmentation and filtering (e.g., 'nms', 'prob', 'min_size', 'circularity').</p>

<p>hyperparameter_chromatinization : dict, optional
    Parameters for segmenting and filtering chromatin spots (e.g., 'cut_point', 'ratio').</p>

<p>img_adj_par_chrom : dict, optional
    Image adjustment parameters (gamma, contrast) specifically for chromatin analysis.</p>

<p>img_adj_par : dict, optional
    Image adjustment parameters for nuclei segmentation.</p>

<p>show_plots : bool, optional
    Flag controlling the automatic display of visual results.</p>

<p>nuclei_results : dict, optional
    A dictionary storing numerical data (features) extracted from the nuclei.</p>

<p>images : dict, optional
    A dictionary storing output images and masks.</p>

<h2 id="attributes">Attributes</h2>

<p>image : np.ndarray
    The currently loaded image for analysis.</p>

<p>test_results : list
    The visual outcomes of NMS/Prob parameter tests.</p>

<p>hyperparameter_nuclei : dict
    A dictionary of active parameters used by the <code><a href="#NucleiFinder.find_nuclei">find_nuclei()</a></code> and <code><a href="#NucleiFinder.select_nuclei">select_nuclei()</a></code> methods.</p>

<p>hyperparameter_chromatinization : dict
    A dictionary of active parameters used by the <code><a href="#NucleiFinder.nuclei_chromatinization">nuclei_chromatinization()</a></code> method.</p>

<p>img_adj_par : dict
    Image correction parameters for nuclei segmentation.</p>

<p>img_adj_par_chrom : dict
    Image correction parameters for chromatin analysis.</p>

<p>show_plots : bool
    The state of the plot display flag.</p>

<p>nuclei_results : dict
    Stores feature dictionaries for: all detected ('nuclei'), selected ('nuclei_reduced'),
    and chromatinization data ('nuclei_chromatinization').</p>

<p>images : dict
    Stores masks and images visualizing the results.</p>

<p>series_im : bool
    Flag indicating if the class is operating in a batch or series processing mode.</p>

<h2 id="methods">Methods</h2>

<p>set_nms(nms)
    Sets the Non-Maximum Suppression (NMS) threshold.</p>

<p>set_prob(prob)
    Sets the segmentation probability threshold.</p>

<p>set_nuclei_circularity(circ)
    Sets the minimum required circularity for a nucleus.</p>

<p>set_nuclei_local_intenisty_FC(local_FC)
    Sets the factor used for removing false positives based on local intensity differences.</p>

<p>set_nuclei_global_area_FC(global_FC)
    Sets the factor used for removing size-based outlier false positives.</p>

<p>set_nuclei_size(size)
    Sets the minimum and maximum area (in pixels) for nuclei selection.</p>

<p>set_nuclei_min_mean_intensity(intensity)
    Sets the minimum required mean intensity value for a nucleus.</p>

<p>set_chromatinization_size(size)
    Sets the minimum and maximum area (in pixels) for chromatin spot selection.</p>

<p>set_chromatinization_cut_point(cut_point)
    Sets the factor used to adjust the chromatin segmentation threshold (Otsu's method).</p>

<p>set_adj_image_gamma(gamma)
    Sets the gamma correction for the nuclei image.</p>

<p>set_adj_chrom_contrast(contrast)
    Sets the contrast adjustment for the chromatinization image.</p>

<p>current_parameters_nuclei (property)
    Returns the active nuclei segmentation and filtering parameters.</p>

<p>find_nuclei()
    Performs nuclei segmentation using StarDist and extracts initial features.</p>

<p>select_nuclei()
    Filters the detected nuclei based on set morphological and intensity criteria.</p>

<p>nuclei_chromatinization()
    Performs quantitative and morphological analysis of chromatin spots in selected nuclei.</p>

<p>get_features(model_out, image)
    Calculates geometric and intensity features from a segmented mask (label image).</p>

<h2 id="notes">Notes</h2>

<p>The typical analysis workflow follows this order:</p>

<ol>
<li><code><a href="#NucleiFinder.input_image">input_image()</a></code></li>
<li><code><a href="#NucleiFinder.find_nuclei">find_nuclei()</a></code></li>
<li><code><a href="#NucleiFinder.select_nuclei">select_nuclei()</a></code> (Optional)</li>
<li><code><a href="#NucleiFinder.nuclei_chromatinization">nuclei_chromatinization()</a></code> (Optional)</li>
</ol>
</div>


                            <div id="NucleiFinder.__init__" class="classattr">
                                        <input id="NucleiFinder.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NucleiFinder</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">image</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">test_results</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">hyperparameter_nuclei</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">hyperparameter_chromatinization</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">img_adj_par_chrom</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">img_adj_par</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">show_plots</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">nuclei_results</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">images</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="NucleiFinder.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.__init__-1095"><a href="#NucleiFinder.__init__-1095"><span class="linenos">1095</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="NucleiFinder.__init__-1096"><a href="#NucleiFinder.__init__-1096"><span class="linenos">1096</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1097"><a href="#NucleiFinder.__init__-1097"><span class="linenos">1097</span></a>        <span class="n">image</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1098"><a href="#NucleiFinder.__init__-1098"><span class="linenos">1098</span></a>        <span class="n">test_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1099"><a href="#NucleiFinder.__init__-1099"><span class="linenos">1099</span></a>        <span class="n">hyperparameter_nuclei</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1100"><a href="#NucleiFinder.__init__-1100"><span class="linenos">1100</span></a>        <span class="n">hyperparameter_chromatinization</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1101"><a href="#NucleiFinder.__init__-1101"><span class="linenos">1101</span></a>        <span class="n">img_adj_par_chrom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1102"><a href="#NucleiFinder.__init__-1102"><span class="linenos">1102</span></a>        <span class="n">img_adj_par</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1103"><a href="#NucleiFinder.__init__-1103"><span class="linenos">1103</span></a>        <span class="n">show_plots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1104"><a href="#NucleiFinder.__init__-1104"><span class="linenos">1104</span></a>        <span class="n">nuclei_results</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1105"><a href="#NucleiFinder.__init__-1105"><span class="linenos">1105</span></a>        <span class="n">images</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1106"><a href="#NucleiFinder.__init__-1106"><span class="linenos">1106</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder.__init__-1107"><a href="#NucleiFinder.__init__-1107"><span class="linenos">1107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1108"><a href="#NucleiFinder.__init__-1108"><span class="linenos">1108</span></a><span class="sd">        The main class for the detection and analysis of cell nuclei and their chromatinization</span>
</span><span id="NucleiFinder.__init__-1109"><a href="#NucleiFinder.__init__-1109"><span class="linenos">1109</span></a><span class="sd">        in microscopy or flow cytometry images, utilizing the StarDist segmentation model.</span>
</span><span id="NucleiFinder.__init__-1110"><a href="#NucleiFinder.__init__-1110"><span class="linenos">1110</span></a>
</span><span id="NucleiFinder.__init__-1111"><a href="#NucleiFinder.__init__-1111"><span class="linenos">1111</span></a><span class="sd">        This class inherits functionality for image processing (ImageTools) and</span>
</span><span id="NucleiFinder.__init__-1112"><a href="#NucleiFinder.__init__-1112"><span class="linenos">1112</span></a><span class="sd">        results handling (RepTools).</span>
</span><span id="NucleiFinder.__init__-1113"><a href="#NucleiFinder.__init__-1113"><span class="linenos">1113</span></a>
</span><span id="NucleiFinder.__init__-1114"><a href="#NucleiFinder.__init__-1114"><span class="linenos">1114</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.__init__-1115"><a href="#NucleiFinder.__init__-1115"><span class="linenos">1115</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.__init__-1116"><a href="#NucleiFinder.__init__-1116"><span class="linenos">1116</span></a><span class="sd">        image : np.ndarray, optional</span>
</span><span id="NucleiFinder.__init__-1117"><a href="#NucleiFinder.__init__-1117"><span class="linenos">1117</span></a><span class="sd">            The input image for analysis.</span>
</span><span id="NucleiFinder.__init__-1118"><a href="#NucleiFinder.__init__-1118"><span class="linenos">1118</span></a><span class="sd">            Default: None.</span>
</span><span id="NucleiFinder.__init__-1119"><a href="#NucleiFinder.__init__-1119"><span class="linenos">1119</span></a>
</span><span id="NucleiFinder.__init__-1120"><a href="#NucleiFinder.__init__-1120"><span class="linenos">1120</span></a><span class="sd">        test_results : list, optional</span>
</span><span id="NucleiFinder.__init__-1121"><a href="#NucleiFinder.__init__-1121"><span class="linenos">1121</span></a><span class="sd">            A list of plots or images resulting from parameter testing.</span>
</span><span id="NucleiFinder.__init__-1122"><a href="#NucleiFinder.__init__-1122"><span class="linenos">1122</span></a><span class="sd">            Default: None.</span>
</span><span id="NucleiFinder.__init__-1123"><a href="#NucleiFinder.__init__-1123"><span class="linenos">1123</span></a>
</span><span id="NucleiFinder.__init__-1124"><a href="#NucleiFinder.__init__-1124"><span class="linenos">1124</span></a><span class="sd">        hyperparameter_nuclei : dict, optional</span>
</span><span id="NucleiFinder.__init__-1125"><a href="#NucleiFinder.__init__-1125"><span class="linenos">1125</span></a><span class="sd">            The segmentation parameters for nuclei detection.</span>
</span><span id="NucleiFinder.__init__-1126"><a href="#NucleiFinder.__init__-1126"><span class="linenos">1126</span></a><span class="sd">            Default:</span>
</span><span id="NucleiFinder.__init__-1127"><a href="#NucleiFinder.__init__-1127"><span class="linenos">1127</span></a><span class="sd">            {&#39;nms&#39;: 0.8, &#39;prob&#39;: 0.4, &#39;max_size&#39;: 1000, &#39;min_size&#39;: 20,</span>
</span><span id="NucleiFinder.__init__-1128"><a href="#NucleiFinder.__init__-1128"><span class="linenos">1128</span></a><span class="sd">             &#39;circularity&#39;: 0.6, &#39;intensity_mean&#39;: 6553.5, &#39;nn_min&#39;: 10,</span>
</span><span id="NucleiFinder.__init__-1129"><a href="#NucleiFinder.__init__-1129"><span class="linenos">1129</span></a><span class="sd">             &#39;FC_diff_global&#39;: 1.5, &#39;FC_diff_local_intensity&#39;: 0.6}</span>
</span><span id="NucleiFinder.__init__-1130"><a href="#NucleiFinder.__init__-1130"><span class="linenos">1130</span></a>
</span><span id="NucleiFinder.__init__-1131"><a href="#NucleiFinder.__init__-1131"><span class="linenos">1131</span></a><span class="sd">        hyperparameter_chromatinization : dict, optional</span>
</span><span id="NucleiFinder.__init__-1132"><a href="#NucleiFinder.__init__-1132"><span class="linenos">1132</span></a><span class="sd">            The analysis parameters for chromatin spots within the nuclei.</span>
</span><span id="NucleiFinder.__init__-1133"><a href="#NucleiFinder.__init__-1133"><span class="linenos">1133</span></a><span class="sd">            Default:</span>
</span><span id="NucleiFinder.__init__-1134"><a href="#NucleiFinder.__init__-1134"><span class="linenos">1134</span></a><span class="sd">            {&#39;max_size&#39;: 800, &#39;min_size&#39;: 2, &#39;ratio&#39;: 0.1, &#39;cut_point&#39;: 0.95}</span>
</span><span id="NucleiFinder.__init__-1135"><a href="#NucleiFinder.__init__-1135"><span class="linenos">1135</span></a>
</span><span id="NucleiFinder.__init__-1136"><a href="#NucleiFinder.__init__-1136"><span class="linenos">1136</span></a><span class="sd">        img_adj_par_chrom : dict, optional</span>
</span><span id="NucleiFinder.__init__-1137"><a href="#NucleiFinder.__init__-1137"><span class="linenos">1137</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for chromatin analysis.</span>
</span><span id="NucleiFinder.__init__-1138"><a href="#NucleiFinder.__init__-1138"><span class="linenos">1138</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.25, &#39;contrast&#39;: 5, &#39;brightness&#39;: 950}</span>
</span><span id="NucleiFinder.__init__-1139"><a href="#NucleiFinder.__init__-1139"><span class="linenos">1139</span></a>
</span><span id="NucleiFinder.__init__-1140"><a href="#NucleiFinder.__init__-1140"><span class="linenos">1140</span></a><span class="sd">        img_adj_par : dict, optional</span>
</span><span id="NucleiFinder.__init__-1141"><a href="#NucleiFinder.__init__-1141"><span class="linenos">1141</span></a><span class="sd">            Image adjustment parameters (gamma, contrast, brightness) for nuclei segmentation.</span>
</span><span id="NucleiFinder.__init__-1142"><a href="#NucleiFinder.__init__-1142"><span class="linenos">1142</span></a><span class="sd">            Default: {&#39;gamma&#39;: 0.9, &#39;contrast&#39;: 2, &#39;brightness&#39;: 1000}</span>
</span><span id="NucleiFinder.__init__-1143"><a href="#NucleiFinder.__init__-1143"><span class="linenos">1143</span></a>
</span><span id="NucleiFinder.__init__-1144"><a href="#NucleiFinder.__init__-1144"><span class="linenos">1144</span></a><span class="sd">        show_plots : bool, optional</span>
</span><span id="NucleiFinder.__init__-1145"><a href="#NucleiFinder.__init__-1145"><span class="linenos">1145</span></a><span class="sd">            Flag to determine whether results and plots should be displayed automatically.</span>
</span><span id="NucleiFinder.__init__-1146"><a href="#NucleiFinder.__init__-1146"><span class="linenos">1146</span></a><span class="sd">            Default: True.</span>
</span><span id="NucleiFinder.__init__-1147"><a href="#NucleiFinder.__init__-1147"><span class="linenos">1147</span></a>
</span><span id="NucleiFinder.__init__-1148"><a href="#NucleiFinder.__init__-1148"><span class="linenos">1148</span></a><span class="sd">        nuclei_results : dict, optional</span>
</span><span id="NucleiFinder.__init__-1149"><a href="#NucleiFinder.__init__-1149"><span class="linenos">1149</span></a><span class="sd">            A dictionary storing the numerical results of the analysis.</span>
</span><span id="NucleiFinder.__init__-1150"><a href="#NucleiFinder.__init__-1150"><span class="linenos">1150</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="NucleiFinder.__init__-1151"><a href="#NucleiFinder.__init__-1151"><span class="linenos">1151</span></a>
</span><span id="NucleiFinder.__init__-1152"><a href="#NucleiFinder.__init__-1152"><span class="linenos">1152</span></a><span class="sd">        images : dict, optional</span>
</span><span id="NucleiFinder.__init__-1153"><a href="#NucleiFinder.__init__-1153"><span class="linenos">1153</span></a><span class="sd">            A dictionary storing the output images (e.g., masks).</span>
</span><span id="NucleiFinder.__init__-1154"><a href="#NucleiFinder.__init__-1154"><span class="linenos">1154</span></a><span class="sd">            Default: {&#39;nuclei&#39;: None, &#39;nuclei_reduced&#39;: None, &#39;nuclei_chromatinization&#39;: None}</span>
</span><span id="NucleiFinder.__init__-1155"><a href="#NucleiFinder.__init__-1155"><span class="linenos">1155</span></a>
</span><span id="NucleiFinder.__init__-1156"><a href="#NucleiFinder.__init__-1156"><span class="linenos">1156</span></a><span class="sd">        Attributes</span>
</span><span id="NucleiFinder.__init__-1157"><a href="#NucleiFinder.__init__-1157"><span class="linenos">1157</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.__init__-1158"><a href="#NucleiFinder.__init__-1158"><span class="linenos">1158</span></a><span class="sd">        image : np.ndarray</span>
</span><span id="NucleiFinder.__init__-1159"><a href="#NucleiFinder.__init__-1159"><span class="linenos">1159</span></a><span class="sd">            The currently loaded image for analysis.</span>
</span><span id="NucleiFinder.__init__-1160"><a href="#NucleiFinder.__init__-1160"><span class="linenos">1160</span></a>
</span><span id="NucleiFinder.__init__-1161"><a href="#NucleiFinder.__init__-1161"><span class="linenos">1161</span></a><span class="sd">        hyperparameter_nuclei : dict</span>
</span><span id="NucleiFinder.__init__-1162"><a href="#NucleiFinder.__init__-1162"><span class="linenos">1162</span></a><span class="sd">            Active nuclei segmentation parameters.</span>
</span><span id="NucleiFinder.__init__-1163"><a href="#NucleiFinder.__init__-1163"><span class="linenos">1163</span></a>
</span><span id="NucleiFinder.__init__-1164"><a href="#NucleiFinder.__init__-1164"><span class="linenos">1164</span></a><span class="sd">        hyperparameter_chromatinization : dict</span>
</span><span id="NucleiFinder.__init__-1165"><a href="#NucleiFinder.__init__-1165"><span class="linenos">1165</span></a><span class="sd">            Active chromatinization analysis parameters.</span>
</span><span id="NucleiFinder.__init__-1166"><a href="#NucleiFinder.__init__-1166"><span class="linenos">1166</span></a>
</span><span id="NucleiFinder.__init__-1167"><a href="#NucleiFinder.__init__-1167"><span class="linenos">1167</span></a><span class="sd">        img_adj_par : dict</span>
</span><span id="NucleiFinder.__init__-1168"><a href="#NucleiFinder.__init__-1168"><span class="linenos">1168</span></a><span class="sd">            Active image correction parameters for nuclei segmentation.</span>
</span><span id="NucleiFinder.__init__-1169"><a href="#NucleiFinder.__init__-1169"><span class="linenos">1169</span></a>
</span><span id="NucleiFinder.__init__-1170"><a href="#NucleiFinder.__init__-1170"><span class="linenos">1170</span></a><span class="sd">        img_adj_par_chrom : dict</span>
</span><span id="NucleiFinder.__init__-1171"><a href="#NucleiFinder.__init__-1171"><span class="linenos">1171</span></a><span class="sd">            Active image correction parameters for chromatin analysis.</span>
</span><span id="NucleiFinder.__init__-1172"><a href="#NucleiFinder.__init__-1172"><span class="linenos">1172</span></a>
</span><span id="NucleiFinder.__init__-1173"><a href="#NucleiFinder.__init__-1173"><span class="linenos">1173</span></a><span class="sd">        show_plots : bool</span>
</span><span id="NucleiFinder.__init__-1174"><a href="#NucleiFinder.__init__-1174"><span class="linenos">1174</span></a><span class="sd">            The current state of the plot display flag.</span>
</span><span id="NucleiFinder.__init__-1175"><a href="#NucleiFinder.__init__-1175"><span class="linenos">1175</span></a>
</span><span id="NucleiFinder.__init__-1176"><a href="#NucleiFinder.__init__-1176"><span class="linenos">1176</span></a><span class="sd">        series_im : bool</span>
</span><span id="NucleiFinder.__init__-1177"><a href="#NucleiFinder.__init__-1177"><span class="linenos">1177</span></a><span class="sd">            Flag indicating if a series of images is being processed.</span>
</span><span id="NucleiFinder.__init__-1178"><a href="#NucleiFinder.__init__-1178"><span class="linenos">1178</span></a>
</span><span id="NucleiFinder.__init__-1179"><a href="#NucleiFinder.__init__-1179"><span class="linenos">1179</span></a><span class="sd">        Notes</span>
</span><span id="NucleiFinder.__init__-1180"><a href="#NucleiFinder.__init__-1180"><span class="linenos">1180</span></a><span class="sd">        -----</span>
</span><span id="NucleiFinder.__init__-1181"><a href="#NucleiFinder.__init__-1181"><span class="linenos">1181</span></a><span class="sd">        The default value for &#39;intensity_mean&#39; in hyperparameter_nuclei is calculated</span>
</span><span id="NucleiFinder.__init__-1182"><a href="#NucleiFinder.__init__-1182"><span class="linenos">1182</span></a><span class="sd">        as $(2^{16} - 1) / 10$, which represents 10% of the maximum 16-bit value (65535 / 10 = 6553.5).</span>
</span><span id="NucleiFinder.__init__-1183"><a href="#NucleiFinder.__init__-1183"><span class="linenos">1183</span></a>
</span><span id="NucleiFinder.__init__-1184"><a href="#NucleiFinder.__init__-1184"><span class="linenos">1184</span></a><span class="sd">        The image adjustment parameters are crucial for optimizing contrast and brightness</span>
</span><span id="NucleiFinder.__init__-1185"><a href="#NucleiFinder.__init__-1185"><span class="linenos">1185</span></a><span class="sd">        to improve the performance of both the StarDist model and the subsequent</span>
</span><span id="NucleiFinder.__init__-1186"><a href="#NucleiFinder.__init__-1186"><span class="linenos">1186</span></a><span class="sd">        chromatin thresholding.</span>
</span><span id="NucleiFinder.__init__-1187"><a href="#NucleiFinder.__init__-1187"><span class="linenos">1187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1188"><a href="#NucleiFinder.__init__-1188"><span class="linenos">1188</span></a>
</span><span id="NucleiFinder.__init__-1189"><a href="#NucleiFinder.__init__-1189"><span class="linenos">1189</span></a>        <span class="c1"># Use default values if parameters are None</span>
</span><span id="NucleiFinder.__init__-1190"><a href="#NucleiFinder.__init__-1190"><span class="linenos">1190</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="NucleiFinder.__init__-1191"><a href="#NucleiFinder.__init__-1191"><span class="linenos">1191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Loaded input image.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1192"><a href="#NucleiFinder.__init__-1192"><span class="linenos">1192</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">test_results</span> <span class="ow">or</span> <span class="kc">None</span>
</span><span id="NucleiFinder.__init__-1193"><a href="#NucleiFinder.__init__-1193"><span class="linenos">1193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Results of parameter tests.</span>
</span><span id="NucleiFinder.__init__-1194"><a href="#NucleiFinder.__init__-1194"><span class="linenos">1194</span></a>
</span><span id="NucleiFinder.__init__-1195"><a href="#NucleiFinder.__init__-1195"><span class="linenos">1195</span></a><span class="sd">            This attribute or method stores the outcomes of parameter testing procedures.</span>
</span><span id="NucleiFinder.__init__-1196"><a href="#NucleiFinder.__init__-1196"><span class="linenos">1196</span></a><span class="sd">            For interactive browsing and inspection of the results, use the </span>
</span><span id="NucleiFinder.__init__-1197"><a href="#NucleiFinder.__init__-1197"><span class="linenos">1197</span></a><span class="sd">            `browser_test(self)` method.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1198"><a href="#NucleiFinder.__init__-1198"><span class="linenos">1198</span></a>
</span><span id="NucleiFinder.__init__-1199"><a href="#NucleiFinder.__init__-1199"><span class="linenos">1199</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span> <span class="o">=</span> <span class="n">hyperparameter_nuclei</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1200"><a href="#NucleiFinder.__init__-1200"><span class="linenos">1200</span></a>            <span class="s2">&quot;nms&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1201"><a href="#NucleiFinder.__init__-1201"><span class="linenos">1201</span></a>            <span class="s2">&quot;prob&quot;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1202"><a href="#NucleiFinder.__init__-1202"><span class="linenos">1202</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1203"><a href="#NucleiFinder.__init__-1203"><span class="linenos">1203</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1204"><a href="#NucleiFinder.__init__-1204"><span class="linenos">1204</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1205"><a href="#NucleiFinder.__init__-1205"><span class="linenos">1205</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1206"><a href="#NucleiFinder.__init__-1206"><span class="linenos">1206</span></a>            <span class="s2">&quot;nn_min&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1207"><a href="#NucleiFinder.__init__-1207"><span class="linenos">1207</span></a>            <span class="s2">&quot;FC_diff_global&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1208"><a href="#NucleiFinder.__init__-1208"><span class="linenos">1208</span></a>            <span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1209"><a href="#NucleiFinder.__init__-1209"><span class="linenos">1209</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1210"><a href="#NucleiFinder.__init__-1210"><span class="linenos">1210</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active nuclei segmentation/filter parameters.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1211"><a href="#NucleiFinder.__init__-1211"><span class="linenos">1211</span></a>
</span><span id="NucleiFinder.__init__-1212"><a href="#NucleiFinder.__init__-1212"><span class="linenos">1212</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span> <span class="o">=</span> <span class="n">hyperparameter_chromatinization</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1213"><a href="#NucleiFinder.__init__-1213"><span class="linenos">1213</span></a>            <span class="s2">&quot;max_size&quot;</span><span class="p">:</span> <span class="mi">800</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1214"><a href="#NucleiFinder.__init__-1214"><span class="linenos">1214</span></a>            <span class="s2">&quot;min_size&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1215"><a href="#NucleiFinder.__init__-1215"><span class="linenos">1215</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1216"><a href="#NucleiFinder.__init__-1216"><span class="linenos">1216</span></a>            <span class="s2">&quot;cut_point&quot;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1217"><a href="#NucleiFinder.__init__-1217"><span class="linenos">1217</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1218"><a href="#NucleiFinder.__init__-1218"><span class="linenos">1218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Active chromatin analysis parameters.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1219"><a href="#NucleiFinder.__init__-1219"><span class="linenos">1219</span></a>
</span><span id="NucleiFinder.__init__-1220"><a href="#NucleiFinder.__init__-1220"><span class="linenos">1220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span> <span class="o">=</span> <span class="n">img_adj_par_chrom</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1221"><a href="#NucleiFinder.__init__-1221"><span class="linenos">1221</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.25</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1222"><a href="#NucleiFinder.__init__-1222"><span class="linenos">1222</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1223"><a href="#NucleiFinder.__init__-1223"><span class="linenos">1223</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">950</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1224"><a href="#NucleiFinder.__init__-1224"><span class="linenos">1224</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1225"><a href="#NucleiFinder.__init__-1225"><span class="linenos">1225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for chromatin analysis.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1226"><a href="#NucleiFinder.__init__-1226"><span class="linenos">1226</span></a>
</span><span id="NucleiFinder.__init__-1227"><a href="#NucleiFinder.__init__-1227"><span class="linenos">1227</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span> <span class="o">=</span> <span class="n">img_adj_par</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1228"><a href="#NucleiFinder.__init__-1228"><span class="linenos">1228</span></a>            <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1229"><a href="#NucleiFinder.__init__-1229"><span class="linenos">1229</span></a>            <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1230"><a href="#NucleiFinder.__init__-1230"><span class="linenos">1230</span></a>            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1231"><a href="#NucleiFinder.__init__-1231"><span class="linenos">1231</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1232"><a href="#NucleiFinder.__init__-1232"><span class="linenos">1232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Image adjustment for nuclei segmentation.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1233"><a href="#NucleiFinder.__init__-1233"><span class="linenos">1233</span></a>
</span><span id="NucleiFinder.__init__-1234"><a href="#NucleiFinder.__init__-1234"><span class="linenos">1234</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="n">show_plots</span> <span class="ow">or</span> <span class="kc">True</span>
</span><span id="NucleiFinder.__init__-1235"><a href="#NucleiFinder.__init__-1235"><span class="linenos">1235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag controlling plot display.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1236"><a href="#NucleiFinder.__init__-1236"><span class="linenos">1236</span></a>
</span><span id="NucleiFinder.__init__-1237"><a href="#NucleiFinder.__init__-1237"><span class="linenos">1237</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span> <span class="o">=</span> <span class="n">nuclei_results</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1238"><a href="#NucleiFinder.__init__-1238"><span class="linenos">1238</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1239"><a href="#NucleiFinder.__init__-1239"><span class="linenos">1239</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1240"><a href="#NucleiFinder.__init__-1240"><span class="linenos">1240</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1241"><a href="#NucleiFinder.__init__-1241"><span class="linenos">1241</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1242"><a href="#NucleiFinder.__init__-1242"><span class="linenos">1242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of nuclei analysis results.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1243"><a href="#NucleiFinder.__init__-1243"><span class="linenos">1243</span></a>
</span><span id="NucleiFinder.__init__-1244"><a href="#NucleiFinder.__init__-1244"><span class="linenos">1244</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">images</span> <span class="ow">or</span> <span class="p">{</span>
</span><span id="NucleiFinder.__init__-1245"><a href="#NucleiFinder.__init__-1245"><span class="linenos">1245</span></a>            <span class="s2">&quot;nuclei&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1246"><a href="#NucleiFinder.__init__-1246"><span class="linenos">1246</span></a>            <span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1247"><a href="#NucleiFinder.__init__-1247"><span class="linenos">1247</span></a>            <span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="NucleiFinder.__init__-1248"><a href="#NucleiFinder.__init__-1248"><span class="linenos">1248</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.__init__-1249"><a href="#NucleiFinder.__init__-1249"><span class="linenos">1249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary of images from nuclei analysis.&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.__init__-1250"><a href="#NucleiFinder.__init__-1250"><span class="linenos">1250</span></a>
</span><span id="NucleiFinder.__init__-1251"><a href="#NucleiFinder.__init__-1251"><span class="linenos">1251</span></a>        <span class="c1"># sereies images</span>
</span><span id="NucleiFinder.__init__-1252"><a href="#NucleiFinder.__init__-1252"><span class="linenos">1252</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.__init__-1253"><a href="#NucleiFinder.__init__-1253"><span class="linenos">1253</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Flag for batch/series image processing.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>The main class for the detection and analysis of cell nuclei and their chromatinization
in microscopy or flow cytometry images, utilizing the StarDist segmentation model.</p>

<p>This class inherits functionality for image processing (ImageTools) and
results handling (RepTools).</p>

<h2 id="parameters">Parameters</h2>

<p>image : np.ndarray, optional
    The input image for analysis.
    Default: None.</p>

<p>test_results : list, optional
    A list of plots or images resulting from parameter testing.
    Default: None.</p>

<p>hyperparameter_nuclei : dict, optional
    The segmentation parameters for nuclei detection.
    Default:
    {'nms': 0.8, 'prob': 0.4, 'max_size': 1000, 'min_size': 20,
     'circularity': 0.6, 'intensity_mean': 6553.5, 'nn_min': 10,
     'FC_diff_global': 1.5, 'FC_diff_local_intensity': 0.6}</p>

<p>hyperparameter_chromatinization : dict, optional
    The analysis parameters for chromatin spots within the nuclei.
    Default:
    {'max_size': 800, 'min_size': 2, 'ratio': 0.1, 'cut_point': 0.95}</p>

<p>img_adj_par_chrom : dict, optional
    Image adjustment parameters (gamma, contrast, brightness) for chromatin analysis.
    Default: {'gamma': 0.25, 'contrast': 5, 'brightness': 950}</p>

<p>img_adj_par : dict, optional
    Image adjustment parameters (gamma, contrast, brightness) for nuclei segmentation.
    Default: {'gamma': 0.9, 'contrast': 2, 'brightness': 1000}</p>

<p>show_plots : bool, optional
    Flag to determine whether results and plots should be displayed automatically.
    Default: True.</p>

<p>nuclei_results : dict, optional
    A dictionary storing the numerical results of the analysis.
    Default: {'nuclei': None, 'nuclei_reduced': None, 'nuclei_chromatinization': None}</p>

<p>images : dict, optional
    A dictionary storing the output images (e.g., masks).
    Default: {'nuclei': None, 'nuclei_reduced': None, 'nuclei_chromatinization': None}</p>

<h2 id="attributes">Attributes</h2>

<p>image : np.ndarray
    The currently loaded image for analysis.</p>

<p>hyperparameter_nuclei : dict
    Active nuclei segmentation parameters.</p>

<p>hyperparameter_chromatinization : dict
    Active chromatinization analysis parameters.</p>

<p>img_adj_par : dict
    Active image correction parameters for nuclei segmentation.</p>

<p>img_adj_par_chrom : dict
    Active image correction parameters for chromatin analysis.</p>

<p>show_plots : bool
    The current state of the plot display flag.</p>

<p>series_im : bool
    Flag indicating if a series of images is being processed.</p>

<h2 id="notes">Notes</h2>

<p>The default value for 'intensity_mean' in hyperparameter_nuclei is calculated
as $(2^{16} - 1) / 10$, which represents 10% of the maximum 16-bit value (65535 / 10 = 6553.5).</p>

<p>The image adjustment parameters are crucial for optimizing contrast and brightness
to improve the performance of both the StarDist model and the subsequent
chromatin thresholding.</p>
</div>


                            </div>
                            <div id="NucleiFinder.image" class="classattr">
                                <div class="attr variable">
            <span class="name">image</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.image"></a>
    
            <div class="docstring"><p>Loaded input image.</p>
</div>


                            </div>
                            <div id="NucleiFinder.test_results" class="classattr">
                                <div class="attr variable">
            <span class="name">test_results</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.test_results"></a>
    
            <div class="docstring"><p>Results of parameter tests.</p>

<p>This attribute or method stores the outcomes of parameter testing procedures.
For interactive browsing and inspection of the results, use the 
<code>browser_test(self)</code> method.</p>
</div>


                            </div>
                            <div id="NucleiFinder.hyperparameter_nuclei" class="classattr">
                                <div class="attr variable">
            <span class="name">hyperparameter_nuclei</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.hyperparameter_nuclei"></a>
    
            <div class="docstring"><p>Active nuclei segmentation/filter parameters.</p>
</div>


                            </div>
                            <div id="NucleiFinder.hyperparameter_chromatinization" class="classattr">
                                <div class="attr variable">
            <span class="name">hyperparameter_chromatinization</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.hyperparameter_chromatinization"></a>
    
            <div class="docstring"><p>Active chromatin analysis parameters.</p>
</div>


                            </div>
                            <div id="NucleiFinder.img_adj_par_chrom" class="classattr">
                                <div class="attr variable">
            <span class="name">img_adj_par_chrom</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.img_adj_par_chrom"></a>
    
            <div class="docstring"><p>Image adjustment for chromatin analysis.</p>
</div>


                            </div>
                            <div id="NucleiFinder.img_adj_par" class="classattr">
                                <div class="attr variable">
            <span class="name">img_adj_par</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.img_adj_par"></a>
    
            <div class="docstring"><p>Image adjustment for nuclei segmentation.</p>
</div>


                            </div>
                            <div id="NucleiFinder.show_plots" class="classattr">
                                <div class="attr variable">
            <span class="name">show_plots</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.show_plots"></a>
    
            <div class="docstring"><p>Flag controlling plot display.</p>
</div>


                            </div>
                            <div id="NucleiFinder.nuclei_results" class="classattr">
                                <div class="attr variable">
            <span class="name">nuclei_results</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.nuclei_results"></a>
    
            <div class="docstring"><p>Stored dictionary of nuclei analysis results.</p>
</div>


                            </div>
                            <div id="NucleiFinder.images" class="classattr">
                                <div class="attr variable">
            <span class="name">images</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.images"></a>
    
            <div class="docstring"><p>Stored dictionary of images from nuclei analysis.</p>
</div>


                            </div>
                            <div id="NucleiFinder.series_im" class="classattr">
                                <div class="attr variable">
            <span class="name">series_im</span>

        
    </div>
    <a class="headerlink" href="#NucleiFinder.series_im"></a>
    
            <div class="docstring"><p>Flag for batch/series image processing.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nms" class="classattr">
                                        <input id="NucleiFinder.set_nms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">nms</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nms-1255"><a href="#NucleiFinder.set_nms-1255"><span class="linenos">1255</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nms</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nms-1256"><a href="#NucleiFinder.set_nms-1256"><span class="linenos">1256</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nms-1257"><a href="#NucleiFinder.set_nms-1257"><span class="linenos">1257</span></a><span class="sd">        Set the Non-Maximum Suppression (NMS) threshold.</span>
</span><span id="NucleiFinder.set_nms-1258"><a href="#NucleiFinder.set_nms-1258"><span class="linenos">1258</span></a>
</span><span id="NucleiFinder.set_nms-1259"><a href="#NucleiFinder.set_nms-1259"><span class="linenos">1259</span></a><span class="sd">        The NMS threshold controls how aggressively overlapping detections are suppressed.</span>
</span><span id="NucleiFinder.set_nms-1260"><a href="#NucleiFinder.set_nms-1260"><span class="linenos">1260</span></a><span class="sd">        A lower value reduces the probability of overlapping nuclei being kept.</span>
</span><span id="NucleiFinder.set_nms-1261"><a href="#NucleiFinder.set_nms-1261"><span class="linenos">1261</span></a>
</span><span id="NucleiFinder.set_nms-1262"><a href="#NucleiFinder.set_nms-1262"><span class="linenos">1262</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nms-1263"><a href="#NucleiFinder.set_nms-1263"><span class="linenos">1263</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nms-1264"><a href="#NucleiFinder.set_nms-1264"><span class="linenos">1264</span></a><span class="sd">        nms : float</span>
</span><span id="NucleiFinder.set_nms-1265"><a href="#NucleiFinder.set_nms-1265"><span class="linenos">1265</span></a><span class="sd">            The NMS IoU threshold value.</span>
</span><span id="NucleiFinder.set_nms-1266"><a href="#NucleiFinder.set_nms-1266"><span class="linenos">1266</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nms-1267"><a href="#NucleiFinder.set_nms-1267"><span class="linenos">1267</span></a>
</span><span id="NucleiFinder.set_nms-1268"><a href="#NucleiFinder.set_nms-1268"><span class="linenos">1268</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nms</span>
</span></pre></div>


            <div class="docstring"><p>Set the Non-Maximum Suppression (NMS) threshold.</p>

<p>The NMS threshold controls how aggressively overlapping detections are suppressed.
A lower value reduces the probability of overlapping nuclei being kept.</p>

<h2 id="parameters">Parameters</h2>

<p>nms : float
    The NMS IoU threshold value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_prob" class="classattr">
                                        <input id="NucleiFinder.set_prob-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_prob</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prob</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_prob-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_prob"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_prob-1270"><a href="#NucleiFinder.set_prob-1270"><span class="linenos">1270</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_prob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prob</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_prob-1271"><a href="#NucleiFinder.set_prob-1271"><span class="linenos">1271</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_prob-1272"><a href="#NucleiFinder.set_prob-1272"><span class="linenos">1272</span></a><span class="sd">        Set the probability threshold used in segmentation.</span>
</span><span id="NucleiFinder.set_prob-1273"><a href="#NucleiFinder.set_prob-1273"><span class="linenos">1273</span></a>
</span><span id="NucleiFinder.set_prob-1274"><a href="#NucleiFinder.set_prob-1274"><span class="linenos">1274</span></a><span class="sd">        The probability threshold determines the minimum confidence required for an object</span>
</span><span id="NucleiFinder.set_prob-1275"><a href="#NucleiFinder.set_prob-1275"><span class="linenos">1275</span></a><span class="sd">        (e.g., a nucleus) to be classified as a segmented entity. Higher values result in</span>
</span><span id="NucleiFinder.set_prob-1276"><a href="#NucleiFinder.set_prob-1276"><span class="linenos">1276</span></a><span class="sd">        fewer segmented objects, as only detections with strong confidence scores are kept.</span>
</span><span id="NucleiFinder.set_prob-1277"><a href="#NucleiFinder.set_prob-1277"><span class="linenos">1277</span></a><span class="sd">        This may lead to omission of weaker or less distinct structures.</span>
</span><span id="NucleiFinder.set_prob-1278"><a href="#NucleiFinder.set_prob-1278"><span class="linenos">1278</span></a>
</span><span id="NucleiFinder.set_prob-1279"><a href="#NucleiFinder.set_prob-1279"><span class="linenos">1279</span></a><span class="sd">        Because optimal values depend on image characteristics, it is important to visually</span>
</span><span id="NucleiFinder.set_prob-1280"><a href="#NucleiFinder.set_prob-1280"><span class="linenos">1280</span></a><span class="sd">        inspect segmentation results produced with different thresholds to determine the</span>
</span><span id="NucleiFinder.set_prob-1281"><a href="#NucleiFinder.set_prob-1281"><span class="linenos">1281</span></a><span class="sd">        most suitable setting.</span>
</span><span id="NucleiFinder.set_prob-1282"><a href="#NucleiFinder.set_prob-1282"><span class="linenos">1282</span></a>
</span><span id="NucleiFinder.set_prob-1283"><a href="#NucleiFinder.set_prob-1283"><span class="linenos">1283</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_prob-1284"><a href="#NucleiFinder.set_prob-1284"><span class="linenos">1284</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_prob-1285"><a href="#NucleiFinder.set_prob-1285"><span class="linenos">1285</span></a><span class="sd">        prob : float</span>
</span><span id="NucleiFinder.set_prob-1286"><a href="#NucleiFinder.set_prob-1286"><span class="linenos">1286</span></a><span class="sd">            The probability threshold value.</span>
</span><span id="NucleiFinder.set_prob-1287"><a href="#NucleiFinder.set_prob-1287"><span class="linenos">1287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_prob-1288"><a href="#NucleiFinder.set_prob-1288"><span class="linenos">1288</span></a>
</span><span id="NucleiFinder.set_prob-1289"><a href="#NucleiFinder.set_prob-1289"><span class="linenos">1289</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prob</span>
</span></pre></div>


            <div class="docstring"><p>Set the probability threshold used in segmentation.</p>

<p>The probability threshold determines the minimum confidence required for an object
(e.g., a nucleus) to be classified as a segmented entity. Higher values result in
fewer segmented objects, as only detections with strong confidence scores are kept.
This may lead to omission of weaker or less distinct structures.</p>

<p>Because optimal values depend on image characteristics, it is important to visually
inspect segmentation results produced with different thresholds to determine the
most suitable setting.</p>

<h2 id="parameters">Parameters</h2>

<p>prob : float
    The probability threshold value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nuclei_circularity" class="classattr">
                                        <input id="NucleiFinder.set_nuclei_circularity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nuclei_circularity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">circ</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nuclei_circularity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nuclei_circularity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nuclei_circularity-1291"><a href="#NucleiFinder.set_nuclei_circularity-1291"><span class="linenos">1291</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_circularity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">circ</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1292"><a href="#NucleiFinder.set_nuclei_circularity-1292"><span class="linenos">1292</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1293"><a href="#NucleiFinder.set_nuclei_circularity-1293"><span class="linenos">1293</span></a><span class="sd">        This method sets &#39;circ&#39; parameter. The circ is a parameter used for adjust minimal nucleus circularity.</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1294"><a href="#NucleiFinder.set_nuclei_circularity-1294"><span class="linenos">1294</span></a>
</span><span id="NucleiFinder.set_nuclei_circularity-1295"><a href="#NucleiFinder.set_nuclei_circularity-1295"><span class="linenos">1295</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1296"><a href="#NucleiFinder.set_nuclei_circularity-1296"><span class="linenos">1296</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1297"><a href="#NucleiFinder.set_nuclei_circularity-1297"><span class="linenos">1297</span></a><span class="sd">        circ : float</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1298"><a href="#NucleiFinder.set_nuclei_circularity-1298"><span class="linenos">1298</span></a><span class="sd">            Nuclei circularity value.</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1299"><a href="#NucleiFinder.set_nuclei_circularity-1299"><span class="linenos">1299</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_circularity-1300"><a href="#NucleiFinder.set_nuclei_circularity-1300"><span class="linenos">1300</span></a>
</span><span id="NucleiFinder.set_nuclei_circularity-1301"><a href="#NucleiFinder.set_nuclei_circularity-1301"><span class="linenos">1301</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">circ</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'circ' parameter. The circ is a parameter used for adjust minimal nucleus circularity.</p>

<h2 id="parameters">Parameters</h2>

<p>circ : float
    Nuclei circularity value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nuclei_local_intenisty_FC" class="classattr">
                                        <input id="NucleiFinder.set_nuclei_local_intenisty_FC-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nuclei_local_intenisty_FC</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">local_FC</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nuclei_local_intenisty_FC-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nuclei_local_intenisty_FC"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1303"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1303"><span class="linenos">1303</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_local_intenisty_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1304"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1304"><span class="linenos">1304</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1305"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1305"><span class="linenos">1305</span></a><span class="sd">        This method sets the &#39;FC_diff_local_intensity&#39; parameter. The &#39;local_FC&#39; is used to remove false positive multiple nuclei that were detected in single image.</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1306"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1306"><span class="linenos">1306</span></a>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1307"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1307"><span class="linenos">1307</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1308"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1308"><span class="linenos">1308</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1309"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1309"><span class="linenos">1309</span></a><span class="sd">        local_FC : float</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1310"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1310"><span class="linenos">1310</span></a><span class="sd">            local_FC value.</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1311"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1311"><span class="linenos">1311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1312"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1312"><span class="linenos">1312</span></a>
</span><span id="NucleiFinder.set_nuclei_local_intenisty_FC-1313"><a href="#NucleiFinder.set_nuclei_local_intenisty_FC-1313"><span class="linenos">1313</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_local_intensity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_FC</span>
</span></pre></div>


            <div class="docstring"><p>This method sets the 'FC_diff_local_intensity' parameter. The 'local_FC' is used to remove false positive multiple nuclei that were detected in single image.</p>

<h2 id="parameters">Parameters</h2>

<p>local_FC : float
    local_FC value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nuclei_global_area_FC" class="classattr">
                                        <input id="NucleiFinder.set_nuclei_global_area_FC-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nuclei_global_area_FC</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">global_FC</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nuclei_global_area_FC-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nuclei_global_area_FC"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nuclei_global_area_FC-1316"><a href="#NucleiFinder.set_nuclei_global_area_FC-1316"><span class="linenos">1316</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_global_area_FC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">global_FC</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1317"><a href="#NucleiFinder.set_nuclei_global_area_FC-1317"><span class="linenos">1317</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1318"><a href="#NucleiFinder.set_nuclei_global_area_FC-1318"><span class="linenos">1318</span></a><span class="sd">        This method sets the &#39;FC_diff_global&#39; parameter. The &#39;global_FC&#39; is used to remove false positive multiple nuclei that were detected in a single image and are outliers from the global mean area size.</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1319"><a href="#NucleiFinder.set_nuclei_global_area_FC-1319"><span class="linenos">1319</span></a>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1320"><a href="#NucleiFinder.set_nuclei_global_area_FC-1320"><span class="linenos">1320</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1321"><a href="#NucleiFinder.set_nuclei_global_area_FC-1321"><span class="linenos">1321</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1322"><a href="#NucleiFinder.set_nuclei_global_area_FC-1322"><span class="linenos">1322</span></a><span class="sd">        FC_diff_global : float</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1323"><a href="#NucleiFinder.set_nuclei_global_area_FC-1323"><span class="linenos">1323</span></a><span class="sd">            global_FC value.</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1324"><a href="#NucleiFinder.set_nuclei_global_area_FC-1324"><span class="linenos">1324</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1325"><a href="#NucleiFinder.set_nuclei_global_area_FC-1325"><span class="linenos">1325</span></a>
</span><span id="NucleiFinder.set_nuclei_global_area_FC-1326"><a href="#NucleiFinder.set_nuclei_global_area_FC-1326"><span class="linenos">1326</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;FC_diff_global&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">global_FC</span>
</span></pre></div>


            <div class="docstring"><p>This method sets the 'FC_diff_global' parameter. The 'global_FC' is used to remove false positive multiple nuclei that were detected in a single image and are outliers from the global mean area size.</p>

<h2 id="parameters">Parameters</h2>

<p>FC_diff_global : float
    global_FC value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nuclei_size" class="classattr">
                                        <input id="NucleiFinder.set_nuclei_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nuclei_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nuclei_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nuclei_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nuclei_size-1328"><a href="#NucleiFinder.set_nuclei_size-1328"><span class="linenos">1328</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nuclei_size-1329"><a href="#NucleiFinder.set_nuclei_size-1329"><span class="linenos">1329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_size-1330"><a href="#NucleiFinder.set_nuclei_size-1330"><span class="linenos">1330</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal nucleus area (px).</span>
</span><span id="NucleiFinder.set_nuclei_size-1331"><a href="#NucleiFinder.set_nuclei_size-1331"><span class="linenos">1331</span></a>
</span><span id="NucleiFinder.set_nuclei_size-1332"><a href="#NucleiFinder.set_nuclei_size-1332"><span class="linenos">1332</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nuclei_size-1333"><a href="#NucleiFinder.set_nuclei_size-1333"><span class="linenos">1333</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nuclei_size-1334"><a href="#NucleiFinder.set_nuclei_size-1334"><span class="linenos">1334</span></a><span class="sd">        size : tuple</span>
</span><span id="NucleiFinder.set_nuclei_size-1335"><a href="#NucleiFinder.set_nuclei_size-1335"><span class="linenos">1335</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="NucleiFinder.set_nuclei_size-1336"><a href="#NucleiFinder.set_nuclei_size-1336"><span class="linenos">1336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_size-1337"><a href="#NucleiFinder.set_nuclei_size-1337"><span class="linenos">1337</span></a>
</span><span id="NucleiFinder.set_nuclei_size-1338"><a href="#NucleiFinder.set_nuclei_size-1338"><span class="linenos">1338</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.set_nuclei_size-1339"><a href="#NucleiFinder.set_nuclei_size-1339"><span class="linenos">1339</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'size' parameter. The size is a parameter used for adjust minimal and maximal nucleus area (px).</p>

<h2 id="parameters">Parameters</h2>

<p>size : tuple
    (min_value, max_value)</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_nuclei_min_mean_intensity" class="classattr">
                                        <input id="NucleiFinder.set_nuclei_min_mean_intensity-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_nuclei_min_mean_intensity</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">intensity</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_nuclei_min_mean_intensity-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_nuclei_min_mean_intensity"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1341"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1341"><span class="linenos">1341</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_nuclei_min_mean_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">intensity</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1342"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1342"><span class="linenos">1342</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1343"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1343"><span class="linenos">1343</span></a><span class="sd">        This method sets &#39;intensity&#39; parameter. The &#39;intensity&#39; parameter is used to adjust the minimum mean intensity of all pixel intensities within the nucleus.</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1344"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1344"><span class="linenos">1344</span></a>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1345"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1345"><span class="linenos">1345</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1346"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1346"><span class="linenos">1346</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1347"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1347"><span class="linenos">1347</span></a><span class="sd">        intensity : int</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1348"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1348"><span class="linenos">1348</span></a><span class="sd">            intensity value.</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1349"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1349"><span class="linenos">1349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1350"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1350"><span class="linenos">1350</span></a>
</span><span id="NucleiFinder.set_nuclei_min_mean_intensity-1351"><a href="#NucleiFinder.set_nuclei_min_mean_intensity-1351"><span class="linenos">1351</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">intensity</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'intensity' parameter. The 'intensity' parameter is used to adjust the minimum mean intensity of all pixel intensities within the nucleus.</p>

<h2 id="parameters">Parameters</h2>

<p>intensity : int
    intensity value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_chromatinization_size" class="classattr">
                                        <input id="NucleiFinder.set_chromatinization_size-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_chromatinization_size</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_chromatinization_size-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_chromatinization_size"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_chromatinization_size-1353"><a href="#NucleiFinder.set_chromatinization_size-1353"><span class="linenos">1353</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="NucleiFinder.set_chromatinization_size-1354"><a href="#NucleiFinder.set_chromatinization_size-1354"><span class="linenos">1354</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_size-1355"><a href="#NucleiFinder.set_chromatinization_size-1355"><span class="linenos">1355</span></a><span class="sd">        This method sets &#39;size&#39; parameter. The size is a parameter used for adjust minimal and maximal chromanitization spot area (px) within the nucleus.</span>
</span><span id="NucleiFinder.set_chromatinization_size-1356"><a href="#NucleiFinder.set_chromatinization_size-1356"><span class="linenos">1356</span></a>
</span><span id="NucleiFinder.set_chromatinization_size-1357"><a href="#NucleiFinder.set_chromatinization_size-1357"><span class="linenos">1357</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_chromatinization_size-1358"><a href="#NucleiFinder.set_chromatinization_size-1358"><span class="linenos">1358</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_chromatinization_size-1359"><a href="#NucleiFinder.set_chromatinization_size-1359"><span class="linenos">1359</span></a><span class="sd">        size : tuple</span>
</span><span id="NucleiFinder.set_chromatinization_size-1360"><a href="#NucleiFinder.set_chromatinization_size-1360"><span class="linenos">1360</span></a><span class="sd">            (min_value, max_value)</span>
</span><span id="NucleiFinder.set_chromatinization_size-1361"><a href="#NucleiFinder.set_chromatinization_size-1361"><span class="linenos">1361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_size-1362"><a href="#NucleiFinder.set_chromatinization_size-1362"><span class="linenos">1362</span></a>
</span><span id="NucleiFinder.set_chromatinization_size-1363"><a href="#NucleiFinder.set_chromatinization_size-1363"><span class="linenos">1363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.set_chromatinization_size-1364"><a href="#NucleiFinder.set_chromatinization_size-1364"><span class="linenos">1364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'size' parameter. The size is a parameter used for adjust minimal and maximal chromanitization spot area (px) within the nucleus.</p>

<h2 id="parameters">Parameters</h2>

<p>size : tuple
    (min_value, max_value)</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_chromatinization_ratio" class="classattr">
                                        <input id="NucleiFinder.set_chromatinization_ratio-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_chromatinization_ratio</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ratio</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_chromatinization_ratio-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_chromatinization_ratio"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_chromatinization_ratio-1366"><a href="#NucleiFinder.set_chromatinization_ratio-1366"><span class="linenos">1366</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1367"><a href="#NucleiFinder.set_chromatinization_ratio-1367"><span class="linenos">1367</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1368"><a href="#NucleiFinder.set_chromatinization_ratio-1368"><span class="linenos">1368</span></a><span class="sd">        This method sets the &#39;ratio&#39; parameter. In this case, the &#39;ratio&#39; parameter is similar to &#39;circularity&#39; as it describes the ratio between the maximum lengths in the x and y dimensions of the nucleus chromatinization.</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1369"><a href="#NucleiFinder.set_chromatinization_ratio-1369"><span class="linenos">1369</span></a>
</span><span id="NucleiFinder.set_chromatinization_ratio-1370"><a href="#NucleiFinder.set_chromatinization_ratio-1370"><span class="linenos">1370</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1371"><a href="#NucleiFinder.set_chromatinization_ratio-1371"><span class="linenos">1371</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1372"><a href="#NucleiFinder.set_chromatinization_ratio-1372"><span class="linenos">1372</span></a><span class="sd">        ratio : float</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1373"><a href="#NucleiFinder.set_chromatinization_ratio-1373"><span class="linenos">1373</span></a><span class="sd">            ratio value.</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1374"><a href="#NucleiFinder.set_chromatinization_ratio-1374"><span class="linenos">1374</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_ratio-1375"><a href="#NucleiFinder.set_chromatinization_ratio-1375"><span class="linenos">1375</span></a>
</span><span id="NucleiFinder.set_chromatinization_ratio-1376"><a href="#NucleiFinder.set_chromatinization_ratio-1376"><span class="linenos">1376</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratio</span>
</span></pre></div>


            <div class="docstring"><p>This method sets the 'ratio' parameter. In this case, the 'ratio' parameter is similar to 'circularity' as it describes the ratio between the maximum lengths in the x and y dimensions of the nucleus chromatinization.</p>

<h2 id="parameters">Parameters</h2>

<p>ratio : float
    ratio value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_chromatinization_cut_point" class="classattr">
                                        <input id="NucleiFinder.set_chromatinization_cut_point-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_chromatinization_cut_point</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">cut_point</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_chromatinization_cut_point-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_chromatinization_cut_point"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_chromatinization_cut_point-1378"><a href="#NucleiFinder.set_chromatinization_cut_point-1378"><span class="linenos">1378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_chromatinization_cut_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cut_point</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1379"><a href="#NucleiFinder.set_chromatinization_cut_point-1379"><span class="linenos">1379</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1380"><a href="#NucleiFinder.set_chromatinization_cut_point-1380"><span class="linenos">1380</span></a><span class="sd">        This method sets the &#39;cut_point&#39; parameter. The &#39;cut_point&#39; parameter is a factor used to adjust the threshold for separating the background from chromatin spots.</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1381"><a href="#NucleiFinder.set_chromatinization_cut_point-1381"><span class="linenos">1381</span></a>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1382"><a href="#NucleiFinder.set_chromatinization_cut_point-1382"><span class="linenos">1382</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1383"><a href="#NucleiFinder.set_chromatinization_cut_point-1383"><span class="linenos">1383</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1384"><a href="#NucleiFinder.set_chromatinization_cut_point-1384"><span class="linenos">1384</span></a><span class="sd">        cut_point : int</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1385"><a href="#NucleiFinder.set_chromatinization_cut_point-1385"><span class="linenos">1385</span></a><span class="sd">            cut_point value.</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1386"><a href="#NucleiFinder.set_chromatinization_cut_point-1386"><span class="linenos">1386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1387"><a href="#NucleiFinder.set_chromatinization_cut_point-1387"><span class="linenos">1387</span></a>
</span><span id="NucleiFinder.set_chromatinization_cut_point-1388"><a href="#NucleiFinder.set_chromatinization_cut_point-1388"><span class="linenos">1388</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut_point</span>
</span></pre></div>


            <div class="docstring"><p>This method sets the 'cut_point' parameter. The 'cut_point' parameter is a factor used to adjust the threshold for separating the background from chromatin spots.</p>

<h2 id="parameters">Parameters</h2>

<p>cut_point : int
    cut_point value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_image_gamma" class="classattr">
                                        <input id="NucleiFinder.set_adj_image_gamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_image_gamma</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_image_gamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_image_gamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_image_gamma-1392"><a href="#NucleiFinder.set_adj_image_gamma-1392"><span class="linenos">1392</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1393"><a href="#NucleiFinder.set_adj_image_gamma-1393"><span class="linenos">1393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1394"><a href="#NucleiFinder.set_adj_image_gamma-1394"><span class="linenos">1394</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus image.</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1395"><a href="#NucleiFinder.set_adj_image_gamma-1395"><span class="linenos">1395</span></a>
</span><span id="NucleiFinder.set_adj_image_gamma-1396"><a href="#NucleiFinder.set_adj_image_gamma-1396"><span class="linenos">1396</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1397"><a href="#NucleiFinder.set_adj_image_gamma-1397"><span class="linenos">1397</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1398"><a href="#NucleiFinder.set_adj_image_gamma-1398"><span class="linenos">1398</span></a><span class="sd">        gamma : float</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1399"><a href="#NucleiFinder.set_adj_image_gamma-1399"><span class="linenos">1399</span></a><span class="sd">            gamma value.</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1400"><a href="#NucleiFinder.set_adj_image_gamma-1400"><span class="linenos">1400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_gamma-1401"><a href="#NucleiFinder.set_adj_image_gamma-1401"><span class="linenos">1401</span></a>
</span><span id="NucleiFinder.set_adj_image_gamma-1402"><a href="#NucleiFinder.set_adj_image_gamma-1402"><span class="linenos">1402</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'gamma' parameter. The gamma is a parameter used for adjust gamma of the nucleus image.</p>

<h2 id="parameters">Parameters</h2>

<p>gamma : float
    gamma value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_image_contrast" class="classattr">
                                        <input id="NucleiFinder.set_adj_image_contrast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_image_contrast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_image_contrast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_image_contrast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_image_contrast-1404"><a href="#NucleiFinder.set_adj_image_contrast-1404"><span class="linenos">1404</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1405"><a href="#NucleiFinder.set_adj_image_contrast-1405"><span class="linenos">1405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1406"><a href="#NucleiFinder.set_adj_image_contrast-1406"><span class="linenos">1406</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus image.</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1407"><a href="#NucleiFinder.set_adj_image_contrast-1407"><span class="linenos">1407</span></a>
</span><span id="NucleiFinder.set_adj_image_contrast-1408"><a href="#NucleiFinder.set_adj_image_contrast-1408"><span class="linenos">1408</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1409"><a href="#NucleiFinder.set_adj_image_contrast-1409"><span class="linenos">1409</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1410"><a href="#NucleiFinder.set_adj_image_contrast-1410"><span class="linenos">1410</span></a><span class="sd">        contrast : float</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1411"><a href="#NucleiFinder.set_adj_image_contrast-1411"><span class="linenos">1411</span></a><span class="sd">            contrast value.</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1412"><a href="#NucleiFinder.set_adj_image_contrast-1412"><span class="linenos">1412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_contrast-1413"><a href="#NucleiFinder.set_adj_image_contrast-1413"><span class="linenos">1413</span></a>
</span><span id="NucleiFinder.set_adj_image_contrast-1414"><a href="#NucleiFinder.set_adj_image_contrast-1414"><span class="linenos">1414</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'contrast' parameter. The contrast is a parameter used for adjust contrast of the nucleus image.</p>

<h2 id="parameters">Parameters</h2>

<p>contrast : float
    contrast value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_image_brightness" class="classattr">
                                        <input id="NucleiFinder.set_adj_image_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_image_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_image_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_image_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_image_brightness-1416"><a href="#NucleiFinder.set_adj_image_brightness-1416"><span class="linenos">1416</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_image_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1417"><a href="#NucleiFinder.set_adj_image_brightness-1417"><span class="linenos">1417</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1418"><a href="#NucleiFinder.set_adj_image_brightness-1418"><span class="linenos">1418</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus image.</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1419"><a href="#NucleiFinder.set_adj_image_brightness-1419"><span class="linenos">1419</span></a>
</span><span id="NucleiFinder.set_adj_image_brightness-1420"><a href="#NucleiFinder.set_adj_image_brightness-1420"><span class="linenos">1420</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1421"><a href="#NucleiFinder.set_adj_image_brightness-1421"><span class="linenos">1421</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1422"><a href="#NucleiFinder.set_adj_image_brightness-1422"><span class="linenos">1422</span></a><span class="sd">        brightness : float</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1423"><a href="#NucleiFinder.set_adj_image_brightness-1423"><span class="linenos">1423</span></a><span class="sd">            brightness value.</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1424"><a href="#NucleiFinder.set_adj_image_brightness-1424"><span class="linenos">1424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_image_brightness-1425"><a href="#NucleiFinder.set_adj_image_brightness-1425"><span class="linenos">1425</span></a>
</span><span id="NucleiFinder.set_adj_image_brightness-1426"><a href="#NucleiFinder.set_adj_image_brightness-1426"><span class="linenos">1426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'brightness' parameter. The brightness is a parameter used for adjust brightness of the nucleus image.</p>

<h2 id="parameters">Parameters</h2>

<p>brightness : float
    brightness value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_chrom_gamma" class="classattr">
                                        <input id="NucleiFinder.set_adj_chrom_gamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_chrom_gamma</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_chrom_gamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_chrom_gamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_chrom_gamma-1430"><a href="#NucleiFinder.set_adj_chrom_gamma-1430"><span class="linenos">1430</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1431"><a href="#NucleiFinder.set_adj_chrom_gamma-1431"><span class="linenos">1431</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1432"><a href="#NucleiFinder.set_adj_chrom_gamma-1432"><span class="linenos">1432</span></a><span class="sd">        This method sets &#39;gamma&#39; parameter. The gamma is a parameter used for adjust gamma of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1433"><a href="#NucleiFinder.set_adj_chrom_gamma-1433"><span class="linenos">1433</span></a>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1434"><a href="#NucleiFinder.set_adj_chrom_gamma-1434"><span class="linenos">1434</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1435"><a href="#NucleiFinder.set_adj_chrom_gamma-1435"><span class="linenos">1435</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1436"><a href="#NucleiFinder.set_adj_chrom_gamma-1436"><span class="linenos">1436</span></a><span class="sd">        gamma : float</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1437"><a href="#NucleiFinder.set_adj_chrom_gamma-1437"><span class="linenos">1437</span></a><span class="sd">            gamma value.</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1438"><a href="#NucleiFinder.set_adj_chrom_gamma-1438"><span class="linenos">1438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1439"><a href="#NucleiFinder.set_adj_chrom_gamma-1439"><span class="linenos">1439</span></a>
</span><span id="NucleiFinder.set_adj_chrom_gamma-1440"><a href="#NucleiFinder.set_adj_chrom_gamma-1440"><span class="linenos">1440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'gamma' parameter. The gamma is a parameter used for adjust gamma of the nucleus chromatinization image.</p>

<h2 id="parameters">Parameters</h2>

<p>gamma : float
    gamma value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_chrom_contrast" class="classattr">
                                        <input id="NucleiFinder.set_adj_chrom_contrast-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_chrom_contrast</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_chrom_contrast-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_chrom_contrast"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_chrom_contrast-1442"><a href="#NucleiFinder.set_adj_chrom_contrast-1442"><span class="linenos">1442</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contrast</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1443"><a href="#NucleiFinder.set_adj_chrom_contrast-1443"><span class="linenos">1443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1444"><a href="#NucleiFinder.set_adj_chrom_contrast-1444"><span class="linenos">1444</span></a><span class="sd">        This method sets &#39;contrast&#39; parameter. The contrast is a parameter used for adjust contrast of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1445"><a href="#NucleiFinder.set_adj_chrom_contrast-1445"><span class="linenos">1445</span></a>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1446"><a href="#NucleiFinder.set_adj_chrom_contrast-1446"><span class="linenos">1446</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1447"><a href="#NucleiFinder.set_adj_chrom_contrast-1447"><span class="linenos">1447</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1448"><a href="#NucleiFinder.set_adj_chrom_contrast-1448"><span class="linenos">1448</span></a><span class="sd">        contrast : float</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1449"><a href="#NucleiFinder.set_adj_chrom_contrast-1449"><span class="linenos">1449</span></a><span class="sd">            contrast value.</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1450"><a href="#NucleiFinder.set_adj_chrom_contrast-1450"><span class="linenos">1450</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1451"><a href="#NucleiFinder.set_adj_chrom_contrast-1451"><span class="linenos">1451</span></a>
</span><span id="NucleiFinder.set_adj_chrom_contrast-1452"><a href="#NucleiFinder.set_adj_chrom_contrast-1452"><span class="linenos">1452</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">contrast</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'contrast' parameter. The contrast is a parameter used for adjust contrast of the nucleus chromatinization image.</p>

<h2 id="parameters">Parameters</h2>

<p>contrast : float
    contrast value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.set_adj_chrom_brightness" class="classattr">
                                        <input id="NucleiFinder.set_adj_chrom_brightness-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_adj_chrom_brightness</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.set_adj_chrom_brightness-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.set_adj_chrom_brightness"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.set_adj_chrom_brightness-1454"><a href="#NucleiFinder.set_adj_chrom_brightness-1454"><span class="linenos">1454</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_adj_chrom_brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1455"><a href="#NucleiFinder.set_adj_chrom_brightness-1455"><span class="linenos">1455</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1456"><a href="#NucleiFinder.set_adj_chrom_brightness-1456"><span class="linenos">1456</span></a><span class="sd">        This method sets &#39;brightness&#39; parameter. The brightness is a parameter used for adjust brightness of the nucleus chromatinization image.</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1457"><a href="#NucleiFinder.set_adj_chrom_brightness-1457"><span class="linenos">1457</span></a>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1458"><a href="#NucleiFinder.set_adj_chrom_brightness-1458"><span class="linenos">1458</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1459"><a href="#NucleiFinder.set_adj_chrom_brightness-1459"><span class="linenos">1459</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1460"><a href="#NucleiFinder.set_adj_chrom_brightness-1460"><span class="linenos">1460</span></a><span class="sd">        brightness : float</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1461"><a href="#NucleiFinder.set_adj_chrom_brightness-1461"><span class="linenos">1461</span></a><span class="sd">            brightness value.</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1462"><a href="#NucleiFinder.set_adj_chrom_brightness-1462"><span class="linenos">1462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1463"><a href="#NucleiFinder.set_adj_chrom_brightness-1463"><span class="linenos">1463</span></a>
</span><span id="NucleiFinder.set_adj_chrom_brightness-1464"><a href="#NucleiFinder.set_adj_chrom_brightness-1464"><span class="linenos">1464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">brightness</span>
</span></pre></div>


            <div class="docstring"><p>This method sets 'brightness' parameter. The brightness is a parameter used for adjust brightness of the nucleus chromatinization image.</p>

<h2 id="parameters">Parameters</h2>

<p>brightness : float
    brightness value.</p>
</div>


                            </div>
                            <div id="NucleiFinder.current_parameters_nuclei" class="classattr">
                                        <input id="NucleiFinder.current_parameters_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">current_parameters_nuclei</span>

                <label class="view-source-button" for="NucleiFinder.current_parameters_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.current_parameters_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.current_parameters_nuclei-1466"><a href="#NucleiFinder.current_parameters_nuclei-1466"><span class="linenos">1466</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1467"><a href="#NucleiFinder.current_parameters_nuclei-1467"><span class="linenos">1467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1468"><a href="#NucleiFinder.current_parameters_nuclei-1468"><span class="linenos">1468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1469"><a href="#NucleiFinder.current_parameters_nuclei-1469"><span class="linenos">1469</span></a><span class="sd">        This method returns current nuclei analysis parameters.</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1470"><a href="#NucleiFinder.current_parameters_nuclei-1470"><span class="linenos">1470</span></a>
</span><span id="NucleiFinder.current_parameters_nuclei-1471"><a href="#NucleiFinder.current_parameters_nuclei-1471"><span class="linenos">1471</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1472"><a href="#NucleiFinder.current_parameters_nuclei-1472"><span class="linenos">1472</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1473"><a href="#NucleiFinder.current_parameters_nuclei-1473"><span class="linenos">1473</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1474"><a href="#NucleiFinder.current_parameters_nuclei-1474"><span class="linenos">1474</span></a><span class="sd">            Nuclei analysis parameters.</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1475"><a href="#NucleiFinder.current_parameters_nuclei-1475"><span class="linenos">1475</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1476"><a href="#NucleiFinder.current_parameters_nuclei-1476"><span class="linenos">1476</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">)</span>
</span><span id="NucleiFinder.current_parameters_nuclei-1477"><a href="#NucleiFinder.current_parameters_nuclei-1477"><span class="linenos">1477</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span>
</span></pre></div>


            <div class="docstring"><p>This method returns current nuclei analysis parameters.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei analysis parameters.</p>
</div>


                            </div>
                            <div id="NucleiFinder.current_parameters_chromatinization" class="classattr">
                                        <input id="NucleiFinder.current_parameters_chromatinization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">current_parameters_chromatinization</span>

                <label class="view-source-button" for="NucleiFinder.current_parameters_chromatinization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.current_parameters_chromatinization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.current_parameters_chromatinization-1479"><a href="#NucleiFinder.current_parameters_chromatinization-1479"><span class="linenos">1479</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1480"><a href="#NucleiFinder.current_parameters_chromatinization-1480"><span class="linenos">1480</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1481"><a href="#NucleiFinder.current_parameters_chromatinization-1481"><span class="linenos">1481</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1482"><a href="#NucleiFinder.current_parameters_chromatinization-1482"><span class="linenos">1482</span></a><span class="sd">        This method returns current nuclei chromatinization analysis parameters.</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1483"><a href="#NucleiFinder.current_parameters_chromatinization-1483"><span class="linenos">1483</span></a>
</span><span id="NucleiFinder.current_parameters_chromatinization-1484"><a href="#NucleiFinder.current_parameters_chromatinization-1484"><span class="linenos">1484</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1485"><a href="#NucleiFinder.current_parameters_chromatinization-1485"><span class="linenos">1485</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1486"><a href="#NucleiFinder.current_parameters_chromatinization-1486"><span class="linenos">1486</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1487"><a href="#NucleiFinder.current_parameters_chromatinization-1487"><span class="linenos">1487</span></a><span class="sd">            Nuclei chromatinization analysis parameters.</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1488"><a href="#NucleiFinder.current_parameters_chromatinization-1488"><span class="linenos">1488</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1489"><a href="#NucleiFinder.current_parameters_chromatinization-1489"><span class="linenos">1489</span></a>
</span><span id="NucleiFinder.current_parameters_chromatinization-1490"><a href="#NucleiFinder.current_parameters_chromatinization-1490"><span class="linenos">1490</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">)</span>
</span><span id="NucleiFinder.current_parameters_chromatinization-1491"><a href="#NucleiFinder.current_parameters_chromatinization-1491"><span class="linenos">1491</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span>
</span></pre></div>


            <div class="docstring"><p>This method returns current nuclei chromatinization analysis parameters.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei chromatinization analysis parameters.</p>
</div>


                            </div>
                            <div id="NucleiFinder.current_parameters_img_adj" class="classattr">
                                        <input id="NucleiFinder.current_parameters_img_adj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">current_parameters_img_adj</span>

                <label class="view-source-button" for="NucleiFinder.current_parameters_img_adj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.current_parameters_img_adj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.current_parameters_img_adj-1493"><a href="#NucleiFinder.current_parameters_img_adj-1493"><span class="linenos">1493</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1494"><a href="#NucleiFinder.current_parameters_img_adj-1494"><span class="linenos">1494</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1495"><a href="#NucleiFinder.current_parameters_img_adj-1495"><span class="linenos">1495</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1496"><a href="#NucleiFinder.current_parameters_img_adj-1496"><span class="linenos">1496</span></a><span class="sd">        This method returns current nuclei image setup.</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1497"><a href="#NucleiFinder.current_parameters_img_adj-1497"><span class="linenos">1497</span></a>
</span><span id="NucleiFinder.current_parameters_img_adj-1498"><a href="#NucleiFinder.current_parameters_img_adj-1498"><span class="linenos">1498</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1499"><a href="#NucleiFinder.current_parameters_img_adj-1499"><span class="linenos">1499</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1500"><a href="#NucleiFinder.current_parameters_img_adj-1500"><span class="linenos">1500</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1501"><a href="#NucleiFinder.current_parameters_img_adj-1501"><span class="linenos">1501</span></a><span class="sd">            Nuclei image setup.</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1502"><a href="#NucleiFinder.current_parameters_img_adj-1502"><span class="linenos">1502</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1503"><a href="#NucleiFinder.current_parameters_img_adj-1503"><span class="linenos">1503</span></a>
</span><span id="NucleiFinder.current_parameters_img_adj-1504"><a href="#NucleiFinder.current_parameters_img_adj-1504"><span class="linenos">1504</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">)</span>
</span><span id="NucleiFinder.current_parameters_img_adj-1505"><a href="#NucleiFinder.current_parameters_img_adj-1505"><span class="linenos">1505</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span>
</span></pre></div>


            <div class="docstring"><p>This method returns current nuclei image setup.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei image setup.</p>
</div>


                            </div>
                            <div id="NucleiFinder.current_parameters_img_adj_chro" class="classattr">
                                        <input id="NucleiFinder.current_parameters_img_adj_chro-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">current_parameters_img_adj_chro</span>

                <label class="view-source-button" for="NucleiFinder.current_parameters_img_adj_chro-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.current_parameters_img_adj_chro"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.current_parameters_img_adj_chro-1507"><a href="#NucleiFinder.current_parameters_img_adj_chro-1507"><span class="linenos">1507</span></a>    <span class="nd">@property</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1508"><a href="#NucleiFinder.current_parameters_img_adj_chro-1508"><span class="linenos">1508</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">current_parameters_img_adj_chro</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1509"><a href="#NucleiFinder.current_parameters_img_adj_chro-1509"><span class="linenos">1509</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1510"><a href="#NucleiFinder.current_parameters_img_adj_chro-1510"><span class="linenos">1510</span></a><span class="sd">        This method returns current nuclei chromatinization image setup.</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1511"><a href="#NucleiFinder.current_parameters_img_adj_chro-1511"><span class="linenos">1511</span></a>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1512"><a href="#NucleiFinder.current_parameters_img_adj_chro-1512"><span class="linenos">1512</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1513"><a href="#NucleiFinder.current_parameters_img_adj_chro-1513"><span class="linenos">1513</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1514"><a href="#NucleiFinder.current_parameters_img_adj_chro-1514"><span class="linenos">1514</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1515"><a href="#NucleiFinder.current_parameters_img_adj_chro-1515"><span class="linenos">1515</span></a><span class="sd">            Nuclei chromatinization image setup.</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1516"><a href="#NucleiFinder.current_parameters_img_adj_chro-1516"><span class="linenos">1516</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1517"><a href="#NucleiFinder.current_parameters_img_adj_chro-1517"><span class="linenos">1517</span></a>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1518"><a href="#NucleiFinder.current_parameters_img_adj_chro-1518"><span class="linenos">1518</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">)</span>
</span><span id="NucleiFinder.current_parameters_img_adj_chro-1519"><a href="#NucleiFinder.current_parameters_img_adj_chro-1519"><span class="linenos">1519</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span>
</span></pre></div>


            <div class="docstring"><p>This method returns current nuclei chromatinization image setup.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei chromatinization image setup.</p>
</div>


                            </div>
                            <div id="NucleiFinder.get_results_nuclei" class="classattr">
                                        <input id="NucleiFinder.get_results_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results_nuclei</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.get_results_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.get_results_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.get_results_nuclei-1521"><a href="#NucleiFinder.get_results_nuclei-1521"><span class="linenos">1521</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.get_results_nuclei-1522"><a href="#NucleiFinder.get_results_nuclei-1522"><span class="linenos">1522</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei-1523"><a href="#NucleiFinder.get_results_nuclei-1523"><span class="linenos">1523</span></a><span class="sd">        This function returns nuclei analysis results.</span>
</span><span id="NucleiFinder.get_results_nuclei-1524"><a href="#NucleiFinder.get_results_nuclei-1524"><span class="linenos">1524</span></a>
</span><span id="NucleiFinder.get_results_nuclei-1525"><a href="#NucleiFinder.get_results_nuclei-1525"><span class="linenos">1525</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.get_results_nuclei-1526"><a href="#NucleiFinder.get_results_nuclei-1526"><span class="linenos">1526</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.get_results_nuclei-1527"><a href="#NucleiFinder.get_results_nuclei-1527"><span class="linenos">1527</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.get_results_nuclei-1528"><a href="#NucleiFinder.get_results_nuclei-1528"><span class="linenos">1528</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="NucleiFinder.get_results_nuclei-1529"><a href="#NucleiFinder.get_results_nuclei-1529"><span class="linenos">1529</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei-1530"><a href="#NucleiFinder.get_results_nuclei-1530"><span class="linenos">1530</span></a>
</span><span id="NucleiFinder.get_results_nuclei-1531"><a href="#NucleiFinder.get_results_nuclei-1531"><span class="linenos">1531</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei-1532"><a href="#NucleiFinder.get_results_nuclei-1532"><span class="linenos">1532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.get_results_nuclei-1533"><a href="#NucleiFinder.get_results_nuclei-1533"><span class="linenos">1533</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder.get_results_nuclei-1534"><a href="#NucleiFinder.get_results_nuclei-1534"><span class="linenos">1534</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei-1535"><a href="#NucleiFinder.get_results_nuclei-1535"><span class="linenos">1535</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei-1536"><a href="#NucleiFinder.get_results_nuclei-1536"><span class="linenos">1536</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei-1537"><a href="#NucleiFinder.get_results_nuclei-1537"><span class="linenos">1537</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder.get_results_nuclei-1538"><a href="#NucleiFinder.get_results_nuclei-1538"><span class="linenos">1538</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>This function returns nuclei analysis results.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei results in the dictionary format.</p>
</div>


                            </div>
                            <div id="NucleiFinder.get_results_nuclei_selected" class="classattr">
                                        <input id="NucleiFinder.get_results_nuclei_selected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results_nuclei_selected</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.get_results_nuclei_selected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.get_results_nuclei_selected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.get_results_nuclei_selected-1540"><a href="#NucleiFinder.get_results_nuclei_selected-1540"><span class="linenos">1540</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_selected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1541"><a href="#NucleiFinder.get_results_nuclei_selected-1541"><span class="linenos">1541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1542"><a href="#NucleiFinder.get_results_nuclei_selected-1542"><span class="linenos">1542</span></a><span class="sd">        This function returns the results of the nuclei analysis following adjustments to the data selection thresholds.</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1543"><a href="#NucleiFinder.get_results_nuclei_selected-1543"><span class="linenos">1543</span></a>
</span><span id="NucleiFinder.get_results_nuclei_selected-1544"><a href="#NucleiFinder.get_results_nuclei_selected-1544"><span class="linenos">1544</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1545"><a href="#NucleiFinder.get_results_nuclei_selected-1545"><span class="linenos">1545</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1546"><a href="#NucleiFinder.get_results_nuclei_selected-1546"><span class="linenos">1546</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1547"><a href="#NucleiFinder.get_results_nuclei_selected-1547"><span class="linenos">1547</span></a><span class="sd">            Nuclei results in the dictionary format.</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1548"><a href="#NucleiFinder.get_results_nuclei_selected-1548"><span class="linenos">1548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1549"><a href="#NucleiFinder.get_results_nuclei_selected-1549"><span class="linenos">1549</span></a>
</span><span id="NucleiFinder.get_results_nuclei_selected-1550"><a href="#NucleiFinder.get_results_nuclei_selected-1550"><span class="linenos">1550</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1551"><a href="#NucleiFinder.get_results_nuclei_selected-1551"><span class="linenos">1551</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1552"><a href="#NucleiFinder.get_results_nuclei_selected-1552"><span class="linenos">1552</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1553"><a href="#NucleiFinder.get_results_nuclei_selected-1553"><span class="linenos">1553</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1554"><a href="#NucleiFinder.get_results_nuclei_selected-1554"><span class="linenos">1554</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1555"><a href="#NucleiFinder.get_results_nuclei_selected-1555"><span class="linenos">1555</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1556"><a href="#NucleiFinder.get_results_nuclei_selected-1556"><span class="linenos">1556</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1557"><a href="#NucleiFinder.get_results_nuclei_selected-1557"><span class="linenos">1557</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1558"><a href="#NucleiFinder.get_results_nuclei_selected-1558"><span class="linenos">1558</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.get_results_nuclei_selected-1559"><a href="#NucleiFinder.get_results_nuclei_selected-1559"><span class="linenos">1559</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>This function returns the results of the nuclei analysis following adjustments to the data selection thresholds.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei results in the dictionary format.</p>
</div>


                            </div>
                            <div id="NucleiFinder.get_results_nuclei_chromatinization" class="classattr">
                                        <input id="NucleiFinder.get_results_nuclei_chromatinization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_results_nuclei_chromatinization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.get_results_nuclei_chromatinization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.get_results_nuclei_chromatinization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.get_results_nuclei_chromatinization-1561"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1561"><span class="linenos">1561</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_results_nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1562"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1562"><span class="linenos">1562</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1563"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1563"><span class="linenos">1563</span></a><span class="sd">        This function returns the results of the nuclei chromatinization analysis.</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1564"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1564"><span class="linenos">1564</span></a>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1565"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1565"><span class="linenos">1565</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1566"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1566"><span class="linenos">1566</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1567"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1567"><span class="linenos">1567</span></a><span class="sd">        dict</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1568"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1568"><span class="linenos">1568</span></a><span class="sd">            Nuclei chromatinization results in the dictionary format.</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1569"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1569"><span class="linenos">1569</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1570"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1570"><span class="linenos">1570</span></a>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1571"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1571"><span class="linenos">1571</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1572"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1572"><span class="linenos">1572</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No results to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1573"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1573"><span class="linenos">1573</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1574"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1574"><span class="linenos">1574</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1575"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1575"><span class="linenos">1575</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1576"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1576"><span class="linenos">1576</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1577"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1577"><span class="linenos">1577</span></a>                    <span class="n">display_preview</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1578"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1578"><span class="linenos">1578</span></a>            <span class="k">return</span> <span class="p">(</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1579"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1579"><span class="linenos">1579</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1580"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1580"><span class="linenos">1580</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.get_results_nuclei_chromatinization-1581"><a href="#NucleiFinder.get_results_nuclei_chromatinization-1581"><span class="linenos">1581</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This function returns the results of the nuclei chromatinization analysis.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Nuclei chromatinization results in the dictionary format.</p>
</div>


                            </div>
                            <div id="NucleiFinder.add_test" class="classattr">
                                        <input id="NucleiFinder.add_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">plots</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.add_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.add_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.add_test-1583"><a href="#NucleiFinder.add_test-1583"><span class="linenos">1583</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plots</span><span class="p">):</span>
</span><span id="NucleiFinder.add_test-1584"><a href="#NucleiFinder.add_test-1584"><span class="linenos">1584</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">plots</span>
</span><span id="NucleiFinder.add_test-1585"><a href="#NucleiFinder.add_test-1585"><span class="linenos">1585</span></a>
</span><span id="NucleiFinder.add_test-1586"><a href="#NucleiFinder.add_test-1586"><span class="linenos">1586</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.add_test-1587"><a href="#NucleiFinder.add_test-1587"><span class="linenos">1587</span></a><span class="sd">        Helper method.</span>
</span><span id="NucleiFinder.add_test-1588"><a href="#NucleiFinder.add_test-1588"><span class="linenos">1588</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span></pre></div>


    

                            </div>
                            <div id="NucleiFinder.input_image" class="classattr">
                                        <input id="NucleiFinder.input_image-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">input_image</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">img</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.input_image-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.input_image"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.input_image-1590"><a href="#NucleiFinder.input_image-1590"><span class="linenos">1590</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">input_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
</span><span id="NucleiFinder.input_image-1591"><a href="#NucleiFinder.input_image-1591"><span class="linenos">1591</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.input_image-1592"><a href="#NucleiFinder.input_image-1592"><span class="linenos">1592</span></a><span class="sd">        This method adds the image to the class for nuclei and/or chromatinization analysis.</span>
</span><span id="NucleiFinder.input_image-1593"><a href="#NucleiFinder.input_image-1593"><span class="linenos">1593</span></a>
</span><span id="NucleiFinder.input_image-1594"><a href="#NucleiFinder.input_image-1594"><span class="linenos">1594</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.input_image-1595"><a href="#NucleiFinder.input_image-1595"><span class="linenos">1595</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.input_image-1596"><a href="#NucleiFinder.input_image-1596"><span class="linenos">1596</span></a><span class="sd">        img : np.ndarray</span>
</span><span id="NucleiFinder.input_image-1597"><a href="#NucleiFinder.input_image-1597"><span class="linenos">1597</span></a><span class="sd">            Input image.</span>
</span><span id="NucleiFinder.input_image-1598"><a href="#NucleiFinder.input_image-1598"><span class="linenos">1598</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.input_image-1599"><a href="#NucleiFinder.input_image-1599"><span class="linenos">1599</span></a>
</span><span id="NucleiFinder.input_image-1600"><a href="#NucleiFinder.input_image-1600"><span class="linenos">1600</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">img</span>
</span><span id="NucleiFinder.input_image-1601"><a href="#NucleiFinder.input_image-1601"><span class="linenos">1601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This method adds the image to the class for nuclei and/or chromatinization analysis.</p>

<h2 id="parameters">Parameters</h2>

<p>img : np.ndarray
    Input image.</p>
</div>


                            </div>
                            <div id="NucleiFinder.get_features" class="classattr">
                                        <input id="NucleiFinder.get_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">model_out</span>, </span><span class="param"><span class="n">image</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.get_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.get_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.get_features-1603"><a href="#NucleiFinder.get_features-1603"><span class="linenos">1603</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_features</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_out</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
</span><span id="NucleiFinder.get_features-1604"><a href="#NucleiFinder.get_features-1604"><span class="linenos">1604</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_features-1605"><a href="#NucleiFinder.get_features-1605"><span class="linenos">1605</span></a><span class="sd">        Extracts numerical feature descriptors from model output for a given image.</span>
</span><span id="NucleiFinder.get_features-1606"><a href="#NucleiFinder.get_features-1606"><span class="linenos">1606</span></a>
</span><span id="NucleiFinder.get_features-1607"><a href="#NucleiFinder.get_features-1607"><span class="linenos">1607</span></a><span class="sd">        This method processes the output returned by a feature-extraction model</span>
</span><span id="NucleiFinder.get_features-1608"><a href="#NucleiFinder.get_features-1608"><span class="linenos">1608</span></a><span class="sd">        (e.g., CNN, encoder network, statistical model) and converts it into a</span>
</span><span id="NucleiFinder.get_features-1609"><a href="#NucleiFinder.get_features-1609"><span class="linenos">1609</span></a><span class="sd">        structured feature vector associated with the provided image.</span>
</span><span id="NucleiFinder.get_features-1610"><a href="#NucleiFinder.get_features-1610"><span class="linenos">1610</span></a><span class="sd">        Typically used for downstream analysis, classification, or clustering.</span>
</span><span id="NucleiFinder.get_features-1611"><a href="#NucleiFinder.get_features-1611"><span class="linenos">1611</span></a>
</span><span id="NucleiFinder.get_features-1612"><a href="#NucleiFinder.get_features-1612"><span class="linenos">1612</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.get_features-1613"><a href="#NucleiFinder.get_features-1613"><span class="linenos">1613</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.get_features-1614"><a href="#NucleiFinder.get_features-1614"><span class="linenos">1614</span></a><span class="sd">        model_out : any</span>
</span><span id="NucleiFinder.get_features-1615"><a href="#NucleiFinder.get_features-1615"><span class="linenos">1615</span></a><span class="sd">            Output returned by the feature-extraction model.</span>
</span><span id="NucleiFinder.get_features-1616"><a href="#NucleiFinder.get_features-1616"><span class="linenos">1616</span></a><span class="sd">            The expected format depends on the model (e.g., tensor, dict, list of arrays).</span>
</span><span id="NucleiFinder.get_features-1617"><a href="#NucleiFinder.get_features-1617"><span class="linenos">1617</span></a>
</span><span id="NucleiFinder.get_features-1618"><a href="#NucleiFinder.get_features-1618"><span class="linenos">1618</span></a><span class="sd">        image : ndarray</span>
</span><span id="NucleiFinder.get_features-1619"><a href="#NucleiFinder.get_features-1619"><span class="linenos">1619</span></a><span class="sd">            The input image (2D or 3D array) for which features are being extracted.</span>
</span><span id="NucleiFinder.get_features-1620"><a href="#NucleiFinder.get_features-1620"><span class="linenos">1620</span></a><span class="sd">            Provided for reference or for combining raw image metrics with model features.</span>
</span><span id="NucleiFinder.get_features-1621"><a href="#NucleiFinder.get_features-1621"><span class="linenos">1621</span></a>
</span><span id="NucleiFinder.get_features-1622"><a href="#NucleiFinder.get_features-1622"><span class="linenos">1622</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.get_features-1623"><a href="#NucleiFinder.get_features-1623"><span class="linenos">1623</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.get_features-1624"><a href="#NucleiFinder.get_features-1624"><span class="linenos">1624</span></a><span class="sd">        features : dict</span>
</span><span id="NucleiFinder.get_features-1625"><a href="#NucleiFinder.get_features-1625"><span class="linenos">1625</span></a><span class="sd">            Dictionary containing extracted features.</span>
</span><span id="NucleiFinder.get_features-1626"><a href="#NucleiFinder.get_features-1626"><span class="linenos">1626</span></a><span class="sd">            Keys correspond to feature names, and values are numerical descriptors.</span>
</span><span id="NucleiFinder.get_features-1627"><a href="#NucleiFinder.get_features-1627"><span class="linenos">1627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.get_features-1628"><a href="#NucleiFinder.get_features-1628"><span class="linenos">1628</span></a>
</span><span id="NucleiFinder.get_features-1629"><a href="#NucleiFinder.get_features-1629"><span class="linenos">1629</span></a>        <span class="n">features</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder.get_features-1630"><a href="#NucleiFinder.get_features-1630"><span class="linenos">1630</span></a>            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1631"><a href="#NucleiFinder.get_features-1631"><span class="linenos">1631</span></a>            <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1632"><a href="#NucleiFinder.get_features-1632"><span class="linenos">1632</span></a>            <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1633"><a href="#NucleiFinder.get_features-1633"><span class="linenos">1633</span></a>            <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1634"><a href="#NucleiFinder.get_features-1634"><span class="linenos">1634</span></a>            <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1635"><a href="#NucleiFinder.get_features-1635"><span class="linenos">1635</span></a>            <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1636"><a href="#NucleiFinder.get_features-1636"><span class="linenos">1636</span></a>            <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1637"><a href="#NucleiFinder.get_features-1637"><span class="linenos">1637</span></a>            <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1638"><a href="#NucleiFinder.get_features-1638"><span class="linenos">1638</span></a>            <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1639"><a href="#NucleiFinder.get_features-1639"><span class="linenos">1639</span></a>            <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1640"><a href="#NucleiFinder.get_features-1640"><span class="linenos">1640</span></a>            <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1641"><a href="#NucleiFinder.get_features-1641"><span class="linenos">1641</span></a>            <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1642"><a href="#NucleiFinder.get_features-1642"><span class="linenos">1642</span></a>            <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1643"><a href="#NucleiFinder.get_features-1643"><span class="linenos">1643</span></a>            <span class="s2">&quot;circularity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1644"><a href="#NucleiFinder.get_features-1644"><span class="linenos">1644</span></a>            <span class="s2">&quot;intensity_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1645"><a href="#NucleiFinder.get_features-1645"><span class="linenos">1645</span></a>            <span class="s2">&quot;intensity_mean&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1646"><a href="#NucleiFinder.get_features-1646"><span class="linenos">1646</span></a>            <span class="s2">&quot;intensity_min&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1647"><a href="#NucleiFinder.get_features-1647"><span class="linenos">1647</span></a>            <span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1648"><a href="#NucleiFinder.get_features-1648"><span class="linenos">1648</span></a>            <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.get_features-1649"><a href="#NucleiFinder.get_features-1649"><span class="linenos">1649</span></a>        <span class="p">}</span>
</span><span id="NucleiFinder.get_features-1650"><a href="#NucleiFinder.get_features-1650"><span class="linenos">1650</span></a>
</span><span id="NucleiFinder.get_features-1651"><a href="#NucleiFinder.get_features-1651"><span class="linenos">1651</span></a>        <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">skimage</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">model_out</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">image</span><span class="p">):</span>
</span><span id="NucleiFinder.get_features-1652"><a href="#NucleiFinder.get_features-1652"><span class="linenos">1652</span></a>
</span><span id="NucleiFinder.get_features-1653"><a href="#NucleiFinder.get_features-1653"><span class="linenos">1653</span></a>            <span class="c1"># Compute circularity</span>
</span><span id="NucleiFinder.get_features-1654"><a href="#NucleiFinder.get_features-1654"><span class="linenos">1654</span></a>            <span class="k">if</span> <span class="n">region</span><span class="o">.</span><span class="n">perimeter</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.get_features-1655"><a href="#NucleiFinder.get_features-1655"><span class="linenos">1655</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">region</span><span class="o">.</span><span class="n">area</span> <span class="o">/</span> <span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1656"><a href="#NucleiFinder.get_features-1656"><span class="linenos">1656</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.get_features-1657"><a href="#NucleiFinder.get_features-1657"><span class="linenos">1657</span></a>                <span class="n">circularity</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder.get_features-1658"><a href="#NucleiFinder.get_features-1658"><span class="linenos">1658</span></a>
</span><span id="NucleiFinder.get_features-1659"><a href="#NucleiFinder.get_features-1659"><span class="linenos">1659</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1660"><a href="#NucleiFinder.get_features-1660"><span class="linenos">1660</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1661"><a href="#NucleiFinder.get_features-1661"><span class="linenos">1661</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1662"><a href="#NucleiFinder.get_features-1662"><span class="linenos">1662</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1663"><a href="#NucleiFinder.get_features-1663"><span class="linenos">1663</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1664"><a href="#NucleiFinder.get_features-1664"><span class="linenos">1664</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1665"><a href="#NucleiFinder.get_features-1665"><span class="linenos">1665</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1666"><a href="#NucleiFinder.get_features-1666"><span class="linenos">1666</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1667"><a href="#NucleiFinder.get_features-1667"><span class="linenos">1667</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1668"><a href="#NucleiFinder.get_features-1668"><span class="linenos">1668</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1669"><a href="#NucleiFinder.get_features-1669"><span class="linenos">1669</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1670"><a href="#NucleiFinder.get_features-1670"><span class="linenos">1670</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1671"><a href="#NucleiFinder.get_features-1671"><span class="linenos">1671</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1672"><a href="#NucleiFinder.get_features-1672"><span class="linenos">1672</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1673"><a href="#NucleiFinder.get_features-1673"><span class="linenos">1673</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;circularity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">circularity</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1674"><a href="#NucleiFinder.get_features-1674"><span class="linenos">1674</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_max</span><span class="p">))</span>
</span><span id="NucleiFinder.get_features-1675"><a href="#NucleiFinder.get_features-1675"><span class="linenos">1675</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_min&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_min</span><span class="p">))</span>
</span><span id="NucleiFinder.get_features-1676"><a href="#NucleiFinder.get_features-1676"><span class="linenos">1676</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">intensity_mean</span><span class="p">))</span>
</span><span id="NucleiFinder.get_features-1677"><a href="#NucleiFinder.get_features-1677"><span class="linenos">1677</span></a>
</span><span id="NucleiFinder.get_features-1678"><a href="#NucleiFinder.get_features-1678"><span class="linenos">1678</span></a>        <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.get_features-1679"><a href="#NucleiFinder.get_features-1679"><span class="linenos">1679</span></a>
</span><span id="NucleiFinder.get_features-1680"><a href="#NucleiFinder.get_features-1680"><span class="linenos">1680</span></a>        <span class="c1"># Calculate the ratio for each pair of values</span>
</span><span id="NucleiFinder.get_features-1681"><a href="#NucleiFinder.get_features-1681"><span class="linenos">1681</span></a>        <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="NucleiFinder.get_features-1682"><a href="#NucleiFinder.get_features-1682"><span class="linenos">1682</span></a>            <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder.get_features-1683"><a href="#NucleiFinder.get_features-1683"><span class="linenos">1683</span></a>        <span class="p">):</span>
</span><span id="NucleiFinder.get_features-1684"><a href="#NucleiFinder.get_features-1684"><span class="linenos">1684</span></a>            <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.get_features-1685"><a href="#NucleiFinder.get_features-1685"><span class="linenos">1685</span></a>                <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="NucleiFinder.get_features-1686"><a href="#NucleiFinder.get_features-1686"><span class="linenos">1686</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="NucleiFinder.get_features-1687"><a href="#NucleiFinder.get_features-1687"><span class="linenos">1687</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.get_features-1688"><a href="#NucleiFinder.get_features-1688"><span class="linenos">1688</span></a>                <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="NucleiFinder.get_features-1689"><a href="#NucleiFinder.get_features-1689"><span class="linenos">1689</span></a>
</span><span id="NucleiFinder.get_features-1690"><a href="#NucleiFinder.get_features-1690"><span class="linenos">1690</span></a>        <span class="n">features</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="NucleiFinder.get_features-1691"><a href="#NucleiFinder.get_features-1691"><span class="linenos">1691</span></a>
</span><span id="NucleiFinder.get_features-1692"><a href="#NucleiFinder.get_features-1692"><span class="linenos">1692</span></a>        <span class="k">return</span> <span class="n">features</span>
</span></pre></div>


            <div class="docstring"><p>Extracts numerical feature descriptors from model output for a given image.</p>

<p>This method processes the output returned by a feature-extraction model
(e.g., CNN, encoder network, statistical model) and converts it into a
structured feature vector associated with the provided image.
Typically used for downstream analysis, classification, or clustering.</p>

<h2 id="parameters">Parameters</h2>

<p>model_out : any
    Output returned by the feature-extraction model.
    The expected format depends on the model (e.g., tensor, dict, list of arrays).</p>

<p>image : ndarray
    The input image (2D or 3D array) for which features are being extracted.
    Provided for reference or for combining raw image metrics with model features.</p>

<h2 id="returns">Returns</h2>

<p>features : dict
    Dictionary containing extracted features.
    Keys correspond to feature names, and values are numerical descriptors.</p>
</div>


                            </div>
                            <div id="NucleiFinder.nuclei_finder_test" class="classattr">
                                        <input id="NucleiFinder.nuclei_finder_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nuclei_finder_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.nuclei_finder_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.nuclei_finder_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.nuclei_finder_test-1695"><a href="#NucleiFinder.nuclei_finder_test-1695"><span class="linenos">1695</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_finder_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_finder_test-1696"><a href="#NucleiFinder.nuclei_finder_test-1696"><span class="linenos">1696</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_finder_test-1697"><a href="#NucleiFinder.nuclei_finder_test-1697"><span class="linenos">1697</span></a><span class="sd">        This method performs testing analysis of parameters (specified &#39;nms&#39; and &#39;prob&#39; parameters)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1698"><a href="#NucleiFinder.nuclei_finder_test-1698"><span class="linenos">1698</span></a><span class="sd">        for the image provided by the input_image() method.</span>
</span><span id="NucleiFinder.nuclei_finder_test-1699"><a href="#NucleiFinder.nuclei_finder_test-1699"><span class="linenos">1699</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1700"><a href="#NucleiFinder.nuclei_finder_test-1700"><span class="linenos">1700</span></a><span class="sd">        This method evaluates the performance of the internal NucleiFinder</span>
</span><span id="NucleiFinder.nuclei_finder_test-1701"><a href="#NucleiFinder.nuclei_finder_test-1701"><span class="linenos">1701</span></a><span class="sd">        configuration using the currently loaded images, parameters, or model</span>
</span><span id="NucleiFinder.nuclei_finder_test-1702"><a href="#NucleiFinder.nuclei_finder_test-1702"><span class="linenos">1702</span></a><span class="sd">        settings. It is typically used to check whether the detection, segmentation</span>
</span><span id="NucleiFinder.nuclei_finder_test-1703"><a href="#NucleiFinder.nuclei_finder_test-1703"><span class="linenos">1703</span></a><span class="sd">        or preprocessing stages run correctly on sample data.</span>
</span><span id="NucleiFinder.nuclei_finder_test-1704"><a href="#NucleiFinder.nuclei_finder_test-1704"><span class="linenos">1704</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1705"><a href="#NucleiFinder.nuclei_finder_test-1705"><span class="linenos">1705</span></a><span class="sd">        Examples</span>
</span><span id="NucleiFinder.nuclei_finder_test-1706"><a href="#NucleiFinder.nuclei_finder_test-1706"><span class="linenos">1706</span></a><span class="sd">        --------</span>
</span><span id="NucleiFinder.nuclei_finder_test-1707"><a href="#NucleiFinder.nuclei_finder_test-1707"><span class="linenos">1707</span></a><span class="sd">        &gt;&gt;&gt; nf.nuclei_finder_test()</span>
</span><span id="NucleiFinder.nuclei_finder_test-1708"><a href="#NucleiFinder.nuclei_finder_test-1708"><span class="linenos">1708</span></a><span class="sd">        &gt;&gt;&gt; nf.browser_test()</span>
</span><span id="NucleiFinder.nuclei_finder_test-1709"><a href="#NucleiFinder.nuclei_finder_test-1709"><span class="linenos">1709</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_finder_test-1710"><a href="#NucleiFinder.nuclei_finder_test-1710"><span class="linenos">1710</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1711"><a href="#NucleiFinder.nuclei_finder_test-1711"><span class="linenos">1711</span></a>        <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">()</span>
</span><span id="NucleiFinder.nuclei_finder_test-1712"><a href="#NucleiFinder.nuclei_finder_test-1712"><span class="linenos">1712</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1713"><a href="#NucleiFinder.nuclei_finder_test-1713"><span class="linenos">1713</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1714"><a href="#NucleiFinder.nuclei_finder_test-1714"><span class="linenos">1714</span></a>        <span class="n">nmst</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_finder_test-1715"><a href="#NucleiFinder.nuclei_finder_test-1715"><span class="linenos">1715</span></a>        <span class="n">probt</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_finder_test-1716"><a href="#NucleiFinder.nuclei_finder_test-1716"><span class="linenos">1716</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1717"><a href="#NucleiFinder.nuclei_finder_test-1717"><span class="linenos">1717</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1718"><a href="#NucleiFinder.nuclei_finder_test-1718"><span class="linenos">1718</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1719"><a href="#NucleiFinder.nuclei_finder_test-1719"><span class="linenos">1719</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1720"><a href="#NucleiFinder.nuclei_finder_test-1720"><span class="linenos">1720</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.nuclei_finder_test-1721"><a href="#NucleiFinder.nuclei_finder_test-1721"><span class="linenos">1721</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1722"><a href="#NucleiFinder.nuclei_finder_test-1722"><span class="linenos">1722</span></a>        <span class="n">plot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_finder_test-1723"><a href="#NucleiFinder.nuclei_finder_test-1723"><span class="linenos">1723</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1724"><a href="#NucleiFinder.nuclei_finder_test-1724"><span class="linenos">1724</span></a>        <span class="c1"># adj img</span>
</span><span id="NucleiFinder.nuclei_finder_test-1725"><a href="#NucleiFinder.nuclei_finder_test-1725"><span class="linenos">1725</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_finder_test-1726"><a href="#NucleiFinder.nuclei_finder_test-1726"><span class="linenos">1726</span></a>            <span class="n">img</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_finder_test-1727"><a href="#NucleiFinder.nuclei_finder_test-1727"><span class="linenos">1727</span></a>            <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_finder_test-1728"><a href="#NucleiFinder.nuclei_finder_test-1728"><span class="linenos">1728</span></a>            <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_finder_test-1729"><a href="#NucleiFinder.nuclei_finder_test-1729"><span class="linenos">1729</span></a>            <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_finder_test-1730"><a href="#NucleiFinder.nuclei_finder_test-1730"><span class="linenos">1730</span></a>        <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1731"><a href="#NucleiFinder.nuclei_finder_test-1731"><span class="linenos">1731</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1732"><a href="#NucleiFinder.nuclei_finder_test-1732"><span class="linenos">1732</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1733"><a href="#NucleiFinder.nuclei_finder_test-1733"><span class="linenos">1733</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1734"><a href="#NucleiFinder.nuclei_finder_test-1734"><span class="linenos">1734</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1735"><a href="#NucleiFinder.nuclei_finder_test-1735"><span class="linenos">1735</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1736"><a href="#NucleiFinder.nuclei_finder_test-1736"><span class="linenos">1736</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1737"><a href="#NucleiFinder.nuclei_finder_test-1737"><span class="linenos">1737</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1738"><a href="#NucleiFinder.nuclei_finder_test-1738"><span class="linenos">1738</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1739"><a href="#NucleiFinder.nuclei_finder_test-1739"><span class="linenos">1739</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1740"><a href="#NucleiFinder.nuclei_finder_test-1740"><span class="linenos">1740</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="NucleiFinder.nuclei_finder_test-1741"><a href="#NucleiFinder.nuclei_finder_test-1741"><span class="linenos">1741</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1742"><a href="#NucleiFinder.nuclei_finder_test-1742"><span class="linenos">1742</span></a>        <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1743"><a href="#NucleiFinder.nuclei_finder_test-1743"><span class="linenos">1743</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1744"><a href="#NucleiFinder.nuclei_finder_test-1744"><span class="linenos">1744</span></a>        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nmst</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Loop 1: nmst&quot;</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_finder_test-1745"><a href="#NucleiFinder.nuclei_finder_test-1745"><span class="linenos">1745</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">➡️ Starting outer loop for n = </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1746"><a href="#NucleiFinder.nuclei_finder_test-1746"><span class="linenos">1746</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1747"><a href="#NucleiFinder.nuclei_finder_test-1747"><span class="linenos">1747</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">probt</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;   ↳ Loop 2 for n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_finder_test-1748"><a href="#NucleiFinder.nuclei_finder_test-1748"><span class="linenos">1748</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   → Starting inner loop for t = </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1749"><a href="#NucleiFinder.nuclei_finder_test-1749"><span class="linenos">1749</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1750"><a href="#NucleiFinder.nuclei_finder_test-1750"><span class="linenos">1750</span></a>                <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_finder_test-1751"><a href="#NucleiFinder.nuclei_finder_test-1751"><span class="linenos">1751</span></a>                    <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()),</span> <span class="n">nms_thresh</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">prob_thresh</span><span class="o">=</span><span class="n">t</span>
</span><span id="NucleiFinder.nuclei_finder_test-1752"><a href="#NucleiFinder.nuclei_finder_test-1752"><span class="linenos">1752</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1753"><a href="#NucleiFinder.nuclei_finder_test-1753"><span class="linenos">1753</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1754"><a href="#NucleiFinder.nuclei_finder_test-1754"><span class="linenos">1754</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1755"><a href="#NucleiFinder.nuclei_finder_test-1755"><span class="linenos">1755</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1756"><a href="#NucleiFinder.nuclei_finder_test-1756"><span class="linenos">1756</span></a>                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1757"><a href="#NucleiFinder.nuclei_finder_test-1757"><span class="linenos">1757</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">render_label</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">img</span><span class="o">=</span><span class="n">img</span><span class="p">))</span>
</span><span id="NucleiFinder.nuclei_finder_test-1758"><a href="#NucleiFinder.nuclei_finder_test-1758"><span class="linenos">1758</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1759"><a href="#NucleiFinder.nuclei_finder_test-1759"><span class="linenos">1759</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_finder_test-1760"><a href="#NucleiFinder.nuclei_finder_test-1760"><span class="linenos">1760</span></a>                    <span class="sa">f</span><span class="s2">&quot;nms </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2"> &amp; prob </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> detected nuc: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_finder_test-1761"><a href="#NucleiFinder.nuclei_finder_test-1761"><span class="linenos">1761</span></a>                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_finder_test-1762"><a href="#NucleiFinder.nuclei_finder_test-1762"><span class="linenos">1762</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1763"><a href="#NucleiFinder.nuclei_finder_test-1763"><span class="linenos">1763</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1764"><a href="#NucleiFinder.nuclei_finder_test-1764"><span class="linenos">1764</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1765"><a href="#NucleiFinder.nuclei_finder_test-1765"><span class="linenos">1765</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_finder_test-1766"><a href="#NucleiFinder.nuclei_finder_test-1766"><span class="linenos">1766</span></a>                        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="NucleiFinder.nuclei_finder_test-1767"><a href="#NucleiFinder.nuclei_finder_test-1767"><span class="linenos">1767</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1768"><a href="#NucleiFinder.nuclei_finder_test-1768"><span class="linenos">1768</span></a>                <span class="n">plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_finder_test-1769"><a href="#NucleiFinder.nuclei_finder_test-1769"><span class="linenos">1769</span></a>
</span><span id="NucleiFinder.nuclei_finder_test-1770"><a href="#NucleiFinder.nuclei_finder_test-1770"><span class="linenos">1770</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">add_test</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This method performs testing analysis of parameters (specified 'nms' and 'prob' parameters)
for the image provided by the input_image() method.</p>

<p>This method evaluates the performance of the internal NucleiFinder
configuration using the currently loaded images, parameters, or model
settings. It is typically used to check whether the detection, segmentation
or preprocessing stages run correctly on sample data.</p>

<h2 id="examples">Examples</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">nf</span><span class="o">.</span><span class="n">nuclei_finder_test</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">nf</span><span class="o">.</span><span class="n">browser_test</span><span class="p">()</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="NucleiFinder.find_nuclei" class="classattr">
                                        <input id="NucleiFinder.find_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_nuclei</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.find_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.find_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.find_nuclei-1772"><a href="#NucleiFinder.find_nuclei-1772"><span class="linenos">1772</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">find_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.find_nuclei-1773"><a href="#NucleiFinder.find_nuclei-1773"><span class="linenos">1773</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.find_nuclei-1774"><a href="#NucleiFinder.find_nuclei-1774"><span class="linenos">1774</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="NucleiFinder.find_nuclei-1775"><a href="#NucleiFinder.find_nuclei-1775"><span class="linenos">1775</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder.find_nuclei-1776"><a href="#NucleiFinder.find_nuclei-1776"><span class="linenos">1776</span></a>
</span><span id="NucleiFinder.find_nuclei-1777"><a href="#NucleiFinder.find_nuclei-1777"><span class="linenos">1777</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder.find_nuclei-1778"><a href="#NucleiFinder.find_nuclei-1778"><span class="linenos">1778</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder.find_nuclei-1779"><a href="#NucleiFinder.find_nuclei-1779"><span class="linenos">1779</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder.find_nuclei-1780"><a href="#NucleiFinder.find_nuclei-1780"><span class="linenos">1780</span></a>
</span><span id="NucleiFinder.find_nuclei-1781"><a href="#NucleiFinder.find_nuclei-1781"><span class="linenos">1781</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder.find_nuclei-1782"><a href="#NucleiFinder.find_nuclei-1782"><span class="linenos">1782</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder.find_nuclei-1783"><a href="#NucleiFinder.find_nuclei-1783"><span class="linenos">1783</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder.find_nuclei-1784"><a href="#NucleiFinder.find_nuclei-1784"><span class="linenos">1784</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder.find_nuclei-1785"><a href="#NucleiFinder.find_nuclei-1785"><span class="linenos">1785</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder.find_nuclei-1786"><a href="#NucleiFinder.find_nuclei-1786"><span class="linenos">1786</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder.find_nuclei-1787"><a href="#NucleiFinder.find_nuclei-1787"><span class="linenos">1787</span></a>
</span><span id="NucleiFinder.find_nuclei-1788"><a href="#NucleiFinder.find_nuclei-1788"><span class="linenos">1788</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder.find_nuclei-1789"><a href="#NucleiFinder.find_nuclei-1789"><span class="linenos">1789</span></a><span class="sd">            - ``get_results_nuclei()``</span>
</span><span id="NucleiFinder.find_nuclei-1790"><a href="#NucleiFinder.find_nuclei-1790"><span class="linenos">1790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.find_nuclei-1791"><a href="#NucleiFinder.find_nuclei-1791"><span class="linenos">1791</span></a>
</span><span id="NucleiFinder.find_nuclei-1792"><a href="#NucleiFinder.find_nuclei-1792"><span class="linenos">1792</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="NucleiFinder.find_nuclei-1793"><a href="#NucleiFinder.find_nuclei-1793"><span class="linenos">1793</span></a>
</span><span id="NucleiFinder.find_nuclei-1794"><a href="#NucleiFinder.find_nuclei-1794"><span class="linenos">1794</span></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">StarDist2D</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;2D_versatile_fluo&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1795"><a href="#NucleiFinder.find_nuclei-1795"><span class="linenos">1795</span></a>
</span><span id="NucleiFinder.find_nuclei-1796"><a href="#NucleiFinder.find_nuclei-1796"><span class="linenos">1796</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1797"><a href="#NucleiFinder.find_nuclei-1797"><span class="linenos">1797</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1798"><a href="#NucleiFinder.find_nuclei-1798"><span class="linenos">1798</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1799"><a href="#NucleiFinder.find_nuclei-1799"><span class="linenos">1799</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.find_nuclei-1800"><a href="#NucleiFinder.find_nuclei-1800"><span class="linenos">1800</span></a>
</span><span id="NucleiFinder.find_nuclei-1801"><a href="#NucleiFinder.find_nuclei-1801"><span class="linenos">1801</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1802"><a href="#NucleiFinder.find_nuclei-1802"><span class="linenos">1802</span></a>                <span class="n">img</span><span class="p">,</span>
</span><span id="NucleiFinder.find_nuclei-1803"><a href="#NucleiFinder.find_nuclei-1803"><span class="linenos">1803</span></a>                <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.find_nuclei-1804"><a href="#NucleiFinder.find_nuclei-1804"><span class="linenos">1804</span></a>                <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.find_nuclei-1805"><a href="#NucleiFinder.find_nuclei-1805"><span class="linenos">1805</span></a>                <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.find_nuclei-1806"><a href="#NucleiFinder.find_nuclei-1806"><span class="linenos">1806</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1807"><a href="#NucleiFinder.find_nuclei-1807"><span class="linenos">1807</span></a>            <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1808"><a href="#NucleiFinder.find_nuclei-1808"><span class="linenos">1808</span></a>            <span class="n">labels</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_instances</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1809"><a href="#NucleiFinder.find_nuclei-1809"><span class="linenos">1809</span></a>                <span class="n">normalize</span><span class="p">(</span><span class="n">img</span><span class="p">),</span>
</span><span id="NucleiFinder.find_nuclei-1810"><a href="#NucleiFinder.find_nuclei-1810"><span class="linenos">1810</span></a>                <span class="n">nms_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;nms&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.find_nuclei-1811"><a href="#NucleiFinder.find_nuclei-1811"><span class="linenos">1811</span></a>                <span class="n">prob_thresh</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;prob&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.find_nuclei-1812"><a href="#NucleiFinder.find_nuclei-1812"><span class="linenos">1812</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1813"><a href="#NucleiFinder.find_nuclei-1813"><span class="linenos">1813</span></a>
</span><span id="NucleiFinder.find_nuclei-1814"><a href="#NucleiFinder.find_nuclei-1814"><span class="linenos">1814</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1815"><a href="#NucleiFinder.find_nuclei-1815"><span class="linenos">1815</span></a>                <span class="n">model_out</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">img</span>
</span><span id="NucleiFinder.find_nuclei-1816"><a href="#NucleiFinder.find_nuclei-1816"><span class="linenos">1816</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1817"><a href="#NucleiFinder.find_nuclei-1817"><span class="linenos">1817</span></a>
</span><span id="NucleiFinder.find_nuclei-1818"><a href="#NucleiFinder.find_nuclei-1818"><span class="linenos">1818</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1819"><a href="#NucleiFinder.find_nuclei-1819"><span class="linenos">1819</span></a>
</span><span id="NucleiFinder.find_nuclei-1820"><a href="#NucleiFinder.find_nuclei-1820"><span class="linenos">1820</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1821"><a href="#NucleiFinder.find_nuclei-1821"><span class="linenos">1821</span></a>
</span><span id="NucleiFinder.find_nuclei-1822"><a href="#NucleiFinder.find_nuclei-1822"><span class="linenos">1822</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="NucleiFinder.find_nuclei-1823"><a href="#NucleiFinder.find_nuclei-1823"><span class="linenos">1823</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1824"><a href="#NucleiFinder.find_nuclei-1824"><span class="linenos">1824</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder.find_nuclei-1825"><a href="#NucleiFinder.find_nuclei-1825"><span class="linenos">1825</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1826"><a href="#NucleiFinder.find_nuclei-1826"><span class="linenos">1826</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1827"><a href="#NucleiFinder.find_nuclei-1827"><span class="linenos">1827</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1828"><a href="#NucleiFinder.find_nuclei-1828"><span class="linenos">1828</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="n">oryginal</span><span class="p">),</span>
</span><span id="NucleiFinder.find_nuclei-1829"><a href="#NucleiFinder.find_nuclei-1829"><span class="linenos">1829</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.find_nuclei-1830"><a href="#NucleiFinder.find_nuclei-1830"><span class="linenos">1830</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder.find_nuclei-1831"><a href="#NucleiFinder.find_nuclei-1831"><span class="linenos">1831</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.find_nuclei-1832"><a href="#NucleiFinder.find_nuclei-1832"><span class="linenos">1832</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1833"><a href="#NucleiFinder.find_nuclei-1833"><span class="linenos">1833</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder.find_nuclei-1834"><a href="#NucleiFinder.find_nuclei-1834"><span class="linenos">1834</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder.find_nuclei-1835"><a href="#NucleiFinder.find_nuclei-1835"><span class="linenos">1835</span></a>
</span><span id="NucleiFinder.find_nuclei-1836"><a href="#NucleiFinder.find_nuclei-1836"><span class="linenos">1836</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1837"><a href="#NucleiFinder.find_nuclei-1837"><span class="linenos">1837</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1838"><a href="#NucleiFinder.find_nuclei-1838"><span class="linenos">1838</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder.find_nuclei-1839"><a href="#NucleiFinder.find_nuclei-1839"><span class="linenos">1839</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.find_nuclei-1840"><a href="#NucleiFinder.find_nuclei-1840"><span class="linenos">1840</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1841"><a href="#NucleiFinder.find_nuclei-1841"><span class="linenos">1841</span></a>
</span><span id="NucleiFinder.find_nuclei-1842"><a href="#NucleiFinder.find_nuclei-1842"><span class="linenos">1842</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1843"><a href="#NucleiFinder.find_nuclei-1843"><span class="linenos">1843</span></a>
</span><span id="NucleiFinder.find_nuclei-1844"><a href="#NucleiFinder.find_nuclei-1844"><span class="linenos">1844</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.find_nuclei-1845"><a href="#NucleiFinder.find_nuclei-1845"><span class="linenos">1845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.find_nuclei-1846"><a href="#NucleiFinder.find_nuclei-1846"><span class="linenos">1846</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.find_nuclei-1847"><a href="#NucleiFinder.find_nuclei-1847"><span class="linenos">1847</span></a>
</span><span id="NucleiFinder.find_nuclei-1848"><a href="#NucleiFinder.find_nuclei-1848"><span class="linenos">1848</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nuclei not detected!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.find_nuclei-1849"><a href="#NucleiFinder.find_nuclei-1849"><span class="linenos">1849</span></a>
</span><span id="NucleiFinder.find_nuclei-1850"><a href="#NucleiFinder.find_nuclei-1850"><span class="linenos">1850</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.find_nuclei-1851"><a href="#NucleiFinder.find_nuclei-1851"><span class="linenos">1851</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Add image firstly!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs analysis on the image provided by the <code><a href="#NucleiFinder.input_image">input_image()</a></code> method
using default or user-defined parameters.</p>

<p>To show current parameters, use:
    - <code><a href="#NucleiFinder.current_parameters_nuclei">current_parameters_nuclei</a></code>
    - <code><a href="#NucleiFinder.current_parameters_img_adj">current_parameters_img_adj</a></code></p>

<p>To set new parameters, use:
    - <code><a href="#NucleiFinder.set_nms">set_nms()</a></code>
    - <code><a href="#NucleiFinder.set_prob">set_prob()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_gamma">set_adj_image_gamma()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_contrast">set_adj_image_contrast()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_brightness">set_adj_image_brightness()</a></code></p>

<p>To get analysis results, use:
    - <code><a href="#NucleiFinder.get_results_nuclei">get_results_nuclei()</a></code></p>
</div>


                            </div>
                            <div id="NucleiFinder.select_nuclei" class="classattr">
                                        <input id="NucleiFinder.select_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_nuclei</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.select_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.select_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.select_nuclei-1853"><a href="#NucleiFinder.select_nuclei-1853"><span class="linenos">1853</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_nuclei</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.select_nuclei-1854"><a href="#NucleiFinder.select_nuclei-1854"><span class="linenos">1854</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.select_nuclei-1855"><a href="#NucleiFinder.select_nuclei-1855"><span class="linenos">1855</span></a><span class="sd">        Selects data obtained from ``find_nuclei()`` based on the set threshold parameters.</span>
</span><span id="NucleiFinder.select_nuclei-1856"><a href="#NucleiFinder.select_nuclei-1856"><span class="linenos">1856</span></a>
</span><span id="NucleiFinder.select_nuclei-1857"><a href="#NucleiFinder.select_nuclei-1857"><span class="linenos">1857</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder.select_nuclei-1858"><a href="#NucleiFinder.select_nuclei-1858"><span class="linenos">1858</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder.select_nuclei-1859"><a href="#NucleiFinder.select_nuclei-1859"><span class="linenos">1859</span></a>
</span><span id="NucleiFinder.select_nuclei-1860"><a href="#NucleiFinder.select_nuclei-1860"><span class="linenos">1860</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder.select_nuclei-1861"><a href="#NucleiFinder.select_nuclei-1861"><span class="linenos">1861</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder.select_nuclei-1862"><a href="#NucleiFinder.select_nuclei-1862"><span class="linenos">1862</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder.select_nuclei-1863"><a href="#NucleiFinder.select_nuclei-1863"><span class="linenos">1863</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder.select_nuclei-1864"><a href="#NucleiFinder.select_nuclei-1864"><span class="linenos">1864</span></a>
</span><span id="NucleiFinder.select_nuclei-1865"><a href="#NucleiFinder.select_nuclei-1865"><span class="linenos">1865</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder.select_nuclei-1866"><a href="#NucleiFinder.select_nuclei-1866"><span class="linenos">1866</span></a><span class="sd">            - ``get_results_nuclei_selected()``</span>
</span><span id="NucleiFinder.select_nuclei-1867"><a href="#NucleiFinder.select_nuclei-1867"><span class="linenos">1867</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.select_nuclei-1868"><a href="#NucleiFinder.select_nuclei-1868"><span class="linenos">1868</span></a>
</span><span id="NucleiFinder.select_nuclei-1869"><a href="#NucleiFinder.select_nuclei-1869"><span class="linenos">1869</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1870"><a href="#NucleiFinder.select_nuclei-1870"><span class="linenos">1870</span></a>            <span class="n">input_in</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.select_nuclei-1871"><a href="#NucleiFinder.select_nuclei-1871"><span class="linenos">1871</span></a>
</span><span id="NucleiFinder.select_nuclei-1872"><a href="#NucleiFinder.select_nuclei-1872"><span class="linenos">1872</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1873"><a href="#NucleiFinder.select_nuclei-1873"><span class="linenos">1873</span></a>                <span class="n">input_in</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1874"><a href="#NucleiFinder.select_nuclei-1874"><span class="linenos">1874</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1875"><a href="#NucleiFinder.select_nuclei-1875"><span class="linenos">1875</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.select_nuclei-1876"><a href="#NucleiFinder.select_nuclei-1876"><span class="linenos">1876</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1877"><a href="#NucleiFinder.select_nuclei-1877"><span class="linenos">1877</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1878"><a href="#NucleiFinder.select_nuclei-1878"><span class="linenos">1878</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1879"><a href="#NucleiFinder.select_nuclei-1879"><span class="linenos">1879</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1880"><a href="#NucleiFinder.select_nuclei-1880"><span class="linenos">1880</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1881"><a href="#NucleiFinder.select_nuclei-1881"><span class="linenos">1881</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.select_nuclei-1882"><a href="#NucleiFinder.select_nuclei-1882"><span class="linenos">1882</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1883"><a href="#NucleiFinder.select_nuclei-1883"><span class="linenos">1883</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1884"><a href="#NucleiFinder.select_nuclei-1884"><span class="linenos">1884</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1885"><a href="#NucleiFinder.select_nuclei-1885"><span class="linenos">1885</span></a>                <span class="n">nuclei_dictionary</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1886"><a href="#NucleiFinder.select_nuclei-1886"><span class="linenos">1886</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1887"><a href="#NucleiFinder.select_nuclei-1887"><span class="linenos">1887</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_nuclei</span><span class="p">[</span><span class="s2">&quot;intensity_mean&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.select_nuclei-1888"><a href="#NucleiFinder.select_nuclei-1888"><span class="linenos">1888</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1889"><a href="#NucleiFinder.select_nuclei-1889"><span class="linenos">1889</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1890"><a href="#NucleiFinder.select_nuclei-1890"><span class="linenos">1890</span></a>
</span><span id="NucleiFinder.select_nuclei-1891"><a href="#NucleiFinder.select_nuclei-1891"><span class="linenos">1891</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1892"><a href="#NucleiFinder.select_nuclei-1892"><span class="linenos">1892</span></a>
</span><span id="NucleiFinder.select_nuclei-1893"><a href="#NucleiFinder.select_nuclei-1893"><span class="linenos">1893</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="NucleiFinder.select_nuclei-1894"><a href="#NucleiFinder.select_nuclei-1894"><span class="linenos">1894</span></a>
</span><span id="NucleiFinder.select_nuclei-1895"><a href="#NucleiFinder.select_nuclei-1895"><span class="linenos">1895</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1896"><a href="#NucleiFinder.select_nuclei-1896"><span class="linenos">1896</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1897"><a href="#NucleiFinder.select_nuclei-1897"><span class="linenos">1897</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1898"><a href="#NucleiFinder.select_nuclei-1898"><span class="linenos">1898</span></a>                    <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.select_nuclei-1899"><a href="#NucleiFinder.select_nuclei-1899"><span class="linenos">1899</span></a>
</span><span id="NucleiFinder.select_nuclei-1900"><a href="#NucleiFinder.select_nuclei-1900"><span class="linenos">1900</span></a>                <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1901"><a href="#NucleiFinder.select_nuclei-1901"><span class="linenos">1901</span></a>
</span><span id="NucleiFinder.select_nuclei-1902"><a href="#NucleiFinder.select_nuclei-1902"><span class="linenos">1902</span></a>                <span class="c1"># series repaired nuclesu</span>
</span><span id="NucleiFinder.select_nuclei-1903"><a href="#NucleiFinder.select_nuclei-1903"><span class="linenos">1903</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1904"><a href="#NucleiFinder.select_nuclei-1904"><span class="linenos">1904</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder.select_nuclei-1905"><a href="#NucleiFinder.select_nuclei-1905"><span class="linenos">1905</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1906"><a href="#NucleiFinder.select_nuclei-1906"><span class="linenos">1906</span></a>                    <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1907"><a href="#NucleiFinder.select_nuclei-1907"><span class="linenos">1907</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1908"><a href="#NucleiFinder.select_nuclei-1908"><span class="linenos">1908</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1909"><a href="#NucleiFinder.select_nuclei-1909"><span class="linenos">1909</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="n">oryginal</span>
</span><span id="NucleiFinder.select_nuclei-1910"><a href="#NucleiFinder.select_nuclei-1910"><span class="linenos">1910</span></a>                            <span class="p">),</span>
</span><span id="NucleiFinder.select_nuclei-1911"><a href="#NucleiFinder.select_nuclei-1911"><span class="linenos">1911</span></a>                            <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1912"><a href="#NucleiFinder.select_nuclei-1912"><span class="linenos">1912</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder.select_nuclei-1913"><a href="#NucleiFinder.select_nuclei-1913"><span class="linenos">1913</span></a>                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.select_nuclei-1914"><a href="#NucleiFinder.select_nuclei-1914"><span class="linenos">1914</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1915"><a href="#NucleiFinder.select_nuclei-1915"><span class="linenos">1915</span></a>                    <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder.select_nuclei-1916"><a href="#NucleiFinder.select_nuclei-1916"><span class="linenos">1916</span></a>
</span><span id="NucleiFinder.select_nuclei-1917"><a href="#NucleiFinder.select_nuclei-1917"><span class="linenos">1917</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder.select_nuclei-1918"><a href="#NucleiFinder.select_nuclei-1918"><span class="linenos">1918</span></a>
</span><span id="NucleiFinder.select_nuclei-1919"><a href="#NucleiFinder.select_nuclei-1919"><span class="linenos">1919</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1920"><a href="#NucleiFinder.select_nuclei-1920"><span class="linenos">1920</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1921"><a href="#NucleiFinder.select_nuclei-1921"><span class="linenos">1921</span></a>                        <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder.select_nuclei-1922"><a href="#NucleiFinder.select_nuclei-1922"><span class="linenos">1922</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.select_nuclei-1923"><a href="#NucleiFinder.select_nuclei-1923"><span class="linenos">1923</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1924"><a href="#NucleiFinder.select_nuclei-1924"><span class="linenos">1924</span></a>
</span><span id="NucleiFinder.select_nuclei-1925"><a href="#NucleiFinder.select_nuclei-1925"><span class="linenos">1925</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1926"><a href="#NucleiFinder.select_nuclei-1926"><span class="linenos">1926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.select_nuclei-1927"><a href="#NucleiFinder.select_nuclei-1927"><span class="linenos">1927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.select_nuclei-1928"><a href="#NucleiFinder.select_nuclei-1928"><span class="linenos">1928</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.select_nuclei-1929"><a href="#NucleiFinder.select_nuclei-1929"><span class="linenos">1929</span></a>
</span><span id="NucleiFinder.select_nuclei-1930"><a href="#NucleiFinder.select_nuclei-1930"><span class="linenos">1930</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selected zero nuclei! Analysis stop!&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.select_nuclei-1931"><a href="#NucleiFinder.select_nuclei-1931"><span class="linenos">1931</span></a>
</span><span id="NucleiFinder.select_nuclei-1932"><a href="#NucleiFinder.select_nuclei-1932"><span class="linenos">1932</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.select_nuclei-1933"><a href="#NucleiFinder.select_nuclei-1933"><span class="linenos">1933</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Selects data obtained from <code><a href="#NucleiFinder.find_nuclei">find_nuclei()</a></code> based on the set threshold parameters.</p>

<p>To show current parameters, use:
    - <code><a href="#NucleiFinder.current_parameters_nuclei">current_parameters_nuclei</a></code></p>

<p>To set new parameters, use:
    - <code><a href="#NucleiFinder.set_nuclei_circularity">set_nuclei_circularity()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_size">set_nuclei_size()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_min_mean_intensity">set_nuclei_min_mean_intensity()</a></code></p>

<p>To get analysis results, use:
    - <code><a href="#NucleiFinder.get_results_nuclei_selected">get_results_nuclei_selected()</a></code></p>
</div>


                            </div>
                            <div id="NucleiFinder.nuclei_chromatinization" class="classattr">
                                        <input id="NucleiFinder.nuclei_chromatinization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">nuclei_chromatinization</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.nuclei_chromatinization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.nuclei_chromatinization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.nuclei_chromatinization-1935"><a href="#NucleiFinder.nuclei_chromatinization-1935"><span class="linenos">1935</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">nuclei_chromatinization</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1936"><a href="#NucleiFinder.nuclei_chromatinization-1936"><span class="linenos">1936</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1937"><a href="#NucleiFinder.nuclei_chromatinization-1937"><span class="linenos">1937</span></a><span class="sd">        Performs chromatinization analysis of nuclei using data obtained from</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1938"><a href="#NucleiFinder.nuclei_chromatinization-1938"><span class="linenos">1938</span></a><span class="sd">        ``find_nuclei()`` and/or ``select_nuclei()``.</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1939"><a href="#NucleiFinder.nuclei_chromatinization-1939"><span class="linenos">1939</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1940"><a href="#NucleiFinder.nuclei_chromatinization-1940"><span class="linenos">1940</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1941"><a href="#NucleiFinder.nuclei_chromatinization-1941"><span class="linenos">1941</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1942"><a href="#NucleiFinder.nuclei_chromatinization-1942"><span class="linenos">1942</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1943"><a href="#NucleiFinder.nuclei_chromatinization-1943"><span class="linenos">1943</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1944"><a href="#NucleiFinder.nuclei_chromatinization-1944"><span class="linenos">1944</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1945"><a href="#NucleiFinder.nuclei_chromatinization-1945"><span class="linenos">1945</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1946"><a href="#NucleiFinder.nuclei_chromatinization-1946"><span class="linenos">1946</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1947"><a href="#NucleiFinder.nuclei_chromatinization-1947"><span class="linenos">1947</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1948"><a href="#NucleiFinder.nuclei_chromatinization-1948"><span class="linenos">1948</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1949"><a href="#NucleiFinder.nuclei_chromatinization-1949"><span class="linenos">1949</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1950"><a href="#NucleiFinder.nuclei_chromatinization-1950"><span class="linenos">1950</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1951"><a href="#NucleiFinder.nuclei_chromatinization-1951"><span class="linenos">1951</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1952"><a href="#NucleiFinder.nuclei_chromatinization-1952"><span class="linenos">1952</span></a><span class="sd">        To get analysis results, use:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1953"><a href="#NucleiFinder.nuclei_chromatinization-1953"><span class="linenos">1953</span></a><span class="sd">            - ``get_results_nuclei_chromatinization()``</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1954"><a href="#NucleiFinder.nuclei_chromatinization-1954"><span class="linenos">1954</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1955"><a href="#NucleiFinder.nuclei_chromatinization-1955"><span class="linenos">1955</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1956"><a href="#NucleiFinder.nuclei_chromatinization-1956"><span class="linenos">1956</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">add_lists</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1957"><a href="#NucleiFinder.nuclei_chromatinization-1957"><span class="linenos">1957</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1958"><a href="#NucleiFinder.nuclei_chromatinization-1958"><span class="linenos">1958</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1959"><a href="#NucleiFinder.nuclei_chromatinization-1959"><span class="linenos">1959</span></a>            <span class="n">max_length</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1960"><a href="#NucleiFinder.nuclei_chromatinization-1960"><span class="linenos">1960</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1961"><a href="#NucleiFinder.nuclei_chromatinization-1961"><span class="linenos">1961</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1962"><a href="#NucleiFinder.nuclei_chromatinization-1962"><span class="linenos">1962</span></a>                <span class="n">f_elem</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1963"><a href="#NucleiFinder.nuclei_chromatinization-1963"><span class="linenos">1963</span></a>                <span class="n">g_elem</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1964"><a href="#NucleiFinder.nuclei_chromatinization-1964"><span class="linenos">1964</span></a>                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f_elem</span> <span class="o">+</span> <span class="n">g_elem</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1965"><a href="#NucleiFinder.nuclei_chromatinization-1965"><span class="linenos">1965</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1966"><a href="#NucleiFinder.nuclei_chromatinization-1966"><span class="linenos">1966</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1967"><a href="#NucleiFinder.nuclei_chromatinization-1967"><span class="linenos">1967</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1968"><a href="#NucleiFinder.nuclei_chromatinization-1968"><span class="linenos">1968</span></a>        <span class="k">def</span><span class="w"> </span><span class="nf">reverse_coords</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1969"><a href="#NucleiFinder.nuclei_chromatinization-1969"><span class="linenos">1969</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1970"><a href="#NucleiFinder.nuclei_chromatinization-1970"><span class="linenos">1970</span></a>            <span class="n">zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1971"><a href="#NucleiFinder.nuclei_chromatinization-1971"><span class="linenos">1971</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1972"><a href="#NucleiFinder.nuclei_chromatinization-1972"><span class="linenos">1972</span></a>            <span class="n">zero</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1973"><a href="#NucleiFinder.nuclei_chromatinization-1973"><span class="linenos">1973</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1974"><a href="#NucleiFinder.nuclei_chromatinization-1974"><span class="linenos">1974</span></a>            <span class="n">zero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1975"><a href="#NucleiFinder.nuclei_chromatinization-1975"><span class="linenos">1975</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1976"><a href="#NucleiFinder.nuclei_chromatinization-1976"><span class="linenos">1976</span></a>            <span class="k">return</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zero_indices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1977"><a href="#NucleiFinder.nuclei_chromatinization-1977"><span class="linenos">1977</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1978"><a href="#NucleiFinder.nuclei_chromatinization-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1979"><a href="#NucleiFinder.nuclei_chromatinization-1979"><span class="linenos">1979</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1980"><a href="#NucleiFinder.nuclei_chromatinization-1980"><span class="linenos">1980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1981"><a href="#NucleiFinder.nuclei_chromatinization-1981"><span class="linenos">1981</span></a>            <span class="n">nuclei_dictionary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1982"><a href="#NucleiFinder.nuclei_chromatinization-1982"><span class="linenos">1982</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1983"><a href="#NucleiFinder.nuclei_chromatinization-1983"><span class="linenos">1983</span></a>        <span class="k">if</span> <span class="n">nuclei_dictionary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1984"><a href="#NucleiFinder.nuclei_chromatinization-1984"><span class="linenos">1984</span></a>            <span class="n">arrays_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1985"><a href="#NucleiFinder.nuclei_chromatinization-1985"><span class="linenos">1985</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-1986"><a href="#NucleiFinder.nuclei_chromatinization-1986"><span class="linenos">1986</span></a>            <span class="n">chromatione_info</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1987"><a href="#NucleiFinder.nuclei_chromatinization-1987"><span class="linenos">1987</span></a>                <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1988"><a href="#NucleiFinder.nuclei_chromatinization-1988"><span class="linenos">1988</span></a>                <span class="s2">&quot;area_bbox&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1989"><a href="#NucleiFinder.nuclei_chromatinization-1989"><span class="linenos">1989</span></a>                <span class="s2">&quot;area_convex&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1990"><a href="#NucleiFinder.nuclei_chromatinization-1990"><span class="linenos">1990</span></a>                <span class="s2">&quot;area_filled&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1991"><a href="#NucleiFinder.nuclei_chromatinization-1991"><span class="linenos">1991</span></a>                <span class="s2">&quot;axis_major_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1992"><a href="#NucleiFinder.nuclei_chromatinization-1992"><span class="linenos">1992</span></a>                <span class="s2">&quot;axis_minor_length&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1993"><a href="#NucleiFinder.nuclei_chromatinization-1993"><span class="linenos">1993</span></a>                <span class="s2">&quot;eccentricity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1994"><a href="#NucleiFinder.nuclei_chromatinization-1994"><span class="linenos">1994</span></a>                <span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1995"><a href="#NucleiFinder.nuclei_chromatinization-1995"><span class="linenos">1995</span></a>                <span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1996"><a href="#NucleiFinder.nuclei_chromatinization-1996"><span class="linenos">1996</span></a>                <span class="s2">&quot;solidity&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1997"><a href="#NucleiFinder.nuclei_chromatinization-1997"><span class="linenos">1997</span></a>                <span class="s2">&quot;perimeter&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1998"><a href="#NucleiFinder.nuclei_chromatinization-1998"><span class="linenos">1998</span></a>                <span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-1999"><a href="#NucleiFinder.nuclei_chromatinization-1999"><span class="linenos">1999</span></a>                <span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2000"><a href="#NucleiFinder.nuclei_chromatinization-2000"><span class="linenos">2000</span></a>            <span class="p">}</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2001"><a href="#NucleiFinder.nuclei_chromatinization-2001"><span class="linenos">2001</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2002"><a href="#NucleiFinder.nuclei_chromatinization-2002"><span class="linenos">2002</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2003"><a href="#NucleiFinder.nuclei_chromatinization-2003"><span class="linenos">2003</span></a>            <span class="n">full_im</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">full_im</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2004"><a href="#NucleiFinder.nuclei_chromatinization-2004"><span class="linenos">2004</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2005"><a href="#NucleiFinder.nuclei_chromatinization-2005"><span class="linenos">2005</span></a>            <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">arrays_list</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2006"><a href="#NucleiFinder.nuclei_chromatinization-2006"><span class="linenos">2006</span></a>                <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2007"><a href="#NucleiFinder.nuclei_chromatinization-2007"><span class="linenos">2007</span></a>                <span class="n">y</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2008"><a href="#NucleiFinder.nuclei_chromatinization-2008"><span class="linenos">2008</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2009"><a href="#NucleiFinder.nuclei_chromatinization-2009"><span class="linenos">2009</span></a>                <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">reverse_coords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2010"><a href="#NucleiFinder.nuclei_chromatinization-2010"><span class="linenos">2010</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2011"><a href="#NucleiFinder.nuclei_chromatinization-2011"><span class="linenos">2011</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2012"><a href="#NucleiFinder.nuclei_chromatinization-2012"><span class="linenos">2012</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2013"><a href="#NucleiFinder.nuclei_chromatinization-2013"><span class="linenos">2013</span></a>                <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2014"><a href="#NucleiFinder.nuclei_chromatinization-2014"><span class="linenos">2014</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2015"><a href="#NucleiFinder.nuclei_chromatinization-2015"><span class="linenos">2015</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">regions_chro2</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint16&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2016"><a href="#NucleiFinder.nuclei_chromatinization-2016"><span class="linenos">2016</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2017"><a href="#NucleiFinder.nuclei_chromatinization-2017"><span class="linenos">2017</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2018"><a href="#NucleiFinder.nuclei_chromatinization-2018"><span class="linenos">2018</span></a>                    <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2019"><a href="#NucleiFinder.nuclei_chromatinization-2019"><span class="linenos">2019</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2020"><a href="#NucleiFinder.nuclei_chromatinization-2020"><span class="linenos">2020</span></a>                    <span class="k">pass</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2021"><a href="#NucleiFinder.nuclei_chromatinization-2021"><span class="linenos">2021</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2022"><a href="#NucleiFinder.nuclei_chromatinization-2022"><span class="linenos">2022</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2023"><a href="#NucleiFinder.nuclei_chromatinization-2023"><span class="linenos">2023</span></a>                    <span class="n">regions_chro2</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2024"><a href="#NucleiFinder.nuclei_chromatinization-2024"><span class="linenos">2024</span></a>                    <span class="n">brightness</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;brightness&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2025"><a href="#NucleiFinder.nuclei_chromatinization-2025"><span class="linenos">2025</span></a>                    <span class="n">contrast</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2026"><a href="#NucleiFinder.nuclei_chromatinization-2026"><span class="linenos">2026</span></a>                    <span class="n">gamma</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_adj_par_chrom</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2027"><a href="#NucleiFinder.nuclei_chromatinization-2027"><span class="linenos">2027</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2028"><a href="#NucleiFinder.nuclei_chromatinization-2028"><span class="linenos">2028</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2029"><a href="#NucleiFinder.nuclei_chromatinization-2029"><span class="linenos">2029</span></a>                <span class="n">full_im</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2030"><a href="#NucleiFinder.nuclei_chromatinization-2030"><span class="linenos">2030</span></a>                    <span class="n">image_list</span><span class="o">=</span><span class="p">[</span><span class="n">full_im</span><span class="p">,</span> <span class="n">regions_chro2</span><span class="p">],</span> <span class="n">intensity_factors</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2031"><a href="#NucleiFinder.nuclei_chromatinization-2031"><span class="linenos">2031</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2032"><a href="#NucleiFinder.nuclei_chromatinization-2032"><span class="linenos">2032</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2033"><a href="#NucleiFinder.nuclei_chromatinization-2033"><span class="linenos">2033</span></a>                <span class="n">ret</span><span class="p">,</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2034"><a href="#NucleiFinder.nuclei_chromatinization-2034"><span class="linenos">2034</span></a>                    <span class="n">regions_chro2</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2035"><a href="#NucleiFinder.nuclei_chromatinization-2035"><span class="linenos">2035</span></a>                    <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2036"><a href="#NucleiFinder.nuclei_chromatinization-2036"><span class="linenos">2036</span></a>                    <span class="mi">2</span><span class="o">**</span><span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2037"><a href="#NucleiFinder.nuclei_chromatinization-2037"><span class="linenos">2037</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">+</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2038"><a href="#NucleiFinder.nuclei_chromatinization-2038"><span class="linenos">2038</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2039"><a href="#NucleiFinder.nuclei_chromatinization-2039"><span class="linenos">2039</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2040"><a href="#NucleiFinder.nuclei_chromatinization-2040"><span class="linenos">2040</span></a>                <span class="n">regions_chro2</span><span class="p">[</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2041"><a href="#NucleiFinder.nuclei_chromatinization-2041"><span class="linenos">2041</span></a>                    <span class="n">regions_chro2</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2042"><a href="#NucleiFinder.nuclei_chromatinization-2042"><span class="linenos">2042</span></a>                    <span class="o">&lt;=</span> <span class="n">ret</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;cut_point&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2043"><a href="#NucleiFinder.nuclei_chromatinization-2043"><span class="linenos">2043</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2044"><a href="#NucleiFinder.nuclei_chromatinization-2044"><span class="linenos">2044</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2045"><a href="#NucleiFinder.nuclei_chromatinization-2045"><span class="linenos">2045</span></a>                <span class="n">regions_chro2</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">regions_chro2</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2046"><a href="#NucleiFinder.nuclei_chromatinization-2046"><span class="linenos">2046</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2047"><a href="#NucleiFinder.nuclei_chromatinization-2047"><span class="linenos">2047</span></a>                <span class="n">chromatione</span> <span class="o">=</span> <span class="n">regions_chro2</span> <span class="o">&gt;</span> <span class="mi">0</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2048"><a href="#NucleiFinder.nuclei_chromatinization-2048"><span class="linenos">2048</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2049"><a href="#NucleiFinder.nuclei_chromatinization-2049"><span class="linenos">2049</span></a>                <span class="n">labeled_cells</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">chromatione</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2050"><a href="#NucleiFinder.nuclei_chromatinization-2050"><span class="linenos">2050</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span><span class="n">labeled_cells</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2051"><a href="#NucleiFinder.nuclei_chromatinization-2051"><span class="linenos">2051</span></a>                <span class="n">regions</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">regionprops</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2052"><a href="#NucleiFinder.nuclei_chromatinization-2052"><span class="linenos">2052</span></a>                    <span class="n">labeled_cells</span><span class="p">,</span> <span class="n">intensity_image</span><span class="o">=</span><span class="n">regions_chro2</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2053"><a href="#NucleiFinder.nuclei_chromatinization-2053"><span class="linenos">2053</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2054"><a href="#NucleiFinder.nuclei_chromatinization-2054"><span class="linenos">2054</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2055"><a href="#NucleiFinder.nuclei_chromatinization-2055"><span class="linenos">2055</span></a>                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2056"><a href="#NucleiFinder.nuclei_chromatinization-2056"><span class="linenos">2056</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2057"><a href="#NucleiFinder.nuclei_chromatinization-2057"><span class="linenos">2057</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2058"><a href="#NucleiFinder.nuclei_chromatinization-2058"><span class="linenos">2058</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2059"><a href="#NucleiFinder.nuclei_chromatinization-2059"><span class="linenos">2059</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2060"><a href="#NucleiFinder.nuclei_chromatinization-2060"><span class="linenos">2060</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2061"><a href="#NucleiFinder.nuclei_chromatinization-2061"><span class="linenos">2061</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2062"><a href="#NucleiFinder.nuclei_chromatinization-2062"><span class="linenos">2062</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_major_length</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2063"><a href="#NucleiFinder.nuclei_chromatinization-2063"><span class="linenos">2063</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2064"><a href="#NucleiFinder.nuclei_chromatinization-2064"><span class="linenos">2064</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2065"><a href="#NucleiFinder.nuclei_chromatinization-2065"><span class="linenos">2065</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">axis_minor_length</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2066"><a href="#NucleiFinder.nuclei_chromatinization-2066"><span class="linenos">2066</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2067"><a href="#NucleiFinder.nuclei_chromatinization-2067"><span class="linenos">2067</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2068"><a href="#NucleiFinder.nuclei_chromatinization-2068"><span class="linenos">2068</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2069"><a href="#NucleiFinder.nuclei_chromatinization-2069"><span class="linenos">2069</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">equivalent_diameter_area</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2070"><a href="#NucleiFinder.nuclei_chromatinization-2070"><span class="linenos">2070</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2071"><a href="#NucleiFinder.nuclei_chromatinization-2071"><span class="linenos">2071</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2072"><a href="#NucleiFinder.nuclei_chromatinization-2072"><span class="linenos">2072</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">feret_diameter_max</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2073"><a href="#NucleiFinder.nuclei_chromatinization-2073"><span class="linenos">2073</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2074"><a href="#NucleiFinder.nuclei_chromatinization-2074"><span class="linenos">2074</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;solidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">solidity</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2075"><a href="#NucleiFinder.nuclei_chromatinization-2075"><span class="linenos">2075</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2076"><a href="#NucleiFinder.nuclei_chromatinization-2076"><span class="linenos">2076</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2077"><a href="#NucleiFinder.nuclei_chromatinization-2077"><span class="linenos">2077</span></a>                        <span class="n">region</span><span class="o">.</span><span class="n">perimeter_crofton</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2078"><a href="#NucleiFinder.nuclei_chromatinization-2078"><span class="linenos">2078</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2079"><a href="#NucleiFinder.nuclei_chromatinization-2079"><span class="linenos">2079</span></a>                    <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2080"><a href="#NucleiFinder.nuclei_chromatinization-2080"><span class="linenos">2080</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2081"><a href="#NucleiFinder.nuclei_chromatinization-2081"><span class="linenos">2081</span></a>            <span class="n">ratios</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2082"><a href="#NucleiFinder.nuclei_chromatinization-2082"><span class="linenos">2082</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2083"><a href="#NucleiFinder.nuclei_chromatinization-2083"><span class="linenos">2083</span></a>            <span class="k">for</span> <span class="n">min_len</span><span class="p">,</span> <span class="n">max_len</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2084"><a href="#NucleiFinder.nuclei_chromatinization-2084"><span class="linenos">2084</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2085"><a href="#NucleiFinder.nuclei_chromatinization-2085"><span class="linenos">2085</span></a>                <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2086"><a href="#NucleiFinder.nuclei_chromatinization-2086"><span class="linenos">2086</span></a>            <span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2087"><a href="#NucleiFinder.nuclei_chromatinization-2087"><span class="linenos">2087</span></a>                <span class="k">if</span> <span class="n">max_len</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2088"><a href="#NucleiFinder.nuclei_chromatinization-2088"><span class="linenos">2088</span></a>                    <span class="n">ratio</span> <span class="o">=</span> <span class="n">min_len</span> <span class="o">/</span> <span class="n">max_len</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2089"><a href="#NucleiFinder.nuclei_chromatinization-2089"><span class="linenos">2089</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2090"><a href="#NucleiFinder.nuclei_chromatinization-2090"><span class="linenos">2090</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2091"><a href="#NucleiFinder.nuclei_chromatinization-2091"><span class="linenos">2091</span></a>                    <span class="n">ratios</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2092"><a href="#NucleiFinder.nuclei_chromatinization-2092"><span class="linenos">2092</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2093"><a href="#NucleiFinder.nuclei_chromatinization-2093"><span class="linenos">2093</span></a>            <span class="n">chromatione_info</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ratios</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2094"><a href="#NucleiFinder.nuclei_chromatinization-2094"><span class="linenos">2094</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2095"><a href="#NucleiFinder.nuclei_chromatinization-2095"><span class="linenos">2095</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2096"><a href="#NucleiFinder.nuclei_chromatinization-2096"><span class="linenos">2096</span></a>                <span class="n">chromatione_info</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2097"><a href="#NucleiFinder.nuclei_chromatinization-2097"><span class="linenos">2097</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2098"><a href="#NucleiFinder.nuclei_chromatinization-2098"><span class="linenos">2098</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;min_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2099"><a href="#NucleiFinder.nuclei_chromatinization-2099"><span class="linenos">2099</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2100"><a href="#NucleiFinder.nuclei_chromatinization-2100"><span class="linenos">2100</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2101"><a href="#NucleiFinder.nuclei_chromatinization-2101"><span class="linenos">2101</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2102"><a href="#NucleiFinder.nuclei_chromatinization-2102"><span class="linenos">2102</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2103"><a href="#NucleiFinder.nuclei_chromatinization-2103"><span class="linenos">2103</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;area&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2104"><a href="#NucleiFinder.nuclei_chromatinization-2104"><span class="linenos">2104</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;max_size&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2105"><a href="#NucleiFinder.nuclei_chromatinization-2105"><span class="linenos">2105</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2106"><a href="#NucleiFinder.nuclei_chromatinization-2106"><span class="linenos">2106</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2107"><a href="#NucleiFinder.nuclei_chromatinization-2107"><span class="linenos">2107</span></a>            <span class="n">chromation_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_dict</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2108"><a href="#NucleiFinder.nuclei_chromatinization-2108"><span class="linenos">2108</span></a>                <span class="n">chromation_dic</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2109"><a href="#NucleiFinder.nuclei_chromatinization-2109"><span class="linenos">2109</span></a>                <span class="n">key</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2110"><a href="#NucleiFinder.nuclei_chromatinization-2110"><span class="linenos">2110</span></a>                <span class="n">var</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hyperparameter_chromatinization</span><span class="p">[</span><span class="s2">&quot;ratio&quot;</span><span class="p">],</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2111"><a href="#NucleiFinder.nuclei_chromatinization-2111"><span class="linenos">2111</span></a>                <span class="n">action</span><span class="o">=</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2112"><a href="#NucleiFinder.nuclei_chromatinization-2112"><span class="linenos">2112</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2113"><a href="#NucleiFinder.nuclei_chromatinization-2113"><span class="linenos">2113</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2114"><a href="#NucleiFinder.nuclei_chromatinization-2114"><span class="linenos">2114</span></a>            <span class="n">arrays_list2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;coords&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2115"><a href="#NucleiFinder.nuclei_chromatinization-2115"><span class="linenos">2115</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2116"><a href="#NucleiFinder.nuclei_chromatinization-2116"><span class="linenos">2116</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2117"><a href="#NucleiFinder.nuclei_chromatinization-2117"><span class="linenos">2117</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2118"><a href="#NucleiFinder.nuclei_chromatinization-2118"><span class="linenos">2118</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2119"><a href="#NucleiFinder.nuclei_chromatinization-2119"><span class="linenos">2119</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2120"><a href="#NucleiFinder.nuclei_chromatinization-2120"><span class="linenos">2120</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2121"><a href="#NucleiFinder.nuclei_chromatinization-2121"><span class="linenos">2121</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2122"><a href="#NucleiFinder.nuclei_chromatinization-2122"><span class="linenos">2122</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2123"><a href="#NucleiFinder.nuclei_chromatinization-2123"><span class="linenos">2123</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2124"><a href="#NucleiFinder.nuclei_chromatinization-2124"><span class="linenos">2124</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2125"><a href="#NucleiFinder.nuclei_chromatinization-2125"><span class="linenos">2125</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2126"><a href="#NucleiFinder.nuclei_chromatinization-2126"><span class="linenos">2126</span></a>            <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2127"><a href="#NucleiFinder.nuclei_chromatinization-2127"><span class="linenos">2127</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2128"><a href="#NucleiFinder.nuclei_chromatinization-2128"><span class="linenos">2128</span></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2129"><a href="#NucleiFinder.nuclei_chromatinization-2129"><span class="linenos">2129</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2130"><a href="#NucleiFinder.nuclei_chromatinization-2130"><span class="linenos">2130</span></a>                <span class="n">spot_size_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2131"><a href="#NucleiFinder.nuclei_chromatinization-2131"><span class="linenos">2131</span></a>                <span class="n">spot_size_area_bbox</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2132"><a href="#NucleiFinder.nuclei_chromatinization-2132"><span class="linenos">2132</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2133"><a href="#NucleiFinder.nuclei_chromatinization-2133"><span class="linenos">2133</span></a>                <span class="n">spot_size_area_convex</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2134"><a href="#NucleiFinder.nuclei_chromatinization-2134"><span class="linenos">2134</span></a>                <span class="n">spot_size_area_filled</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2135"><a href="#NucleiFinder.nuclei_chromatinization-2135"><span class="linenos">2135</span></a>                <span class="n">spot_axis_major_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2136"><a href="#NucleiFinder.nuclei_chromatinization-2136"><span class="linenos">2136</span></a>                <span class="n">spot_axis_minor_length</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2137"><a href="#NucleiFinder.nuclei_chromatinization-2137"><span class="linenos">2137</span></a>                <span class="n">spot_eccentricity</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2138"><a href="#NucleiFinder.nuclei_chromatinization-2138"><span class="linenos">2138</span></a>                <span class="n">spot_size_equivalent_diameter_area</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2139"><a href="#NucleiFinder.nuclei_chromatinization-2139"><span class="linenos">2139</span></a>                <span class="n">spot_feret_diameter_max</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2140"><a href="#NucleiFinder.nuclei_chromatinization-2140"><span class="linenos">2140</span></a>                <span class="n">spot_perimeter</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2141"><a href="#NucleiFinder.nuclei_chromatinization-2141"><span class="linenos">2141</span></a>                <span class="n">spot_perimeter_crofton</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2142"><a href="#NucleiFinder.nuclei_chromatinization-2142"><span class="linenos">2142</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2143"><a href="#NucleiFinder.nuclei_chromatinization-2143"><span class="linenos">2143</span></a>                <span class="c1"># Flatten the array,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2144"><a href="#NucleiFinder.nuclei_chromatinization-2144"><span class="linenos">2144</span></a>                <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2145"><a href="#NucleiFinder.nuclei_chromatinization-2145"><span class="linenos">2145</span></a>                <span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2146"><a href="#NucleiFinder.nuclei_chromatinization-2146"><span class="linenos">2146</span></a>                    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2147"><a href="#NucleiFinder.nuclei_chromatinization-2147"><span class="linenos">2147</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2148"><a href="#NucleiFinder.nuclei_chromatinization-2148"><span class="linenos">2148</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2149"><a href="#NucleiFinder.nuclei_chromatinization-2149"><span class="linenos">2149</span></a>                <span class="n">counter_tmp</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2150"><a href="#NucleiFinder.nuclei_chromatinization-2150"><span class="linenos">2150</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2151"><a href="#NucleiFinder.nuclei_chromatinization-2151"><span class="linenos">2151</span></a>                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">arr2</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays_list2</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2152"><a href="#NucleiFinder.nuclei_chromatinization-2152"><span class="linenos">2152</span></a>                    <span class="n">df_tmp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">arr2</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2153"><a href="#NucleiFinder.nuclei_chromatinization-2153"><span class="linenos">2153</span></a>                    <span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">add_lists</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2154"><a href="#NucleiFinder.nuclei_chromatinization-2154"><span class="linenos">2154</span></a>                        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">df_tmp2</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2155"><a href="#NucleiFinder.nuclei_chromatinization-2155"><span class="linenos">2155</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2156"><a href="#NucleiFinder.nuclei_chromatinization-2156"><span class="linenos">2156</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2157"><a href="#NucleiFinder.nuclei_chromatinization-2157"><span class="linenos">2157</span></a>                    <span class="n">counter_tmp2</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2158"><a href="#NucleiFinder.nuclei_chromatinization-2158"><span class="linenos">2158</span></a>                    <span class="n">intersection_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">counter_tmp2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2159"><a href="#NucleiFinder.nuclei_chromatinization-2159"><span class="linenos">2159</span></a>                    <span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">counter_tmp2</span><span class="p">))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2160"><a href="#NucleiFinder.nuclei_chromatinization-2160"><span class="linenos">2160</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2161"><a href="#NucleiFinder.nuclei_chromatinization-2161"><span class="linenos">2161</span></a>                    <span class="k">if</span> <span class="n">intersection_length</span> <span class="o">&gt;=</span> <span class="mf">0.8</span> <span class="o">*</span> <span class="n">min_length</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2162"><a href="#NucleiFinder.nuclei_chromatinization-2162"><span class="linenos">2162</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2163"><a href="#NucleiFinder.nuclei_chromatinization-2163"><span class="linenos">2163</span></a>                        <span class="k">if</span> <span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2164"><a href="#NucleiFinder.nuclei_chromatinization-2164"><span class="linenos">2164</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2165"><a href="#NucleiFinder.nuclei_chromatinization-2165"><span class="linenos">2165</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2166"><a href="#NucleiFinder.nuclei_chromatinization-2166"><span class="linenos">2166</span></a>                        <span class="p">)</span> <span class="o">&gt;=</span> <span class="mf">0.025</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2167"><a href="#NucleiFinder.nuclei_chromatinization-2167"><span class="linenos">2167</span></a>                            <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp2</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2168"><a href="#NucleiFinder.nuclei_chromatinization-2168"><span class="linenos">2168</span></a>                            <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[</span><span class="s2">&quot;duplicates&quot;</span><span class="p">]))</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2169"><a href="#NucleiFinder.nuclei_chromatinization-2169"><span class="linenos">2169</span></a>                        <span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2170"><a href="#NucleiFinder.nuclei_chromatinization-2170"><span class="linenos">2170</span></a>                            <span class="n">spot_size_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2171"><a href="#NucleiFinder.nuclei_chromatinization-2171"><span class="linenos">2171</span></a>                            <span class="n">spot_size_area_bbox</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2172"><a href="#NucleiFinder.nuclei_chromatinization-2172"><span class="linenos">2172</span></a>                            <span class="n">spot_size_area_convex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2173"><a href="#NucleiFinder.nuclei_chromatinization-2173"><span class="linenos">2173</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_convex&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2174"><a href="#NucleiFinder.nuclei_chromatinization-2174"><span class="linenos">2174</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2175"><a href="#NucleiFinder.nuclei_chromatinization-2175"><span class="linenos">2175</span></a>                            <span class="n">spot_size_area_filled</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2176"><a href="#NucleiFinder.nuclei_chromatinization-2176"><span class="linenos">2176</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;area_filled&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2177"><a href="#NucleiFinder.nuclei_chromatinization-2177"><span class="linenos">2177</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2178"><a href="#NucleiFinder.nuclei_chromatinization-2178"><span class="linenos">2178</span></a>                            <span class="n">spot_axis_major_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2179"><a href="#NucleiFinder.nuclei_chromatinization-2179"><span class="linenos">2179</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2180"><a href="#NucleiFinder.nuclei_chromatinization-2180"><span class="linenos">2180</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2181"><a href="#NucleiFinder.nuclei_chromatinization-2181"><span class="linenos">2181</span></a>                            <span class="n">spot_axis_minor_length</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2182"><a href="#NucleiFinder.nuclei_chromatinization-2182"><span class="linenos">2182</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2183"><a href="#NucleiFinder.nuclei_chromatinization-2183"><span class="linenos">2183</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2184"><a href="#NucleiFinder.nuclei_chromatinization-2184"><span class="linenos">2184</span></a>                            <span class="n">spot_eccentricity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2185"><a href="#NucleiFinder.nuclei_chromatinization-2185"><span class="linenos">2185</span></a>                            <span class="n">spot_size_equivalent_diameter_area</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2186"><a href="#NucleiFinder.nuclei_chromatinization-2186"><span class="linenos">2186</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;equivalent_diameter_area&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2187"><a href="#NucleiFinder.nuclei_chromatinization-2187"><span class="linenos">2187</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2188"><a href="#NucleiFinder.nuclei_chromatinization-2188"><span class="linenos">2188</span></a>                            <span class="n">spot_feret_diameter_max</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2189"><a href="#NucleiFinder.nuclei_chromatinization-2189"><span class="linenos">2189</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2190"><a href="#NucleiFinder.nuclei_chromatinization-2190"><span class="linenos">2190</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2191"><a href="#NucleiFinder.nuclei_chromatinization-2191"><span class="linenos">2191</span></a>                            <span class="n">spot_perimeter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2192"><a href="#NucleiFinder.nuclei_chromatinization-2192"><span class="linenos">2192</span></a>                            <span class="n">spot_perimeter_crofton</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2193"><a href="#NucleiFinder.nuclei_chromatinization-2193"><span class="linenos">2193</span></a>                                <span class="n">chromation_dic</span><span class="p">[</span><span class="s2">&quot;perimeter_crofton&quot;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2194"><a href="#NucleiFinder.nuclei_chromatinization-2194"><span class="linenos">2194</span></a>                            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2195"><a href="#NucleiFinder.nuclei_chromatinization-2195"><span class="linenos">2195</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2196"><a href="#NucleiFinder.nuclei_chromatinization-2196"><span class="linenos">2196</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2197"><a href="#NucleiFinder.nuclei_chromatinization-2197"><span class="linenos">2197</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_bbox</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2198"><a href="#NucleiFinder.nuclei_chromatinization-2198"><span class="linenos">2198</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_convex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_convex</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2199"><a href="#NucleiFinder.nuclei_chromatinization-2199"><span class="linenos">2199</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_area_filled&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_size_area_filled</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2200"><a href="#NucleiFinder.nuclei_chromatinization-2200"><span class="linenos">2200</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2201"><a href="#NucleiFinder.nuclei_chromatinization-2201"><span class="linenos">2201</span></a>                    <span class="n">spot_axis_major_length</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2202"><a href="#NucleiFinder.nuclei_chromatinization-2202"><span class="linenos">2202</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2203"><a href="#NucleiFinder.nuclei_chromatinization-2203"><span class="linenos">2203</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2204"><a href="#NucleiFinder.nuclei_chromatinization-2204"><span class="linenos">2204</span></a>                    <span class="n">spot_axis_minor_length</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2205"><a href="#NucleiFinder.nuclei_chromatinization-2205"><span class="linenos">2205</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2206"><a href="#NucleiFinder.nuclei_chromatinization-2206"><span class="linenos">2206</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_eccentricity</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2207"><a href="#NucleiFinder.nuclei_chromatinization-2207"><span class="linenos">2207</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2208"><a href="#NucleiFinder.nuclei_chromatinization-2208"><span class="linenos">2208</span></a>                    <span class="n">spot_size_equivalent_diameter_area</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2209"><a href="#NucleiFinder.nuclei_chromatinization-2209"><span class="linenos">2209</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2210"><a href="#NucleiFinder.nuclei_chromatinization-2210"><span class="linenos">2210</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_feret_diameter_max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2211"><a href="#NucleiFinder.nuclei_chromatinization-2211"><span class="linenos">2211</span></a>                    <span class="n">spot_feret_diameter_max</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2212"><a href="#NucleiFinder.nuclei_chromatinization-2212"><span class="linenos">2212</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2213"><a href="#NucleiFinder.nuclei_chromatinization-2213"><span class="linenos">2213</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spot_perimeter</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2214"><a href="#NucleiFinder.nuclei_chromatinization-2214"><span class="linenos">2214</span></a>                <span class="n">nuclei_dictionary</span><span class="p">[</span><span class="s2">&quot;spot_perimeter_crofton&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2215"><a href="#NucleiFinder.nuclei_chromatinization-2215"><span class="linenos">2215</span></a>                    <span class="n">spot_perimeter_crofton</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2216"><a href="#NucleiFinder.nuclei_chromatinization-2216"><span class="linenos">2216</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2217"><a href="#NucleiFinder.nuclei_chromatinization-2217"><span class="linenos">2217</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2218"><a href="#NucleiFinder.nuclei_chromatinization-2218"><span class="linenos">2218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chromation_dic</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2219"><a href="#NucleiFinder.nuclei_chromatinization-2219"><span class="linenos">2219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_dictionary</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2220"><a href="#NucleiFinder.nuclei_chromatinization-2220"><span class="linenos">2220</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2221"><a href="#NucleiFinder.nuclei_chromatinization-2221"><span class="linenos">2221</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2222"><a href="#NucleiFinder.nuclei_chromatinization-2222"><span class="linenos">2222</span></a>                <span class="n">chromation_dic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2223"><a href="#NucleiFinder.nuclei_chromatinization-2223"><span class="linenos">2223</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2224"><a href="#NucleiFinder.nuclei_chromatinization-2224"><span class="linenos">2224</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2225"><a href="#NucleiFinder.nuclei_chromatinization-2225"><span class="linenos">2225</span></a>            <span class="n">img_chrom</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2226"><a href="#NucleiFinder.nuclei_chromatinization-2226"><span class="linenos">2226</span></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2227"><a href="#NucleiFinder.nuclei_chromatinization-2227"><span class="linenos">2227</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2228"><a href="#NucleiFinder.nuclei_chromatinization-2228"><span class="linenos">2228</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;chromatinization&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2229"><a href="#NucleiFinder.nuclei_chromatinization-2229"><span class="linenos">2229</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2230"><a href="#NucleiFinder.nuclei_chromatinization-2230"><span class="linenos">2230</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2231"><a href="#NucleiFinder.nuclei_chromatinization-2231"><span class="linenos">2231</span></a>                <span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2232"><a href="#NucleiFinder.nuclei_chromatinization-2232"><span class="linenos">2232</span></a>                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2233"><a href="#NucleiFinder.nuclei_chromatinization-2233"><span class="linenos">2233</span></a>            <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2234"><a href="#NucleiFinder.nuclei_chromatinization-2234"><span class="linenos">2234</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2235"><a href="#NucleiFinder.nuclei_chromatinization-2235"><span class="linenos">2235</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2236"><a href="#NucleiFinder.nuclei_chromatinization-2236"><span class="linenos">2236</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2237"><a href="#NucleiFinder.nuclei_chromatinization-2237"><span class="linenos">2237</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2238"><a href="#NucleiFinder.nuclei_chromatinization-2238"><span class="linenos">2238</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2239"><a href="#NucleiFinder.nuclei_chromatinization-2239"><span class="linenos">2239</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei_reduced&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2240"><a href="#NucleiFinder.nuclei_chromatinization-2240"><span class="linenos">2240</span></a>                        <span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2241"><a href="#NucleiFinder.nuclei_chromatinization-2241"><span class="linenos">2241</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2242"><a href="#NucleiFinder.nuclei_chromatinization-2242"><span class="linenos">2242</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2243"><a href="#NucleiFinder.nuclei_chromatinization-2243"><span class="linenos">2243</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2244"><a href="#NucleiFinder.nuclei_chromatinization-2244"><span class="linenos">2244</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2245"><a href="#NucleiFinder.nuclei_chromatinization-2245"><span class="linenos">2245</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2246"><a href="#NucleiFinder.nuclei_chromatinization-2246"><span class="linenos">2246</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2247"><a href="#NucleiFinder.nuclei_chromatinization-2247"><span class="linenos">2247</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2248"><a href="#NucleiFinder.nuclei_chromatinization-2248"><span class="linenos">2248</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2249"><a href="#NucleiFinder.nuclei_chromatinization-2249"><span class="linenos">2249</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2250"><a href="#NucleiFinder.nuclei_chromatinization-2250"><span class="linenos">2250</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2251"><a href="#NucleiFinder.nuclei_chromatinization-2251"><span class="linenos">2251</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2252"><a href="#NucleiFinder.nuclei_chromatinization-2252"><span class="linenos">2252</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2253"><a href="#NucleiFinder.nuclei_chromatinization-2253"><span class="linenos">2253</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2254"><a href="#NucleiFinder.nuclei_chromatinization-2254"><span class="linenos">2254</span></a>            <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">merge_images</span><span class="p">([</span><span class="n">nuclei_mask</span><span class="p">,</span> <span class="n">img_chrom</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2255"><a href="#NucleiFinder.nuclei_chromatinization-2255"><span class="linenos">2255</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2256"><a href="#NucleiFinder.nuclei_chromatinization-2256"><span class="linenos">2256</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2257"><a href="#NucleiFinder.nuclei_chromatinization-2257"><span class="linenos">2257</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">full_im</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2258"><a href="#NucleiFinder.nuclei_chromatinization-2258"><span class="linenos">2258</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2259"><a href="#NucleiFinder.nuclei_chromatinization-2259"><span class="linenos">2259</span></a>                <span class="n">img</span> <span class="o">=</span> <span class="n">full_im</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2260"><a href="#NucleiFinder.nuclei_chromatinization-2260"><span class="linenos">2260</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2261"><a href="#NucleiFinder.nuclei_chromatinization-2261"><span class="linenos">2261</span></a>            <span class="n">oryginal</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2262"><a href="#NucleiFinder.nuclei_chromatinization-2262"><span class="linenos">2262</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2263"><a href="#NucleiFinder.nuclei_chromatinization-2263"><span class="linenos">2263</span></a>            <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">oryginal</span><span class="p">,</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2264"><a href="#NucleiFinder.nuclei_chromatinization-2264"><span class="linenos">2264</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2265"><a href="#NucleiFinder.nuclei_chromatinization-2265"><span class="linenos">2265</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concatenated_image</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2266"><a href="#NucleiFinder.nuclei_chromatinization-2266"><span class="linenos">2266</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2267"><a href="#NucleiFinder.nuclei_chromatinization-2267"><span class="linenos">2267</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2268"><a href="#NucleiFinder.nuclei_chromatinization-2268"><span class="linenos">2268</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2269"><a href="#NucleiFinder.nuclei_chromatinization-2269"><span class="linenos">2269</span></a>                    <span class="n">display_preview</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2270"><a href="#NucleiFinder.nuclei_chromatinization-2270"><span class="linenos">2270</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to_screen_img</span><span class="p">(</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2271"><a href="#NucleiFinder.nuclei_chromatinization-2271"><span class="linenos">2271</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="s2">&quot;nuclei_chromatinization&quot;</span><span class="p">]</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2272"><a href="#NucleiFinder.nuclei_chromatinization-2272"><span class="linenos">2272</span></a>                        <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2273"><a href="#NucleiFinder.nuclei_chromatinization-2273"><span class="linenos">2273</span></a>                    <span class="p">)</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2274"><a href="#NucleiFinder.nuclei_chromatinization-2274"><span class="linenos">2274</span></a>
</span><span id="NucleiFinder.nuclei_chromatinization-2275"><a href="#NucleiFinder.nuclei_chromatinization-2275"><span class="linenos">2275</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.nuclei_chromatinization-2276"><a href="#NucleiFinder.nuclei_chromatinization-2276"><span class="linenos">2276</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Lack of nuclei data to select!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Performs chromatinization analysis of nuclei using data obtained from
<code><a href="#NucleiFinder.find_nuclei">find_nuclei()</a></code> and/or <code><a href="#NucleiFinder.select_nuclei">select_nuclei()</a></code>.</p>

<p>To show current parameters, use:
    - <code><a href="#NucleiFinder.current_parameters_chromatinization">current_parameters_chromatinization</a></code>
    - <code><a href="#NucleiFinder.current_parameters_img_adj_chro">current_parameters_img_adj_chro</a></code></p>

<p>To set new parameters, use:
    - <code><a href="#NucleiFinder.set_chromatinization_size">set_chromatinization_size()</a></code>
    - <code><a href="#NucleiFinder.set_chromatinization_ratio">set_chromatinization_ratio()</a></code>
    - <code><a href="#NucleiFinder.set_chromatinization_cut_point">set_chromatinization_cut_point()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_gamma">set_adj_chrom_gamma()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_contrast">set_adj_chrom_contrast()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_brightness">set_adj_chrom_brightness()</a></code></p>

<p>To get analysis results, use:
    - <code><a href="#NucleiFinder.get_results_nuclei_chromatinization">get_results_nuclei_chromatinization()</a></code></p>
</div>


                            </div>
                            <div id="NucleiFinder.browser_test" class="classattr">
                                        <input id="NucleiFinder.browser_test-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">browser_test</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.browser_test-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.browser_test"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.browser_test-2587"><a href="#NucleiFinder.browser_test-2587"><span class="linenos">2587</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">browser_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiFinder.browser_test-2588"><a href="#NucleiFinder.browser_test-2588"><span class="linenos">2588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.browser_test-2589"><a href="#NucleiFinder.browser_test-2589"><span class="linenos">2589</span></a><span class="sd">        Displays test results generated by the ``nuclei_finder_test()`` method</span>
</span><span id="NucleiFinder.browser_test-2590"><a href="#NucleiFinder.browser_test-2590"><span class="linenos">2590</span></a><span class="sd">        in the default web browser.</span>
</span><span id="NucleiFinder.browser_test-2591"><a href="#NucleiFinder.browser_test-2591"><span class="linenos">2591</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.browser_test-2592"><a href="#NucleiFinder.browser_test-2592"><span class="linenos">2592</span></a>
</span><span id="NucleiFinder.browser_test-2593"><a href="#NucleiFinder.browser_test-2593"><span class="linenos">2593</span></a>        <span class="n">html_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="NucleiFinder.browser_test-2594"><a href="#NucleiFinder.browser_test-2594"><span class="linenos">2594</span></a>
</span><span id="NucleiFinder.browser_test-2595"><a href="#NucleiFinder.browser_test-2595"><span class="linenos">2595</span></a>        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span><span class="p">:</span>
</span><span id="NucleiFinder.browser_test-2596"><a href="#NucleiFinder.browser_test-2596"><span class="linenos">2596</span></a>            <span class="n">buf</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
</span><span id="NucleiFinder.browser_test-2597"><a href="#NucleiFinder.browser_test-2597"><span class="linenos">2597</span></a>            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.browser_test-2598"><a href="#NucleiFinder.browser_test-2598"><span class="linenos">2598</span></a>            <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="NucleiFinder.browser_test-2599"><a href="#NucleiFinder.browser_test-2599"><span class="linenos">2599</span></a>
</span><span id="NucleiFinder.browser_test-2600"><a href="#NucleiFinder.browser_test-2600"><span class="linenos">2600</span></a>            <span class="n">img_base64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">buf</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.browser_test-2601"><a href="#NucleiFinder.browser_test-2601"><span class="linenos">2601</span></a>
</span><span id="NucleiFinder.browser_test-2602"><a href="#NucleiFinder.browser_test-2602"><span class="linenos">2602</span></a>            <span class="n">html_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;img src=&quot;data:image/png;base64,</span><span class="si">{</span><span class="n">img_base64</span><span class="si">}</span><span class="s1">&quot; style=&quot;margin:10px;&quot;/&gt;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="NucleiFinder.browser_test-2603"><a href="#NucleiFinder.browser_test-2603"><span class="linenos">2603</span></a>
</span><span id="NucleiFinder.browser_test-2604"><a href="#NucleiFinder.browser_test-2604"><span class="linenos">2604</span></a>        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span>
</span><span id="NucleiFinder.browser_test-2605"><a href="#NucleiFinder.browser_test-2605"><span class="linenos">2605</span></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.html&quot;</span>
</span><span id="NucleiFinder.browser_test-2606"><a href="#NucleiFinder.browser_test-2606"><span class="linenos">2606</span></a>        <span class="p">)</span> <span class="k">as</span> <span class="n">tmp_file</span><span class="p">:</span>
</span><span id="NucleiFinder.browser_test-2607"><a href="#NucleiFinder.browser_test-2607"><span class="linenos">2607</span></a>            <span class="n">tmp_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html_content</span><span class="p">)</span>
</span><span id="NucleiFinder.browser_test-2608"><a href="#NucleiFinder.browser_test-2608"><span class="linenos">2608</span></a>            <span class="n">tmp_filename</span> <span class="o">=</span> <span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span>
</span><span id="NucleiFinder.browser_test-2609"><a href="#NucleiFinder.browser_test-2609"><span class="linenos">2609</span></a>
</span><span id="NucleiFinder.browser_test-2610"><a href="#NucleiFinder.browser_test-2610"><span class="linenos">2610</span></a>        <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new_tab</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Displays test results generated by the <code><a href="#NucleiFinder.nuclei_finder_test">nuclei_finder_test()</a></code> method
in the default web browser.</p>
</div>


                            </div>
                            <div id="NucleiFinder.series_analysis_chromatinization" class="classattr">
                                        <input id="NucleiFinder.series_analysis_chromatinization-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">series_analysis_chromatinization</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tiff&#39;</span>,</span><span class="param">	<span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.series_analysis_chromatinization-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.series_analysis_chromatinization"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.series_analysis_chromatinization-2612"><a href="#NucleiFinder.series_analysis_chromatinization-2612"><span class="linenos">2612</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_chromatinization</span><span class="p">(</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2613"><a href="#NucleiFinder.series_analysis_chromatinization-2613"><span class="linenos">2613</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2614"><a href="#NucleiFinder.series_analysis_chromatinization-2614"><span class="linenos">2614</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2615"><a href="#NucleiFinder.series_analysis_chromatinization-2615"><span class="linenos">2615</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2616"><a href="#NucleiFinder.series_analysis_chromatinization-2616"><span class="linenos">2616</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2617"><a href="#NucleiFinder.series_analysis_chromatinization-2617"><span class="linenos">2617</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2618"><a href="#NucleiFinder.series_analysis_chromatinization-2618"><span class="linenos">2618</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2619"><a href="#NucleiFinder.series_analysis_chromatinization-2619"><span class="linenos">2619</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2620"><a href="#NucleiFinder.series_analysis_chromatinization-2620"><span class="linenos">2620</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2621"><a href="#NucleiFinder.series_analysis_chromatinization-2621"><span class="linenos">2621</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2622"><a href="#NucleiFinder.series_analysis_chromatinization-2622"><span class="linenos">2622</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2623"><a href="#NucleiFinder.series_analysis_chromatinization-2623"><span class="linenos">2623</span></a><span class="sd">        Performs full analysis on images provided via the ``input_image()`` method</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2624"><a href="#NucleiFinder.series_analysis_chromatinization-2624"><span class="linenos">2624</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2625"><a href="#NucleiFinder.series_analysis_chromatinization-2625"><span class="linenos">2625</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2626"><a href="#NucleiFinder.series_analysis_chromatinization-2626"><span class="linenos">2626</span></a><span class="sd">        This method runs nuclei detection, nuclei selection, and chromatinization</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2627"><a href="#NucleiFinder.series_analysis_chromatinization-2627"><span class="linenos">2627</span></a><span class="sd">        analysis in a single pipeline. Users can adjust parameters for each step</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2628"><a href="#NucleiFinder.series_analysis_chromatinization-2628"><span class="linenos">2628</span></a><span class="sd">        before running the analysis.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2629"><a href="#NucleiFinder.series_analysis_chromatinization-2629"><span class="linenos">2629</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2630"><a href="#NucleiFinder.series_analysis_chromatinization-2630"><span class="linenos">2630</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2631"><a href="#NucleiFinder.series_analysis_chromatinization-2631"><span class="linenos">2631</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2632"><a href="#NucleiFinder.series_analysis_chromatinization-2632"><span class="linenos">2632</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2633"><a href="#NucleiFinder.series_analysis_chromatinization-2633"><span class="linenos">2633</span></a><span class="sd">            - ``current_parameters_chromatinization``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2634"><a href="#NucleiFinder.series_analysis_chromatinization-2634"><span class="linenos">2634</span></a><span class="sd">            - ``current_parameters_img_adj_chro``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2635"><a href="#NucleiFinder.series_analysis_chromatinization-2635"><span class="linenos">2635</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2636"><a href="#NucleiFinder.series_analysis_chromatinization-2636"><span class="linenos">2636</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2637"><a href="#NucleiFinder.series_analysis_chromatinization-2637"><span class="linenos">2637</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2638"><a href="#NucleiFinder.series_analysis_chromatinization-2638"><span class="linenos">2638</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2639"><a href="#NucleiFinder.series_analysis_chromatinization-2639"><span class="linenos">2639</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2640"><a href="#NucleiFinder.series_analysis_chromatinization-2640"><span class="linenos">2640</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2641"><a href="#NucleiFinder.series_analysis_chromatinization-2641"><span class="linenos">2641</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2642"><a href="#NucleiFinder.series_analysis_chromatinization-2642"><span class="linenos">2642</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2643"><a href="#NucleiFinder.series_analysis_chromatinization-2643"><span class="linenos">2643</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2644"><a href="#NucleiFinder.series_analysis_chromatinization-2644"><span class="linenos">2644</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2645"><a href="#NucleiFinder.series_analysis_chromatinization-2645"><span class="linenos">2645</span></a><span class="sd">            - ``set_chromatinization_size()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2646"><a href="#NucleiFinder.series_analysis_chromatinization-2646"><span class="linenos">2646</span></a><span class="sd">            - ``set_chromatinization_ratio()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2647"><a href="#NucleiFinder.series_analysis_chromatinization-2647"><span class="linenos">2647</span></a><span class="sd">            - ``set_chromatinization_cut_point()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2648"><a href="#NucleiFinder.series_analysis_chromatinization-2648"><span class="linenos">2648</span></a><span class="sd">            - ``set_adj_chrom_gamma()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2649"><a href="#NucleiFinder.series_analysis_chromatinization-2649"><span class="linenos">2649</span></a><span class="sd">            - ``set_adj_chrom_contrast()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2650"><a href="#NucleiFinder.series_analysis_chromatinization-2650"><span class="linenos">2650</span></a><span class="sd">            - ``set_adj_chrom_brightness()``</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2651"><a href="#NucleiFinder.series_analysis_chromatinization-2651"><span class="linenos">2651</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2652"><a href="#NucleiFinder.series_analysis_chromatinization-2652"><span class="linenos">2652</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2653"><a href="#NucleiFinder.series_analysis_chromatinization-2653"><span class="linenos">2653</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2654"><a href="#NucleiFinder.series_analysis_chromatinization-2654"><span class="linenos">2654</span></a><span class="sd">        path_to_images : str</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2655"><a href="#NucleiFinder.series_analysis_chromatinization-2655"><span class="linenos">2655</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2656"><a href="#NucleiFinder.series_analysis_chromatinization-2656"><span class="linenos">2656</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2657"><a href="#NucleiFinder.series_analysis_chromatinization-2657"><span class="linenos">2657</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2658"><a href="#NucleiFinder.series_analysis_chromatinization-2658"><span class="linenos">2658</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2659"><a href="#NucleiFinder.series_analysis_chromatinization-2659"><span class="linenos">2659</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2660"><a href="#NucleiFinder.series_analysis_chromatinization-2660"><span class="linenos">2660</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2661"><a href="#NucleiFinder.series_analysis_chromatinization-2661"><span class="linenos">2661</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2662"><a href="#NucleiFinder.series_analysis_chromatinization-2662"><span class="linenos">2662</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2663"><a href="#NucleiFinder.series_analysis_chromatinization-2663"><span class="linenos">2663</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2664"><a href="#NucleiFinder.series_analysis_chromatinization-2664"><span class="linenos">2664</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2665"><a href="#NucleiFinder.series_analysis_chromatinization-2665"><span class="linenos">2665</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2666"><a href="#NucleiFinder.series_analysis_chromatinization-2666"><span class="linenos">2666</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2667"><a href="#NucleiFinder.series_analysis_chromatinization-2667"><span class="linenos">2667</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2668"><a href="#NucleiFinder.series_analysis_chromatinization-2668"><span class="linenos">2668</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2669"><a href="#NucleiFinder.series_analysis_chromatinization-2669"><span class="linenos">2669</span></a><span class="sd">            Whether to run ``select_nuclei()`` with the defined parameters. Default is True.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2670"><a href="#NucleiFinder.series_analysis_chromatinization-2670"><span class="linenos">2670</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2671"><a href="#NucleiFinder.series_analysis_chromatinization-2671"><span class="linenos">2671</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2672"><a href="#NucleiFinder.series_analysis_chromatinization-2672"><span class="linenos">2672</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2673"><a href="#NucleiFinder.series_analysis_chromatinization-2673"><span class="linenos">2673</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2674"><a href="#NucleiFinder.series_analysis_chromatinization-2674"><span class="linenos">2674</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2675"><a href="#NucleiFinder.series_analysis_chromatinization-2675"><span class="linenos">2675</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2676"><a href="#NucleiFinder.series_analysis_chromatinization-2676"><span class="linenos">2676</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2677"><a href="#NucleiFinder.series_analysis_chromatinization-2677"><span class="linenos">2677</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2678"><a href="#NucleiFinder.series_analysis_chromatinization-2678"><span class="linenos">2678</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2679"><a href="#NucleiFinder.series_analysis_chromatinization-2679"><span class="linenos">2679</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2680"><a href="#NucleiFinder.series_analysis_chromatinization-2680"><span class="linenos">2680</span></a><span class="sd">        results_dict : dict</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2681"><a href="#NucleiFinder.series_analysis_chromatinization-2681"><span class="linenos">2681</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2682"><a href="#NucleiFinder.series_analysis_chromatinization-2682"><span class="linenos">2682</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2683"><a href="#NucleiFinder.series_analysis_chromatinization-2683"><span class="linenos">2683</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2684"><a href="#NucleiFinder.series_analysis_chromatinization-2684"><span class="linenos">2684</span></a><span class="sd">        Notes</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2685"><a href="#NucleiFinder.series_analysis_chromatinization-2685"><span class="linenos">2685</span></a><span class="sd">        -----</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2686"><a href="#NucleiFinder.series_analysis_chromatinization-2686"><span class="linenos">2686</span></a><span class="sd">        This method runs the complete nuclei and chromatinization analysis pipeline.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2687"><a href="#NucleiFinder.series_analysis_chromatinization-2687"><span class="linenos">2687</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2688"><a href="#NucleiFinder.series_analysis_chromatinization-2688"><span class="linenos">2688</span></a><span class="sd">        Parameters must be set appropriately before calling to ensure correct results.</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2689"><a href="#NucleiFinder.series_analysis_chromatinization-2689"><span class="linenos">2689</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2690"><a href="#NucleiFinder.series_analysis_chromatinization-2690"><span class="linenos">2690</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2691"><a href="#NucleiFinder.series_analysis_chromatinization-2691"><span class="linenos">2691</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2692"><a href="#NucleiFinder.series_analysis_chromatinization-2692"><span class="linenos">2692</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2693"><a href="#NucleiFinder.series_analysis_chromatinization-2693"><span class="linenos">2693</span></a>        <span class="n">results_img_raw</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2694"><a href="#NucleiFinder.series_analysis_chromatinization-2694"><span class="linenos">2694</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2695"><a href="#NucleiFinder.series_analysis_chromatinization-2695"><span class="linenos">2695</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2696"><a href="#NucleiFinder.series_analysis_chromatinization-2696"><span class="linenos">2696</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2697"><a href="#NucleiFinder.series_analysis_chromatinization-2697"><span class="linenos">2697</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2698"><a href="#NucleiFinder.series_analysis_chromatinization-2698"><span class="linenos">2698</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2699"><a href="#NucleiFinder.series_analysis_chromatinization-2699"><span class="linenos">2699</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2700"><a href="#NucleiFinder.series_analysis_chromatinization-2700"><span class="linenos">2700</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2701"><a href="#NucleiFinder.series_analysis_chromatinization-2701"><span class="linenos">2701</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2702"><a href="#NucleiFinder.series_analysis_chromatinization-2702"><span class="linenos">2702</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2703"><a href="#NucleiFinder.series_analysis_chromatinization-2703"><span class="linenos">2703</span></a>                <span class="n">x</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2704"><a href="#NucleiFinder.series_analysis_chromatinization-2704"><span class="linenos">2704</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2705"><a href="#NucleiFinder.series_analysis_chromatinization-2705"><span class="linenos">2705</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2706"><a href="#NucleiFinder.series_analysis_chromatinization-2706"><span class="linenos">2706</span></a>            <span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2707"><a href="#NucleiFinder.series_analysis_chromatinization-2707"><span class="linenos">2707</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2708"><a href="#NucleiFinder.series_analysis_chromatinization-2708"><span class="linenos">2708</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2709"><a href="#NucleiFinder.series_analysis_chromatinization-2709"><span class="linenos">2709</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2710"><a href="#NucleiFinder.series_analysis_chromatinization-2710"><span class="linenos">2710</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2711"><a href="#NucleiFinder.series_analysis_chromatinization-2711"><span class="linenos">2711</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2712"><a href="#NucleiFinder.series_analysis_chromatinization-2712"><span class="linenos">2712</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2713"><a href="#NucleiFinder.series_analysis_chromatinization-2713"><span class="linenos">2713</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2714"><a href="#NucleiFinder.series_analysis_chromatinization-2714"><span class="linenos">2714</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2715"><a href="#NucleiFinder.series_analysis_chromatinization-2715"><span class="linenos">2715</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2716"><a href="#NucleiFinder.series_analysis_chromatinization-2716"><span class="linenos">2716</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2717"><a href="#NucleiFinder.series_analysis_chromatinization-2717"><span class="linenos">2717</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2718"><a href="#NucleiFinder.series_analysis_chromatinization-2718"><span class="linenos">2718</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2719"><a href="#NucleiFinder.series_analysis_chromatinization-2719"><span class="linenos">2719</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2720"><a href="#NucleiFinder.series_analysis_chromatinization-2720"><span class="linenos">2720</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2721"><a href="#NucleiFinder.series_analysis_chromatinization-2721"><span class="linenos">2721</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2722"><a href="#NucleiFinder.series_analysis_chromatinization-2722"><span class="linenos">2722</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2723"><a href="#NucleiFinder.series_analysis_chromatinization-2723"><span class="linenos">2723</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2724"><a href="#NucleiFinder.series_analysis_chromatinization-2724"><span class="linenos">2724</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2725"><a href="#NucleiFinder.series_analysis_chromatinization-2725"><span class="linenos">2725</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2726"><a href="#NucleiFinder.series_analysis_chromatinization-2726"><span class="linenos">2726</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2727"><a href="#NucleiFinder.series_analysis_chromatinization-2727"><span class="linenos">2727</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2728"><a href="#NucleiFinder.series_analysis_chromatinization-2728"><span class="linenos">2728</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2729"><a href="#NucleiFinder.series_analysis_chromatinization-2729"><span class="linenos">2729</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2730"><a href="#NucleiFinder.series_analysis_chromatinization-2730"><span class="linenos">2730</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2731"><a href="#NucleiFinder.series_analysis_chromatinization-2731"><span class="linenos">2731</span></a>            <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2732"><a href="#NucleiFinder.series_analysis_chromatinization-2732"><span class="linenos">2732</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2733"><a href="#NucleiFinder.series_analysis_chromatinization-2733"><span class="linenos">2733</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2734"><a href="#NucleiFinder.series_analysis_chromatinization-2734"><span class="linenos">2734</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2735"><a href="#NucleiFinder.series_analysis_chromatinization-2735"><span class="linenos">2735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2736"><a href="#NucleiFinder.series_analysis_chromatinization-2736"><span class="linenos">2736</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2737"><a href="#NucleiFinder.series_analysis_chromatinization-2737"><span class="linenos">2737</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2738"><a href="#NucleiFinder.series_analysis_chromatinization-2738"><span class="linenos">2738</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2739"><a href="#NucleiFinder.series_analysis_chromatinization-2739"><span class="linenos">2739</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2740"><a href="#NucleiFinder.series_analysis_chromatinization-2740"><span class="linenos">2740</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2741"><a href="#NucleiFinder.series_analysis_chromatinization-2741"><span class="linenos">2741</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2742"><a href="#NucleiFinder.series_analysis_chromatinization-2742"><span class="linenos">2742</span></a>                    <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2743"><a href="#NucleiFinder.series_analysis_chromatinization-2743"><span class="linenos">2743</span></a>                    <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2744"><a href="#NucleiFinder.series_analysis_chromatinization-2744"><span class="linenos">2744</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">image</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2745"><a href="#NucleiFinder.series_analysis_chromatinization-2745"><span class="linenos">2745</span></a>                    <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2746"><a href="#NucleiFinder.series_analysis_chromatinization-2746"><span class="linenos">2746</span></a>                    <span class="k">del</span> <span class="n">image</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2747"><a href="#NucleiFinder.series_analysis_chromatinization-2747"><span class="linenos">2747</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2748"><a href="#NucleiFinder.series_analysis_chromatinization-2748"><span class="linenos">2748</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2749"><a href="#NucleiFinder.series_analysis_chromatinization-2749"><span class="linenos">2749</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2750"><a href="#NucleiFinder.series_analysis_chromatinization-2750"><span class="linenos">2750</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2751"><a href="#NucleiFinder.series_analysis_chromatinization-2751"><span class="linenos">2751</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2752"><a href="#NucleiFinder.series_analysis_chromatinization-2752"><span class="linenos">2752</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Chromatization searching:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2753"><a href="#NucleiFinder.series_analysis_chromatinization-2753"><span class="linenos">2753</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2754"><a href="#NucleiFinder.series_analysis_chromatinization-2754"><span class="linenos">2754</span></a>        <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2755"><a href="#NucleiFinder.series_analysis_chromatinization-2755"><span class="linenos">2755</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2756"><a href="#NucleiFinder.series_analysis_chromatinization-2756"><span class="linenos">2756</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2757"><a href="#NucleiFinder.series_analysis_chromatinization-2757"><span class="linenos">2757</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2758"><a href="#NucleiFinder.series_analysis_chromatinization-2758"><span class="linenos">2758</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2759"><a href="#NucleiFinder.series_analysis_chromatinization-2759"><span class="linenos">2759</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_nuclei_chromatinization_series</span><span class="p">(</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2760"><a href="#NucleiFinder.series_analysis_chromatinization-2760"><span class="linenos">2760</span></a>                    <span class="n">results_img_raw</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2761"><a href="#NucleiFinder.series_analysis_chromatinization-2761"><span class="linenos">2761</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2762"><a href="#NucleiFinder.series_analysis_chromatinization-2762"><span class="linenos">2762</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_chromatinization</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2763"><a href="#NucleiFinder.series_analysis_chromatinization-2763"><span class="linenos">2763</span></a>            <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2764"><a href="#NucleiFinder.series_analysis_chromatinization-2764"><span class="linenos">2764</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="n">ke</span><span class="si">}</span><span class="s2"> could not be processed.&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2765"><a href="#NucleiFinder.series_analysis_chromatinization-2765"><span class="linenos">2765</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2766"><a href="#NucleiFinder.series_analysis_chromatinization-2766"><span class="linenos">2766</span></a>            <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2767"><a href="#NucleiFinder.series_analysis_chromatinization-2767"><span class="linenos">2767</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2768"><a href="#NucleiFinder.series_analysis_chromatinization-2768"><span class="linenos">2768</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2769"><a href="#NucleiFinder.series_analysis_chromatinization-2769"><span class="linenos">2769</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2770"><a href="#NucleiFinder.series_analysis_chromatinization-2770"><span class="linenos">2770</span></a>                    <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2771"><a href="#NucleiFinder.series_analysis_chromatinization-2771"><span class="linenos">2771</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2772"><a href="#NucleiFinder.series_analysis_chromatinization-2772"><span class="linenos">2772</span></a>                    <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2773"><a href="#NucleiFinder.series_analysis_chromatinization-2773"><span class="linenos">2773</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2774"><a href="#NucleiFinder.series_analysis_chromatinization-2774"><span class="linenos">2774</span></a>                            <span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2775"><a href="#NucleiFinder.series_analysis_chromatinization-2775"><span class="linenos">2775</span></a>                            <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2776"><a href="#NucleiFinder.series_analysis_chromatinization-2776"><span class="linenos">2776</span></a>                        <span class="p">}</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2777"><a href="#NucleiFinder.series_analysis_chromatinization-2777"><span class="linenos">2777</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2778"><a href="#NucleiFinder.series_analysis_chromatinization-2778"><span class="linenos">2778</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2779"><a href="#NucleiFinder.series_analysis_chromatinization-2779"><span class="linenos">2779</span></a>                        <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">ke</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2780"><a href="#NucleiFinder.series_analysis_chromatinization-2780"><span class="linenos">2780</span></a>                        <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2781"><a href="#NucleiFinder.series_analysis_chromatinization-2781"><span class="linenos">2781</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2782"><a href="#NucleiFinder.series_analysis_chromatinization-2782"><span class="linenos">2782</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2783"><a href="#NucleiFinder.series_analysis_chromatinization-2783"><span class="linenos">2783</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">ke</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2784"><a href="#NucleiFinder.series_analysis_chromatinization-2784"><span class="linenos">2784</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2785"><a href="#NucleiFinder.series_analysis_chromatinization-2785"><span class="linenos">2785</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2786"><a href="#NucleiFinder.series_analysis_chromatinization-2786"><span class="linenos">2786</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.series_analysis_chromatinization-2787"><a href="#NucleiFinder.series_analysis_chromatinization-2787"><span class="linenos">2787</span></a>
</span><span id="NucleiFinder.series_analysis_chromatinization-2788"><a href="#NucleiFinder.series_analysis_chromatinization-2788"><span class="linenos">2788</span></a>        <span class="k">return</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>Performs full analysis on images provided via the <code><a href="#NucleiFinder.input_image">input_image()</a></code> method
using default or user-defined parameters.</p>

<p>This method runs nuclei detection, nuclei selection, and chromatinization
analysis in a single pipeline. Users can adjust parameters for each step
before running the analysis.</p>

<p>To show current parameters, use:
    - <code><a href="#NucleiFinder.current_parameters_nuclei">current_parameters_nuclei</a></code>
    - <code><a href="#NucleiFinder.current_parameters_img_adj">current_parameters_img_adj</a></code>
    - <code><a href="#NucleiFinder.current_parameters_chromatinization">current_parameters_chromatinization</a></code>
    - <code><a href="#NucleiFinder.current_parameters_img_adj_chro">current_parameters_img_adj_chro</a></code></p>

<p>To set new parameters, use:
    - <code><a href="#NucleiFinder.set_nms">set_nms()</a></code>
    - <code><a href="#NucleiFinder.set_prob">set_prob()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_gamma">set_adj_image_gamma()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_contrast">set_adj_image_contrast()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_brightness">set_adj_image_brightness()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_circularity">set_nuclei_circularity()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_size">set_nuclei_size()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_min_mean_intensity">set_nuclei_min_mean_intensity()</a></code>
    - <code><a href="#NucleiFinder.set_chromatinization_size">set_chromatinization_size()</a></code>
    - <code><a href="#NucleiFinder.set_chromatinization_ratio">set_chromatinization_ratio()</a></code>
    - <code><a href="#NucleiFinder.set_chromatinization_cut_point">set_chromatinization_cut_point()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_gamma">set_adj_chrom_gamma()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_contrast">set_adj_chrom_contrast()</a></code>
    - <code><a href="#NucleiFinder.set_adj_chrom_brightness">set_adj_chrom_brightness()</a></code></p>

<h2 id="parameters">Parameters</h2>

<p>path_to_images : str
    Path to the directory containing images for analysis.</p>

<p>file_extension : str, optional
    Extension of the image files. Default is 'tiff'.</p>

<p>selected_id : list, optional
    List of IDs that must be part of the image name to distinguish them
    from others. Default is an empty list, which means all images in
    the directory will be processed.</p>

<p>fille_name_part : str, optional
    Part of the file name to filter images. Default is an empty string.</p>

<p>selection_opt : bool, optional
    Whether to run <code><a href="#NucleiFinder.select_nuclei">select_nuclei()</a></code> with the defined parameters. Default is True.</p>

<p>include_img : bool, optional
    Whether to include the images in the result dictionary. Default is True.</p>

<p>test_series : int, optional
    Number of images to test the parameters and return results. Default is 0,
    which means all images in the directory will be processed.</p>

<h2 id="returns">Returns</h2>

<p>results_dict : dict
    Dictionary containing results for each image in the directory.
    Keys correspond to image file names.</p>

<h2 id="notes">Notes</h2>

<p>This method runs the complete nuclei and chromatinization analysis pipeline.</p>

<p>Parameters must be set appropriately before calling to ensure correct results.</p>
</div>


                            </div>
                            <div id="NucleiFinder.series_analysis_nuclei" class="classattr">
                                        <input id="NucleiFinder.series_analysis_nuclei-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">series_analysis_nuclei</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;tiff&#39;</span>,</span><span class="param">	<span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>,</span><span class="param">	<span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiFinder.series_analysis_nuclei-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiFinder.series_analysis_nuclei"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiFinder.series_analysis_nuclei-2790"><a href="#NucleiFinder.series_analysis_nuclei-2790"><span class="linenos">2790</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">series_analysis_nuclei</span><span class="p">(</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2791"><a href="#NucleiFinder.series_analysis_nuclei-2791"><span class="linenos">2791</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2792"><a href="#NucleiFinder.series_analysis_nuclei-2792"><span class="linenos">2792</span></a>        <span class="n">path_to_images</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2793"><a href="#NucleiFinder.series_analysis_nuclei-2793"><span class="linenos">2793</span></a>        <span class="n">file_extension</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;tiff&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2794"><a href="#NucleiFinder.series_analysis_nuclei-2794"><span class="linenos">2794</span></a>        <span class="n">selected_id</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[],</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2795"><a href="#NucleiFinder.series_analysis_nuclei-2795"><span class="linenos">2795</span></a>        <span class="n">fille_name_part</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2796"><a href="#NucleiFinder.series_analysis_nuclei-2796"><span class="linenos">2796</span></a>        <span class="n">selection_opt</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2797"><a href="#NucleiFinder.series_analysis_nuclei-2797"><span class="linenos">2797</span></a>        <span class="n">include_img</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2798"><a href="#NucleiFinder.series_analysis_nuclei-2798"><span class="linenos">2798</span></a>        <span class="n">test_series</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2799"><a href="#NucleiFinder.series_analysis_nuclei-2799"><span class="linenos">2799</span></a>    <span class="p">):</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2800"><a href="#NucleiFinder.series_analysis_nuclei-2800"><span class="linenos">2800</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2801"><a href="#NucleiFinder.series_analysis_nuclei-2801"><span class="linenos">2801</span></a><span class="sd">        Performs analysis on the image provided by the ``input_image()`` method</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2802"><a href="#NucleiFinder.series_analysis_nuclei-2802"><span class="linenos">2802</span></a><span class="sd">        using default or user-defined parameters.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2803"><a href="#NucleiFinder.series_analysis_nuclei-2803"><span class="linenos">2803</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2804"><a href="#NucleiFinder.series_analysis_nuclei-2804"><span class="linenos">2804</span></a><span class="sd">        This method runs nuclei detection and selection using the currently set</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2805"><a href="#NucleiFinder.series_analysis_nuclei-2805"><span class="linenos">2805</span></a><span class="sd">        parameters. Users can adjust image preprocessing and nuclei detection</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2806"><a href="#NucleiFinder.series_analysis_nuclei-2806"><span class="linenos">2806</span></a><span class="sd">        parameters before running the analysis.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2807"><a href="#NucleiFinder.series_analysis_nuclei-2807"><span class="linenos">2807</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2808"><a href="#NucleiFinder.series_analysis_nuclei-2808"><span class="linenos">2808</span></a><span class="sd">        To show current parameters, use:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2809"><a href="#NucleiFinder.series_analysis_nuclei-2809"><span class="linenos">2809</span></a><span class="sd">            - ``current_parameters_nuclei``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2810"><a href="#NucleiFinder.series_analysis_nuclei-2810"><span class="linenos">2810</span></a><span class="sd">            - ``current_parameters_img_adj``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2811"><a href="#NucleiFinder.series_analysis_nuclei-2811"><span class="linenos">2811</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2812"><a href="#NucleiFinder.series_analysis_nuclei-2812"><span class="linenos">2812</span></a><span class="sd">        To set new parameters, use:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2813"><a href="#NucleiFinder.series_analysis_nuclei-2813"><span class="linenos">2813</span></a><span class="sd">            - ``set_nms()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2814"><a href="#NucleiFinder.series_analysis_nuclei-2814"><span class="linenos">2814</span></a><span class="sd">            - ``set_prob()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2815"><a href="#NucleiFinder.series_analysis_nuclei-2815"><span class="linenos">2815</span></a><span class="sd">            - ``set_adj_image_gamma()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2816"><a href="#NucleiFinder.series_analysis_nuclei-2816"><span class="linenos">2816</span></a><span class="sd">            - ``set_adj_image_contrast()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2817"><a href="#NucleiFinder.series_analysis_nuclei-2817"><span class="linenos">2817</span></a><span class="sd">            - ``set_adj_image_brightness()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2818"><a href="#NucleiFinder.series_analysis_nuclei-2818"><span class="linenos">2818</span></a><span class="sd">            - ``set_nuclei_circularity()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2819"><a href="#NucleiFinder.series_analysis_nuclei-2819"><span class="linenos">2819</span></a><span class="sd">            - ``set_nuclei_size()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2820"><a href="#NucleiFinder.series_analysis_nuclei-2820"><span class="linenos">2820</span></a><span class="sd">            - ``set_nuclei_min_mean_intensity()``</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2821"><a href="#NucleiFinder.series_analysis_nuclei-2821"><span class="linenos">2821</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2822"><a href="#NucleiFinder.series_analysis_nuclei-2822"><span class="linenos">2822</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2823"><a href="#NucleiFinder.series_analysis_nuclei-2823"><span class="linenos">2823</span></a><span class="sd">        ----------</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2824"><a href="#NucleiFinder.series_analysis_nuclei-2824"><span class="linenos">2824</span></a><span class="sd">        path_to_images : str</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2825"><a href="#NucleiFinder.series_analysis_nuclei-2825"><span class="linenos">2825</span></a><span class="sd">            Path to the directory containing images for analysis.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2826"><a href="#NucleiFinder.series_analysis_nuclei-2826"><span class="linenos">2826</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2827"><a href="#NucleiFinder.series_analysis_nuclei-2827"><span class="linenos">2827</span></a><span class="sd">        file_extension : str, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2828"><a href="#NucleiFinder.series_analysis_nuclei-2828"><span class="linenos">2828</span></a><span class="sd">            Extension of the image files. Default is &#39;tiff&#39;.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2829"><a href="#NucleiFinder.series_analysis_nuclei-2829"><span class="linenos">2829</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2830"><a href="#NucleiFinder.series_analysis_nuclei-2830"><span class="linenos">2830</span></a><span class="sd">        selected_id : list, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2831"><a href="#NucleiFinder.series_analysis_nuclei-2831"><span class="linenos">2831</span></a><span class="sd">            List of IDs that must be part of the image name to distinguish them</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2832"><a href="#NucleiFinder.series_analysis_nuclei-2832"><span class="linenos">2832</span></a><span class="sd">            from others. Default is an empty list, which means all images in</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2833"><a href="#NucleiFinder.series_analysis_nuclei-2833"><span class="linenos">2833</span></a><span class="sd">            the directory will be processed.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2834"><a href="#NucleiFinder.series_analysis_nuclei-2834"><span class="linenos">2834</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2835"><a href="#NucleiFinder.series_analysis_nuclei-2835"><span class="linenos">2835</span></a><span class="sd">        fille_name_part : str, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2836"><a href="#NucleiFinder.series_analysis_nuclei-2836"><span class="linenos">2836</span></a><span class="sd">            Part of the file name to filter images. Default is an empty string.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2837"><a href="#NucleiFinder.series_analysis_nuclei-2837"><span class="linenos">2837</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2838"><a href="#NucleiFinder.series_analysis_nuclei-2838"><span class="linenos">2838</span></a><span class="sd">        selection_opt : bool, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2839"><a href="#NucleiFinder.series_analysis_nuclei-2839"><span class="linenos">2839</span></a><span class="sd">            Whether to run the ``select_nuclei()`` method with the defined parameters.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2840"><a href="#NucleiFinder.series_analysis_nuclei-2840"><span class="linenos">2840</span></a><span class="sd">            Default is True.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2841"><a href="#NucleiFinder.series_analysis_nuclei-2841"><span class="linenos">2841</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2842"><a href="#NucleiFinder.series_analysis_nuclei-2842"><span class="linenos">2842</span></a><span class="sd">        include_img : bool, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2843"><a href="#NucleiFinder.series_analysis_nuclei-2843"><span class="linenos">2843</span></a><span class="sd">            Whether to include the images in the result dictionary. Default is True.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2844"><a href="#NucleiFinder.series_analysis_nuclei-2844"><span class="linenos">2844</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2845"><a href="#NucleiFinder.series_analysis_nuclei-2845"><span class="linenos">2845</span></a><span class="sd">        test_series : int, optional</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2846"><a href="#NucleiFinder.series_analysis_nuclei-2846"><span class="linenos">2846</span></a><span class="sd">            Number of images to test the parameters and return results. Default is 0,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2847"><a href="#NucleiFinder.series_analysis_nuclei-2847"><span class="linenos">2847</span></a><span class="sd">            which means all images in the directory will be processed.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2848"><a href="#NucleiFinder.series_analysis_nuclei-2848"><span class="linenos">2848</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2849"><a href="#NucleiFinder.series_analysis_nuclei-2849"><span class="linenos">2849</span></a><span class="sd">        Returns</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2850"><a href="#NucleiFinder.series_analysis_nuclei-2850"><span class="linenos">2850</span></a><span class="sd">        -------</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2851"><a href="#NucleiFinder.series_analysis_nuclei-2851"><span class="linenos">2851</span></a><span class="sd">        results_dict : dict</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2852"><a href="#NucleiFinder.series_analysis_nuclei-2852"><span class="linenos">2852</span></a><span class="sd">            Dictionary containing results for each image in the directory.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2853"><a href="#NucleiFinder.series_analysis_nuclei-2853"><span class="linenos">2853</span></a><span class="sd">            Keys correspond to image file names.</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2854"><a href="#NucleiFinder.series_analysis_nuclei-2854"><span class="linenos">2854</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2855"><a href="#NucleiFinder.series_analysis_nuclei-2855"><span class="linenos">2855</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2856"><a href="#NucleiFinder.series_analysis_nuclei-2856"><span class="linenos">2856</span></a>        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2857"><a href="#NucleiFinder.series_analysis_nuclei-2857"><span class="linenos">2857</span></a>        <span class="n">results_img</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2858"><a href="#NucleiFinder.series_analysis_nuclei-2858"><span class="linenos">2858</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2859"><a href="#NucleiFinder.series_analysis_nuclei-2859"><span class="linenos">2859</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_to_images</span><span class="p">,</span> <span class="s2">&quot;*.&quot;</span> <span class="o">+</span> <span class="n">file_extension</span><span class="p">))</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2860"><a href="#NucleiFinder.series_analysis_nuclei-2860"><span class="linenos">2860</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2861"><a href="#NucleiFinder.series_analysis_nuclei-2861"><span class="linenos">2861</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fille_name_part</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2862"><a href="#NucleiFinder.series_analysis_nuclei-2862"><span class="linenos">2862</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">fille_name_part</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2863"><a href="#NucleiFinder.series_analysis_nuclei-2863"><span class="linenos">2863</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2864"><a href="#NucleiFinder.series_analysis_nuclei-2864"><span class="linenos">2864</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2865"><a href="#NucleiFinder.series_analysis_nuclei-2865"><span class="linenos">2865</span></a>            <span class="n">selected_id</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selected_id</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2866"><a href="#NucleiFinder.series_analysis_nuclei-2866"><span class="linenos">2866</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2867"><a href="#NucleiFinder.series_analysis_nuclei-2867"><span class="linenos">2867</span></a>                <span class="n">x</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2868"><a href="#NucleiFinder.series_analysis_nuclei-2868"><span class="linenos">2868</span></a>                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">files</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2869"><a href="#NucleiFinder.series_analysis_nuclei-2869"><span class="linenos">2869</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="ow">in</span> <span class="n">selected_id</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2870"><a href="#NucleiFinder.series_analysis_nuclei-2870"><span class="linenos">2870</span></a>            <span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2871"><a href="#NucleiFinder.series_analysis_nuclei-2871"><span class="linenos">2871</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2872"><a href="#NucleiFinder.series_analysis_nuclei-2872"><span class="linenos">2872</span></a>        <span class="k">if</span> <span class="n">test_series</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2873"><a href="#NucleiFinder.series_analysis_nuclei-2873"><span class="linenos">2873</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2874"><a href="#NucleiFinder.series_analysis_nuclei-2874"><span class="linenos">2874</span></a>            <span class="n">files</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">test_series</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2875"><a href="#NucleiFinder.series_analysis_nuclei-2875"><span class="linenos">2875</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2876"><a href="#NucleiFinder.series_analysis_nuclei-2876"><span class="linenos">2876</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2877"><a href="#NucleiFinder.series_analysis_nuclei-2877"><span class="linenos">2877</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2878"><a href="#NucleiFinder.series_analysis_nuclei-2878"><span class="linenos">2878</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2879"><a href="#NucleiFinder.series_analysis_nuclei-2879"><span class="linenos">2879</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">File analysis:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2880"><a href="#NucleiFinder.series_analysis_nuclei-2880"><span class="linenos">2880</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2881"><a href="#NucleiFinder.series_analysis_nuclei-2881"><span class="linenos">2881</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2882"><a href="#NucleiFinder.series_analysis_nuclei-2882"><span class="linenos">2882</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2883"><a href="#NucleiFinder.series_analysis_nuclei-2883"><span class="linenos">2883</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2884"><a href="#NucleiFinder.series_analysis_nuclei-2884"><span class="linenos">2884</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2885"><a href="#NucleiFinder.series_analysis_nuclei-2885"><span class="linenos">2885</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_image</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2886"><a href="#NucleiFinder.series_analysis_nuclei-2886"><span class="linenos">2886</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2887"><a href="#NucleiFinder.series_analysis_nuclei-2887"><span class="linenos">2887</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">input_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2888"><a href="#NucleiFinder.series_analysis_nuclei-2888"><span class="linenos">2888</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2889"><a href="#NucleiFinder.series_analysis_nuclei-2889"><span class="linenos">2889</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">find_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2890"><a href="#NucleiFinder.series_analysis_nuclei-2890"><span class="linenos">2890</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2891"><a href="#NucleiFinder.series_analysis_nuclei-2891"><span class="linenos">2891</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_results</span><span class="p">[</span><span class="s2">&quot;nuclei&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2892"><a href="#NucleiFinder.series_analysis_nuclei-2892"><span class="linenos">2892</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2893"><a href="#NucleiFinder.series_analysis_nuclei-2893"><span class="linenos">2893</span></a>                <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2894"><a href="#NucleiFinder.series_analysis_nuclei-2894"><span class="linenos">2894</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2895"><a href="#NucleiFinder.series_analysis_nuclei-2895"><span class="linenos">2895</span></a>                <span class="k">if</span> <span class="n">selection_opt</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2896"><a href="#NucleiFinder.series_analysis_nuclei-2896"><span class="linenos">2896</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">select_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2897"><a href="#NucleiFinder.series_analysis_nuclei-2897"><span class="linenos">2897</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei_selected</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2898"><a href="#NucleiFinder.series_analysis_nuclei-2898"><span class="linenos">2898</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2899"><a href="#NucleiFinder.series_analysis_nuclei-2899"><span class="linenos">2899</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2900"><a href="#NucleiFinder.series_analysis_nuclei-2900"><span class="linenos">2900</span></a>                    <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_results_nuclei</span><span class="p">()</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2901"><a href="#NucleiFinder.series_analysis_nuclei-2901"><span class="linenos">2901</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2902"><a href="#NucleiFinder.series_analysis_nuclei-2902"><span class="linenos">2902</span></a>                <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2903"><a href="#NucleiFinder.series_analysis_nuclei-2903"><span class="linenos">2903</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2904"><a href="#NucleiFinder.series_analysis_nuclei-2904"><span class="linenos">2904</span></a>                    <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2905"><a href="#NucleiFinder.series_analysis_nuclei-2905"><span class="linenos">2905</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2906"><a href="#NucleiFinder.series_analysis_nuclei-2906"><span class="linenos">2906</span></a>                        <span class="k">if</span> <span class="n">include_img</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2907"><a href="#NucleiFinder.series_analysis_nuclei-2907"><span class="linenos">2907</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2908"><a href="#NucleiFinder.series_analysis_nuclei-2908"><span class="linenos">2908</span></a>                            <span class="n">results_img</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2909"><a href="#NucleiFinder.series_analysis_nuclei-2909"><span class="linenos">2909</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2910"><a href="#NucleiFinder.series_analysis_nuclei-2910"><span class="linenos">2910</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2911"><a href="#NucleiFinder.series_analysis_nuclei-2911"><span class="linenos">2911</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2912"><a href="#NucleiFinder.series_analysis_nuclei-2912"><span class="linenos">2912</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2913"><a href="#NucleiFinder.series_analysis_nuclei-2913"><span class="linenos">2913</span></a>                            <span class="n">results_dict</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file</span><span class="p">))]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2914"><a href="#NucleiFinder.series_analysis_nuclei-2914"><span class="linenos">2914</span></a>                            <span class="k">del</span> <span class="n">tmp</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2915"><a href="#NucleiFinder.series_analysis_nuclei-2915"><span class="linenos">2915</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2916"><a href="#NucleiFinder.series_analysis_nuclei-2916"><span class="linenos">2916</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2917"><a href="#NucleiFinder.series_analysis_nuclei-2917"><span class="linenos">2917</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2918"><a href="#NucleiFinder.series_analysis_nuclei-2918"><span class="linenos">2918</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2919"><a href="#NucleiFinder.series_analysis_nuclei-2919"><span class="linenos">2919</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2920"><a href="#NucleiFinder.series_analysis_nuclei-2920"><span class="linenos">2920</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2921"><a href="#NucleiFinder.series_analysis_nuclei-2921"><span class="linenos">2921</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to obtain results for </span><span class="si">{</span><span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2922"><a href="#NucleiFinder.series_analysis_nuclei-2922"><span class="linenos">2922</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2923"><a href="#NucleiFinder.series_analysis_nuclei-2923"><span class="linenos">2923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">show_plots</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2924"><a href="#NucleiFinder.series_analysis_nuclei-2924"><span class="linenos">2924</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">series_im</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2925"><a href="#NucleiFinder.series_analysis_nuclei-2925"><span class="linenos">2925</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2926"><a href="#NucleiFinder.series_analysis_nuclei-2926"><span class="linenos">2926</span></a>        <span class="n">results_dict_tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repairing_nuclei</span><span class="p">(</span><span class="n">results_dict</span><span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2927"><a href="#NucleiFinder.series_analysis_nuclei-2927"><span class="linenos">2927</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2928"><a href="#NucleiFinder.series_analysis_nuclei-2928"><span class="linenos">2928</span></a>        <span class="k">if</span> <span class="n">include_img</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2929"><a href="#NucleiFinder.series_analysis_nuclei-2929"><span class="linenos">2929</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2930"><a href="#NucleiFinder.series_analysis_nuclei-2930"><span class="linenos">2930</span></a>            <span class="k">return</span> <span class="n">results_dict_tmp</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2931"><a href="#NucleiFinder.series_analysis_nuclei-2931"><span class="linenos">2931</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2932"><a href="#NucleiFinder.series_analysis_nuclei-2932"><span class="linenos">2932</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2933"><a href="#NucleiFinder.series_analysis_nuclei-2933"><span class="linenos">2933</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2934"><a href="#NucleiFinder.series_analysis_nuclei-2934"><span class="linenos">2934</span></a>            <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2935"><a href="#NucleiFinder.series_analysis_nuclei-2935"><span class="linenos">2935</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2936"><a href="#NucleiFinder.series_analysis_nuclei-2936"><span class="linenos">2936</span></a>            <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">results_dict_tmp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2937"><a href="#NucleiFinder.series_analysis_nuclei-2937"><span class="linenos">2937</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2938"><a href="#NucleiFinder.series_analysis_nuclei-2938"><span class="linenos">2938</span></a>                <span class="n">nuclei_mask</span> <span class="o">=</span> <span class="n">adjust_img_16bit</span><span class="p">(</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2939"><a href="#NucleiFinder.series_analysis_nuclei-2939"><span class="linenos">2939</span></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2940"><a href="#NucleiFinder.series_analysis_nuclei-2940"><span class="linenos">2940</span></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">create_mask</span><span class="p">(</span><span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">]),</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2941"><a href="#NucleiFinder.series_analysis_nuclei-2941"><span class="linenos">2941</span></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2942"><a href="#NucleiFinder.series_analysis_nuclei-2942"><span class="linenos">2942</span></a>                    <span class="p">),</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2943"><a href="#NucleiFinder.series_analysis_nuclei-2943"><span class="linenos">2943</span></a>                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2944"><a href="#NucleiFinder.series_analysis_nuclei-2944"><span class="linenos">2944</span></a>                <span class="p">)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2945"><a href="#NucleiFinder.series_analysis_nuclei-2945"><span class="linenos">2945</span></a>                <span class="n">concatenated_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">hconcat</span><span class="p">([</span><span class="n">results_img</span><span class="p">[</span><span class="n">ke</span><span class="p">],</span> <span class="n">nuclei_mask</span><span class="p">])</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2946"><a href="#NucleiFinder.series_analysis_nuclei-2946"><span class="linenos">2946</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2947"><a href="#NucleiFinder.series_analysis_nuclei-2947"><span class="linenos">2947</span></a>                <span class="n">cred</span> <span class="o">=</span> <span class="n">results_dict_tmp</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2948"><a href="#NucleiFinder.series_analysis_nuclei-2948"><span class="linenos">2948</span></a>                <span class="c1"># cred.pop(&#39;coords&#39;)</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2949"><a href="#NucleiFinder.series_analysis_nuclei-2949"><span class="linenos">2949</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2950"><a href="#NucleiFinder.series_analysis_nuclei-2950"><span class="linenos">2950</span></a>                <span class="n">results_dict</span><span class="p">[</span><span class="n">ke</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stats&quot;</span><span class="p">:</span> <span class="n">cred</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">:</span> <span class="n">concatenated_image</span><span class="p">}</span>
</span><span id="NucleiFinder.series_analysis_nuclei-2951"><a href="#NucleiFinder.series_analysis_nuclei-2951"><span class="linenos">2951</span></a>
</span><span id="NucleiFinder.series_analysis_nuclei-2952"><a href="#NucleiFinder.series_analysis_nuclei-2952"><span class="linenos">2952</span></a>            <span class="k">return</span> <span class="n">results_dict</span>
</span></pre></div>


            <div class="docstring"><p>Performs analysis on the image provided by the <code><a href="#NucleiFinder.input_image">input_image()</a></code> method
using default or user-defined parameters.</p>

<p>This method runs nuclei detection and selection using the currently set
parameters. Users can adjust image preprocessing and nuclei detection
parameters before running the analysis.</p>

<p>To show current parameters, use:
    - <code><a href="#NucleiFinder.current_parameters_nuclei">current_parameters_nuclei</a></code>
    - <code><a href="#NucleiFinder.current_parameters_img_adj">current_parameters_img_adj</a></code></p>

<p>To set new parameters, use:
    - <code><a href="#NucleiFinder.set_nms">set_nms()</a></code>
    - <code><a href="#NucleiFinder.set_prob">set_prob()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_gamma">set_adj_image_gamma()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_contrast">set_adj_image_contrast()</a></code>
    - <code><a href="#NucleiFinder.set_adj_image_brightness">set_adj_image_brightness()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_circularity">set_nuclei_circularity()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_size">set_nuclei_size()</a></code>
    - <code><a href="#NucleiFinder.set_nuclei_min_mean_intensity">set_nuclei_min_mean_intensity()</a></code></p>

<h2 id="parameters">Parameters</h2>

<p>path_to_images : str
    Path to the directory containing images for analysis.</p>

<p>file_extension : str, optional
    Extension of the image files. Default is 'tiff'.</p>

<p>selected_id : list, optional
    List of IDs that must be part of the image name to distinguish them
    from others. Default is an empty list, which means all images in
    the directory will be processed.</p>

<p>fille_name_part : str, optional
    Part of the file name to filter images. Default is an empty string.</p>

<p>selection_opt : bool, optional
    Whether to run the <code><a href="#NucleiFinder.select_nuclei">select_nuclei()</a></code> method with the defined parameters.
    Default is True.</p>

<p>include_img : bool, optional
    Whether to include the images in the result dictionary. Default is True.</p>

<p>test_series : int, optional
    Number of images to test the parameters and return results. Default is 0,
    which means all images in the directory will be processed.</p>

<h2 id="returns">Returns</h2>

<p>results_dict : dict
    Dictionary containing results for each image in the directory.
    Keys correspond to image file names.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="utils.html#ImageTools">jimg_ncd.utils.ImageTools</a></dt>
                                <dd id="NucleiFinder.get_screan" class="function"><a href="utils.html#ImageTools.get_screan">get_screan</a></dd>
                <dd id="NucleiFinder.resize_to_screen_img" class="function"><a href="utils.html#ImageTools.resize_to_screen_img">resize_to_screen_img</a></dd>
                <dd id="NucleiFinder.load_JIMG_project" class="function"><a href="utils.html#ImageTools.load_JIMG_project">load_JIMG_project</a></dd>
                <dd id="NucleiFinder.ajd_mask_size" class="function"><a href="utils.html#ImageTools.ajd_mask_size">ajd_mask_size</a></dd>
                <dd id="NucleiFinder.load_image" class="function"><a href="utils.html#ImageTools.load_image">load_image</a></dd>
                <dd id="NucleiFinder.load_3D_tiff" class="function"><a href="utils.html#ImageTools.load_3D_tiff">load_3D_tiff</a></dd>
                <dd id="NucleiFinder.load_mask" class="function"><a href="utils.html#ImageTools.load_mask">load_mask</a></dd>
                <dd id="NucleiFinder.save" class="function"><a href="utils.html#ImageTools.save">save</a></dd>
                <dd id="NucleiFinder.drop_dict" class="function"><a href="utils.html#ImageTools.drop_dict">drop_dict</a></dd>
                <dd id="NucleiFinder.create_mask" class="function"><a href="utils.html#ImageTools.create_mask">create_mask</a></dd>
                <dd id="NucleiFinder.min_max_histograme" class="function"><a href="utils.html#ImageTools.min_max_histograme">min_max_histograme</a></dd>

            </div>
            <div><dt><a href="#RepTools">RepTools</a></dt>
                                <dd id="NucleiFinder.extract_dict_by_indices" class="function"><a href="#RepTools.extract_dict_by_indices">extract_dict_by_indices</a></dd>
                <dd id="NucleiFinder.drop_outlires" class="function"><a href="#RepTools.drop_outlires">drop_outlires</a></dd>
                <dd id="NucleiFinder.nn" class="function"><a href="#RepTools.nn">nn</a></dd>
                <dd id="NucleiFinder.compute_axes_length" class="function"><a href="#RepTools.compute_axes_length">compute_axes_length</a></dd>
                <dd id="NucleiFinder.compute_eccentricity" class="function"><a href="#RepTools.compute_eccentricity">compute_eccentricity</a></dd>
                <dd id="NucleiFinder.compute_feret_diameter" class="function"><a href="#RepTools.compute_feret_diameter">compute_feret_diameter</a></dd>
                <dd id="NucleiFinder.compute_perimeter" class="function"><a href="#RepTools.compute_perimeter">compute_perimeter</a></dd>
                <dd id="NucleiFinder.compute_circularity" class="function"><a href="#RepTools.compute_circularity">compute_circularity</a></dd>
                <dd id="NucleiFinder.repairing_nuclei" class="function"><a href="#RepTools.repairing_nuclei">repairing_nuclei</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="NucleiDataManagement">
                            <input id="NucleiDataManagement-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NucleiDataManagement</span>:

                <label class="view-source-button" for="NucleiDataManagement-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement-2955"><a href="#NucleiDataManagement-2955"><span class="linenos">2955</span></a><span class="k">class</span><span class="w"> </span><span class="nc">NucleiDataManagement</span><span class="p">:</span>
</span><span id="NucleiDataManagement-2956"><a href="#NucleiDataManagement-2956"><span class="linenos">2956</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-2957"><a href="#NucleiDataManagement-2957"><span class="linenos">2957</span></a><span class="sd">    Manages nuclei analysis data obtained from the `NucleiFinder` class,</span>
</span><span id="NucleiDataManagement-2958"><a href="#NucleiDataManagement-2958"><span class="linenos">2958</span></a><span class="sd">    including nuclei properties and optionally Image Stream (IS) data.</span>
</span><span id="NucleiDataManagement-2959"><a href="#NucleiDataManagement-2959"><span class="linenos">2959</span></a>
</span><span id="NucleiDataManagement-2960"><a href="#NucleiDataManagement-2960"><span class="linenos">2960</span></a><span class="sd">    This class allows loading nuclei data from JSON files or directly from</span>
</span><span id="NucleiDataManagement-2961"><a href="#NucleiDataManagement-2961"><span class="linenos">2961</span></a><span class="sd">    `NucleiFinder` analysis results, converting them to pandas DataFrames,</span>
</span><span id="NucleiDataManagement-2962"><a href="#NucleiDataManagement-2962"><span class="linenos">2962</span></a><span class="sd">    adding IS data, concatenating results from multiple experiments, and</span>
</span><span id="NucleiDataManagement-2963"><a href="#NucleiDataManagement-2963"><span class="linenos">2963</span></a><span class="sd">    saving results in JSON or CSV format. It also provides helper methods</span>
</span><span id="NucleiDataManagement-2964"><a href="#NucleiDataManagement-2964"><span class="linenos">2964</span></a><span class="sd">    for merging, filtering, and retrieving data.</span>
</span><span id="NucleiDataManagement-2965"><a href="#NucleiDataManagement-2965"><span class="linenos">2965</span></a>
</span><span id="NucleiDataManagement-2966"><a href="#NucleiDataManagement-2966"><span class="linenos">2966</span></a><span class="sd">    Attributes</span>
</span><span id="NucleiDataManagement-2967"><a href="#NucleiDataManagement-2967"><span class="linenos">2967</span></a><span class="sd">    ----------</span>
</span><span id="NucleiDataManagement-2968"><a href="#NucleiDataManagement-2968"><span class="linenos">2968</span></a><span class="sd">    nuceli_data : dict</span>
</span><span id="NucleiDataManagement-2969"><a href="#NucleiDataManagement-2969"><span class="linenos">2969</span></a><span class="sd">        Dictionary storing nuclei properties for each image or experiment.</span>
</span><span id="NucleiDataManagement-2970"><a href="#NucleiDataManagement-2970"><span class="linenos">2970</span></a>
</span><span id="NucleiDataManagement-2971"><a href="#NucleiDataManagement-2971"><span class="linenos">2971</span></a><span class="sd">    experiment_name : str</span>
</span><span id="NucleiDataManagement-2972"><a href="#NucleiDataManagement-2972"><span class="linenos">2972</span></a><span class="sd">        Name of the experiment.</span>
</span><span id="NucleiDataManagement-2973"><a href="#NucleiDataManagement-2973"><span class="linenos">2973</span></a>
</span><span id="NucleiDataManagement-2974"><a href="#NucleiDataManagement-2974"><span class="linenos">2974</span></a><span class="sd">    nuceli_data_df : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement-2975"><a href="#NucleiDataManagement-2975"><span class="linenos">2975</span></a><span class="sd">        DataFrame representation of nuclei properties.</span>
</span><span id="NucleiDataManagement-2976"><a href="#NucleiDataManagement-2976"><span class="linenos">2976</span></a>
</span><span id="NucleiDataManagement-2977"><a href="#NucleiDataManagement-2977"><span class="linenos">2977</span></a><span class="sd">    nuclei_IS_data : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement-2978"><a href="#NucleiDataManagement-2978"><span class="linenos">2978</span></a><span class="sd">        DataFrame of nuclei data merged with IS data.</span>
</span><span id="NucleiDataManagement-2979"><a href="#NucleiDataManagement-2979"><span class="linenos">2979</span></a>
</span><span id="NucleiDataManagement-2980"><a href="#NucleiDataManagement-2980"><span class="linenos">2980</span></a><span class="sd">    concat_data : list or None</span>
</span><span id="NucleiDataManagement-2981"><a href="#NucleiDataManagement-2981"><span class="linenos">2981</span></a><span class="sd">        List of other `NucleiDataManagement` objects added for combined analysis.</span>
</span><span id="NucleiDataManagement-2982"><a href="#NucleiDataManagement-2982"><span class="linenos">2982</span></a>
</span><span id="NucleiDataManagement-2983"><a href="#NucleiDataManagement-2983"><span class="linenos">2983</span></a><span class="sd">    Methods</span>
</span><span id="NucleiDataManagement-2984"><a href="#NucleiDataManagement-2984"><span class="linenos">2984</span></a><span class="sd">    -------</span>
</span><span id="NucleiDataManagement-2985"><a href="#NucleiDataManagement-2985"><span class="linenos">2985</span></a><span class="sd">    load_nuc_dict(path)</span>
</span><span id="NucleiDataManagement-2986"><a href="#NucleiDataManagement-2986"><span class="linenos">2986</span></a><span class="sd">        Load nuclei data from a JSON dictionary file (*.nuc) and initialize the object.</span>
</span><span id="NucleiDataManagement-2987"><a href="#NucleiDataManagement-2987"><span class="linenos">2987</span></a><span class="sd">        _convert_to_df()</span>
</span><span id="NucleiDataManagement-2988"><a href="#NucleiDataManagement-2988"><span class="linenos">2988</span></a><span class="sd">        Convert nuclei dictionary data to a pandas DataFrame.</span>
</span><span id="NucleiDataManagement-2989"><a href="#NucleiDataManagement-2989"><span class="linenos">2989</span></a>
</span><span id="NucleiDataManagement-2990"><a href="#NucleiDataManagement-2990"><span class="linenos">2990</span></a><span class="sd">    add_IS_data(IS_data, IS_features)</span>
</span><span id="NucleiDataManagement-2991"><a href="#NucleiDataManagement-2991"><span class="linenos">2991</span></a><span class="sd">        Merge Image Stream (IS) data with nuclei data.</span>
</span><span id="NucleiDataManagement-2992"><a href="#NucleiDataManagement-2992"><span class="linenos">2992</span></a>
</span><span id="NucleiDataManagement-2993"><a href="#NucleiDataManagement-2993"><span class="linenos">2993</span></a><span class="sd">    get_data()</span>
</span><span id="NucleiDataManagement-2994"><a href="#NucleiDataManagement-2994"><span class="linenos">2994</span></a><span class="sd">        Retrieve the nuclei data as a pandas DataFrame.</span>
</span><span id="NucleiDataManagement-2995"><a href="#NucleiDataManagement-2995"><span class="linenos">2995</span></a>
</span><span id="NucleiDataManagement-2996"><a href="#NucleiDataManagement-2996"><span class="linenos">2996</span></a><span class="sd">    get_data_with_IS()</span>
</span><span id="NucleiDataManagement-2997"><a href="#NucleiDataManagement-2997"><span class="linenos">2997</span></a><span class="sd">        Retrieve the nuclei data merged with IS data.</span>
</span><span id="NucleiDataManagement-2998"><a href="#NucleiDataManagement-2998"><span class="linenos">2998</span></a>
</span><span id="NucleiDataManagement-2999"><a href="#NucleiDataManagement-2999"><span class="linenos">2999</span></a><span class="sd">    save_nuc_project(path)</span>
</span><span id="NucleiDataManagement-3000"><a href="#NucleiDataManagement-3000"><span class="linenos">3000</span></a><span class="sd">        Save nuclei data as a JSON file with *.nuc extension.</span>
</span><span id="NucleiDataManagement-3001"><a href="#NucleiDataManagement-3001"><span class="linenos">3001</span></a>
</span><span id="NucleiDataManagement-3002"><a href="#NucleiDataManagement-3002"><span class="linenos">3002</span></a><span class="sd">    save_results_df(path)</span>
</span><span id="NucleiDataManagement-3003"><a href="#NucleiDataManagement-3003"><span class="linenos">3003</span></a><span class="sd">        Save nuclei data as a CSV file.</span>
</span><span id="NucleiDataManagement-3004"><a href="#NucleiDataManagement-3004"><span class="linenos">3004</span></a>
</span><span id="NucleiDataManagement-3005"><a href="#NucleiDataManagement-3005"><span class="linenos">3005</span></a><span class="sd">    save_results_df_with_IS(path)</span>
</span><span id="NucleiDataManagement-3006"><a href="#NucleiDataManagement-3006"><span class="linenos">3006</span></a><span class="sd">        Save nuclei data merged with IS data as a CSV file.</span>
</span><span id="NucleiDataManagement-3007"><a href="#NucleiDataManagement-3007"><span class="linenos">3007</span></a>
</span><span id="NucleiDataManagement-3008"><a href="#NucleiDataManagement-3008"><span class="linenos">3008</span></a><span class="sd">    add_experiment(data_list)</span>
</span><span id="NucleiDataManagement-3009"><a href="#NucleiDataManagement-3009"><span class="linenos">3009</span></a><span class="sd">        Add other `NucleiDataManagement` objects for concatenated analysis.</span>
</span><span id="NucleiDataManagement-3010"><a href="#NucleiDataManagement-3010"><span class="linenos">3010</span></a>
</span><span id="NucleiDataManagement-3011"><a href="#NucleiDataManagement-3011"><span class="linenos">3011</span></a><span class="sd">    get_mutual_experiments_data(inc_is)</span>
</span><span id="NucleiDataManagement-3012"><a href="#NucleiDataManagement-3012"><span class="linenos">3012</span></a><span class="sd">        Retrieve concatenated nuclei data from multiple experiments.</span>
</span><span id="NucleiDataManagement-3013"><a href="#NucleiDataManagement-3013"><span class="linenos">3013</span></a>
</span><span id="NucleiDataManagement-3014"><a href="#NucleiDataManagement-3014"><span class="linenos">3014</span></a><span class="sd">    save_mutual_experiments(path, inc_is)</span>
</span><span id="NucleiDataManagement-3015"><a href="#NucleiDataManagement-3015"><span class="linenos">3015</span></a><span class="sd">        Save concatenated data from multiple experiments as a CSV file.</span>
</span><span id="NucleiDataManagement-3016"><a href="#NucleiDataManagement-3016"><span class="linenos">3016</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3017"><a href="#NucleiDataManagement-3017"><span class="linenos">3017</span></a>
</span><span id="NucleiDataManagement-3018"><a href="#NucleiDataManagement-3018"><span class="linenos">3018</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3019"><a href="#NucleiDataManagement-3019"><span class="linenos">3019</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3020"><a href="#NucleiDataManagement-3020"><span class="linenos">3020</span></a><span class="sd">        Initialize a NucleiDataManagement object with nuclei data and experiment name.</span>
</span><span id="NucleiDataManagement-3021"><a href="#NucleiDataManagement-3021"><span class="linenos">3021</span></a>
</span><span id="NucleiDataManagement-3022"><a href="#NucleiDataManagement-3022"><span class="linenos">3022</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3023"><a href="#NucleiDataManagement-3023"><span class="linenos">3023</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3024"><a href="#NucleiDataManagement-3024"><span class="linenos">3024</span></a><span class="sd">        nuclei_data : dict</span>
</span><span id="NucleiDataManagement-3025"><a href="#NucleiDataManagement-3025"><span class="linenos">3025</span></a><span class="sd">            Dictionary containing nuclei properties for each image or experiment.</span>
</span><span id="NucleiDataManagement-3026"><a href="#NucleiDataManagement-3026"><span class="linenos">3026</span></a><span class="sd">            If the dictionary entries have keys &#39;stats&#39; and &#39;img&#39;, only &#39;stats&#39; are stored.</span>
</span><span id="NucleiDataManagement-3027"><a href="#NucleiDataManagement-3027"><span class="linenos">3027</span></a>
</span><span id="NucleiDataManagement-3028"><a href="#NucleiDataManagement-3028"><span class="linenos">3028</span></a><span class="sd">        experiment_name : str</span>
</span><span id="NucleiDataManagement-3029"><a href="#NucleiDataManagement-3029"><span class="linenos">3029</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="NucleiDataManagement-3030"><a href="#NucleiDataManagement-3030"><span class="linenos">3030</span></a>
</span><span id="NucleiDataManagement-3031"><a href="#NucleiDataManagement-3031"><span class="linenos">3031</span></a><span class="sd">        Attributes</span>
</span><span id="NucleiDataManagement-3032"><a href="#NucleiDataManagement-3032"><span class="linenos">3032</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3033"><a href="#NucleiDataManagement-3033"><span class="linenos">3033</span></a><span class="sd">        nuceli_data : dict</span>
</span><span id="NucleiDataManagement-3034"><a href="#NucleiDataManagement-3034"><span class="linenos">3034</span></a><span class="sd">            Dictionary storing nuclei properties for each image or experiment.</span>
</span><span id="NucleiDataManagement-3035"><a href="#NucleiDataManagement-3035"><span class="linenos">3035</span></a>
</span><span id="NucleiDataManagement-3036"><a href="#NucleiDataManagement-3036"><span class="linenos">3036</span></a><span class="sd">        experiment_name : str</span>
</span><span id="NucleiDataManagement-3037"><a href="#NucleiDataManagement-3037"><span class="linenos">3037</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="NucleiDataManagement-3038"><a href="#NucleiDataManagement-3038"><span class="linenos">3038</span></a>
</span><span id="NucleiDataManagement-3039"><a href="#NucleiDataManagement-3039"><span class="linenos">3039</span></a><span class="sd">        nuceli_data_df : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement-3040"><a href="#NucleiDataManagement-3040"><span class="linenos">3040</span></a><span class="sd">            DataFrame representation of nuclei properties (initialized as None).</span>
</span><span id="NucleiDataManagement-3041"><a href="#NucleiDataManagement-3041"><span class="linenos">3041</span></a>
</span><span id="NucleiDataManagement-3042"><a href="#NucleiDataManagement-3042"><span class="linenos">3042</span></a><span class="sd">        nuclei_IS_data : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement-3043"><a href="#NucleiDataManagement-3043"><span class="linenos">3043</span></a><span class="sd">            DataFrame of nuclei data merged with Image Stream (IS) data (initialized as None).</span>
</span><span id="NucleiDataManagement-3044"><a href="#NucleiDataManagement-3044"><span class="linenos">3044</span></a>
</span><span id="NucleiDataManagement-3045"><a href="#NucleiDataManagement-3045"><span class="linenos">3045</span></a><span class="sd">        concat_data : list or None</span>
</span><span id="NucleiDataManagement-3046"><a href="#NucleiDataManagement-3046"><span class="linenos">3046</span></a><span class="sd">            List of other `NucleiDataManagement` objects added for combined analysis (initialized as None).</span>
</span><span id="NucleiDataManagement-3047"><a href="#NucleiDataManagement-3047"><span class="linenos">3047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3048"><a href="#NucleiDataManagement-3048"><span class="linenos">3048</span></a>
</span><span id="NucleiDataManagement-3049"><a href="#NucleiDataManagement-3049"><span class="linenos">3049</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3050"><a href="#NucleiDataManagement-3050"><span class="linenos">3050</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3051"><a href="#NucleiDataManagement-3051"><span class="linenos">3051</span></a>        <span class="p">):</span>
</span><span id="NucleiDataManagement-3052"><a href="#NucleiDataManagement-3052"><span class="linenos">3052</span></a>
</span><span id="NucleiDataManagement-3053"><a href="#NucleiDataManagement-3053"><span class="linenos">3053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiDataManagement-3054"><a href="#NucleiDataManagement-3054"><span class="linenos">3054</span></a>
</span><span id="NucleiDataManagement-3055"><a href="#NucleiDataManagement-3055"><span class="linenos">3055</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement-3056"><a href="#NucleiDataManagement-3056"><span class="linenos">3056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3057"><a href="#NucleiDataManagement-3057"><span class="linenos">3057</span></a>
</span><span id="NucleiDataManagement-3058"><a href="#NucleiDataManagement-3058"><span class="linenos">3058</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement-3059"><a href="#NucleiDataManagement-3059"><span class="linenos">3059</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement-3060"><a href="#NucleiDataManagement-3060"><span class="linenos">3060</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3061"><a href="#NucleiDataManagement-3061"><span class="linenos">3061</span></a>
</span><span id="NucleiDataManagement-3062"><a href="#NucleiDataManagement-3062"><span class="linenos">3062</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3063"><a href="#NucleiDataManagement-3063"><span class="linenos">3063</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="n">nuclei_data</span>
</span><span id="NucleiDataManagement-3064"><a href="#NucleiDataManagement-3064"><span class="linenos">3064</span></a>
</span><span id="NucleiDataManagement-3065"><a href="#NucleiDataManagement-3065"><span class="linenos">3065</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement-3066"><a href="#NucleiDataManagement-3066"><span class="linenos">3066</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement-3067"><a href="#NucleiDataManagement-3067"><span class="linenos">3067</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3068"><a href="#NucleiDataManagement-3068"><span class="linenos">3068</span></a>
</span><span id="NucleiDataManagement-3069"><a href="#NucleiDataManagement-3069"><span class="linenos">3069</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="NucleiDataManagement-3070"><a href="#NucleiDataManagement-3070"><span class="linenos">3070</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the experiment.&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3071"><a href="#NucleiDataManagement-3071"><span class="linenos">3071</span></a>
</span><span id="NucleiDataManagement-3072"><a href="#NucleiDataManagement-3072"><span class="linenos">3072</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement-3073"><a href="#NucleiDataManagement-3073"><span class="linenos">3073</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame representation of nuclei features&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3074"><a href="#NucleiDataManagement-3074"><span class="linenos">3074</span></a>
</span><span id="NucleiDataManagement-3075"><a href="#NucleiDataManagement-3075"><span class="linenos">3075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement-3076"><a href="#NucleiDataManagement-3076"><span class="linenos">3076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame of data from Image Stream (IS).&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3077"><a href="#NucleiDataManagement-3077"><span class="linenos">3077</span></a>
</span><span id="NucleiDataManagement-3078"><a href="#NucleiDataManagement-3078"><span class="linenos">3078</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement-3079"><a href="#NucleiDataManagement-3079"><span class="linenos">3079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotored list of other `NucleiDataManagement` objects.&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3080"><a href="#NucleiDataManagement-3080"><span class="linenos">3080</span></a>
</span><span id="NucleiDataManagement-3081"><a href="#NucleiDataManagement-3081"><span class="linenos">3081</span></a>    <span class="nd">@classmethod</span>
</span><span id="NucleiDataManagement-3082"><a href="#NucleiDataManagement-3082"><span class="linenos">3082</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_nuc_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3083"><a href="#NucleiDataManagement-3083"><span class="linenos">3083</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3084"><a href="#NucleiDataManagement-3084"><span class="linenos">3084</span></a><span class="sd">        Initialize a NucleiDataManagement object from a JSON dictionary file.</span>
</span><span id="NucleiDataManagement-3085"><a href="#NucleiDataManagement-3085"><span class="linenos">3085</span></a>
</span><span id="NucleiDataManagement-3086"><a href="#NucleiDataManagement-3086"><span class="linenos">3086</span></a><span class="sd">        The loaded data must be previously saved using the ``save_nuc_project()`` method.</span>
</span><span id="NucleiDataManagement-3087"><a href="#NucleiDataManagement-3087"><span class="linenos">3087</span></a>
</span><span id="NucleiDataManagement-3088"><a href="#NucleiDataManagement-3088"><span class="linenos">3088</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3089"><a href="#NucleiDataManagement-3089"><span class="linenos">3089</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3090"><a href="#NucleiDataManagement-3090"><span class="linenos">3090</span></a><span class="sd">        path : str</span>
</span><span id="NucleiDataManagement-3091"><a href="#NucleiDataManagement-3091"><span class="linenos">3091</span></a><span class="sd">            Path to the *.nuc JSON file containing nuclei data.</span>
</span><span id="NucleiDataManagement-3092"><a href="#NucleiDataManagement-3092"><span class="linenos">3092</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3093"><a href="#NucleiDataManagement-3093"><span class="linenos">3093</span></a>
</span><span id="NucleiDataManagement-3094"><a href="#NucleiDataManagement-3094"><span class="linenos">3094</span></a>        <span class="k">if</span> <span class="s2">&quot;.nuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3095"><a href="#NucleiDataManagement-3095"><span class="linenos">3095</span></a>
</span><span id="NucleiDataManagement-3096"><a href="#NucleiDataManagement-3096"><span class="linenos">3096</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3097"><a href="#NucleiDataManagement-3097"><span class="linenos">3097</span></a>
</span><span id="NucleiDataManagement-3098"><a href="#NucleiDataManagement-3098"><span class="linenos">3098</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3099"><a href="#NucleiDataManagement-3099"><span class="linenos">3099</span></a>                    <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3100"><a href="#NucleiDataManagement-3100"><span class="linenos">3100</span></a>
</span><span id="NucleiDataManagement-3101"><a href="#NucleiDataManagement-3101"><span class="linenos">3101</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="NucleiDataManagement-3102"><a href="#NucleiDataManagement-3102"><span class="linenos">3102</span></a>
</span><span id="NucleiDataManagement-3103"><a href="#NucleiDataManagement-3103"><span class="linenos">3103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3104"><a href="#NucleiDataManagement-3104"><span class="linenos">3104</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3105"><a href="#NucleiDataManagement-3105"><span class="linenos">3105</span></a>
</span><span id="NucleiDataManagement-3106"><a href="#NucleiDataManagement-3106"><span class="linenos">3106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3107"><a href="#NucleiDataManagement-3107"><span class="linenos">3107</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3108"><a href="#NucleiDataManagement-3108"><span class="linenos">3108</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .nuc extension!&quot;</span>
</span><span id="NucleiDataManagement-3109"><a href="#NucleiDataManagement-3109"><span class="linenos">3109</span></a>            <span class="p">)</span>
</span><span id="NucleiDataManagement-3110"><a href="#NucleiDataManagement-3110"><span class="linenos">3110</span></a>
</span><span id="NucleiDataManagement-3111"><a href="#NucleiDataManagement-3111"><span class="linenos">3111</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_to_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3112"><a href="#NucleiDataManagement-3112"><span class="linenos">3112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3113"><a href="#NucleiDataManagement-3113"><span class="linenos">3113</span></a><span class="sd">        Helper method that converts the internal nuclei dictionary into a pandas DataFrame.</span>
</span><span id="NucleiDataManagement-3114"><a href="#NucleiDataManagement-3114"><span class="linenos">3114</span></a>
</span><span id="NucleiDataManagement-3115"><a href="#NucleiDataManagement-3115"><span class="linenos">3115</span></a><span class="sd">        This method iterates over the nuclei data stored in `self.nuceli_data`,</span>
</span><span id="NucleiDataManagement-3116"><a href="#NucleiDataManagement-3116"><span class="linenos">3116</span></a><span class="sd">        flattens the information for each nucleus, computes aggregate statistics</span>
</span><span id="NucleiDataManagement-3117"><a href="#NucleiDataManagement-3117"><span class="linenos">3117</span></a><span class="sd">        for associated spots if present, and stores the resulting DataFrame in</span>
</span><span id="NucleiDataManagement-3118"><a href="#NucleiDataManagement-3118"><span class="linenos">3118</span></a><span class="sd">        `self.nuceli_data_df`.</span>
</span><span id="NucleiDataManagement-3119"><a href="#NucleiDataManagement-3119"><span class="linenos">3119</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3120"><a href="#NucleiDataManagement-3120"><span class="linenos">3120</span></a>
</span><span id="NucleiDataManagement-3121"><a href="#NucleiDataManagement-3121"><span class="linenos">3121</span></a>        <span class="n">nuclei_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span>
</span><span id="NucleiDataManagement-3122"><a href="#NucleiDataManagement-3122"><span class="linenos">3122</span></a>
</span><span id="NucleiDataManagement-3123"><a href="#NucleiDataManagement-3123"><span class="linenos">3123</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiDataManagement-3124"><a href="#NucleiDataManagement-3124"><span class="linenos">3124</span></a>
</span><span id="NucleiDataManagement-3125"><a href="#NucleiDataManagement-3125"><span class="linenos">3125</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
</span><span id="NucleiDataManagement-3126"><a href="#NucleiDataManagement-3126"><span class="linenos">3126</span></a>            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">]):</span>
</span><span id="NucleiDataManagement-3127"><a href="#NucleiDataManagement-3127"><span class="linenos">3127</span></a>                <span class="n">row</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="NucleiDataManagement-3128"><a href="#NucleiDataManagement-3128"><span class="linenos">3128</span></a>                    <span class="s2">&quot;id_name&quot;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_.*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span>
</span><span id="NucleiDataManagement-3129"><a href="#NucleiDataManagement-3129"><span class="linenos">3129</span></a>                    <span class="s2">&quot;nuclei_area&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3130"><a href="#NucleiDataManagement-3130"><span class="linenos">3130</span></a>                    <span class="s2">&quot;nuclei_area_bbox&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3131"><a href="#NucleiDataManagement-3131"><span class="linenos">3131</span></a>                    <span class="s2">&quot;nuclei_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="NucleiDataManagement-3132"><a href="#NucleiDataManagement-3132"><span class="linenos">3132</span></a>                        <span class="s2">&quot;equivalent_diameter_area&quot;</span>
</span><span id="NucleiDataManagement-3133"><a href="#NucleiDataManagement-3133"><span class="linenos">3133</span></a>                    <span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3134"><a href="#NucleiDataManagement-3134"><span class="linenos">3134</span></a>                    <span class="s2">&quot;nuclei_feret_diameter_max&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;feret_diameter_max&quot;</span><span class="p">][</span>
</span><span id="NucleiDataManagement-3135"><a href="#NucleiDataManagement-3135"><span class="linenos">3135</span></a>                        <span class="n">n</span>
</span><span id="NucleiDataManagement-3136"><a href="#NucleiDataManagement-3136"><span class="linenos">3136</span></a>                    <span class="p">],</span>
</span><span id="NucleiDataManagement-3137"><a href="#NucleiDataManagement-3137"><span class="linenos">3137</span></a>                    <span class="s2">&quot;nuclei_axis_major_length&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;axis_major_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3138"><a href="#NucleiDataManagement-3138"><span class="linenos">3138</span></a>                    <span class="s2">&quot;nuclei_axis_minor_length&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;axis_minor_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3139"><a href="#NucleiDataManagement-3139"><span class="linenos">3139</span></a>                    <span class="s2">&quot;nuclei_circularity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;circularity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3140"><a href="#NucleiDataManagement-3140"><span class="linenos">3140</span></a>                    <span class="s2">&quot;nuclei_eccentricity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;eccentricity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3141"><a href="#NucleiDataManagement-3141"><span class="linenos">3141</span></a>                    <span class="s2">&quot;nuclei_perimeter&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3142"><a href="#NucleiDataManagement-3142"><span class="linenos">3142</span></a>                    <span class="s2">&quot;nuclei_ratio&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;ratio&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3143"><a href="#NucleiDataManagement-3143"><span class="linenos">3143</span></a>                    <span class="s2">&quot;nuclei_solidity&quot;</span><span class="p">:</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;solidity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">],</span>
</span><span id="NucleiDataManagement-3144"><a href="#NucleiDataManagement-3144"><span class="linenos">3144</span></a>                <span class="p">}</span>
</span><span id="NucleiDataManagement-3145"><a href="#NucleiDataManagement-3145"><span class="linenos">3145</span></a>
</span><span id="NucleiDataManagement-3146"><a href="#NucleiDataManagement-3146"><span class="linenos">3146</span></a>                <span class="k">if</span> <span class="s2">&quot;spot_size_area&quot;</span> <span class="ow">in</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
</span><span id="NucleiDataManagement-3147"><a href="#NucleiDataManagement-3147"><span class="linenos">3147</span></a>                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3148"><a href="#NucleiDataManagement-3148"><span class="linenos">3148</span></a>                        <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3149"><a href="#NucleiDataManagement-3149"><span class="linenos">3149</span></a>                            <span class="p">{</span>
</span><span id="NucleiDataManagement-3150"><a href="#NucleiDataManagement-3150"><span class="linenos">3150</span></a>                                <span class="s2">&quot;spot_n&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]),</span>
</span><span id="NucleiDataManagement-3151"><a href="#NucleiDataManagement-3151"><span class="linenos">3151</span></a>                                <span class="s2">&quot;avg_spot_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3152"><a href="#NucleiDataManagement-3152"><span class="linenos">3152</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3153"><a href="#NucleiDataManagement-3153"><span class="linenos">3153</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3154"><a href="#NucleiDataManagement-3154"><span class="linenos">3154</span></a>                                <span class="s2">&quot;avg_spot_area_bbox&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3155"><a href="#NucleiDataManagement-3155"><span class="linenos">3155</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3156"><a href="#NucleiDataManagement-3156"><span class="linenos">3156</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3157"><a href="#NucleiDataManagement-3157"><span class="linenos">3157</span></a>                                <span class="s2">&quot;avg_spot_perimeter&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3158"><a href="#NucleiDataManagement-3158"><span class="linenos">3158</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3159"><a href="#NucleiDataManagement-3159"><span class="linenos">3159</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3160"><a href="#NucleiDataManagement-3160"><span class="linenos">3160</span></a>                                <span class="s2">&quot;sum_spot_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3161"><a href="#NucleiDataManagement-3161"><span class="linenos">3161</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3162"><a href="#NucleiDataManagement-3162"><span class="linenos">3162</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3163"><a href="#NucleiDataManagement-3163"><span class="linenos">3163</span></a>                                <span class="s2">&quot;sum_spot_area_bbox&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3164"><a href="#NucleiDataManagement-3164"><span class="linenos">3164</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_size_area_bbox&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3165"><a href="#NucleiDataManagement-3165"><span class="linenos">3165</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3166"><a href="#NucleiDataManagement-3166"><span class="linenos">3166</span></a>                                <span class="s2">&quot;sum_spot_perimeter&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3167"><a href="#NucleiDataManagement-3167"><span class="linenos">3167</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_perimeter&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3168"><a href="#NucleiDataManagement-3168"><span class="linenos">3168</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3169"><a href="#NucleiDataManagement-3169"><span class="linenos">3169</span></a>                                <span class="s2">&quot;avg_spot_axis_major_length&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3170"><a href="#NucleiDataManagement-3170"><span class="linenos">3170</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_axis_major_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3171"><a href="#NucleiDataManagement-3171"><span class="linenos">3171</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3172"><a href="#NucleiDataManagement-3172"><span class="linenos">3172</span></a>                                <span class="s2">&quot;avg_spot_axis_minor_length&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3173"><a href="#NucleiDataManagement-3173"><span class="linenos">3173</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_axis_minor_length&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3174"><a href="#NucleiDataManagement-3174"><span class="linenos">3174</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3175"><a href="#NucleiDataManagement-3175"><span class="linenos">3175</span></a>                                <span class="s2">&quot;avg_spot_eccentricity&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3176"><a href="#NucleiDataManagement-3176"><span class="linenos">3176</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;spot_eccentricity&quot;</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3177"><a href="#NucleiDataManagement-3177"><span class="linenos">3177</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3178"><a href="#NucleiDataManagement-3178"><span class="linenos">3178</span></a>                                <span class="s2">&quot;avg_spot_size_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3179"><a href="#NucleiDataManagement-3179"><span class="linenos">3179</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="NucleiDataManagement-3180"><a href="#NucleiDataManagement-3180"><span class="linenos">3180</span></a>                                        <span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span>
</span><span id="NucleiDataManagement-3181"><a href="#NucleiDataManagement-3181"><span class="linenos">3181</span></a>                                    <span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3182"><a href="#NucleiDataManagement-3182"><span class="linenos">3182</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3183"><a href="#NucleiDataManagement-3183"><span class="linenos">3183</span></a>                                <span class="s2">&quot;sum_spot_size_equivalent_diameter_area&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3184"><a href="#NucleiDataManagement-3184"><span class="linenos">3184</span></a>                                    <span class="n">nuclei_data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span>
</span><span id="NucleiDataManagement-3185"><a href="#NucleiDataManagement-3185"><span class="linenos">3185</span></a>                                        <span class="s2">&quot;spot_size_equivalent_diameter_area&quot;</span>
</span><span id="NucleiDataManagement-3186"><a href="#NucleiDataManagement-3186"><span class="linenos">3186</span></a>                                    <span class="p">][</span><span class="n">n</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3187"><a href="#NucleiDataManagement-3187"><span class="linenos">3187</span></a>                                <span class="p">),</span>
</span><span id="NucleiDataManagement-3188"><a href="#NucleiDataManagement-3188"><span class="linenos">3188</span></a>                            <span class="p">}</span>
</span><span id="NucleiDataManagement-3189"><a href="#NucleiDataManagement-3189"><span class="linenos">3189</span></a>                        <span class="p">)</span>
</span><span id="NucleiDataManagement-3190"><a href="#NucleiDataManagement-3190"><span class="linenos">3190</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3191"><a href="#NucleiDataManagement-3191"><span class="linenos">3191</span></a>                        <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3192"><a href="#NucleiDataManagement-3192"><span class="linenos">3192</span></a>                            <span class="p">{</span>
</span><span id="NucleiDataManagement-3193"><a href="#NucleiDataManagement-3193"><span class="linenos">3193</span></a>                                <span class="n">k</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="NucleiDataManagement-3194"><a href="#NucleiDataManagement-3194"><span class="linenos">3194</span></a>                                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="NucleiDataManagement-3195"><a href="#NucleiDataManagement-3195"><span class="linenos">3195</span></a>                                    <span class="s2">&quot;spot_n&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3196"><a href="#NucleiDataManagement-3196"><span class="linenos">3196</span></a>                                    <span class="s2">&quot;avg_spot_area&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3197"><a href="#NucleiDataManagement-3197"><span class="linenos">3197</span></a>                                    <span class="s2">&quot;avg_spot_area_bbox&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3198"><a href="#NucleiDataManagement-3198"><span class="linenos">3198</span></a>                                    <span class="s2">&quot;avg_spot_perimeter&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3199"><a href="#NucleiDataManagement-3199"><span class="linenos">3199</span></a>                                    <span class="s2">&quot;sum_spot_area&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3200"><a href="#NucleiDataManagement-3200"><span class="linenos">3200</span></a>                                    <span class="s2">&quot;sum_spot_area_bbox&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3201"><a href="#NucleiDataManagement-3201"><span class="linenos">3201</span></a>                                    <span class="s2">&quot;sum_spot_perimeter&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3202"><a href="#NucleiDataManagement-3202"><span class="linenos">3202</span></a>                                    <span class="s2">&quot;avg_spot_axis_major_length&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3203"><a href="#NucleiDataManagement-3203"><span class="linenos">3203</span></a>                                    <span class="s2">&quot;avg_spot_axis_minor_length&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3204"><a href="#NucleiDataManagement-3204"><span class="linenos">3204</span></a>                                    <span class="s2">&quot;avg_spot_eccentricity&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3205"><a href="#NucleiDataManagement-3205"><span class="linenos">3205</span></a>                                    <span class="s2">&quot;avg_spot_size_equivalent_diameter_area&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3206"><a href="#NucleiDataManagement-3206"><span class="linenos">3206</span></a>                                    <span class="s2">&quot;sum_spot_size_equivalent_diameter_area&quot;</span><span class="p">,</span>
</span><span id="NucleiDataManagement-3207"><a href="#NucleiDataManagement-3207"><span class="linenos">3207</span></a>                                <span class="p">]</span>
</span><span id="NucleiDataManagement-3208"><a href="#NucleiDataManagement-3208"><span class="linenos">3208</span></a>                            <span class="p">}</span>
</span><span id="NucleiDataManagement-3209"><a href="#NucleiDataManagement-3209"><span class="linenos">3209</span></a>                        <span class="p">)</span>
</span><span id="NucleiDataManagement-3210"><a href="#NucleiDataManagement-3210"><span class="linenos">3210</span></a>
</span><span id="NucleiDataManagement-3211"><a href="#NucleiDataManagement-3211"><span class="linenos">3211</span></a>                <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3212"><a href="#NucleiDataManagement-3212"><span class="linenos">3212</span></a>
</span><span id="NucleiDataManagement-3213"><a href="#NucleiDataManagement-3213"><span class="linenos">3213</span></a>        <span class="n">nuclei_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3214"><a href="#NucleiDataManagement-3214"><span class="linenos">3214</span></a>
</span><span id="NucleiDataManagement-3215"><a href="#NucleiDataManagement-3215"><span class="linenos">3215</span></a>        <span class="n">nuclei_df</span><span class="p">[</span><span class="s2">&quot;nuclei_per_img&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;id_name&quot;</span><span class="p">)[</span><span class="s2">&quot;id_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3216"><a href="#NucleiDataManagement-3216"><span class="linenos">3216</span></a>            <span class="s2">&quot;count&quot;</span>
</span><span id="NucleiDataManagement-3217"><a href="#NucleiDataManagement-3217"><span class="linenos">3217</span></a>        <span class="p">)</span>
</span><span id="NucleiDataManagement-3218"><a href="#NucleiDataManagement-3218"><span class="linenos">3218</span></a>        <span class="n">nuclei_df</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
</span><span id="NucleiDataManagement-3219"><a href="#NucleiDataManagement-3219"><span class="linenos">3219</span></a>
</span><span id="NucleiDataManagement-3220"><a href="#NucleiDataManagement-3220"><span class="linenos">3220</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="o">=</span> <span class="n">nuclei_df</span>
</span><span id="NucleiDataManagement-3221"><a href="#NucleiDataManagement-3221"><span class="linenos">3221</span></a>
</span><span id="NucleiDataManagement-3222"><a href="#NucleiDataManagement-3222"><span class="linenos">3222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_IS_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">IS_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="NucleiDataManagement-3223"><a href="#NucleiDataManagement-3223"><span class="linenos">3223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3224"><a href="#NucleiDataManagement-3224"><span class="linenos">3224</span></a><span class="sd">        Merge Image Stream (IS) data with nuclei analysis data.</span>
</span><span id="NucleiDataManagement-3225"><a href="#NucleiDataManagement-3225"><span class="linenos">3225</span></a>
</span><span id="NucleiDataManagement-3226"><a href="#NucleiDataManagement-3226"><span class="linenos">3226</span></a><span class="sd">        This method concatenates IS (Image Stream, https://cytekbio.com/pages/imagestream)</span>
</span><span id="NucleiDataManagement-3227"><a href="#NucleiDataManagement-3227"><span class="linenos">3227</span></a><span class="sd">        results with the nuclei data stored in the object. The merge is performed based</span>
</span><span id="NucleiDataManagement-3228"><a href="#NucleiDataManagement-3228"><span class="linenos">3228</span></a><span class="sd">        on object IDs, allowing joint analysis of nuclei features and IS features.</span>
</span><span id="NucleiDataManagement-3229"><a href="#NucleiDataManagement-3229"><span class="linenos">3229</span></a>
</span><span id="NucleiDataManagement-3230"><a href="#NucleiDataManagement-3230"><span class="linenos">3230</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3231"><a href="#NucleiDataManagement-3231"><span class="linenos">3231</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3232"><a href="#NucleiDataManagement-3232"><span class="linenos">3232</span></a><span class="sd">        IS_data : pd.DataFrame</span>
</span><span id="NucleiDataManagement-3233"><a href="#NucleiDataManagement-3233"><span class="linenos">3233</span></a><span class="sd">            DataFrame containing IS data results.</span>
</span><span id="NucleiDataManagement-3234"><a href="#NucleiDataManagement-3234"><span class="linenos">3234</span></a>
</span><span id="NucleiDataManagement-3235"><a href="#NucleiDataManagement-3235"><span class="linenos">3235</span></a><span class="sd">        IS_features : list, optional</span>
</span><span id="NucleiDataManagement-3236"><a href="#NucleiDataManagement-3236"><span class="linenos">3236</span></a><span class="sd">            List of features to extract from the IS data. Default is an empty list.</span>
</span><span id="NucleiDataManagement-3237"><a href="#NucleiDataManagement-3237"><span class="linenos">3237</span></a>
</span><span id="NucleiDataManagement-3238"><a href="#NucleiDataManagement-3238"><span class="linenos">3238</span></a><span class="sd">        Notes</span>
</span><span id="NucleiDataManagement-3239"><a href="#NucleiDataManagement-3239"><span class="linenos">3239</span></a><span class="sd">        -----</span>
</span><span id="NucleiDataManagement-3240"><a href="#NucleiDataManagement-3240"><span class="linenos">3240</span></a><span class="sd">        The merged data will be stored in the attribute `self.nuclei_IS_data`.</span>
</span><span id="NucleiDataManagement-3241"><a href="#NucleiDataManagement-3241"><span class="linenos">3241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3242"><a href="#NucleiDataManagement-3242"><span class="linenos">3242</span></a>
</span><span id="NucleiDataManagement-3243"><a href="#NucleiDataManagement-3243"><span class="linenos">3243</span></a>        <span class="n">nuclei_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span><span id="NucleiDataManagement-3244"><a href="#NucleiDataManagement-3244"><span class="linenos">3244</span></a>
</span><span id="NucleiDataManagement-3245"><a href="#NucleiDataManagement-3245"><span class="linenos">3245</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
</span><span id="NucleiDataManagement-3246"><a href="#NucleiDataManagement-3246"><span class="linenos">3246</span></a>
</span><span id="NucleiDataManagement-3247"><a href="#NucleiDataManagement-3247"><span class="linenos">3247</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IS_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3248"><a href="#NucleiDataManagement-3248"><span class="linenos">3248</span></a>            <span class="n">IS_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">IS_features</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">]))</span>
</span><span id="NucleiDataManagement-3249"><a href="#NucleiDataManagement-3249"><span class="linenos">3249</span></a>            <span class="n">IS_data</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="n">IS_features</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3250"><a href="#NucleiDataManagement-3250"><span class="linenos">3250</span></a>
</span><span id="NucleiDataManagement-3251"><a href="#NucleiDataManagement-3251"><span class="linenos">3251</span></a>        <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="NucleiDataManagement-3252"><a href="#NucleiDataManagement-3252"><span class="linenos">3252</span></a>            <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3253"><a href="#NucleiDataManagement-3253"><span class="linenos">3253</span></a>        <span class="p">)</span>
</span><span id="NucleiDataManagement-3254"><a href="#NucleiDataManagement-3254"><span class="linenos">3254</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3255"><a href="#NucleiDataManagement-3255"><span class="linenos">3255</span></a>
</span><span id="NucleiDataManagement-3256"><a href="#NucleiDataManagement-3256"><span class="linenos">3256</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3257"><a href="#NucleiDataManagement-3257"><span class="linenos">3257</span></a>        <span class="n">merged_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;set_x&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3258"><a href="#NucleiDataManagement-3258"><span class="linenos">3258</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;set_y&quot;</span><span class="p">:</span> <span class="s2">&quot;set&quot;</span><span class="p">})</span>
</span><span id="NucleiDataManagement-3259"><a href="#NucleiDataManagement-3259"><span class="linenos">3259</span></a>
</span><span id="NucleiDataManagement-3260"><a href="#NucleiDataManagement-3260"><span class="linenos">3260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="n">merged_data</span>
</span><span id="NucleiDataManagement-3261"><a href="#NucleiDataManagement-3261"><span class="linenos">3261</span></a>
</span><span id="NucleiDataManagement-3262"><a href="#NucleiDataManagement-3262"><span class="linenos">3262</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3263"><a href="#NucleiDataManagement-3263"><span class="linenos">3263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3264"><a href="#NucleiDataManagement-3264"><span class="linenos">3264</span></a><span class="sd">        Helper method to retrieve the nuclei data as a pandas DataFrame.</span>
</span><span id="NucleiDataManagement-3265"><a href="#NucleiDataManagement-3265"><span class="linenos">3265</span></a>
</span><span id="NucleiDataManagement-3266"><a href="#NucleiDataManagement-3266"><span class="linenos">3266</span></a><span class="sd">        If the internal DataFrame `self.nuceli_data_df` has not been created yet,</span>
</span><span id="NucleiDataManagement-3267"><a href="#NucleiDataManagement-3267"><span class="linenos">3267</span></a><span class="sd">        this method calls `_convert_to_df()` to generate it from `self.nuceli_data`.</span>
</span><span id="NucleiDataManagement-3268"><a href="#NucleiDataManagement-3268"><span class="linenos">3268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3269"><a href="#NucleiDataManagement-3269"><span class="linenos">3269</span></a>
</span><span id="NucleiDataManagement-3270"><a href="#NucleiDataManagement-3270"><span class="linenos">3270</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3271"><a href="#NucleiDataManagement-3271"><span class="linenos">3271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_to_df</span><span class="p">()</span>
</span><span id="NucleiDataManagement-3272"><a href="#NucleiDataManagement-3272"><span class="linenos">3272</span></a>
</span><span id="NucleiDataManagement-3273"><a href="#NucleiDataManagement-3273"><span class="linenos">3273</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span>
</span><span id="NucleiDataManagement-3274"><a href="#NucleiDataManagement-3274"><span class="linenos">3274</span></a>
</span><span id="NucleiDataManagement-3275"><a href="#NucleiDataManagement-3275"><span class="linenos">3275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3276"><a href="#NucleiDataManagement-3276"><span class="linenos">3276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3277"><a href="#NucleiDataManagement-3277"><span class="linenos">3277</span></a><span class="sd">        Retrieve nuclei results for a single project including IS data.</span>
</span><span id="NucleiDataManagement-3278"><a href="#NucleiDataManagement-3278"><span class="linenos">3278</span></a>
</span><span id="NucleiDataManagement-3279"><a href="#NucleiDataManagement-3279"><span class="linenos">3279</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement-3280"><a href="#NucleiDataManagement-3280"><span class="linenos">3280</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement-3281"><a href="#NucleiDataManagement-3281"><span class="linenos">3281</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="NucleiDataManagement-3282"><a href="#NucleiDataManagement-3282"><span class="linenos">3282</span></a><span class="sd">            DataFrame containing nuclei results merged with IS (Image Stream) data</span>
</span><span id="NucleiDataManagement-3283"><a href="#NucleiDataManagement-3283"><span class="linenos">3283</span></a><span class="sd">            added via `self.add_IS_data()`. Returns None if no IS data has been added.</span>
</span><span id="NucleiDataManagement-3284"><a href="#NucleiDataManagement-3284"><span class="linenos">3284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3285"><a href="#NucleiDataManagement-3285"><span class="linenos">3285</span></a>
</span><span id="NucleiDataManagement-3286"><a href="#NucleiDataManagement-3286"><span class="linenos">3286</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3287"><a href="#NucleiDataManagement-3287"><span class="linenos">3287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3288"><a href="#NucleiDataManagement-3288"><span class="linenos">3288</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span>
</span><span id="NucleiDataManagement-3289"><a href="#NucleiDataManagement-3289"><span class="linenos">3289</span></a>
</span><span id="NucleiDataManagement-3290"><a href="#NucleiDataManagement-3290"><span class="linenos">3290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3291"><a href="#NucleiDataManagement-3291"><span class="linenos">3291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3292"><a href="#NucleiDataManagement-3292"><span class="linenos">3292</span></a><span class="sd">        Retrieve nuclei results for a single project as a pandas DataFrame.</span>
</span><span id="NucleiDataManagement-3293"><a href="#NucleiDataManagement-3293"><span class="linenos">3293</span></a>
</span><span id="NucleiDataManagement-3294"><a href="#NucleiDataManagement-3294"><span class="linenos">3294</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement-3295"><a href="#NucleiDataManagement-3295"><span class="linenos">3295</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement-3296"><a href="#NucleiDataManagement-3296"><span class="linenos">3296</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="NucleiDataManagement-3297"><a href="#NucleiDataManagement-3297"><span class="linenos">3297</span></a><span class="sd">            DataFrame containing nuclei analysis results for the experiment.</span>
</span><span id="NucleiDataManagement-3298"><a href="#NucleiDataManagement-3298"><span class="linenos">3298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3299"><a href="#NucleiDataManagement-3299"><span class="linenos">3299</span></a>
</span><span id="NucleiDataManagement-3300"><a href="#NucleiDataManagement-3300"><span class="linenos">3300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span><span id="NucleiDataManagement-3301"><a href="#NucleiDataManagement-3301"><span class="linenos">3301</span></a>
</span><span id="NucleiDataManagement-3302"><a href="#NucleiDataManagement-3302"><span class="linenos">3302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_nuc_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3303"><a href="#NucleiDataManagement-3303"><span class="linenos">3303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3304"><a href="#NucleiDataManagement-3304"><span class="linenos">3304</span></a><span class="sd">        Save nuclei results as a JSON file with a *.nuc extension.</span>
</span><span id="NucleiDataManagement-3305"><a href="#NucleiDataManagement-3305"><span class="linenos">3305</span></a>
</span><span id="NucleiDataManagement-3306"><a href="#NucleiDataManagement-3306"><span class="linenos">3306</span></a><span class="sd">        The saved data can later be loaded using the `cls.load_nuc_dict()` method.</span>
</span><span id="NucleiDataManagement-3307"><a href="#NucleiDataManagement-3307"><span class="linenos">3307</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement-3308"><a href="#NucleiDataManagement-3308"><span class="linenos">3308</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement-3309"><a href="#NucleiDataManagement-3309"><span class="linenos">3309</span></a>
</span><span id="NucleiDataManagement-3310"><a href="#NucleiDataManagement-3310"><span class="linenos">3310</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3311"><a href="#NucleiDataManagement-3311"><span class="linenos">3311</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3312"><a href="#NucleiDataManagement-3312"><span class="linenos">3312</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement-3313"><a href="#NucleiDataManagement-3313"><span class="linenos">3313</span></a><span class="sd">            Directory where the results will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement-3314"><a href="#NucleiDataManagement-3314"><span class="linenos">3314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3315"><a href="#NucleiDataManagement-3315"><span class="linenos">3315</span></a>
</span><span id="NucleiDataManagement-3316"><a href="#NucleiDataManagement-3316"><span class="linenos">3316</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span>
</span><span id="NucleiDataManagement-3317"><a href="#NucleiDataManagement-3317"><span class="linenos">3317</span></a>
</span><span id="NucleiDataManagement-3318"><a href="#NucleiDataManagement-3318"><span class="linenos">3318</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3319"><a href="#NucleiDataManagement-3319"><span class="linenos">3319</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3320"><a href="#NucleiDataManagement-3320"><span class="linenos">3320</span></a>
</span><span id="NucleiDataManagement-3321"><a href="#NucleiDataManagement-3321"><span class="linenos">3321</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span> <span class="o">+</span> <span class="s2">&quot;.nuc&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3322"><a href="#NucleiDataManagement-3322"><span class="linenos">3322</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3323"><a href="#NucleiDataManagement-3323"><span class="linenos">3323</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3324"><a href="#NucleiDataManagement-3324"><span class="linenos">3324</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data not provided!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3325"><a href="#NucleiDataManagement-3325"><span class="linenos">3325</span></a>
</span><span id="NucleiDataManagement-3326"><a href="#NucleiDataManagement-3326"><span class="linenos">3326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3327"><a href="#NucleiDataManagement-3327"><span class="linenos">3327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3328"><a href="#NucleiDataManagement-3328"><span class="linenos">3328</span></a><span class="sd">        Save nuclei results for a single project as a CSV file.</span>
</span><span id="NucleiDataManagement-3329"><a href="#NucleiDataManagement-3329"><span class="linenos">3329</span></a>
</span><span id="NucleiDataManagement-3330"><a href="#NucleiDataManagement-3330"><span class="linenos">3330</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement-3331"><a href="#NucleiDataManagement-3331"><span class="linenos">3331</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement-3332"><a href="#NucleiDataManagement-3332"><span class="linenos">3332</span></a>
</span><span id="NucleiDataManagement-3333"><a href="#NucleiDataManagement-3333"><span class="linenos">3333</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3334"><a href="#NucleiDataManagement-3334"><span class="linenos">3334</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3335"><a href="#NucleiDataManagement-3335"><span class="linenos">3335</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement-3336"><a href="#NucleiDataManagement-3336"><span class="linenos">3336</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement-3337"><a href="#NucleiDataManagement-3337"><span class="linenos">3337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3338"><a href="#NucleiDataManagement-3338"><span class="linenos">3338</span></a>
</span><span id="NucleiDataManagement-3339"><a href="#NucleiDataManagement-3339"><span class="linenos">3339</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</span><span id="NucleiDataManagement-3340"><a href="#NucleiDataManagement-3340"><span class="linenos">3340</span></a>
</span><span id="NucleiDataManagement-3341"><a href="#NucleiDataManagement-3341"><span class="linenos">3341</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3342"><a href="#NucleiDataManagement-3342"><span class="linenos">3342</span></a>
</span><span id="NucleiDataManagement-3343"><a href="#NucleiDataManagement-3343"><span class="linenos">3343</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3344"><a href="#NucleiDataManagement-3344"><span class="linenos">3344</span></a>
</span><span id="NucleiDataManagement-3345"><a href="#NucleiDataManagement-3345"><span class="linenos">3345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3346"><a href="#NucleiDataManagement-3346"><span class="linenos">3346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3347"><a href="#NucleiDataManagement-3347"><span class="linenos">3347</span></a><span class="sd">        Save nuclei results with IS data for a single project as a CSV file.</span>
</span><span id="NucleiDataManagement-3348"><a href="#NucleiDataManagement-3348"><span class="linenos">3348</span></a>
</span><span id="NucleiDataManagement-3349"><a href="#NucleiDataManagement-3349"><span class="linenos">3349</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement-3350"><a href="#NucleiDataManagement-3350"><span class="linenos">3350</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement-3351"><a href="#NucleiDataManagement-3351"><span class="linenos">3351</span></a><span class="sd">        IS data should have been added via `self.add_IS_data()`.</span>
</span><span id="NucleiDataManagement-3352"><a href="#NucleiDataManagement-3352"><span class="linenos">3352</span></a>
</span><span id="NucleiDataManagement-3353"><a href="#NucleiDataManagement-3353"><span class="linenos">3353</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3354"><a href="#NucleiDataManagement-3354"><span class="linenos">3354</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3355"><a href="#NucleiDataManagement-3355"><span class="linenos">3355</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement-3356"><a href="#NucleiDataManagement-3356"><span class="linenos">3356</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement-3357"><a href="#NucleiDataManagement-3357"><span class="linenos">3357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3358"><a href="#NucleiDataManagement-3358"><span class="linenos">3358</span></a>
</span><span id="NucleiDataManagement-3359"><a href="#NucleiDataManagement-3359"><span class="linenos">3359</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span>
</span><span id="NucleiDataManagement-3360"><a href="#NucleiDataManagement-3360"><span class="linenos">3360</span></a>
</span><span id="NucleiDataManagement-3361"><a href="#NucleiDataManagement-3361"><span class="linenos">3361</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3362"><a href="#NucleiDataManagement-3362"><span class="linenos">3362</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There was nothing to save.&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3363"><a href="#NucleiDataManagement-3363"><span class="linenos">3363</span></a>
</span><span id="NucleiDataManagement-3364"><a href="#NucleiDataManagement-3364"><span class="linenos">3364</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3365"><a href="#NucleiDataManagement-3365"><span class="linenos">3365</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3366"><a href="#NucleiDataManagement-3366"><span class="linenos">3366</span></a>
</span><span id="NucleiDataManagement-3367"><a href="#NucleiDataManagement-3367"><span class="linenos">3367</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3368"><a href="#NucleiDataManagement-3368"><span class="linenos">3368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3369"><a href="#NucleiDataManagement-3369"><span class="linenos">3369</span></a><span class="sd">        Add additional NucleiDataManagement objects from other experiments for concatenation.</span>
</span><span id="NucleiDataManagement-3370"><a href="#NucleiDataManagement-3370"><span class="linenos">3370</span></a>
</span><span id="NucleiDataManagement-3371"><a href="#NucleiDataManagement-3371"><span class="linenos">3371</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3372"><a href="#NucleiDataManagement-3372"><span class="linenos">3372</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3373"><a href="#NucleiDataManagement-3373"><span class="linenos">3373</span></a><span class="sd">        data_list : list</span>
</span><span id="NucleiDataManagement-3374"><a href="#NucleiDataManagement-3374"><span class="linenos">3374</span></a><span class="sd">            List of `NucleiDataManagement` objects from separate experiments to be added.</span>
</span><span id="NucleiDataManagement-3375"><a href="#NucleiDataManagement-3375"><span class="linenos">3375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3376"><a href="#NucleiDataManagement-3376"><span class="linenos">3376</span></a>
</span><span id="NucleiDataManagement-3377"><a href="#NucleiDataManagement-3377"><span class="linenos">3377</span></a>        <span class="n">valid_class</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiDataManagement-3378"><a href="#NucleiDataManagement-3378"><span class="linenos">3378</span></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3379"><a href="#NucleiDataManagement-3379"><span class="linenos">3379</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3380"><a href="#NucleiDataManagement-3380"><span class="linenos">3380</span></a>                <span class="n">valid_class</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3381"><a href="#NucleiDataManagement-3381"><span class="linenos">3381</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3382"><a href="#NucleiDataManagement-3382"><span class="linenos">3382</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> is invalid type.&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3383"><a href="#NucleiDataManagement-3383"><span class="linenos">3383</span></a>
</span><span id="NucleiDataManagement-3384"><a href="#NucleiDataManagement-3384"><span class="linenos">3384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="n">valid_class</span>
</span><span id="NucleiDataManagement-3385"><a href="#NucleiDataManagement-3385"><span class="linenos">3385</span></a>
</span><span id="NucleiDataManagement-3386"><a href="#NucleiDataManagement-3386"><span class="linenos">3386</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mutual_experiments_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3387"><a href="#NucleiDataManagement-3387"><span class="linenos">3387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3388"><a href="#NucleiDataManagement-3388"><span class="linenos">3388</span></a><span class="sd">        Retrieve concatenated NucleiDataManagement data from other added experiments.</span>
</span><span id="NucleiDataManagement-3389"><a href="#NucleiDataManagement-3389"><span class="linenos">3389</span></a>
</span><span id="NucleiDataManagement-3390"><a href="#NucleiDataManagement-3390"><span class="linenos">3390</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3391"><a href="#NucleiDataManagement-3391"><span class="linenos">3391</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3392"><a href="#NucleiDataManagement-3392"><span class="linenos">3392</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="NucleiDataManagement-3393"><a href="#NucleiDataManagement-3393"><span class="linenos">3393</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="NucleiDataManagement-3394"><a href="#NucleiDataManagement-3394"><span class="linenos">3394</span></a>
</span><span id="NucleiDataManagement-3395"><a href="#NucleiDataManagement-3395"><span class="linenos">3395</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement-3396"><a href="#NucleiDataManagement-3396"><span class="linenos">3396</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement-3397"><a href="#NucleiDataManagement-3397"><span class="linenos">3397</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="NucleiDataManagement-3398"><a href="#NucleiDataManagement-3398"><span class="linenos">3398</span></a><span class="sd">            Concatenated nuclei data (with or without IS data) from all added experiments.</span>
</span><span id="NucleiDataManagement-3399"><a href="#NucleiDataManagement-3399"><span class="linenos">3399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3400"><a href="#NucleiDataManagement-3400"><span class="linenos">3400</span></a>
</span><span id="NucleiDataManagement-3401"><a href="#NucleiDataManagement-3401"><span class="linenos">3401</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3402"><a href="#NucleiDataManagement-3402"><span class="linenos">3402</span></a>            <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3403"><a href="#NucleiDataManagement-3403"><span class="linenos">3403</span></a>
</span><span id="NucleiDataManagement-3404"><a href="#NucleiDataManagement-3404"><span class="linenos">3404</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3405"><a href="#NucleiDataManagement-3405"><span class="linenos">3405</span></a>                    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3406"><a href="#NucleiDataManagement-3406"><span class="linenos">3406</span></a>                        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span>
</span><span id="NucleiDataManagement-3407"><a href="#NucleiDataManagement-3407"><span class="linenos">3407</span></a>                        <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()]</span>
</span><span id="NucleiDataManagement-3408"><a href="#NucleiDataManagement-3408"><span class="linenos">3408</span></a>                    <span class="p">)</span>
</span><span id="NucleiDataManagement-3409"><a href="#NucleiDataManagement-3409"><span class="linenos">3409</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3410"><a href="#NucleiDataManagement-3410"><span class="linenos">3410</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3411"><a href="#NucleiDataManagement-3411"><span class="linenos">3411</span></a>                        <span class="s2">&quot;Lack of IS data in some object. Check if the IS data was added to each project.&quot;</span>
</span><span id="NucleiDataManagement-3412"><a href="#NucleiDataManagement-3412"><span class="linenos">3412</span></a>                    <span class="p">)</span>
</span><span id="NucleiDataManagement-3413"><a href="#NucleiDataManagement-3413"><span class="linenos">3413</span></a>
</span><span id="NucleiDataManagement-3414"><a href="#NucleiDataManagement-3414"><span class="linenos">3414</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3415"><a href="#NucleiDataManagement-3415"><span class="linenos">3415</span></a>                <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="NucleiDataManagement-3416"><a href="#NucleiDataManagement-3416"><span class="linenos">3416</span></a>                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()]</span>
</span><span id="NucleiDataManagement-3417"><a href="#NucleiDataManagement-3417"><span class="linenos">3417</span></a>                <span class="p">)</span>
</span><span id="NucleiDataManagement-3418"><a href="#NucleiDataManagement-3418"><span class="linenos">3418</span></a>
</span><span id="NucleiDataManagement-3419"><a href="#NucleiDataManagement-3419"><span class="linenos">3419</span></a>            <span class="k">return</span> <span class="n">final_df</span>
</span><span id="NucleiDataManagement-3420"><a href="#NucleiDataManagement-3420"><span class="linenos">3420</span></a>
</span><span id="NucleiDataManagement-3421"><a href="#NucleiDataManagement-3421"><span class="linenos">3421</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No object to concatenate. Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3422"><a href="#NucleiDataManagement-3422"><span class="linenos">3422</span></a>
</span><span id="NucleiDataManagement-3423"><a href="#NucleiDataManagement-3423"><span class="linenos">3423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_mutual_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiDataManagement-3424"><a href="#NucleiDataManagement-3424"><span class="linenos">3424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3425"><a href="#NucleiDataManagement-3425"><span class="linenos">3425</span></a><span class="sd">        Save concatenated NucleiDataManagement data from added experiments as a CSV file.</span>
</span><span id="NucleiDataManagement-3426"><a href="#NucleiDataManagement-3426"><span class="linenos">3426</span></a>
</span><span id="NucleiDataManagement-3427"><a href="#NucleiDataManagement-3427"><span class="linenos">3427</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement-3428"><a href="#NucleiDataManagement-3428"><span class="linenos">3428</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement-3429"><a href="#NucleiDataManagement-3429"><span class="linenos">3429</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="NucleiDataManagement-3430"><a href="#NucleiDataManagement-3430"><span class="linenos">3430</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="NucleiDataManagement-3431"><a href="#NucleiDataManagement-3431"><span class="linenos">3431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement-3432"><a href="#NucleiDataManagement-3432"><span class="linenos">3432</span></a>
</span><span id="NucleiDataManagement-3433"><a href="#NucleiDataManagement-3433"><span class="linenos">3433</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mutual_experiments_data</span><span class="p">(</span><span class="n">inc_is</span><span class="o">=</span><span class="n">inc_is</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3434"><a href="#NucleiDataManagement-3434"><span class="linenos">3434</span></a>
</span><span id="NucleiDataManagement-3435"><a href="#NucleiDataManagement-3435"><span class="linenos">3435</span></a>        <span class="n">experimets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="NucleiDataManagement-3436"><a href="#NucleiDataManagement-3436"><span class="linenos">3436</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">experiment_name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span>
</span><span id="NucleiDataManagement-3437"><a href="#NucleiDataManagement-3437"><span class="linenos">3437</span></a>        <span class="p">]</span>
</span><span id="NucleiDataManagement-3438"><a href="#NucleiDataManagement-3438"><span class="linenos">3438</span></a>
</span><span id="NucleiDataManagement-3439"><a href="#NucleiDataManagement-3439"><span class="linenos">3439</span></a>        <span class="n">experimets_names</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimets</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3440"><a href="#NucleiDataManagement-3440"><span class="linenos">3440</span></a>
</span><span id="NucleiDataManagement-3441"><a href="#NucleiDataManagement-3441"><span class="linenos">3441</span></a>        <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3442"><a href="#NucleiDataManagement-3442"><span class="linenos">3442</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3443"><a href="#NucleiDataManagement-3443"><span class="linenos">3443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement-3444"><a href="#NucleiDataManagement-3444"><span class="linenos">3444</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement-3445"><a href="#NucleiDataManagement-3445"><span class="linenos">3445</span></a>
</span><span id="NucleiDataManagement-3446"><a href="#NucleiDataManagement-3446"><span class="linenos">3446</span></a>        <span class="n">dt</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Manages nuclei analysis data obtained from the <code><a href="#NucleiFinder">NucleiFinder</a></code> class,
including nuclei properties and optionally Image Stream (IS) data.</p>

<p>This class allows loading nuclei data from JSON files or directly from
<code><a href="#NucleiFinder">NucleiFinder</a></code> analysis results, converting them to pandas DataFrames,
adding IS data, concatenating results from multiple experiments, and
saving results in JSON or CSV format. It also provides helper methods
for merging, filtering, and retrieving data.</p>

<h2 id="attributes">Attributes</h2>

<p>nuceli_data : dict
    Dictionary storing nuclei properties for each image or experiment.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<p>nuceli_data_df : pd.DataFrame or None
    DataFrame representation of nuclei properties.</p>

<p>nuclei_IS_data : pd.DataFrame or None
    DataFrame of nuclei data merged with IS data.</p>

<p>concat_data : list or None
    List of other <code><a href="#NucleiDataManagement">NucleiDataManagement</a></code> objects added for combined analysis.</p>

<h2 id="methods">Methods</h2>

<p>load_nuc_dict(path)
    Load nuclei data from a JSON dictionary file (*.nuc) and initialize the object.
    _convert_to_df()
    Convert nuclei dictionary data to a pandas DataFrame.</p>

<p>add_IS_data(IS_data, IS_features)
    Merge Image Stream (IS) data with nuclei data.</p>

<p>get_data()
    Retrieve the nuclei data as a pandas DataFrame.</p>

<p>get_data_with_IS()
    Retrieve the nuclei data merged with IS data.</p>

<p>save_nuc_project(path)
    Save nuclei data as a JSON file with *.nuc extension.</p>

<p>save_results_df(path)
    Save nuclei data as a CSV file.</p>

<p>save_results_df_with_IS(path)
    Save nuclei data merged with IS data as a CSV file.</p>

<p>add_experiment(data_list)
    Add other <code><a href="#NucleiDataManagement">NucleiDataManagement</a></code> objects for concatenated analysis.</p>

<p>get_mutual_experiments_data(inc_is)
    Retrieve concatenated nuclei data from multiple experiments.</p>

<p>save_mutual_experiments(path, inc_is)
    Save concatenated data from multiple experiments as a CSV file.</p>
</div>


                            <div id="NucleiDataManagement.__init__" class="classattr">
                                        <input id="NucleiDataManagement.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">NucleiDataManagement</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">nuclei_data</span><span class="p">:</span> <span class="nb">dict</span>, </span><span class="param"><span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span></span>)</span>

                <label class="view-source-button" for="NucleiDataManagement.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.__init__-3018"><a href="#NucleiDataManagement.__init__-3018"><span class="linenos">3018</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclei_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">experiment_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NucleiDataManagement.__init__-3019"><a href="#NucleiDataManagement.__init__-3019"><span class="linenos">3019</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.__init__-3020"><a href="#NucleiDataManagement.__init__-3020"><span class="linenos">3020</span></a><span class="sd">        Initialize a NucleiDataManagement object with nuclei data and experiment name.</span>
</span><span id="NucleiDataManagement.__init__-3021"><a href="#NucleiDataManagement.__init__-3021"><span class="linenos">3021</span></a>
</span><span id="NucleiDataManagement.__init__-3022"><a href="#NucleiDataManagement.__init__-3022"><span class="linenos">3022</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.__init__-3023"><a href="#NucleiDataManagement.__init__-3023"><span class="linenos">3023</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.__init__-3024"><a href="#NucleiDataManagement.__init__-3024"><span class="linenos">3024</span></a><span class="sd">        nuclei_data : dict</span>
</span><span id="NucleiDataManagement.__init__-3025"><a href="#NucleiDataManagement.__init__-3025"><span class="linenos">3025</span></a><span class="sd">            Dictionary containing nuclei properties for each image or experiment.</span>
</span><span id="NucleiDataManagement.__init__-3026"><a href="#NucleiDataManagement.__init__-3026"><span class="linenos">3026</span></a><span class="sd">            If the dictionary entries have keys &#39;stats&#39; and &#39;img&#39;, only &#39;stats&#39; are stored.</span>
</span><span id="NucleiDataManagement.__init__-3027"><a href="#NucleiDataManagement.__init__-3027"><span class="linenos">3027</span></a>
</span><span id="NucleiDataManagement.__init__-3028"><a href="#NucleiDataManagement.__init__-3028"><span class="linenos">3028</span></a><span class="sd">        experiment_name : str</span>
</span><span id="NucleiDataManagement.__init__-3029"><a href="#NucleiDataManagement.__init__-3029"><span class="linenos">3029</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="NucleiDataManagement.__init__-3030"><a href="#NucleiDataManagement.__init__-3030"><span class="linenos">3030</span></a>
</span><span id="NucleiDataManagement.__init__-3031"><a href="#NucleiDataManagement.__init__-3031"><span class="linenos">3031</span></a><span class="sd">        Attributes</span>
</span><span id="NucleiDataManagement.__init__-3032"><a href="#NucleiDataManagement.__init__-3032"><span class="linenos">3032</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.__init__-3033"><a href="#NucleiDataManagement.__init__-3033"><span class="linenos">3033</span></a><span class="sd">        nuceli_data : dict</span>
</span><span id="NucleiDataManagement.__init__-3034"><a href="#NucleiDataManagement.__init__-3034"><span class="linenos">3034</span></a><span class="sd">            Dictionary storing nuclei properties for each image or experiment.</span>
</span><span id="NucleiDataManagement.__init__-3035"><a href="#NucleiDataManagement.__init__-3035"><span class="linenos">3035</span></a>
</span><span id="NucleiDataManagement.__init__-3036"><a href="#NucleiDataManagement.__init__-3036"><span class="linenos">3036</span></a><span class="sd">        experiment_name : str</span>
</span><span id="NucleiDataManagement.__init__-3037"><a href="#NucleiDataManagement.__init__-3037"><span class="linenos">3037</span></a><span class="sd">            Name of the experiment.</span>
</span><span id="NucleiDataManagement.__init__-3038"><a href="#NucleiDataManagement.__init__-3038"><span class="linenos">3038</span></a>
</span><span id="NucleiDataManagement.__init__-3039"><a href="#NucleiDataManagement.__init__-3039"><span class="linenos">3039</span></a><span class="sd">        nuceli_data_df : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement.__init__-3040"><a href="#NucleiDataManagement.__init__-3040"><span class="linenos">3040</span></a><span class="sd">            DataFrame representation of nuclei properties (initialized as None).</span>
</span><span id="NucleiDataManagement.__init__-3041"><a href="#NucleiDataManagement.__init__-3041"><span class="linenos">3041</span></a>
</span><span id="NucleiDataManagement.__init__-3042"><a href="#NucleiDataManagement.__init__-3042"><span class="linenos">3042</span></a><span class="sd">        nuclei_IS_data : pd.DataFrame or None</span>
</span><span id="NucleiDataManagement.__init__-3043"><a href="#NucleiDataManagement.__init__-3043"><span class="linenos">3043</span></a><span class="sd">            DataFrame of nuclei data merged with Image Stream (IS) data (initialized as None).</span>
</span><span id="NucleiDataManagement.__init__-3044"><a href="#NucleiDataManagement.__init__-3044"><span class="linenos">3044</span></a>
</span><span id="NucleiDataManagement.__init__-3045"><a href="#NucleiDataManagement.__init__-3045"><span class="linenos">3045</span></a><span class="sd">        concat_data : list or None</span>
</span><span id="NucleiDataManagement.__init__-3046"><a href="#NucleiDataManagement.__init__-3046"><span class="linenos">3046</span></a><span class="sd">            List of other `NucleiDataManagement` objects added for combined analysis (initialized as None).</span>
</span><span id="NucleiDataManagement.__init__-3047"><a href="#NucleiDataManagement.__init__-3047"><span class="linenos">3047</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.__init__-3048"><a href="#NucleiDataManagement.__init__-3048"><span class="linenos">3048</span></a>
</span><span id="NucleiDataManagement.__init__-3049"><a href="#NucleiDataManagement.__init__-3049"><span class="linenos">3049</span></a>        <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span>
</span><span id="NucleiDataManagement.__init__-3050"><a href="#NucleiDataManagement.__init__-3050"><span class="linenos">3050</span></a>            <span class="p">[</span><span class="s2">&quot;stats&quot;</span><span class="p">,</span> <span class="s2">&quot;img&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement.__init__-3051"><a href="#NucleiDataManagement.__init__-3051"><span class="linenos">3051</span></a>        <span class="p">):</span>
</span><span id="NucleiDataManagement.__init__-3052"><a href="#NucleiDataManagement.__init__-3052"><span class="linenos">3052</span></a>
</span><span id="NucleiDataManagement.__init__-3053"><a href="#NucleiDataManagement.__init__-3053"><span class="linenos">3053</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="NucleiDataManagement.__init__-3054"><a href="#NucleiDataManagement.__init__-3054"><span class="linenos">3054</span></a>
</span><span id="NucleiDataManagement.__init__-3055"><a href="#NucleiDataManagement.__init__-3055"><span class="linenos">3055</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">nuclei_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement.__init__-3056"><a href="#NucleiDataManagement.__init__-3056"><span class="linenos">3056</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s2">&quot;stats&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement.__init__-3057"><a href="#NucleiDataManagement.__init__-3057"><span class="linenos">3057</span></a>
</span><span id="NucleiDataManagement.__init__-3058"><a href="#NucleiDataManagement.__init__-3058"><span class="linenos">3058</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement.__init__-3059"><a href="#NucleiDataManagement.__init__-3059"><span class="linenos">3059</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement.__init__-3060"><a href="#NucleiDataManagement.__init__-3060"><span class="linenos">3060</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.__init__-3061"><a href="#NucleiDataManagement.__init__-3061"><span class="linenos">3061</span></a>
</span><span id="NucleiDataManagement.__init__-3062"><a href="#NucleiDataManagement.__init__-3062"><span class="linenos">3062</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.__init__-3063"><a href="#NucleiDataManagement.__init__-3063"><span class="linenos">3063</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span> <span class="o">=</span> <span class="n">nuclei_data</span>
</span><span id="NucleiDataManagement.__init__-3064"><a href="#NucleiDataManagement.__init__-3064"><span class="linenos">3064</span></a>
</span><span id="NucleiDataManagement.__init__-3065"><a href="#NucleiDataManagement.__init__-3065"><span class="linenos">3065</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement.__init__-3066"><a href="#NucleiDataManagement.__init__-3066"><span class="linenos">3066</span></a>                <span class="k">if</span> <span class="s2">&quot;coords&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="NucleiDataManagement.__init__-3067"><a href="#NucleiDataManagement.__init__-3067"><span class="linenos">3067</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.__init__-3068"><a href="#NucleiDataManagement.__init__-3068"><span class="linenos">3068</span></a>
</span><span id="NucleiDataManagement.__init__-3069"><a href="#NucleiDataManagement.__init__-3069"><span class="linenos">3069</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span> <span class="o">=</span> <span class="n">experiment_name</span>
</span><span id="NucleiDataManagement.__init__-3070"><a href="#NucleiDataManagement.__init__-3070"><span class="linenos">3070</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of the experiment.&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.__init__-3071"><a href="#NucleiDataManagement.__init__-3071"><span class="linenos">3071</span></a>
</span><span id="NucleiDataManagement.__init__-3072"><a href="#NucleiDataManagement.__init__-3072"><span class="linenos">3072</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data_df</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement.__init__-3073"><a href="#NucleiDataManagement.__init__-3073"><span class="linenos">3073</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame representation of nuclei features&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.__init__-3074"><a href="#NucleiDataManagement.__init__-3074"><span class="linenos">3074</span></a>
</span><span id="NucleiDataManagement.__init__-3075"><a href="#NucleiDataManagement.__init__-3075"><span class="linenos">3075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement.__init__-3076"><a href="#NucleiDataManagement.__init__-3076"><span class="linenos">3076</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored DataFrame of data from Image Stream (IS).&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.__init__-3077"><a href="#NucleiDataManagement.__init__-3077"><span class="linenos">3077</span></a>
</span><span id="NucleiDataManagement.__init__-3078"><a href="#NucleiDataManagement.__init__-3078"><span class="linenos">3078</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="NucleiDataManagement.__init__-3079"><a href="#NucleiDataManagement.__init__-3079"><span class="linenos">3079</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotored list of other `NucleiDataManagement` objects.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a NucleiDataManagement object with nuclei data and experiment name.</p>

<h2 id="parameters">Parameters</h2>

<p>nuclei_data : dict
    Dictionary containing nuclei properties for each image or experiment.
    If the dictionary entries have keys 'stats' and 'img', only 'stats' are stored.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<h2 id="attributes">Attributes</h2>

<p>nuceli_data : dict
    Dictionary storing nuclei properties for each image or experiment.</p>

<p>experiment_name : str
    Name of the experiment.</p>

<p>nuceli_data_df : pd.DataFrame or None
    DataFrame representation of nuclei properties (initialized as None).</p>

<p>nuclei_IS_data : pd.DataFrame or None
    DataFrame of nuclei data merged with Image Stream (IS) data (initialized as None).</p>

<p>concat_data : list or None
    List of other <code><a href="#NucleiDataManagement">NucleiDataManagement</a></code> objects added for combined analysis (initialized as None).</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.experiment_name" class="classattr">
                                <div class="attr variable">
            <span class="name">experiment_name</span>

        
    </div>
    <a class="headerlink" href="#NucleiDataManagement.experiment_name"></a>
    
            <div class="docstring"><p>Name of the experiment.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.nuceli_data_df" class="classattr">
                                <div class="attr variable">
            <span class="name">nuceli_data_df</span>

        
    </div>
    <a class="headerlink" href="#NucleiDataManagement.nuceli_data_df"></a>
    
            <div class="docstring"><p>Stored DataFrame representation of nuclei features</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.nuclei_IS_data" class="classattr">
                                <div class="attr variable">
            <span class="name">nuclei_IS_data</span>

        
    </div>
    <a class="headerlink" href="#NucleiDataManagement.nuclei_IS_data"></a>
    
            <div class="docstring"><p>Stored DataFrame of data from Image Stream (IS).</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.concat_data" class="classattr">
                                <div class="attr variable">
            <span class="name">concat_data</span>

        
    </div>
    <a class="headerlink" href="#NucleiDataManagement.concat_data"></a>
    
            <div class="docstring"><p>Sotored list of other <code><a href="#NucleiDataManagement">NucleiDataManagement</a></code> objects.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.load_nuc_dict" class="classattr">
                                        <input id="NucleiDataManagement.load_nuc_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_nuc_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.load_nuc_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.load_nuc_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.load_nuc_dict-3081"><a href="#NucleiDataManagement.load_nuc_dict-3081"><span class="linenos">3081</span></a>    <span class="nd">@classmethod</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3082"><a href="#NucleiDataManagement.load_nuc_dict-3082"><span class="linenos">3082</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_nuc_dict</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3083"><a href="#NucleiDataManagement.load_nuc_dict-3083"><span class="linenos">3083</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3084"><a href="#NucleiDataManagement.load_nuc_dict-3084"><span class="linenos">3084</span></a><span class="sd">        Initialize a NucleiDataManagement object from a JSON dictionary file.</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3085"><a href="#NucleiDataManagement.load_nuc_dict-3085"><span class="linenos">3085</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3086"><a href="#NucleiDataManagement.load_nuc_dict-3086"><span class="linenos">3086</span></a><span class="sd">        The loaded data must be previously saved using the ``save_nuc_project()`` method.</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3087"><a href="#NucleiDataManagement.load_nuc_dict-3087"><span class="linenos">3087</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3088"><a href="#NucleiDataManagement.load_nuc_dict-3088"><span class="linenos">3088</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3089"><a href="#NucleiDataManagement.load_nuc_dict-3089"><span class="linenos">3089</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3090"><a href="#NucleiDataManagement.load_nuc_dict-3090"><span class="linenos">3090</span></a><span class="sd">        path : str</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3091"><a href="#NucleiDataManagement.load_nuc_dict-3091"><span class="linenos">3091</span></a><span class="sd">            Path to the *.nuc JSON file containing nuclei data.</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3092"><a href="#NucleiDataManagement.load_nuc_dict-3092"><span class="linenos">3092</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3093"><a href="#NucleiDataManagement.load_nuc_dict-3093"><span class="linenos">3093</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3094"><a href="#NucleiDataManagement.load_nuc_dict-3094"><span class="linenos">3094</span></a>        <span class="k">if</span> <span class="s2">&quot;.nuc&quot;</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3095"><a href="#NucleiDataManagement.load_nuc_dict-3095"><span class="linenos">3095</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3096"><a href="#NucleiDataManagement.load_nuc_dict-3096"><span class="linenos">3096</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3097"><a href="#NucleiDataManagement.load_nuc_dict-3097"><span class="linenos">3097</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3098"><a href="#NucleiDataManagement.load_nuc_dict-3098"><span class="linenos">3098</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3099"><a href="#NucleiDataManagement.load_nuc_dict-3099"><span class="linenos">3099</span></a>                    <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3100"><a href="#NucleiDataManagement.load_nuc_dict-3100"><span class="linenos">3100</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3101"><a href="#NucleiDataManagement.load_nuc_dict-3101"><span class="linenos">3101</span></a>                <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3102"><a href="#NucleiDataManagement.load_nuc_dict-3102"><span class="linenos">3102</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3103"><a href="#NucleiDataManagement.load_nuc_dict-3103"><span class="linenos">3103</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3104"><a href="#NucleiDataManagement.load_nuc_dict-3104"><span class="linenos">3104</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid path!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3105"><a href="#NucleiDataManagement.load_nuc_dict-3105"><span class="linenos">3105</span></a>
</span><span id="NucleiDataManagement.load_nuc_dict-3106"><a href="#NucleiDataManagement.load_nuc_dict-3106"><span class="linenos">3106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3107"><a href="#NucleiDataManagement.load_nuc_dict-3107"><span class="linenos">3107</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3108"><a href="#NucleiDataManagement.load_nuc_dict-3108"><span class="linenos">3108</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Invalid dictionary to load. It must contain a .nuc extension!&quot;</span>
</span><span id="NucleiDataManagement.load_nuc_dict-3109"><a href="#NucleiDataManagement.load_nuc_dict-3109"><span class="linenos">3109</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a NucleiDataManagement object from a JSON dictionary file.</p>

<p>The loaded data must be previously saved using the <code><a href="#NucleiDataManagement.save_nuc_project">save_nuc_project()</a></code> method.</p>

<h2 id="parameters">Parameters</h2>

<p>path : str
    Path to the *.nuc JSON file containing nuclei data.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.add_IS_data" class="classattr">
                                        <input id="NucleiDataManagement.add_IS_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_IS_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">IS_data</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span>, </span><span class="param"><span class="n">IS_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.add_IS_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.add_IS_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.add_IS_data-3222"><a href="#NucleiDataManagement.add_IS_data-3222"><span class="linenos">3222</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_IS_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">IS_features</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="NucleiDataManagement.add_IS_data-3223"><a href="#NucleiDataManagement.add_IS_data-3223"><span class="linenos">3223</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.add_IS_data-3224"><a href="#NucleiDataManagement.add_IS_data-3224"><span class="linenos">3224</span></a><span class="sd">        Merge Image Stream (IS) data with nuclei analysis data.</span>
</span><span id="NucleiDataManagement.add_IS_data-3225"><a href="#NucleiDataManagement.add_IS_data-3225"><span class="linenos">3225</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3226"><a href="#NucleiDataManagement.add_IS_data-3226"><span class="linenos">3226</span></a><span class="sd">        This method concatenates IS (Image Stream, https://cytekbio.com/pages/imagestream)</span>
</span><span id="NucleiDataManagement.add_IS_data-3227"><a href="#NucleiDataManagement.add_IS_data-3227"><span class="linenos">3227</span></a><span class="sd">        results with the nuclei data stored in the object. The merge is performed based</span>
</span><span id="NucleiDataManagement.add_IS_data-3228"><a href="#NucleiDataManagement.add_IS_data-3228"><span class="linenos">3228</span></a><span class="sd">        on object IDs, allowing joint analysis of nuclei features and IS features.</span>
</span><span id="NucleiDataManagement.add_IS_data-3229"><a href="#NucleiDataManagement.add_IS_data-3229"><span class="linenos">3229</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3230"><a href="#NucleiDataManagement.add_IS_data-3230"><span class="linenos">3230</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.add_IS_data-3231"><a href="#NucleiDataManagement.add_IS_data-3231"><span class="linenos">3231</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.add_IS_data-3232"><a href="#NucleiDataManagement.add_IS_data-3232"><span class="linenos">3232</span></a><span class="sd">        IS_data : pd.DataFrame</span>
</span><span id="NucleiDataManagement.add_IS_data-3233"><a href="#NucleiDataManagement.add_IS_data-3233"><span class="linenos">3233</span></a><span class="sd">            DataFrame containing IS data results.</span>
</span><span id="NucleiDataManagement.add_IS_data-3234"><a href="#NucleiDataManagement.add_IS_data-3234"><span class="linenos">3234</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3235"><a href="#NucleiDataManagement.add_IS_data-3235"><span class="linenos">3235</span></a><span class="sd">        IS_features : list, optional</span>
</span><span id="NucleiDataManagement.add_IS_data-3236"><a href="#NucleiDataManagement.add_IS_data-3236"><span class="linenos">3236</span></a><span class="sd">            List of features to extract from the IS data. Default is an empty list.</span>
</span><span id="NucleiDataManagement.add_IS_data-3237"><a href="#NucleiDataManagement.add_IS_data-3237"><span class="linenos">3237</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3238"><a href="#NucleiDataManagement.add_IS_data-3238"><span class="linenos">3238</span></a><span class="sd">        Notes</span>
</span><span id="NucleiDataManagement.add_IS_data-3239"><a href="#NucleiDataManagement.add_IS_data-3239"><span class="linenos">3239</span></a><span class="sd">        -----</span>
</span><span id="NucleiDataManagement.add_IS_data-3240"><a href="#NucleiDataManagement.add_IS_data-3240"><span class="linenos">3240</span></a><span class="sd">        The merged data will be stored in the attribute `self.nuclei_IS_data`.</span>
</span><span id="NucleiDataManagement.add_IS_data-3241"><a href="#NucleiDataManagement.add_IS_data-3241"><span class="linenos">3241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.add_IS_data-3242"><a href="#NucleiDataManagement.add_IS_data-3242"><span class="linenos">3242</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3243"><a href="#NucleiDataManagement.add_IS_data-3243"><span class="linenos">3243</span></a>        <span class="n">nuclei_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span><span id="NucleiDataManagement.add_IS_data-3244"><a href="#NucleiDataManagement.add_IS_data-3244"><span class="linenos">3244</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3245"><a href="#NucleiDataManagement.add_IS_data-3245"><span class="linenos">3245</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span>
</span><span id="NucleiDataManagement.add_IS_data-3246"><a href="#NucleiDataManagement.add_IS_data-3246"><span class="linenos">3246</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3247"><a href="#NucleiDataManagement.add_IS_data-3247"><span class="linenos">3247</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IS_features</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiDataManagement.add_IS_data-3248"><a href="#NucleiDataManagement.add_IS_data-3248"><span class="linenos">3248</span></a>            <span class="n">IS_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">IS_features</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">,</span> <span class="s2">&quot;set&quot;</span><span class="p">]))</span>
</span><span id="NucleiDataManagement.add_IS_data-3249"><a href="#NucleiDataManagement.add_IS_data-3249"><span class="linenos">3249</span></a>            <span class="n">IS_data</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="n">IS_features</span><span class="p">]</span>
</span><span id="NucleiDataManagement.add_IS_data-3250"><a href="#NucleiDataManagement.add_IS_data-3250"><span class="linenos">3250</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3251"><a href="#NucleiDataManagement.add_IS_data-3251"><span class="linenos">3251</span></a>        <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="NucleiDataManagement.add_IS_data-3252"><a href="#NucleiDataManagement.add_IS_data-3252"><span class="linenos">3252</span></a>            <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;id_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">nuclei_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement.add_IS_data-3253"><a href="#NucleiDataManagement.add_IS_data-3253"><span class="linenos">3253</span></a>        <span class="p">)</span>
</span><span id="NucleiDataManagement.add_IS_data-3254"><a href="#NucleiDataManagement.add_IS_data-3254"><span class="linenos">3254</span></a>        <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;Object Number&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">IS_data</span><span class="p">[</span><span class="s2">&quot;set&quot;</span><span class="p">]</span>
</span><span id="NucleiDataManagement.add_IS_data-3255"><a href="#NucleiDataManagement.add_IS_data-3255"><span class="linenos">3255</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3256"><a href="#NucleiDataManagement.add_IS_data-3256"><span class="linenos">3256</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">nuclei_data</span><span class="p">,</span> <span class="n">IS_data</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.add_IS_data-3257"><a href="#NucleiDataManagement.add_IS_data-3257"><span class="linenos">3257</span></a>        <span class="n">merged_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;set_x&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.add_IS_data-3258"><a href="#NucleiDataManagement.add_IS_data-3258"><span class="linenos">3258</span></a>        <span class="n">merged_data</span> <span class="o">=</span> <span class="n">merged_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;set_y&quot;</span><span class="p">:</span> <span class="s2">&quot;set&quot;</span><span class="p">})</span>
</span><span id="NucleiDataManagement.add_IS_data-3259"><a href="#NucleiDataManagement.add_IS_data-3259"><span class="linenos">3259</span></a>
</span><span id="NucleiDataManagement.add_IS_data-3260"><a href="#NucleiDataManagement.add_IS_data-3260"><span class="linenos">3260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="o">=</span> <span class="n">merged_data</span>
</span></pre></div>


            <div class="docstring"><p>Merge Image Stream (IS) data with nuclei analysis data.</p>

<p>This method concatenates IS (Image Stream, <a href="https://cytekbio.com/pages/imagestream">https://cytekbio.com/pages/imagestream</a>)
results with the nuclei data stored in the object. The merge is performed based
on object IDs, allowing joint analysis of nuclei features and IS features.</p>

<h2 id="parameters">Parameters</h2>

<p>IS_data : pd.DataFrame
    DataFrame containing IS data results.</p>

<p>IS_features : list, optional
    List of features to extract from the IS data. Default is an empty list.</p>

<h2 id="notes">Notes</h2>

<p>The merged data will be stored in the attribute <code>self.nuclei_IS_data</code>.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.get_data_with_IS" class="classattr">
                                        <input id="NucleiDataManagement.get_data_with_IS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data_with_IS</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.get_data_with_IS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.get_data_with_IS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.get_data_with_IS-3275"><a href="#NucleiDataManagement.get_data_with_IS-3275"><span class="linenos">3275</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3276"><a href="#NucleiDataManagement.get_data_with_IS-3276"><span class="linenos">3276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3277"><a href="#NucleiDataManagement.get_data_with_IS-3277"><span class="linenos">3277</span></a><span class="sd">        Retrieve nuclei results for a single project including IS data.</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3278"><a href="#NucleiDataManagement.get_data_with_IS-3278"><span class="linenos">3278</span></a>
</span><span id="NucleiDataManagement.get_data_with_IS-3279"><a href="#NucleiDataManagement.get_data_with_IS-3279"><span class="linenos">3279</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3280"><a href="#NucleiDataManagement.get_data_with_IS-3280"><span class="linenos">3280</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3281"><a href="#NucleiDataManagement.get_data_with_IS-3281"><span class="linenos">3281</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3282"><a href="#NucleiDataManagement.get_data_with_IS-3282"><span class="linenos">3282</span></a><span class="sd">            DataFrame containing nuclei results merged with IS (Image Stream) data</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3283"><a href="#NucleiDataManagement.get_data_with_IS-3283"><span class="linenos">3283</span></a><span class="sd">            added via `self.add_IS_data()`. Returns None if no IS data has been added.</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3284"><a href="#NucleiDataManagement.get_data_with_IS-3284"><span class="linenos">3284</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3285"><a href="#NucleiDataManagement.get_data_with_IS-3285"><span class="linenos">3285</span></a>
</span><span id="NucleiDataManagement.get_data_with_IS-3286"><a href="#NucleiDataManagement.get_data_with_IS-3286"><span class="linenos">3286</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3287"><a href="#NucleiDataManagement.get_data_with_IS-3287"><span class="linenos">3287</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Nothing to return!&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.get_data_with_IS-3288"><a href="#NucleiDataManagement.get_data_with_IS-3288"><span class="linenos">3288</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuclei_IS_data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve nuclei results for a single project including IS data.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame or None
    DataFrame containing nuclei results merged with IS (Image Stream) data
    added via <code>self.add_IS_data()</code>. Returns None if no IS data has been added.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.get_data" class="classattr">
                                        <input id="NucleiDataManagement.get_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.get_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.get_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.get_data-3290"><a href="#NucleiDataManagement.get_data-3290"><span class="linenos">3290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="NucleiDataManagement.get_data-3291"><a href="#NucleiDataManagement.get_data-3291"><span class="linenos">3291</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_data-3292"><a href="#NucleiDataManagement.get_data-3292"><span class="linenos">3292</span></a><span class="sd">        Retrieve nuclei results for a single project as a pandas DataFrame.</span>
</span><span id="NucleiDataManagement.get_data-3293"><a href="#NucleiDataManagement.get_data-3293"><span class="linenos">3293</span></a>
</span><span id="NucleiDataManagement.get_data-3294"><a href="#NucleiDataManagement.get_data-3294"><span class="linenos">3294</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement.get_data-3295"><a href="#NucleiDataManagement.get_data-3295"><span class="linenos">3295</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement.get_data-3296"><a href="#NucleiDataManagement.get_data-3296"><span class="linenos">3296</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="NucleiDataManagement.get_data-3297"><a href="#NucleiDataManagement.get_data-3297"><span class="linenos">3297</span></a><span class="sd">            DataFrame containing nuclei analysis results for the experiment.</span>
</span><span id="NucleiDataManagement.get_data-3298"><a href="#NucleiDataManagement.get_data-3298"><span class="linenos">3298</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_data-3299"><a href="#NucleiDataManagement.get_data-3299"><span class="linenos">3299</span></a>
</span><span id="NucleiDataManagement.get_data-3300"><a href="#NucleiDataManagement.get_data-3300"><span class="linenos">3300</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve nuclei results for a single project as a pandas DataFrame.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    DataFrame containing nuclei analysis results for the experiment.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.save_nuc_project" class="classattr">
                                        <input id="NucleiDataManagement.save_nuc_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_nuc_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.save_nuc_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.save_nuc_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.save_nuc_project-3302"><a href="#NucleiDataManagement.save_nuc_project-3302"><span class="linenos">3302</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_nuc_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement.save_nuc_project-3303"><a href="#NucleiDataManagement.save_nuc_project-3303"><span class="linenos">3303</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_nuc_project-3304"><a href="#NucleiDataManagement.save_nuc_project-3304"><span class="linenos">3304</span></a><span class="sd">        Save nuclei results as a JSON file with a *.nuc extension.</span>
</span><span id="NucleiDataManagement.save_nuc_project-3305"><a href="#NucleiDataManagement.save_nuc_project-3305"><span class="linenos">3305</span></a>
</span><span id="NucleiDataManagement.save_nuc_project-3306"><a href="#NucleiDataManagement.save_nuc_project-3306"><span class="linenos">3306</span></a><span class="sd">        The saved data can later be loaded using the `cls.load_nuc_dict()` method.</span>
</span><span id="NucleiDataManagement.save_nuc_project-3307"><a href="#NucleiDataManagement.save_nuc_project-3307"><span class="linenos">3307</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement.save_nuc_project-3308"><a href="#NucleiDataManagement.save_nuc_project-3308"><span class="linenos">3308</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement.save_nuc_project-3309"><a href="#NucleiDataManagement.save_nuc_project-3309"><span class="linenos">3309</span></a>
</span><span id="NucleiDataManagement.save_nuc_project-3310"><a href="#NucleiDataManagement.save_nuc_project-3310"><span class="linenos">3310</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.save_nuc_project-3311"><a href="#NucleiDataManagement.save_nuc_project-3311"><span class="linenos">3311</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.save_nuc_project-3312"><a href="#NucleiDataManagement.save_nuc_project-3312"><span class="linenos">3312</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement.save_nuc_project-3313"><a href="#NucleiDataManagement.save_nuc_project-3313"><span class="linenos">3313</span></a><span class="sd">            Directory where the results will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement.save_nuc_project-3314"><a href="#NucleiDataManagement.save_nuc_project-3314"><span class="linenos">3314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_nuc_project-3315"><a href="#NucleiDataManagement.save_nuc_project-3315"><span class="linenos">3315</span></a>
</span><span id="NucleiDataManagement.save_nuc_project-3316"><a href="#NucleiDataManagement.save_nuc_project-3316"><span class="linenos">3316</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nuceli_data</span>
</span><span id="NucleiDataManagement.save_nuc_project-3317"><a href="#NucleiDataManagement.save_nuc_project-3317"><span class="linenos">3317</span></a>
</span><span id="NucleiDataManagement.save_nuc_project-3318"><a href="#NucleiDataManagement.save_nuc_project-3318"><span class="linenos">3318</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_nuc_project-3319"><a href="#NucleiDataManagement.save_nuc_project-3319"><span class="linenos">3319</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_nuc_project-3320"><a href="#NucleiDataManagement.save_nuc_project-3320"><span class="linenos">3320</span></a>
</span><span id="NucleiDataManagement.save_nuc_project-3321"><a href="#NucleiDataManagement.save_nuc_project-3321"><span class="linenos">3321</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">full_path</span> <span class="o">+</span> <span class="s2">&quot;.nuc&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_nuc_project-3322"><a href="#NucleiDataManagement.save_nuc_project-3322"><span class="linenos">3322</span></a>                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_nuc_project-3323"><a href="#NucleiDataManagement.save_nuc_project-3323"><span class="linenos">3323</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_nuc_project-3324"><a href="#NucleiDataManagement.save_nuc_project-3324"><span class="linenos">3324</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data not provided!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save nuclei results as a JSON file with a *.nuc extension.</p>

<p>The saved data can later be loaded using the <code>cls.load_nuc_dict()</code> method.
Results must be obtained from the <code><a href="#NucleiFinder">NucleiFinder</a></code> class using
<code>series_analysis_nuclei()</code> or <code>series_analysis_chromatinization()</code> methods.</p>

<h2 id="parameters">Parameters</h2>

<p>path : str, optional
    Directory where the results will be saved. Default is the current working directory.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.save_results_df" class="classattr">
                                        <input id="NucleiDataManagement.save_results_df-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_results_df</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.save_results_df-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.save_results_df"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.save_results_df-3326"><a href="#NucleiDataManagement.save_results_df-3326"><span class="linenos">3326</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement.save_results_df-3327"><a href="#NucleiDataManagement.save_results_df-3327"><span class="linenos">3327</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_results_df-3328"><a href="#NucleiDataManagement.save_results_df-3328"><span class="linenos">3328</span></a><span class="sd">        Save nuclei results for a single project as a CSV file.</span>
</span><span id="NucleiDataManagement.save_results_df-3329"><a href="#NucleiDataManagement.save_results_df-3329"><span class="linenos">3329</span></a>
</span><span id="NucleiDataManagement.save_results_df-3330"><a href="#NucleiDataManagement.save_results_df-3330"><span class="linenos">3330</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement.save_results_df-3331"><a href="#NucleiDataManagement.save_results_df-3331"><span class="linenos">3331</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement.save_results_df-3332"><a href="#NucleiDataManagement.save_results_df-3332"><span class="linenos">3332</span></a>
</span><span id="NucleiDataManagement.save_results_df-3333"><a href="#NucleiDataManagement.save_results_df-3333"><span class="linenos">3333</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.save_results_df-3334"><a href="#NucleiDataManagement.save_results_df-3334"><span class="linenos">3334</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.save_results_df-3335"><a href="#NucleiDataManagement.save_results_df-3335"><span class="linenos">3335</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement.save_results_df-3336"><a href="#NucleiDataManagement.save_results_df-3336"><span class="linenos">3336</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement.save_results_df-3337"><a href="#NucleiDataManagement.save_results_df-3337"><span class="linenos">3337</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_results_df-3338"><a href="#NucleiDataManagement.save_results_df-3338"><span class="linenos">3338</span></a>
</span><span id="NucleiDataManagement.save_results_df-3339"><a href="#NucleiDataManagement.save_results_df-3339"><span class="linenos">3339</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
</span><span id="NucleiDataManagement.save_results_df-3340"><a href="#NucleiDataManagement.save_results_df-3340"><span class="linenos">3340</span></a>
</span><span id="NucleiDataManagement.save_results_df-3341"><a href="#NucleiDataManagement.save_results_df-3341"><span class="linenos">3341</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_results_df-3342"><a href="#NucleiDataManagement.save_results_df-3342"><span class="linenos">3342</span></a>
</span><span id="NucleiDataManagement.save_results_df-3343"><a href="#NucleiDataManagement.save_results_df-3343"><span class="linenos">3343</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save nuclei results for a single project as a CSV file.</p>

<p>Results must be obtained from the <code><a href="#NucleiFinder">NucleiFinder</a></code> class using
<code>series_analysis_nuclei()</code> or <code>series_analysis_chromatinization()</code> methods.</p>

<h2 id="parameters">Parameters</h2>

<p>path : str, optional
    Directory where the CSV file will be saved. Default is the current working directory.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.save_results_df_with_IS" class="classattr">
                                        <input id="NucleiDataManagement.save_results_df_with_IS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_results_df_with_IS</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.save_results_df_with_IS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.save_results_df_with_IS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.save_results_df_with_IS-3345"><a href="#NucleiDataManagement.save_results_df_with_IS-3345"><span class="linenos">3345</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_results_df_with_IS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3346"><a href="#NucleiDataManagement.save_results_df_with_IS-3346"><span class="linenos">3346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3347"><a href="#NucleiDataManagement.save_results_df_with_IS-3347"><span class="linenos">3347</span></a><span class="sd">        Save nuclei results with IS data for a single project as a CSV file.</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3348"><a href="#NucleiDataManagement.save_results_df_with_IS-3348"><span class="linenos">3348</span></a>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3349"><a href="#NucleiDataManagement.save_results_df_with_IS-3349"><span class="linenos">3349</span></a><span class="sd">        Results must be obtained from the `NucleiFinder` class using</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3350"><a href="#NucleiDataManagement.save_results_df_with_IS-3350"><span class="linenos">3350</span></a><span class="sd">        `series_analysis_nuclei()` or `series_analysis_chromatinization()` methods.</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3351"><a href="#NucleiDataManagement.save_results_df_with_IS-3351"><span class="linenos">3351</span></a><span class="sd">        IS data should have been added via `self.add_IS_data()`.</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3352"><a href="#NucleiDataManagement.save_results_df_with_IS-3352"><span class="linenos">3352</span></a>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3353"><a href="#NucleiDataManagement.save_results_df_with_IS-3353"><span class="linenos">3353</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3354"><a href="#NucleiDataManagement.save_results_df_with_IS-3354"><span class="linenos">3354</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3355"><a href="#NucleiDataManagement.save_results_df_with_IS-3355"><span class="linenos">3355</span></a><span class="sd">        path : str, optional</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3356"><a href="#NucleiDataManagement.save_results_df_with_IS-3356"><span class="linenos">3356</span></a><span class="sd">            Directory where the CSV file will be saved. Default is the current working directory.</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3357"><a href="#NucleiDataManagement.save_results_df_with_IS-3357"><span class="linenos">3357</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3358"><a href="#NucleiDataManagement.save_results_df_with_IS-3358"><span class="linenos">3358</span></a>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3359"><a href="#NucleiDataManagement.save_results_df_with_IS-3359"><span class="linenos">3359</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3360"><a href="#NucleiDataManagement.save_results_df_with_IS-3360"><span class="linenos">3360</span></a>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3361"><a href="#NucleiDataManagement.save_results_df_with_IS-3361"><span class="linenos">3361</span></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3362"><a href="#NucleiDataManagement.save_results_df_with_IS-3362"><span class="linenos">3362</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There was nothing to save.&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3363"><a href="#NucleiDataManagement.save_results_df_with_IS-3363"><span class="linenos">3363</span></a>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3364"><a href="#NucleiDataManagement.save_results_df_with_IS-3364"><span class="linenos">3364</span></a>        <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_results_df_with_IS-3365"><a href="#NucleiDataManagement.save_results_df_with_IS-3365"><span class="linenos">3365</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save nuclei results with IS data for a single project as a CSV file.</p>

<p>Results must be obtained from the <code><a href="#NucleiFinder">NucleiFinder</a></code> class using
<code>series_analysis_nuclei()</code> or <code>series_analysis_chromatinization()</code> methods.
IS data should have been added via <code>self.add_IS_data()</code>.</p>

<h2 id="parameters">Parameters</h2>

<p>path : str, optional
    Directory where the CSV file will be saved. Default is the current working directory.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.add_experiment" class="classattr">
                                        <input id="NucleiDataManagement.add_experiment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_experiment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.add_experiment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.add_experiment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.add_experiment-3367"><a href="#NucleiDataManagement.add_experiment-3367"><span class="linenos">3367</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">add_experiment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="NucleiDataManagement.add_experiment-3368"><a href="#NucleiDataManagement.add_experiment-3368"><span class="linenos">3368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.add_experiment-3369"><a href="#NucleiDataManagement.add_experiment-3369"><span class="linenos">3369</span></a><span class="sd">        Add additional NucleiDataManagement objects from other experiments for concatenation.</span>
</span><span id="NucleiDataManagement.add_experiment-3370"><a href="#NucleiDataManagement.add_experiment-3370"><span class="linenos">3370</span></a>
</span><span id="NucleiDataManagement.add_experiment-3371"><a href="#NucleiDataManagement.add_experiment-3371"><span class="linenos">3371</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.add_experiment-3372"><a href="#NucleiDataManagement.add_experiment-3372"><span class="linenos">3372</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.add_experiment-3373"><a href="#NucleiDataManagement.add_experiment-3373"><span class="linenos">3373</span></a><span class="sd">        data_list : list</span>
</span><span id="NucleiDataManagement.add_experiment-3374"><a href="#NucleiDataManagement.add_experiment-3374"><span class="linenos">3374</span></a><span class="sd">            List of `NucleiDataManagement` objects from separate experiments to be added.</span>
</span><span id="NucleiDataManagement.add_experiment-3375"><a href="#NucleiDataManagement.add_experiment-3375"><span class="linenos">3375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.add_experiment-3376"><a href="#NucleiDataManagement.add_experiment-3376"><span class="linenos">3376</span></a>
</span><span id="NucleiDataManagement.add_experiment-3377"><a href="#NucleiDataManagement.add_experiment-3377"><span class="linenos">3377</span></a>        <span class="n">valid_class</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="NucleiDataManagement.add_experiment-3378"><a href="#NucleiDataManagement.add_experiment-3378"><span class="linenos">3378</span></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">data_list</span><span class="p">:</span>
</span><span id="NucleiDataManagement.add_experiment-3379"><a href="#NucleiDataManagement.add_experiment-3379"><span class="linenos">3379</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="NucleiDataManagement.add_experiment-3380"><a href="#NucleiDataManagement.add_experiment-3380"><span class="linenos">3380</span></a>                <span class="n">valid_class</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="NucleiDataManagement.add_experiment-3381"><a href="#NucleiDataManagement.add_experiment-3381"><span class="linenos">3381</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.add_experiment-3382"><a href="#NucleiDataManagement.add_experiment-3382"><span class="linenos">3382</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">}</span><span class="s2"> is invalid type.&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.add_experiment-3383"><a href="#NucleiDataManagement.add_experiment-3383"><span class="linenos">3383</span></a>
</span><span id="NucleiDataManagement.add_experiment-3384"><a href="#NucleiDataManagement.add_experiment-3384"><span class="linenos">3384</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="o">=</span> <span class="n">valid_class</span>
</span></pre></div>


            <div class="docstring"><p>Add additional NucleiDataManagement objects from other experiments for concatenation.</p>

<h2 id="parameters">Parameters</h2>

<p>data_list : list
    List of <code><a href="#NucleiDataManagement">NucleiDataManagement</a></code> objects from separate experiments to be added.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.get_mutual_experiments_data" class="classattr">
                                        <input id="NucleiDataManagement.get_mutual_experiments_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_mutual_experiments_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.get_mutual_experiments_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.get_mutual_experiments_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.get_mutual_experiments_data-3386"><a href="#NucleiDataManagement.get_mutual_experiments_data-3386"><span class="linenos">3386</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_mutual_experiments_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3387"><a href="#NucleiDataManagement.get_mutual_experiments_data-3387"><span class="linenos">3387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3388"><a href="#NucleiDataManagement.get_mutual_experiments_data-3388"><span class="linenos">3388</span></a><span class="sd">        Retrieve concatenated NucleiDataManagement data from other added experiments.</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3389"><a href="#NucleiDataManagement.get_mutual_experiments_data-3389"><span class="linenos">3389</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3390"><a href="#NucleiDataManagement.get_mutual_experiments_data-3390"><span class="linenos">3390</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3391"><a href="#NucleiDataManagement.get_mutual_experiments_data-3391"><span class="linenos">3391</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3392"><a href="#NucleiDataManagement.get_mutual_experiments_data-3392"><span class="linenos">3392</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3393"><a href="#NucleiDataManagement.get_mutual_experiments_data-3393"><span class="linenos">3393</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3394"><a href="#NucleiDataManagement.get_mutual_experiments_data-3394"><span class="linenos">3394</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3395"><a href="#NucleiDataManagement.get_mutual_experiments_data-3395"><span class="linenos">3395</span></a><span class="sd">        Returns</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3396"><a href="#NucleiDataManagement.get_mutual_experiments_data-3396"><span class="linenos">3396</span></a><span class="sd">        -------</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3397"><a href="#NucleiDataManagement.get_mutual_experiments_data-3397"><span class="linenos">3397</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3398"><a href="#NucleiDataManagement.get_mutual_experiments_data-3398"><span class="linenos">3398</span></a><span class="sd">            Concatenated nuclei data (with or without IS data) from all added experiments.</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3399"><a href="#NucleiDataManagement.get_mutual_experiments_data-3399"><span class="linenos">3399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3400"><a href="#NucleiDataManagement.get_mutual_experiments_data-3400"><span class="linenos">3400</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3401"><a href="#NucleiDataManagement.get_mutual_experiments_data-3401"><span class="linenos">3401</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3402"><a href="#NucleiDataManagement.get_mutual_experiments_data-3402"><span class="linenos">3402</span></a>            <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3403"><a href="#NucleiDataManagement.get_mutual_experiments_data-3403"><span class="linenos">3403</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3404"><a href="#NucleiDataManagement.get_mutual_experiments_data-3404"><span class="linenos">3404</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3405"><a href="#NucleiDataManagement.get_mutual_experiments_data-3405"><span class="linenos">3405</span></a>                    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3406"><a href="#NucleiDataManagement.get_mutual_experiments_data-3406"><span class="linenos">3406</span></a>                        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3407"><a href="#NucleiDataManagement.get_mutual_experiments_data-3407"><span class="linenos">3407</span></a>                        <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data_with_IS</span><span class="p">()]</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3408"><a href="#NucleiDataManagement.get_mutual_experiments_data-3408"><span class="linenos">3408</span></a>                    <span class="p">)</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3409"><a href="#NucleiDataManagement.get_mutual_experiments_data-3409"><span class="linenos">3409</span></a>                <span class="k">except</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3410"><a href="#NucleiDataManagement.get_mutual_experiments_data-3410"><span class="linenos">3410</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3411"><a href="#NucleiDataManagement.get_mutual_experiments_data-3411"><span class="linenos">3411</span></a>                        <span class="s2">&quot;Lack of IS data in some object. Check if the IS data was added to each project.&quot;</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3412"><a href="#NucleiDataManagement.get_mutual_experiments_data-3412"><span class="linenos">3412</span></a>                    <span class="p">)</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3413"><a href="#NucleiDataManagement.get_mutual_experiments_data-3413"><span class="linenos">3413</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3414"><a href="#NucleiDataManagement.get_mutual_experiments_data-3414"><span class="linenos">3414</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3415"><a href="#NucleiDataManagement.get_mutual_experiments_data-3415"><span class="linenos">3415</span></a>                <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3416"><a href="#NucleiDataManagement.get_mutual_experiments_data-3416"><span class="linenos">3416</span></a>                    <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">()]</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3417"><a href="#NucleiDataManagement.get_mutual_experiments_data-3417"><span class="linenos">3417</span></a>                <span class="p">)</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3418"><a href="#NucleiDataManagement.get_mutual_experiments_data-3418"><span class="linenos">3418</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3419"><a href="#NucleiDataManagement.get_mutual_experiments_data-3419"><span class="linenos">3419</span></a>            <span class="k">return</span> <span class="n">final_df</span>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3420"><a href="#NucleiDataManagement.get_mutual_experiments_data-3420"><span class="linenos">3420</span></a>
</span><span id="NucleiDataManagement.get_mutual_experiments_data-3421"><a href="#NucleiDataManagement.get_mutual_experiments_data-3421"><span class="linenos">3421</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No object to concatenate. Nothing to return!&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve concatenated NucleiDataManagement data from other added experiments.</p>

<h2 id="parameters">Parameters</h2>

<p>inc_is : bool, optional
    Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    Concatenated nuclei data (with or without IS data) from all added experiments.</p>
</div>


                            </div>
                            <div id="NucleiDataManagement.save_mutual_experiments" class="classattr">
                                        <input id="NucleiDataManagement.save_mutual_experiments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save_mutual_experiments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="NucleiDataManagement.save_mutual_experiments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NucleiDataManagement.save_mutual_experiments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NucleiDataManagement.save_mutual_experiments-3423"><a href="#NucleiDataManagement.save_mutual_experiments-3423"><span class="linenos">3423</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_mutual_experiments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">inc_is</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3424"><a href="#NucleiDataManagement.save_mutual_experiments-3424"><span class="linenos">3424</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3425"><a href="#NucleiDataManagement.save_mutual_experiments-3425"><span class="linenos">3425</span></a><span class="sd">        Save concatenated NucleiDataManagement data from added experiments as a CSV file.</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3426"><a href="#NucleiDataManagement.save_mutual_experiments-3426"><span class="linenos">3426</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3427"><a href="#NucleiDataManagement.save_mutual_experiments-3427"><span class="linenos">3427</span></a><span class="sd">        Parameters</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3428"><a href="#NucleiDataManagement.save_mutual_experiments-3428"><span class="linenos">3428</span></a><span class="sd">        ----------</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3429"><a href="#NucleiDataManagement.save_mutual_experiments-3429"><span class="linenos">3429</span></a><span class="sd">        inc_is : bool, optional</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3430"><a href="#NucleiDataManagement.save_mutual_experiments-3430"><span class="linenos">3430</span></a><span class="sd">            Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3431"><a href="#NucleiDataManagement.save_mutual_experiments-3431"><span class="linenos">3431</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3432"><a href="#NucleiDataManagement.save_mutual_experiments-3432"><span class="linenos">3432</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3433"><a href="#NucleiDataManagement.save_mutual_experiments-3433"><span class="linenos">3433</span></a>        <span class="n">dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mutual_experiments_data</span><span class="p">(</span><span class="n">inc_is</span><span class="o">=</span><span class="n">inc_is</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3434"><a href="#NucleiDataManagement.save_mutual_experiments-3434"><span class="linenos">3434</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3435"><a href="#NucleiDataManagement.save_mutual_experiments-3435"><span class="linenos">3435</span></a>        <span class="n">experimets</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">experiment_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3436"><a href="#NucleiDataManagement.save_mutual_experiments-3436"><span class="linenos">3436</span></a>            <span class="n">n</span><span class="o">.</span><span class="n">experiment_name</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">concat_data</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3437"><a href="#NucleiDataManagement.save_mutual_experiments-3437"><span class="linenos">3437</span></a>        <span class="p">]</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3438"><a href="#NucleiDataManagement.save_mutual_experiments-3438"><span class="linenos">3438</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3439"><a href="#NucleiDataManagement.save_mutual_experiments-3439"><span class="linenos">3439</span></a>        <span class="n">experimets_names</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">experimets</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3440"><a href="#NucleiDataManagement.save_mutual_experiments-3440"><span class="linenos">3440</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3441"><a href="#NucleiDataManagement.save_mutual_experiments-3441"><span class="linenos">3441</span></a>        <span class="k">if</span> <span class="n">inc_is</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3442"><a href="#NucleiDataManagement.save_mutual_experiments-3442"><span class="linenos">3442</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">_IS.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3443"><a href="#NucleiDataManagement.save_mutual_experiments-3443"><span class="linenos">3443</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3444"><a href="#NucleiDataManagement.save_mutual_experiments-3444"><span class="linenos">3444</span></a>            <span class="n">full_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">experimets_names</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
</span><span id="NucleiDataManagement.save_mutual_experiments-3445"><a href="#NucleiDataManagement.save_mutual_experiments-3445"><span class="linenos">3445</span></a>
</span><span id="NucleiDataManagement.save_mutual_experiments-3446"><a href="#NucleiDataManagement.save_mutual_experiments-3446"><span class="linenos">3446</span></a>        <span class="n">dt</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">full_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Save concatenated NucleiDataManagement data from added experiments as a CSV file.</p>

<h2 id="parameters">Parameters</h2>

<p>inc_is : bool, optional
    Whether to include IS (Image Stream) data, if it was added to each experiment. Default is False.</p>
</div>


                            </div>
                </section>
                <section id="GroupAnalysis">
                            <input id="GroupAnalysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GroupAnalysis</span>:

                <label class="view-source-button" for="GroupAnalysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis-3449"><a href="#GroupAnalysis-3449"><span class="linenos">3449</span></a><span class="k">class</span><span class="w"> </span><span class="nc">GroupAnalysis</span><span class="p">:</span>
</span><span id="GroupAnalysis-3450"><a href="#GroupAnalysis-3450"><span class="linenos">3450</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3451"><a href="#GroupAnalysis-3451"><span class="linenos">3451</span></a><span class="sd">    A class for performing multivariate analysis, dimensionality reduction,</span>
</span><span id="GroupAnalysis-3452"><a href="#GroupAnalysis-3452"><span class="linenos">3452</span></a><span class="sd">    clustering, and differential feature analysis (DFA) on biological or</span>
</span><span id="GroupAnalysis-3453"><a href="#GroupAnalysis-3453"><span class="linenos">3453</span></a><span class="sd">    experimental datasets.</span>
</span><span id="GroupAnalysis-3454"><a href="#GroupAnalysis-3454"><span class="linenos">3454</span></a>
</span><span id="GroupAnalysis-3455"><a href="#GroupAnalysis-3455"><span class="linenos">3455</span></a><span class="sd">    This class provides tools for:</span>
</span><span id="GroupAnalysis-3456"><a href="#GroupAnalysis-3456"><span class="linenos">3456</span></a><span class="sd">    - Scaling and PCA of input data</span>
</span><span id="GroupAnalysis-3457"><a href="#GroupAnalysis-3457"><span class="linenos">3457</span></a><span class="sd">    - UMAP embedding and DBSCAN clustering</span>
</span><span id="GroupAnalysis-3458"><a href="#GroupAnalysis-3458"><span class="linenos">3458</span></a><span class="sd">    - Differential Feature Analysis across groups</span>
</span><span id="GroupAnalysis-3459"><a href="#GroupAnalysis-3459"><span class="linenos">3459</span></a><span class="sd">    - Proportion analysis and plotting</span>
</span><span id="GroupAnalysis-3460"><a href="#GroupAnalysis-3460"><span class="linenos">3460</span></a><span class="sd">    - Data selection and merging with metadata</span>
</span><span id="GroupAnalysis-3461"><a href="#GroupAnalysis-3461"><span class="linenos">3461</span></a>
</span><span id="GroupAnalysis-3462"><a href="#GroupAnalysis-3462"><span class="linenos">3462</span></a><span class="sd">    Attributes</span>
</span><span id="GroupAnalysis-3463"><a href="#GroupAnalysis-3463"><span class="linenos">3463</span></a><span class="sd">    ----------</span>
</span><span id="GroupAnalysis-3464"><a href="#GroupAnalysis-3464"><span class="linenos">3464</span></a><span class="sd">    input_data : pd.DataFrame</span>
</span><span id="GroupAnalysis-3465"><a href="#GroupAnalysis-3465"><span class="linenos">3465</span></a><span class="sd">        The primary dataset containing features for analysis.</span>
</span><span id="GroupAnalysis-3466"><a href="#GroupAnalysis-3466"><span class="linenos">3466</span></a>
</span><span id="GroupAnalysis-3467"><a href="#GroupAnalysis-3467"><span class="linenos">3467</span></a><span class="sd">    input_metadata : pd.DataFrame</span>
</span><span id="GroupAnalysis-3468"><a href="#GroupAnalysis-3468"><span class="linenos">3468</span></a><span class="sd">        Metadata corresponding to the input data, including identifiers and group labels.</span>
</span><span id="GroupAnalysis-3469"><a href="#GroupAnalysis-3469"><span class="linenos">3469</span></a>
</span><span id="GroupAnalysis-3470"><a href="#GroupAnalysis-3470"><span class="linenos">3470</span></a><span class="sd">    tmp_data : pd.DataFrame</span>
</span><span id="GroupAnalysis-3471"><a href="#GroupAnalysis-3471"><span class="linenos">3471</span></a><span class="sd">        Temporary copy of the input data, used for feature selection and filtering.</span>
</span><span id="GroupAnalysis-3472"><a href="#GroupAnalysis-3472"><span class="linenos">3472</span></a>
</span><span id="GroupAnalysis-3473"><a href="#GroupAnalysis-3473"><span class="linenos">3473</span></a><span class="sd">    tmp_metadata : pd.DataFrame</span>
</span><span id="GroupAnalysis-3474"><a href="#GroupAnalysis-3474"><span class="linenos">3474</span></a><span class="sd">        Temporary copy of metadata, used for filtered or subsetted operations.</span>
</span><span id="GroupAnalysis-3475"><a href="#GroupAnalysis-3475"><span class="linenos">3475</span></a>
</span><span id="GroupAnalysis-3476"><a href="#GroupAnalysis-3476"><span class="linenos">3476</span></a><span class="sd">    scaled_data : np.ndarray or None</span>
</span><span id="GroupAnalysis-3477"><a href="#GroupAnalysis-3477"><span class="linenos">3477</span></a><span class="sd">        Scaled version of the temporary dataset (`tmp_data`), updated after `data_scale()`.</span>
</span><span id="GroupAnalysis-3478"><a href="#GroupAnalysis-3478"><span class="linenos">3478</span></a>
</span><span id="GroupAnalysis-3479"><a href="#GroupAnalysis-3479"><span class="linenos">3479</span></a><span class="sd">    PCA_results : np.ndarray or None</span>
</span><span id="GroupAnalysis-3480"><a href="#GroupAnalysis-3480"><span class="linenos">3480</span></a><span class="sd">        Results of PCA transformation applied on scaled data.</span>
</span><span id="GroupAnalysis-3481"><a href="#GroupAnalysis-3481"><span class="linenos">3481</span></a>
</span><span id="GroupAnalysis-3482"><a href="#GroupAnalysis-3482"><span class="linenos">3482</span></a><span class="sd">    var_data : np.ndarray or None</span>
</span><span id="GroupAnalysis-3483"><a href="#GroupAnalysis-3483"><span class="linenos">3483</span></a><span class="sd">        Explained variance ratio from PCA.</span>
</span><span id="GroupAnalysis-3484"><a href="#GroupAnalysis-3484"><span class="linenos">3484</span></a>
</span><span id="GroupAnalysis-3485"><a href="#GroupAnalysis-3485"><span class="linenos">3485</span></a><span class="sd">    knee_plot : matplotlib.figure.Figure or None</span>
</span><span id="GroupAnalysis-3486"><a href="#GroupAnalysis-3486"><span class="linenos">3486</span></a><span class="sd">        Figure of cumulative explained variance for PCA components.</span>
</span><span id="GroupAnalysis-3487"><a href="#GroupAnalysis-3487"><span class="linenos">3487</span></a>
</span><span id="GroupAnalysis-3488"><a href="#GroupAnalysis-3488"><span class="linenos">3488</span></a><span class="sd">    UMAP_data : np.ndarray or None</span>
</span><span id="GroupAnalysis-3489"><a href="#GroupAnalysis-3489"><span class="linenos">3489</span></a><span class="sd">        Embedding results from UMAP dimensionality reduction.</span>
</span><span id="GroupAnalysis-3490"><a href="#GroupAnalysis-3490"><span class="linenos">3490</span></a>
</span><span id="GroupAnalysis-3491"><a href="#GroupAnalysis-3491"><span class="linenos">3491</span></a><span class="sd">    UMAP_plot : dict</span>
</span><span id="GroupAnalysis-3492"><a href="#GroupAnalysis-3492"><span class="linenos">3492</span></a><span class="sd">        Dictionary containing UMAP plots. Keys: &#39;static&#39; (matplotlib) and &#39;html&#39; (plotly).</span>
</span><span id="GroupAnalysis-3493"><a href="#GroupAnalysis-3493"><span class="linenos">3493</span></a>
</span><span id="GroupAnalysis-3494"><a href="#GroupAnalysis-3494"><span class="linenos">3494</span></a><span class="sd">    dblabels : list or None</span>
</span><span id="GroupAnalysis-3495"><a href="#GroupAnalysis-3495"><span class="linenos">3495</span></a><span class="sd">        Cluster labels assigned by DBSCAN after UMAP embedding.</span>
</span><span id="GroupAnalysis-3496"><a href="#GroupAnalysis-3496"><span class="linenos">3496</span></a>
</span><span id="GroupAnalysis-3497"><a href="#GroupAnalysis-3497"><span class="linenos">3497</span></a><span class="sd">    explained_variance_ratio : np.ndarray or None</span>
</span><span id="GroupAnalysis-3498"><a href="#GroupAnalysis-3498"><span class="linenos">3498</span></a><span class="sd">        Explained variance ratio of PCA components.</span>
</span><span id="GroupAnalysis-3499"><a href="#GroupAnalysis-3499"><span class="linenos">3499</span></a>
</span><span id="GroupAnalysis-3500"><a href="#GroupAnalysis-3500"><span class="linenos">3500</span></a><span class="sd">    DFA_results : pd.DataFrame or None</span>
</span><span id="GroupAnalysis-3501"><a href="#GroupAnalysis-3501"><span class="linenos">3501</span></a><span class="sd">        Results of Differential Feature Analysis (DFA).</span>
</span><span id="GroupAnalysis-3502"><a href="#GroupAnalysis-3502"><span class="linenos">3502</span></a>
</span><span id="GroupAnalysis-3503"><a href="#GroupAnalysis-3503"><span class="linenos">3503</span></a><span class="sd">    proportion_stats : pd.DataFrame or None</span>
</span><span id="GroupAnalysis-3504"><a href="#GroupAnalysis-3504"><span class="linenos">3504</span></a><span class="sd">        Statistics from proportion analysis.</span>
</span><span id="GroupAnalysis-3505"><a href="#GroupAnalysis-3505"><span class="linenos">3505</span></a>
</span><span id="GroupAnalysis-3506"><a href="#GroupAnalysis-3506"><span class="linenos">3506</span></a><span class="sd">    proportion_plot : matplotlib.figure.Figure or None</span>
</span><span id="GroupAnalysis-3507"><a href="#GroupAnalysis-3507"><span class="linenos">3507</span></a><span class="sd">        Figure of proportion analysis results.</span>
</span><span id="GroupAnalysis-3508"><a href="#GroupAnalysis-3508"><span class="linenos">3508</span></a>
</span><span id="GroupAnalysis-3509"><a href="#GroupAnalysis-3509"><span class="linenos">3509</span></a><span class="sd">    Methods</span>
</span><span id="GroupAnalysis-3510"><a href="#GroupAnalysis-3510"><span class="linenos">3510</span></a><span class="sd">    -------</span>
</span><span id="GroupAnalysis-3511"><a href="#GroupAnalysis-3511"><span class="linenos">3511</span></a><span class="sd">    resest_project():</span>
</span><span id="GroupAnalysis-3512"><a href="#GroupAnalysis-3512"><span class="linenos">3512</span></a><span class="sd">        Reset all temporary and analysis results to initial state.</span>
</span><span id="GroupAnalysis-3513"><a href="#GroupAnalysis-3513"><span class="linenos">3513</span></a>
</span><span id="GroupAnalysis-3514"><a href="#GroupAnalysis-3514"><span class="linenos">3514</span></a><span class="sd">    load_data(data, ids_col=&#39;id_name&#39;, set_col=&#39;set&#39;):</span>
</span><span id="GroupAnalysis-3515"><a href="#GroupAnalysis-3515"><span class="linenos">3515</span></a><span class="sd">        Class method to load data and metadata and initialize the object.</span>
</span><span id="GroupAnalysis-3516"><a href="#GroupAnalysis-3516"><span class="linenos">3516</span></a>
</span><span id="GroupAnalysis-3517"><a href="#GroupAnalysis-3517"><span class="linenos">3517</span></a><span class="sd">    groups:</span>
</span><span id="GroupAnalysis-3518"><a href="#GroupAnalysis-3518"><span class="linenos">3518</span></a><span class="sd">        Property returning available groups in the metadata.</span>
</span><span id="GroupAnalysis-3519"><a href="#GroupAnalysis-3519"><span class="linenos">3519</span></a>
</span><span id="GroupAnalysis-3520"><a href="#GroupAnalysis-3520"><span class="linenos">3520</span></a><span class="sd">    get_DFA(), get_PCA(), get_knee_plot(), get_var_data(), get_scaled_data():</span>
</span><span id="GroupAnalysis-3521"><a href="#GroupAnalysis-3521"><span class="linenos">3521</span></a><span class="sd">        Methods to retrieve previously computed results.</span>
</span><span id="GroupAnalysis-3522"><a href="#GroupAnalysis-3522"><span class="linenos">3522</span></a>
</span><span id="GroupAnalysis-3523"><a href="#GroupAnalysis-3523"><span class="linenos">3523</span></a><span class="sd">    UMAP(), db_scan(), UMAP_on_clusters():</span>
</span><span id="GroupAnalysis-3524"><a href="#GroupAnalysis-3524"><span class="linenos">3524</span></a><span class="sd">        Methods for dimensionality reduction and clustering visualization.</span>
</span><span id="GroupAnalysis-3525"><a href="#GroupAnalysis-3525"><span class="linenos">3525</span></a>
</span><span id="GroupAnalysis-3526"><a href="#GroupAnalysis-3526"><span class="linenos">3526</span></a><span class="sd">    DFA(meta_group_by=&#39;sets&#39;, sets={}, n_proc=5):</span>
</span><span id="GroupAnalysis-3527"><a href="#GroupAnalysis-3527"><span class="linenos">3527</span></a><span class="sd">        Perform Differential Feature Analysis.</span>
</span><span id="GroupAnalysis-3528"><a href="#GroupAnalysis-3528"><span class="linenos">3528</span></a>
</span><span id="GroupAnalysis-3529"><a href="#GroupAnalysis-3529"><span class="linenos">3529</span></a><span class="sd">    proportion_analysis(grouping_col=&#39;sets&#39;, val_col=&#39;nuclei_per_img&#39;, ...):</span>
</span><span id="GroupAnalysis-3530"><a href="#GroupAnalysis-3530"><span class="linenos">3530</span></a><span class="sd">        Perform and plot proportion analysis across groups.</span>
</span><span id="GroupAnalysis-3531"><a href="#GroupAnalysis-3531"><span class="linenos">3531</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3532"><a href="#GroupAnalysis-3532"><span class="linenos">3532</span></a>
</span><span id="GroupAnalysis-3533"><a href="#GroupAnalysis-3533"><span class="linenos">3533</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GroupAnalysis-3534"><a href="#GroupAnalysis-3534"><span class="linenos">3534</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis-3535"><a href="#GroupAnalysis-3535"><span class="linenos">3535</span></a>        <span class="n">input_data</span><span class="p">,</span>
</span><span id="GroupAnalysis-3536"><a href="#GroupAnalysis-3536"><span class="linenos">3536</span></a>        <span class="n">input_metadata</span><span class="p">,</span>
</span><span id="GroupAnalysis-3537"><a href="#GroupAnalysis-3537"><span class="linenos">3537</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis-3538"><a href="#GroupAnalysis-3538"><span class="linenos">3538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3539"><a href="#GroupAnalysis-3539"><span class="linenos">3539</span></a><span class="sd">        Initialize a GroupAnalysis instance with data and metadata.</span>
</span><span id="GroupAnalysis-3540"><a href="#GroupAnalysis-3540"><span class="linenos">3540</span></a>
</span><span id="GroupAnalysis-3541"><a href="#GroupAnalysis-3541"><span class="linenos">3541</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-3542"><a href="#GroupAnalysis-3542"><span class="linenos">3542</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-3543"><a href="#GroupAnalysis-3543"><span class="linenos">3543</span></a><span class="sd">        input_data : pd.DataFrame</span>
</span><span id="GroupAnalysis-3544"><a href="#GroupAnalysis-3544"><span class="linenos">3544</span></a><span class="sd">            Dataset containing features for analysis. Rows represent samples and columns represent features.</span>
</span><span id="GroupAnalysis-3545"><a href="#GroupAnalysis-3545"><span class="linenos">3545</span></a>
</span><span id="GroupAnalysis-3546"><a href="#GroupAnalysis-3546"><span class="linenos">3546</span></a><span class="sd">        input_metadata : pd.DataFrame</span>
</span><span id="GroupAnalysis-3547"><a href="#GroupAnalysis-3547"><span class="linenos">3547</span></a><span class="sd">            Metadata corresponding to `input_data`, including sample identifiers and group labels.</span>
</span><span id="GroupAnalysis-3548"><a href="#GroupAnalysis-3548"><span class="linenos">3548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3549"><a href="#GroupAnalysis-3549"><span class="linenos">3549</span></a>
</span><span id="GroupAnalysis-3550"><a href="#GroupAnalysis-3550"><span class="linenos">3550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="GroupAnalysis-3551"><a href="#GroupAnalysis-3551"><span class="linenos">3551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored input dataset for analysis.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3552"><a href="#GroupAnalysis-3552"><span class="linenos">3552</span></a>
</span><span id="GroupAnalysis-3553"><a href="#GroupAnalysis-3553"><span class="linenos">3553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="GroupAnalysis-3554"><a href="#GroupAnalysis-3554"><span class="linenos">3554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored metadata associated with `input_data`.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3555"><a href="#GroupAnalysis-3555"><span class="linenos">3555</span></a>
</span><span id="GroupAnalysis-3556"><a href="#GroupAnalysis-3556"><span class="linenos">3556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="GroupAnalysis-3557"><a href="#GroupAnalysis-3557"><span class="linenos">3557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_data` used for filtering, selection, or scaling.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3558"><a href="#GroupAnalysis-3558"><span class="linenos">3558</span></a>
</span><span id="GroupAnalysis-3559"><a href="#GroupAnalysis-3559"><span class="linenos">3559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="GroupAnalysis-3560"><a href="#GroupAnalysis-3560"><span class="linenos">3560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_metadata` used for filtered operations.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3561"><a href="#GroupAnalysis-3561"><span class="linenos">3561</span></a>
</span><span id="GroupAnalysis-3562"><a href="#GroupAnalysis-3562"><span class="linenos">3562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3563"><a href="#GroupAnalysis-3563"><span class="linenos">3563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored scaled version of `tmp_data` after normalization or standardization.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3564"><a href="#GroupAnalysis-3564"><span class="linenos">3564</span></a>
</span><span id="GroupAnalysis-3565"><a href="#GroupAnalysis-3565"><span class="linenos">3565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3566"><a href="#GroupAnalysis-3566"><span class="linenos">3566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Stored results of PCA transformation applied on `scaled_data`.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3567"><a href="#GroupAnalysis-3567"><span class="linenos">3567</span></a>
</span><span id="GroupAnalysis-3568"><a href="#GroupAnalysis-3568"><span class="linenos">3568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3569"><a href="#GroupAnalysis-3569"><span class="linenos">3569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotred explained variance ratio for PCA components.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3570"><a href="#GroupAnalysis-3570"><span class="linenos">3570</span></a>
</span><span id="GroupAnalysis-3571"><a href="#GroupAnalysis-3571"><span class="linenos">3571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3572"><a href="#GroupAnalysis-3572"><span class="linenos">3572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure showing cumulative explained variance for PCA.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3573"><a href="#GroupAnalysis-3573"><span class="linenos">3573</span></a>
</span><span id="GroupAnalysis-3574"><a href="#GroupAnalysis-3574"><span class="linenos">3574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3575"><a href="#GroupAnalysis-3575"><span class="linenos">3575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored embedding coordinates from UMAP dimensionality reduction.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3576"><a href="#GroupAnalysis-3576"><span class="linenos">3576</span></a>
</span><span id="GroupAnalysis-3577"><a href="#GroupAnalysis-3577"><span class="linenos">3577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="GroupAnalysis-3578"><a href="#GroupAnalysis-3578"><span class="linenos">3578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary containing UMAP plots: &#39;static&#39; (matplotlib) and &#39;html&#39; (plotly).&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3579"><a href="#GroupAnalysis-3579"><span class="linenos">3579</span></a>
</span><span id="GroupAnalysis-3580"><a href="#GroupAnalysis-3580"><span class="linenos">3580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3581"><a href="#GroupAnalysis-3581"><span class="linenos">3581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored cluster labels assigned by DBSCAN after UMAP embedding.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3582"><a href="#GroupAnalysis-3582"><span class="linenos">3582</span></a>
</span><span id="GroupAnalysis-3583"><a href="#GroupAnalysis-3583"><span class="linenos">3583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3584"><a href="#GroupAnalysis-3584"><span class="linenos">3584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored explained variance ratio of PCA components.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3585"><a href="#GroupAnalysis-3585"><span class="linenos">3585</span></a>
</span><span id="GroupAnalysis-3586"><a href="#GroupAnalysis-3586"><span class="linenos">3586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3587"><a href="#GroupAnalysis-3587"><span class="linenos">3587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored Differential Feature Analysis (DFA) results.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3588"><a href="#GroupAnalysis-3588"><span class="linenos">3588</span></a>
</span><span id="GroupAnalysis-3589"><a href="#GroupAnalysis-3589"><span class="linenos">3589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3590"><a href="#GroupAnalysis-3590"><span class="linenos">3590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored statistics from proportion analysis of groups.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3591"><a href="#GroupAnalysis-3591"><span class="linenos">3591</span></a>
</span><span id="GroupAnalysis-3592"><a href="#GroupAnalysis-3592"><span class="linenos">3592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3593"><a href="#GroupAnalysis-3593"><span class="linenos">3593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure visualizing proportion analysis results.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3594"><a href="#GroupAnalysis-3594"><span class="linenos">3594</span></a>
</span><span id="GroupAnalysis-3595"><a href="#GroupAnalysis-3595"><span class="linenos">3595</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resest_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3596"><a href="#GroupAnalysis-3596"><span class="linenos">3596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3597"><a href="#GroupAnalysis-3597"><span class="linenos">3597</span></a><span class="sd">        Resets the project state by clearing or reinitializing various attributes.</span>
</span><span id="GroupAnalysis-3598"><a href="#GroupAnalysis-3598"><span class="linenos">3598</span></a>
</span><span id="GroupAnalysis-3599"><a href="#GroupAnalysis-3599"><span class="linenos">3599</span></a><span class="sd">        This method resets the following attributes to initial values:</span>
</span><span id="GroupAnalysis-3600"><a href="#GroupAnalysis-3600"><span class="linenos">3600</span></a><span class="sd">        - `tmp_metadata`</span>
</span><span id="GroupAnalysis-3601"><a href="#GroupAnalysis-3601"><span class="linenos">3601</span></a><span class="sd">        - `tmp_data`</span>
</span><span id="GroupAnalysis-3602"><a href="#GroupAnalysis-3602"><span class="linenos">3602</span></a><span class="sd">        - `scaled_data`</span>
</span><span id="GroupAnalysis-3603"><a href="#GroupAnalysis-3603"><span class="linenos">3603</span></a><span class="sd">        - `PCA_results`</span>
</span><span id="GroupAnalysis-3604"><a href="#GroupAnalysis-3604"><span class="linenos">3604</span></a><span class="sd">        - `var_data`</span>
</span><span id="GroupAnalysis-3605"><a href="#GroupAnalysis-3605"><span class="linenos">3605</span></a><span class="sd">        - `knee_plot`</span>
</span><span id="GroupAnalysis-3606"><a href="#GroupAnalysis-3606"><span class="linenos">3606</span></a><span class="sd">        - `UMAP_data`</span>
</span><span id="GroupAnalysis-3607"><a href="#GroupAnalysis-3607"><span class="linenos">3607</span></a><span class="sd">        - `UMAP_plot`</span>
</span><span id="GroupAnalysis-3608"><a href="#GroupAnalysis-3608"><span class="linenos">3608</span></a><span class="sd">        - `dblabels`</span>
</span><span id="GroupAnalysis-3609"><a href="#GroupAnalysis-3609"><span class="linenos">3609</span></a><span class="sd">        - `explained_variance_ratio`</span>
</span><span id="GroupAnalysis-3610"><a href="#GroupAnalysis-3610"><span class="linenos">3610</span></a><span class="sd">        - `DFA_results`</span>
</span><span id="GroupAnalysis-3611"><a href="#GroupAnalysis-3611"><span class="linenos">3611</span></a>
</span><span id="GroupAnalysis-3612"><a href="#GroupAnalysis-3612"><span class="linenos">3612</span></a><span class="sd">        This method is typically called to reinitialize the project data and results, preparing the system for new computations or project resets.</span>
</span><span id="GroupAnalysis-3613"><a href="#GroupAnalysis-3613"><span class="linenos">3613</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3614"><a href="#GroupAnalysis-3614"><span class="linenos">3614</span></a>
</span><span id="GroupAnalysis-3615"><a href="#GroupAnalysis-3615"><span class="linenos">3615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span>
</span><span id="GroupAnalysis-3616"><a href="#GroupAnalysis-3616"><span class="linenos">3616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span>
</span><span id="GroupAnalysis-3617"><a href="#GroupAnalysis-3617"><span class="linenos">3617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3618"><a href="#GroupAnalysis-3618"><span class="linenos">3618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3619"><a href="#GroupAnalysis-3619"><span class="linenos">3619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3620"><a href="#GroupAnalysis-3620"><span class="linenos">3620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3621"><a href="#GroupAnalysis-3621"><span class="linenos">3621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3622"><a href="#GroupAnalysis-3622"><span class="linenos">3622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="GroupAnalysis-3623"><a href="#GroupAnalysis-3623"><span class="linenos">3623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3624"><a href="#GroupAnalysis-3624"><span class="linenos">3624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3625"><a href="#GroupAnalysis-3625"><span class="linenos">3625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3626"><a href="#GroupAnalysis-3626"><span class="linenos">3626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3627"><a href="#GroupAnalysis-3627"><span class="linenos">3627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis-3628"><a href="#GroupAnalysis-3628"><span class="linenos">3628</span></a>
</span><span id="GroupAnalysis-3629"><a href="#GroupAnalysis-3629"><span class="linenos">3629</span></a>    <span class="nd">@classmethod</span>
</span><span id="GroupAnalysis-3630"><a href="#GroupAnalysis-3630"><span class="linenos">3630</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ids_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id_name&quot;</span><span class="p">,</span> <span class="n">set_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;set&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis-3631"><a href="#GroupAnalysis-3631"><span class="linenos">3631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3632"><a href="#GroupAnalysis-3632"><span class="linenos">3632</span></a><span class="sd">        Load data and initialize the class by storing both the feature data and metadata.</span>
</span><span id="GroupAnalysis-3633"><a href="#GroupAnalysis-3633"><span class="linenos">3633</span></a>
</span><span id="GroupAnalysis-3634"><a href="#GroupAnalysis-3634"><span class="linenos">3634</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-3635"><a href="#GroupAnalysis-3635"><span class="linenos">3635</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-3636"><a href="#GroupAnalysis-3636"><span class="linenos">3636</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="GroupAnalysis-3637"><a href="#GroupAnalysis-3637"><span class="linenos">3637</span></a><span class="sd">            Input dataset used for group analysis. Must contain both feature columns and</span>
</span><span id="GroupAnalysis-3638"><a href="#GroupAnalysis-3638"><span class="linenos">3638</span></a><span class="sd">            metadata columns specified by `ids_col` and `set_col`.</span>
</span><span id="GroupAnalysis-3639"><a href="#GroupAnalysis-3639"><span class="linenos">3639</span></a>
</span><span id="GroupAnalysis-3640"><a href="#GroupAnalysis-3640"><span class="linenos">3640</span></a><span class="sd">        ids_col : str, optional</span>
</span><span id="GroupAnalysis-3641"><a href="#GroupAnalysis-3641"><span class="linenos">3641</span></a><span class="sd">            Name of the column containing unique object identifiers.</span>
</span><span id="GroupAnalysis-3642"><a href="#GroupAnalysis-3642"><span class="linenos">3642</span></a><span class="sd">            Default is ``&#39;id_name&#39;``.</span>
</span><span id="GroupAnalysis-3643"><a href="#GroupAnalysis-3643"><span class="linenos">3643</span></a>
</span><span id="GroupAnalysis-3644"><a href="#GroupAnalysis-3644"><span class="linenos">3644</span></a><span class="sd">        set_col : str, optional</span>
</span><span id="GroupAnalysis-3645"><a href="#GroupAnalysis-3645"><span class="linenos">3645</span></a><span class="sd">            Name of the column specifying group or set assignment for each object.</span>
</span><span id="GroupAnalysis-3646"><a href="#GroupAnalysis-3646"><span class="linenos">3646</span></a><span class="sd">            Default is ``&#39;set&#39;``.</span>
</span><span id="GroupAnalysis-3647"><a href="#GroupAnalysis-3647"><span class="linenos">3647</span></a>
</span><span id="GroupAnalysis-3648"><a href="#GroupAnalysis-3648"><span class="linenos">3648</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-3649"><a href="#GroupAnalysis-3649"><span class="linenos">3649</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-3650"><a href="#GroupAnalysis-3650"><span class="linenos">3650</span></a><span class="sd">        This method performs in-place initialization of the class and does not return</span>
</span><span id="GroupAnalysis-3651"><a href="#GroupAnalysis-3651"><span class="linenos">3651</span></a><span class="sd">        a separate object. All loaded data and metadata become available through the</span>
</span><span id="GroupAnalysis-3652"><a href="#GroupAnalysis-3652"><span class="linenos">3652</span></a><span class="sd">        class attributes for downstream analysis.</span>
</span><span id="GroupAnalysis-3653"><a href="#GroupAnalysis-3653"><span class="linenos">3653</span></a>
</span><span id="GroupAnalysis-3654"><a href="#GroupAnalysis-3654"><span class="linenos">3654</span></a><span class="sd">        This method updates internal class attributes:</span>
</span><span id="GroupAnalysis-3655"><a href="#GroupAnalysis-3655"><span class="linenos">3655</span></a>
</span><span id="GroupAnalysis-3656"><a href="#GroupAnalysis-3656"><span class="linenos">3656</span></a><span class="sd">        - **input_data** : pd.DataFrame</span>
</span><span id="GroupAnalysis-3657"><a href="#GroupAnalysis-3657"><span class="linenos">3657</span></a><span class="sd">          Cleaned feature table with index set to object IDs.</span>
</span><span id="GroupAnalysis-3658"><a href="#GroupAnalysis-3658"><span class="linenos">3658</span></a>
</span><span id="GroupAnalysis-3659"><a href="#GroupAnalysis-3659"><span class="linenos">3659</span></a><span class="sd">        - **tmp_data** : pd.DataFrame</span>
</span><span id="GroupAnalysis-3660"><a href="#GroupAnalysis-3660"><span class="linenos">3660</span></a><span class="sd">          Copy of `input_data` used for temporary operations.</span>
</span><span id="GroupAnalysis-3661"><a href="#GroupAnalysis-3661"><span class="linenos">3661</span></a>
</span><span id="GroupAnalysis-3662"><a href="#GroupAnalysis-3662"><span class="linenos">3662</span></a><span class="sd">        - **input_metadata** : pd.DataFrame</span>
</span><span id="GroupAnalysis-3663"><a href="#GroupAnalysis-3663"><span class="linenos">3663</span></a><span class="sd">          Metadata containing object IDs and group assignments.</span>
</span><span id="GroupAnalysis-3664"><a href="#GroupAnalysis-3664"><span class="linenos">3664</span></a>
</span><span id="GroupAnalysis-3665"><a href="#GroupAnalysis-3665"><span class="linenos">3665</span></a><span class="sd">        - **tmp_metadata** : pd.DataFrame</span>
</span><span id="GroupAnalysis-3666"><a href="#GroupAnalysis-3666"><span class="linenos">3666</span></a><span class="sd">          Copy of `input_metadata` for temporary operations.</span>
</span><span id="GroupAnalysis-3667"><a href="#GroupAnalysis-3667"><span class="linenos">3667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3668"><a href="#GroupAnalysis-3668"><span class="linenos">3668</span></a>
</span><span id="GroupAnalysis-3669"><a href="#GroupAnalysis-3669"><span class="linenos">3669</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="GroupAnalysis-3670"><a href="#GroupAnalysis-3670"><span class="linenos">3670</span></a>
</span><span id="GroupAnalysis-3671"><a href="#GroupAnalysis-3671"><span class="linenos">3671</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GroupAnalysis-3672"><a href="#GroupAnalysis-3672"><span class="linenos">3672</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="GroupAnalysis-3673"><a href="#GroupAnalysis-3673"><span class="linenos">3673</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">set_col</span><span class="p">]</span>
</span><span id="GroupAnalysis-3674"><a href="#GroupAnalysis-3674"><span class="linenos">3674</span></a>
</span><span id="GroupAnalysis-3675"><a href="#GroupAnalysis-3675"><span class="linenos">3675</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="GroupAnalysis-3676"><a href="#GroupAnalysis-3676"><span class="linenos">3676</span></a>
</span><span id="GroupAnalysis-3677"><a href="#GroupAnalysis-3677"><span class="linenos">3677</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3678"><a href="#GroupAnalysis-3678"><span class="linenos">3678</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;id_name&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3679"><a href="#GroupAnalysis-3679"><span class="linenos">3679</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3680"><a href="#GroupAnalysis-3680"><span class="linenos">3680</span></a>            <span class="kc">None</span>
</span><span id="GroupAnalysis-3681"><a href="#GroupAnalysis-3681"><span class="linenos">3681</span></a>
</span><span id="GroupAnalysis-3682"><a href="#GroupAnalysis-3682"><span class="linenos">3682</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3683"><a href="#GroupAnalysis-3683"><span class="linenos">3683</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Object Number&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3684"><a href="#GroupAnalysis-3684"><span class="linenos">3684</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3685"><a href="#GroupAnalysis-3685"><span class="linenos">3685</span></a>            <span class="kc">None</span>
</span><span id="GroupAnalysis-3686"><a href="#GroupAnalysis-3686"><span class="linenos">3686</span></a>
</span><span id="GroupAnalysis-3687"><a href="#GroupAnalysis-3687"><span class="linenos">3687</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span><span id="GroupAnalysis-3688"><a href="#GroupAnalysis-3688"><span class="linenos">3688</span></a>
</span><span id="GroupAnalysis-3689"><a href="#GroupAnalysis-3689"><span class="linenos">3689</span></a>    <span class="nd">@property</span>
</span><span id="GroupAnalysis-3690"><a href="#GroupAnalysis-3690"><span class="linenos">3690</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3691"><a href="#GroupAnalysis-3691"><span class="linenos">3691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3692"><a href="#GroupAnalysis-3692"><span class="linenos">3692</span></a><span class="sd">        Return information about available groups in the metadata for ``self.DFA``.</span>
</span><span id="GroupAnalysis-3693"><a href="#GroupAnalysis-3693"><span class="linenos">3693</span></a>
</span><span id="GroupAnalysis-3694"><a href="#GroupAnalysis-3694"><span class="linenos">3694</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3695"><a href="#GroupAnalysis-3695"><span class="linenos">3695</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3696"><a href="#GroupAnalysis-3696"><span class="linenos">3696</span></a><span class="sd">        dict</span>
</span><span id="GroupAnalysis-3697"><a href="#GroupAnalysis-3697"><span class="linenos">3697</span></a><span class="sd">            Dictionary mapping each metadata column name to a list of unique groups</span>
</span><span id="GroupAnalysis-3698"><a href="#GroupAnalysis-3698"><span class="linenos">3698</span></a><span class="sd">            available in that column.</span>
</span><span id="GroupAnalysis-3699"><a href="#GroupAnalysis-3699"><span class="linenos">3699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3700"><a href="#GroupAnalysis-3700"><span class="linenos">3700</span></a>
</span><span id="GroupAnalysis-3701"><a href="#GroupAnalysis-3701"><span class="linenos">3701</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3702"><a href="#GroupAnalysis-3702"><span class="linenos">3702</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GroupAnalysis-3703"><a href="#GroupAnalysis-3703"><span class="linenos">3703</span></a>                <span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]),</span>
</span><span id="GroupAnalysis-3704"><a href="#GroupAnalysis-3704"><span class="linenos">3704</span></a>                <span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]),</span>
</span><span id="GroupAnalysis-3705"><a href="#GroupAnalysis-3705"><span class="linenos">3705</span></a>            <span class="p">}</span>
</span><span id="GroupAnalysis-3706"><a href="#GroupAnalysis-3706"><span class="linenos">3706</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3707"><a href="#GroupAnalysis-3707"><span class="linenos">3707</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])}</span>
</span><span id="GroupAnalysis-3708"><a href="#GroupAnalysis-3708"><span class="linenos">3708</span></a>
</span><span id="GroupAnalysis-3709"><a href="#GroupAnalysis-3709"><span class="linenos">3709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3710"><a href="#GroupAnalysis-3710"><span class="linenos">3710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3711"><a href="#GroupAnalysis-3711"><span class="linenos">3711</span></a><span class="sd">        Retrieve the DFA results produced by the ``DFA()`` method.</span>
</span><span id="GroupAnalysis-3712"><a href="#GroupAnalysis-3712"><span class="linenos">3712</span></a>
</span><span id="GroupAnalysis-3713"><a href="#GroupAnalysis-3713"><span class="linenos">3713</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3714"><a href="#GroupAnalysis-3714"><span class="linenos">3714</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3715"><a href="#GroupAnalysis-3715"><span class="linenos">3715</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="GroupAnalysis-3716"><a href="#GroupAnalysis-3716"><span class="linenos">3716</span></a><span class="sd">            The DFA results stored in ``self.DFA_results``.</span>
</span><span id="GroupAnalysis-3717"><a href="#GroupAnalysis-3717"><span class="linenos">3717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3718"><a href="#GroupAnalysis-3718"><span class="linenos">3718</span></a>
</span><span id="GroupAnalysis-3719"><a href="#GroupAnalysis-3719"><span class="linenos">3719</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis-3720"><a href="#GroupAnalysis-3720"><span class="linenos">3720</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3721"><a href="#GroupAnalysis-3721"><span class="linenos">3721</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3722"><a href="#GroupAnalysis-3722"><span class="linenos">3722</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span>
</span><span id="GroupAnalysis-3723"><a href="#GroupAnalysis-3723"><span class="linenos">3723</span></a>
</span><span id="GroupAnalysis-3724"><a href="#GroupAnalysis-3724"><span class="linenos">3724</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3725"><a href="#GroupAnalysis-3725"><span class="linenos">3725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3726"><a href="#GroupAnalysis-3726"><span class="linenos">3726</span></a><span class="sd">        Retrieve the PCA results produced by the ``PCA()`` method.</span>
</span><span id="GroupAnalysis-3727"><a href="#GroupAnalysis-3727"><span class="linenos">3727</span></a>
</span><span id="GroupAnalysis-3728"><a href="#GroupAnalysis-3728"><span class="linenos">3728</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3729"><a href="#GroupAnalysis-3729"><span class="linenos">3729</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3730"><a href="#GroupAnalysis-3730"><span class="linenos">3730</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis-3731"><a href="#GroupAnalysis-3731"><span class="linenos">3731</span></a><span class="sd">            The PCA results stored in ``self.PCA_results``.</span>
</span><span id="GroupAnalysis-3732"><a href="#GroupAnalysis-3732"><span class="linenos">3732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3733"><a href="#GroupAnalysis-3733"><span class="linenos">3733</span></a>
</span><span id="GroupAnalysis-3734"><a href="#GroupAnalysis-3734"><span class="linenos">3734</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis-3735"><a href="#GroupAnalysis-3735"><span class="linenos">3735</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the PCA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3736"><a href="#GroupAnalysis-3736"><span class="linenos">3736</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3737"><a href="#GroupAnalysis-3737"><span class="linenos">3737</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span><span id="GroupAnalysis-3738"><a href="#GroupAnalysis-3738"><span class="linenos">3738</span></a>
</span><span id="GroupAnalysis-3739"><a href="#GroupAnalysis-3739"><span class="linenos">3739</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_knee_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis-3740"><a href="#GroupAnalysis-3740"><span class="linenos">3740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3741"><a href="#GroupAnalysis-3741"><span class="linenos">3741</span></a><span class="sd">        Retrieve the knee plot of cumulative explained variance generated by the ``var_plot()`` method.</span>
</span><span id="GroupAnalysis-3742"><a href="#GroupAnalysis-3742"><span class="linenos">3742</span></a>
</span><span id="GroupAnalysis-3743"><a href="#GroupAnalysis-3743"><span class="linenos">3743</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-3744"><a href="#GroupAnalysis-3744"><span class="linenos">3744</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-3745"><a href="#GroupAnalysis-3745"><span class="linenos">3745</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis-3746"><a href="#GroupAnalysis-3746"><span class="linenos">3746</span></a><span class="sd">            If ``True`` (default), the knee plot is displayed.</span>
</span><span id="GroupAnalysis-3747"><a href="#GroupAnalysis-3747"><span class="linenos">3747</span></a>
</span><span id="GroupAnalysis-3748"><a href="#GroupAnalysis-3748"><span class="linenos">3748</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3749"><a href="#GroupAnalysis-3749"><span class="linenos">3749</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3750"><a href="#GroupAnalysis-3750"><span class="linenos">3750</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis-3751"><a href="#GroupAnalysis-3751"><span class="linenos">3751</span></a><span class="sd">            The figure object containing the knee plot.</span>
</span><span id="GroupAnalysis-3752"><a href="#GroupAnalysis-3752"><span class="linenos">3752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3753"><a href="#GroupAnalysis-3753"><span class="linenos">3753</span></a>
</span><span id="GroupAnalysis-3754"><a href="#GroupAnalysis-3754"><span class="linenos">3754</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis-3755"><a href="#GroupAnalysis-3755"><span class="linenos">3755</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3756"><a href="#GroupAnalysis-3756"><span class="linenos">3756</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3757"><a href="#GroupAnalysis-3757"><span class="linenos">3757</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-3758"><a href="#GroupAnalysis-3758"><span class="linenos">3758</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GroupAnalysis-3759"><a href="#GroupAnalysis-3759"><span class="linenos">3759</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span><span id="GroupAnalysis-3760"><a href="#GroupAnalysis-3760"><span class="linenos">3760</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3761"><a href="#GroupAnalysis-3761"><span class="linenos">3761</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis-3762"><a href="#GroupAnalysis-3762"><span class="linenos">3762</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3763"><a href="#GroupAnalysis-3763"><span class="linenos">3763</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis-3764"><a href="#GroupAnalysis-3764"><span class="linenos">3764</span></a>
</span><span id="GroupAnalysis-3765"><a href="#GroupAnalysis-3765"><span class="linenos">3765</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span><span id="GroupAnalysis-3766"><a href="#GroupAnalysis-3766"><span class="linenos">3766</span></a>
</span><span id="GroupAnalysis-3767"><a href="#GroupAnalysis-3767"><span class="linenos">3767</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_var_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3768"><a href="#GroupAnalysis-3768"><span class="linenos">3768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3769"><a href="#GroupAnalysis-3769"><span class="linenos">3769</span></a><span class="sd">        Retrieve the explained variance data from the ``var_plot()`` method.</span>
</span><span id="GroupAnalysis-3770"><a href="#GroupAnalysis-3770"><span class="linenos">3770</span></a>
</span><span id="GroupAnalysis-3771"><a href="#GroupAnalysis-3771"><span class="linenos">3771</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3772"><a href="#GroupAnalysis-3772"><span class="linenos">3772</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3773"><a href="#GroupAnalysis-3773"><span class="linenos">3773</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis-3774"><a href="#GroupAnalysis-3774"><span class="linenos">3774</span></a><span class="sd">            Array containing the explained variance values stored in ``self.var_data``.</span>
</span><span id="GroupAnalysis-3775"><a href="#GroupAnalysis-3775"><span class="linenos">3775</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3776"><a href="#GroupAnalysis-3776"><span class="linenos">3776</span></a>
</span><span id="GroupAnalysis-3777"><a href="#GroupAnalysis-3777"><span class="linenos">3777</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-3778"><a href="#GroupAnalysis-3778"><span class="linenos">3778</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3779"><a href="#GroupAnalysis-3779"><span class="linenos">3779</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3780"><a href="#GroupAnalysis-3780"><span class="linenos">3780</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span>
</span><span id="GroupAnalysis-3781"><a href="#GroupAnalysis-3781"><span class="linenos">3781</span></a>
</span><span id="GroupAnalysis-3782"><a href="#GroupAnalysis-3782"><span class="linenos">3782</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_scaled_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3783"><a href="#GroupAnalysis-3783"><span class="linenos">3783</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3784"><a href="#GroupAnalysis-3784"><span class="linenos">3784</span></a><span class="sd">        Retrieve the scaled data produced by the ``data_scale()`` method.</span>
</span><span id="GroupAnalysis-3785"><a href="#GroupAnalysis-3785"><span class="linenos">3785</span></a>
</span><span id="GroupAnalysis-3786"><a href="#GroupAnalysis-3786"><span class="linenos">3786</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3787"><a href="#GroupAnalysis-3787"><span class="linenos">3787</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3788"><a href="#GroupAnalysis-3788"><span class="linenos">3788</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis-3789"><a href="#GroupAnalysis-3789"><span class="linenos">3789</span></a><span class="sd">            Scaled data stored in ``self.scaled_data``.</span>
</span><span id="GroupAnalysis-3790"><a href="#GroupAnalysis-3790"><span class="linenos">3790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3791"><a href="#GroupAnalysis-3791"><span class="linenos">3791</span></a>
</span><span id="GroupAnalysis-3792"><a href="#GroupAnalysis-3792"><span class="linenos">3792</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-3793"><a href="#GroupAnalysis-3793"><span class="linenos">3793</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the data_scale() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3794"><a href="#GroupAnalysis-3794"><span class="linenos">3794</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3795"><a href="#GroupAnalysis-3795"><span class="linenos">3795</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span>
</span><span id="GroupAnalysis-3796"><a href="#GroupAnalysis-3796"><span class="linenos">3796</span></a>
</span><span id="GroupAnalysis-3797"><a href="#GroupAnalysis-3797"><span class="linenos">3797</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3798"><a href="#GroupAnalysis-3798"><span class="linenos">3798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3799"><a href="#GroupAnalysis-3799"><span class="linenos">3799</span></a><span class="sd">        Retrieve the UMAP-transformed data generated by the ``UMAP()`` method.</span>
</span><span id="GroupAnalysis-3800"><a href="#GroupAnalysis-3800"><span class="linenos">3800</span></a>
</span><span id="GroupAnalysis-3801"><a href="#GroupAnalysis-3801"><span class="linenos">3801</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3802"><a href="#GroupAnalysis-3802"><span class="linenos">3802</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3803"><a href="#GroupAnalysis-3803"><span class="linenos">3803</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis-3804"><a href="#GroupAnalysis-3804"><span class="linenos">3804</span></a><span class="sd">            UMAP-embedded data stored in ``self.UMAP_data``.</span>
</span><span id="GroupAnalysis-3805"><a href="#GroupAnalysis-3805"><span class="linenos">3805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3806"><a href="#GroupAnalysis-3806"><span class="linenos">3806</span></a>
</span><span id="GroupAnalysis-3807"><a href="#GroupAnalysis-3807"><span class="linenos">3807</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-3808"><a href="#GroupAnalysis-3808"><span class="linenos">3808</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3809"><a href="#GroupAnalysis-3809"><span class="linenos">3809</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3810"><a href="#GroupAnalysis-3810"><span class="linenos">3810</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span>
</span><span id="GroupAnalysis-3811"><a href="#GroupAnalysis-3811"><span class="linenos">3811</span></a>
</span><span id="GroupAnalysis-3812"><a href="#GroupAnalysis-3812"><span class="linenos">3812</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis-3813"><a href="#GroupAnalysis-3813"><span class="linenos">3813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3814"><a href="#GroupAnalysis-3814"><span class="linenos">3814</span></a><span class="sd">        Retrieve UMAP plots generated by the ``UMAP()`` and/or ``UMAP_on_clusters()`` methods.</span>
</span><span id="GroupAnalysis-3815"><a href="#GroupAnalysis-3815"><span class="linenos">3815</span></a>
</span><span id="GroupAnalysis-3816"><a href="#GroupAnalysis-3816"><span class="linenos">3816</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-3817"><a href="#GroupAnalysis-3817"><span class="linenos">3817</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-3818"><a href="#GroupAnalysis-3818"><span class="linenos">3818</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis-3819"><a href="#GroupAnalysis-3819"><span class="linenos">3819</span></a><span class="sd">            Whether to display the UMAP plots. Default is True.</span>
</span><span id="GroupAnalysis-3820"><a href="#GroupAnalysis-3820"><span class="linenos">3820</span></a>
</span><span id="GroupAnalysis-3821"><a href="#GroupAnalysis-3821"><span class="linenos">3821</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-3822"><a href="#GroupAnalysis-3822"><span class="linenos">3822</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-3823"><a href="#GroupAnalysis-3823"><span class="linenos">3823</span></a><span class="sd">        dict of matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis-3824"><a href="#GroupAnalysis-3824"><span class="linenos">3824</span></a><span class="sd">            A dictionary containing the UMAP plots. Keys correspond to plot names, and values are the figure objects.</span>
</span><span id="GroupAnalysis-3825"><a href="#GroupAnalysis-3825"><span class="linenos">3825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3826"><a href="#GroupAnalysis-3826"><span class="linenos">3826</span></a>
</span><span id="GroupAnalysis-3827"><a href="#GroupAnalysis-3827"><span class="linenos">3827</span></a>        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="GroupAnalysis-3828"><a href="#GroupAnalysis-3828"><span class="linenos">3828</span></a>
</span><span id="GroupAnalysis-3829"><a href="#GroupAnalysis-3829"><span class="linenos">3829</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GroupAnalysis-3830"><a href="#GroupAnalysis-3830"><span class="linenos">3830</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-3831"><a href="#GroupAnalysis-3831"><span class="linenos">3831</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="GroupAnalysis-3832"><a href="#GroupAnalysis-3832"><span class="linenos">3832</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis-3833"><a href="#GroupAnalysis-3833"><span class="linenos">3833</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3834"><a href="#GroupAnalysis-3834"><span class="linenos">3834</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-3835"><a href="#GroupAnalysis-3835"><span class="linenos">3835</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis-3836"><a href="#GroupAnalysis-3836"><span class="linenos">3836</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis-3837"><a href="#GroupAnalysis-3837"><span class="linenos">3837</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="GroupAnalysis-3838"><a href="#GroupAnalysis-3838"><span class="linenos">3838</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3839"><a href="#GroupAnalysis-3839"><span class="linenos">3839</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="GroupAnalysis-3840"><a href="#GroupAnalysis-3840"><span class="linenos">3840</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3841"><a href="#GroupAnalysis-3841"><span class="linenos">3841</span></a>                                <span class="kc">None</span>
</span><span id="GroupAnalysis-3842"><a href="#GroupAnalysis-3842"><span class="linenos">3842</span></a>
</span><span id="GroupAnalysis-3843"><a href="#GroupAnalysis-3843"><span class="linenos">3843</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-3844"><a href="#GroupAnalysis-3844"><span class="linenos">3844</span></a>
</span><span id="GroupAnalysis-3845"><a href="#GroupAnalysis-3845"><span class="linenos">3845</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3846"><a href="#GroupAnalysis-3846"><span class="linenos">3846</span></a>
</span><span id="GroupAnalysis-3847"><a href="#GroupAnalysis-3847"><span class="linenos">3847</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GroupAnalysis-3848"><a href="#GroupAnalysis-3848"><span class="linenos">3848</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-3849"><a href="#GroupAnalysis-3849"><span class="linenos">3849</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="GroupAnalysis-3850"><a href="#GroupAnalysis-3850"><span class="linenos">3850</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis-3851"><a href="#GroupAnalysis-3851"><span class="linenos">3851</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3852"><a href="#GroupAnalysis-3852"><span class="linenos">3852</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-3853"><a href="#GroupAnalysis-3853"><span class="linenos">3853</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis-3854"><a href="#GroupAnalysis-3854"><span class="linenos">3854</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis-3855"><a href="#GroupAnalysis-3855"><span class="linenos">3855</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="GroupAnalysis-3856"><a href="#GroupAnalysis-3856"><span class="linenos">3856</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-3857"><a href="#GroupAnalysis-3857"><span class="linenos">3857</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="GroupAnalysis-3858"><a href="#GroupAnalysis-3858"><span class="linenos">3858</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-3859"><a href="#GroupAnalysis-3859"><span class="linenos">3859</span></a>                                <span class="kc">None</span>
</span><span id="GroupAnalysis-3860"><a href="#GroupAnalysis-3860"><span class="linenos">3860</span></a>
</span><span id="GroupAnalysis-3861"><a href="#GroupAnalysis-3861"><span class="linenos">3861</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-3862"><a href="#GroupAnalysis-3862"><span class="linenos">3862</span></a>
</span><span id="GroupAnalysis-3863"><a href="#GroupAnalysis-3863"><span class="linenos">3863</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="GroupAnalysis-3864"><a href="#GroupAnalysis-3864"><span class="linenos">3864</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3865"><a href="#GroupAnalysis-3865"><span class="linenos">3865</span></a><span class="sd">        Select specific features (columns) from the dataset for further analysis.</span>
</span><span id="GroupAnalysis-3866"><a href="#GroupAnalysis-3866"><span class="linenos">3866</span></a>
</span><span id="GroupAnalysis-3867"><a href="#GroupAnalysis-3867"><span class="linenos">3867</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-3868"><a href="#GroupAnalysis-3868"><span class="linenos">3868</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-3869"><a href="#GroupAnalysis-3869"><span class="linenos">3869</span></a><span class="sd">        features_list : list of str, optional</span>
</span><span id="GroupAnalysis-3870"><a href="#GroupAnalysis-3870"><span class="linenos">3870</span></a><span class="sd">            List of feature names (column names) to select from the dataset. Default is an empty list, which selects no features.</span>
</span><span id="GroupAnalysis-3871"><a href="#GroupAnalysis-3871"><span class="linenos">3871</span></a>
</span><span id="GroupAnalysis-3872"><a href="#GroupAnalysis-3872"><span class="linenos">3872</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-3873"><a href="#GroupAnalysis-3873"><span class="linenos">3873</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-3874"><a href="#GroupAnalysis-3874"><span class="linenos">3874</span></a><span class="sd">        Modifies the `self.tmp_data` attribute to contain only the selected features from `self.input_data`.</span>
</span><span id="GroupAnalysis-3875"><a href="#GroupAnalysis-3875"><span class="linenos">3875</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3876"><a href="#GroupAnalysis-3876"><span class="linenos">3876</span></a>
</span><span id="GroupAnalysis-3877"><a href="#GroupAnalysis-3877"><span class="linenos">3877</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-3878"><a href="#GroupAnalysis-3878"><span class="linenos">3878</span></a>
</span><span id="GroupAnalysis-3879"><a href="#GroupAnalysis-3879"><span class="linenos">3879</span></a>        <span class="n">not_in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="GroupAnalysis-3880"><a href="#GroupAnalysis-3880"><span class="linenos">3880</span></a>
</span><span id="GroupAnalysis-3881"><a href="#GroupAnalysis-3881"><span class="linenos">3881</span></a>        <span class="k">if</span> <span class="n">not_in_columns</span><span class="p">:</span>
</span><span id="GroupAnalysis-3882"><a href="#GroupAnalysis-3882"><span class="linenos">3882</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;These names are not in data&quot;</span><span class="p">,</span> <span class="n">not_in_columns</span><span class="p">)</span>
</span><span id="GroupAnalysis-3883"><a href="#GroupAnalysis-3883"><span class="linenos">3883</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3884"><a href="#GroupAnalysis-3884"><span class="linenos">3884</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All names are present in data.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3885"><a href="#GroupAnalysis-3885"><span class="linenos">3885</span></a>
</span><span id="GroupAnalysis-3886"><a href="#GroupAnalysis-3886"><span class="linenos">3886</span></a>        <span class="n">in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="GroupAnalysis-3887"><a href="#GroupAnalysis-3887"><span class="linenos">3887</span></a>
</span><span id="GroupAnalysis-3888"><a href="#GroupAnalysis-3888"><span class="linenos">3888</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">in_columns</span><span class="p">]</span>
</span><span id="GroupAnalysis-3889"><a href="#GroupAnalysis-3889"><span class="linenos">3889</span></a>
</span><span id="GroupAnalysis-3890"><a href="#GroupAnalysis-3890"><span class="linenos">3890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">dat</span>
</span><span id="GroupAnalysis-3891"><a href="#GroupAnalysis-3891"><span class="linenos">3891</span></a>
</span><span id="GroupAnalysis-3892"><a href="#GroupAnalysis-3892"><span class="linenos">3892</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">data_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3893"><a href="#GroupAnalysis-3893"><span class="linenos">3893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3894"><a href="#GroupAnalysis-3894"><span class="linenos">3894</span></a><span class="sd">        Scale the data using standardization (z-score normalization).</span>
</span><span id="GroupAnalysis-3895"><a href="#GroupAnalysis-3895"><span class="linenos">3895</span></a>
</span><span id="GroupAnalysis-3896"><a href="#GroupAnalysis-3896"><span class="linenos">3896</span></a><span class="sd">        This method applies `StandardScaler` from scikit-learn to the temporary dataset (`self.tmp_data`) and stores the scaled data.</span>
</span><span id="GroupAnalysis-3897"><a href="#GroupAnalysis-3897"><span class="linenos">3897</span></a>
</span><span id="GroupAnalysis-3898"><a href="#GroupAnalysis-3898"><span class="linenos">3898</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-3899"><a href="#GroupAnalysis-3899"><span class="linenos">3899</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-3900"><a href="#GroupAnalysis-3900"><span class="linenos">3900</span></a><span class="sd">        Modifies the `self.scaled_data` attribute to contain the standardized version of `self.tmp_data`.</span>
</span><span id="GroupAnalysis-3901"><a href="#GroupAnalysis-3901"><span class="linenos">3901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3902"><a href="#GroupAnalysis-3902"><span class="linenos">3902</span></a>
</span><span id="GroupAnalysis-3903"><a href="#GroupAnalysis-3903"><span class="linenos">3903</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-3904"><a href="#GroupAnalysis-3904"><span class="linenos">3904</span></a>
</span><span id="GroupAnalysis-3905"><a href="#GroupAnalysis-3905"><span class="linenos">3905</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">is_id_column</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GroupAnalysis-3906"><a href="#GroupAnalysis-3906"><span class="linenos">3906</span></a>                <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="GroupAnalysis-3907"><a href="#GroupAnalysis-3907"><span class="linenos">3907</span></a>                <span class="k">return</span> <span class="n">name_lower</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span> <span class="ow">or</span> <span class="s2">&quot;id_&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span> <span class="ow">or</span> <span class="s2">&quot;_id&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span>
</span><span id="GroupAnalysis-3908"><a href="#GroupAnalysis-3908"><span class="linenos">3908</span></a>
</span><span id="GroupAnalysis-3909"><a href="#GroupAnalysis-3909"><span class="linenos">3909</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="GroupAnalysis-3910"><a href="#GroupAnalysis-3910"><span class="linenos">3910</span></a>
</span><span id="GroupAnalysis-3911"><a href="#GroupAnalysis-3911"><span class="linenos">3911</span></a>            <span class="n">cols_with_strings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="GroupAnalysis-3912"><a href="#GroupAnalysis-3912"><span class="linenos">3912</span></a>                <span class="n">c</span>
</span><span id="GroupAnalysis-3913"><a href="#GroupAnalysis-3913"><span class="linenos">3913</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span>
</span><span id="GroupAnalysis-3914"><a href="#GroupAnalysis-3914"><span class="linenos">3914</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="GroupAnalysis-3915"><a href="#GroupAnalysis-3915"><span class="linenos">3915</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis-3916"><a href="#GroupAnalysis-3916"><span class="linenos">3916</span></a>
</span><span id="GroupAnalysis-3917"><a href="#GroupAnalysis-3917"><span class="linenos">3917</span></a>            <span class="n">cols_id_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">is_id_column</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
</span><span id="GroupAnalysis-3918"><a href="#GroupAnalysis-3918"><span class="linenos">3918</span></a>
</span><span id="GroupAnalysis-3919"><a href="#GroupAnalysis-3919"><span class="linenos">3919</span></a>            <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cols_id_pattern</span> <span class="o">+</span> <span class="n">cols_with_strings</span><span class="p">))</span>
</span><span id="GroupAnalysis-3920"><a href="#GroupAnalysis-3920"><span class="linenos">3920</span></a>
</span><span id="GroupAnalysis-3921"><a href="#GroupAnalysis-3921"><span class="linenos">3921</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_drop</span><span class="p">)</span>
</span><span id="GroupAnalysis-3922"><a href="#GroupAnalysis-3922"><span class="linenos">3922</span></a>
</span><span id="GroupAnalysis-3923"><a href="#GroupAnalysis-3923"><span class="linenos">3923</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span><span id="GroupAnalysis-3924"><a href="#GroupAnalysis-3924"><span class="linenos">3924</span></a>
</span><span id="GroupAnalysis-3925"><a href="#GroupAnalysis-3925"><span class="linenos">3925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="GroupAnalysis-3926"><a href="#GroupAnalysis-3926"><span class="linenos">3926</span></a>
</span><span id="GroupAnalysis-3927"><a href="#GroupAnalysis-3927"><span class="linenos">3927</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3928"><a href="#GroupAnalysis-3928"><span class="linenos">3928</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-3929"><a href="#GroupAnalysis-3929"><span class="linenos">3929</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data to scale. Please use the load_data() method first, and optionally the select_data() method.&quot;</span>
</span><span id="GroupAnalysis-3930"><a href="#GroupAnalysis-3930"><span class="linenos">3930</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-3931"><a href="#GroupAnalysis-3931"><span class="linenos">3931</span></a>
</span><span id="GroupAnalysis-3932"><a href="#GroupAnalysis-3932"><span class="linenos">3932</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3933"><a href="#GroupAnalysis-3933"><span class="linenos">3933</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3934"><a href="#GroupAnalysis-3934"><span class="linenos">3934</span></a><span class="sd">        Perform Principal Component Analysis (PCA) on the scaled data.</span>
</span><span id="GroupAnalysis-3935"><a href="#GroupAnalysis-3935"><span class="linenos">3935</span></a>
</span><span id="GroupAnalysis-3936"><a href="#GroupAnalysis-3936"><span class="linenos">3936</span></a><span class="sd">        This method reduces the dimensionality of `self.scaled_data` while retaining the maximum variance.</span>
</span><span id="GroupAnalysis-3937"><a href="#GroupAnalysis-3937"><span class="linenos">3937</span></a>
</span><span id="GroupAnalysis-3938"><a href="#GroupAnalysis-3938"><span class="linenos">3938</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-3939"><a href="#GroupAnalysis-3939"><span class="linenos">3939</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-3940"><a href="#GroupAnalysis-3940"><span class="linenos">3940</span></a><span class="sd">        Modifies the `self.PCA_results` attribute with the PCA-transformed data.</span>
</span><span id="GroupAnalysis-3941"><a href="#GroupAnalysis-3941"><span class="linenos">3941</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3942"><a href="#GroupAnalysis-3942"><span class="linenos">3942</span></a>
</span><span id="GroupAnalysis-3943"><a href="#GroupAnalysis-3943"><span class="linenos">3943</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-3944"><a href="#GroupAnalysis-3944"><span class="linenos">3944</span></a>            <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="GroupAnalysis-3945"><a href="#GroupAnalysis-3945"><span class="linenos">3945</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="GroupAnalysis-3946"><a href="#GroupAnalysis-3946"><span class="linenos">3946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
</span><span id="GroupAnalysis-3947"><a href="#GroupAnalysis-3947"><span class="linenos">3947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3948"><a href="#GroupAnalysis-3948"><span class="linenos">3948</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for PCA. Please use the data_scale() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3949"><a href="#GroupAnalysis-3949"><span class="linenos">3949</span></a>
</span><span id="GroupAnalysis-3950"><a href="#GroupAnalysis-3950"><span class="linenos">3950</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">var_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-3951"><a href="#GroupAnalysis-3951"><span class="linenos">3951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3952"><a href="#GroupAnalysis-3952"><span class="linenos">3952</span></a><span class="sd">        Plot the cumulative explained variance of the principal components from PCA.</span>
</span><span id="GroupAnalysis-3953"><a href="#GroupAnalysis-3953"><span class="linenos">3953</span></a>
</span><span id="GroupAnalysis-3954"><a href="#GroupAnalysis-3954"><span class="linenos">3954</span></a><span class="sd">        This method visualizes the cumulative explained variance to help determine how many components capture most of the variance.</span>
</span><span id="GroupAnalysis-3955"><a href="#GroupAnalysis-3955"><span class="linenos">3955</span></a>
</span><span id="GroupAnalysis-3956"><a href="#GroupAnalysis-3956"><span class="linenos">3956</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-3957"><a href="#GroupAnalysis-3957"><span class="linenos">3957</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-3958"><a href="#GroupAnalysis-3958"><span class="linenos">3958</span></a><span class="sd">        Stores results in the following attributes:</span>
</span><span id="GroupAnalysis-3959"><a href="#GroupAnalysis-3959"><span class="linenos">3959</span></a><span class="sd">        - `self.var_data` (np.ndarray): Explained variance ratio for each principal component.</span>
</span><span id="GroupAnalysis-3960"><a href="#GroupAnalysis-3960"><span class="linenos">3960</span></a><span class="sd">        - `self.knee_plot` (matplotlib.figure.Figure): Figure of the cumulative explained variance plot.</span>
</span><span id="GroupAnalysis-3961"><a href="#GroupAnalysis-3961"><span class="linenos">3961</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3962"><a href="#GroupAnalysis-3962"><span class="linenos">3962</span></a>
</span><span id="GroupAnalysis-3963"><a href="#GroupAnalysis-3963"><span class="linenos">3963</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis-3964"><a href="#GroupAnalysis-3964"><span class="linenos">3964</span></a>
</span><span id="GroupAnalysis-3965"><a href="#GroupAnalysis-3965"><span class="linenos">3965</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="GroupAnalysis-3966"><a href="#GroupAnalysis-3966"><span class="linenos">3966</span></a>            <span class="n">explained_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span>
</span><span id="GroupAnalysis-3967"><a href="#GroupAnalysis-3967"><span class="linenos">3967</span></a>
</span><span id="GroupAnalysis-3968"><a href="#GroupAnalysis-3968"><span class="linenos">3968</span></a>            <span class="n">cumulative_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_var</span><span class="p">)</span>
</span><span id="GroupAnalysis-3969"><a href="#GroupAnalysis-3969"><span class="linenos">3969</span></a>
</span><span id="GroupAnalysis-3970"><a href="#GroupAnalysis-3970"><span class="linenos">3970</span></a>            <span class="c1"># Plot the cumulative explained variance as a function of the number of components</span>
</span><span id="GroupAnalysis-3971"><a href="#GroupAnalysis-3971"><span class="linenos">3971</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span>
</span><span id="GroupAnalysis-3972"><a href="#GroupAnalysis-3972"><span class="linenos">3972</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Components&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3973"><a href="#GroupAnalysis-3973"><span class="linenos">3973</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3974"><a href="#GroupAnalysis-3974"><span class="linenos">3974</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Explained variance of PCs&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-3975"><a href="#GroupAnalysis-3975"><span class="linenos">3975</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="GroupAnalysis-3976"><a href="#GroupAnalysis-3976"><span class="linenos">3976</span></a>
</span><span id="GroupAnalysis-3977"><a href="#GroupAnalysis-3977"><span class="linenos">3977</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="n">explained_var</span>
</span><span id="GroupAnalysis-3978"><a href="#GroupAnalysis-3978"><span class="linenos">3978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="GroupAnalysis-3979"><a href="#GroupAnalysis-3979"><span class="linenos">3979</span></a>
</span><span id="GroupAnalysis-3980"><a href="#GroupAnalysis-3980"><span class="linenos">3980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-3981"><a href="#GroupAnalysis-3981"><span class="linenos">3981</span></a>
</span><span id="GroupAnalysis-3982"><a href="#GroupAnalysis-3982"><span class="linenos">3982</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-3983"><a href="#GroupAnalysis-3983"><span class="linenos">3983</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for variance explanation analysis. Please use the PCA() method first.&quot;</span>
</span><span id="GroupAnalysis-3984"><a href="#GroupAnalysis-3984"><span class="linenos">3984</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-3985"><a href="#GroupAnalysis-3985"><span class="linenos">3985</span></a>
</span><span id="GroupAnalysis-3986"><a href="#GroupAnalysis-3986"><span class="linenos">3986</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP</span><span class="p">(</span>
</span><span id="GroupAnalysis-3987"><a href="#GroupAnalysis-3987"><span class="linenos">3987</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis-3988"><a href="#GroupAnalysis-3988"><span class="linenos">3988</span></a>        <span class="n">PC_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GroupAnalysis-3989"><a href="#GroupAnalysis-3989"><span class="linenos">3989</span></a>        <span class="n">factorize_with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GroupAnalysis-3990"><a href="#GroupAnalysis-3990"><span class="linenos">3990</span></a>        <span class="n">harmonize_sets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="GroupAnalysis-3991"><a href="#GroupAnalysis-3991"><span class="linenos">3991</span></a>        <span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="GroupAnalysis-3992"><a href="#GroupAnalysis-3992"><span class="linenos">3992</span></a>        <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="GroupAnalysis-3993"><a href="#GroupAnalysis-3993"><span class="linenos">3993</span></a>        <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="GroupAnalysis-3994"><a href="#GroupAnalysis-3994"><span class="linenos">3994</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="GroupAnalysis-3995"><a href="#GroupAnalysis-3995"><span class="linenos">3995</span></a>        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GroupAnalysis-3996"><a href="#GroupAnalysis-3996"><span class="linenos">3996</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis-3997"><a href="#GroupAnalysis-3997"><span class="linenos">3997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-3998"><a href="#GroupAnalysis-3998"><span class="linenos">3998</span></a><span class="sd">         Perform UMAP (Uniform Manifold Approximation and Projection) dimensionality reduction on PCA results.</span>
</span><span id="GroupAnalysis-3999"><a href="#GroupAnalysis-3999"><span class="linenos">3999</span></a>
</span><span id="GroupAnalysis-4000"><a href="#GroupAnalysis-4000"><span class="linenos">4000</span></a><span class="sd">         UMAP is applied to the top principal components, optionally using metadata labels to influence the embedding. Generates both 2D/3D embeddings and visualizations.</span>
</span><span id="GroupAnalysis-4001"><a href="#GroupAnalysis-4001"><span class="linenos">4001</span></a>
</span><span id="GroupAnalysis-4002"><a href="#GroupAnalysis-4002"><span class="linenos">4002</span></a><span class="sd">         Parameters</span>
</span><span id="GroupAnalysis-4003"><a href="#GroupAnalysis-4003"><span class="linenos">4003</span></a><span class="sd">         ----------</span>
</span><span id="GroupAnalysis-4004"><a href="#GroupAnalysis-4004"><span class="linenos">4004</span></a><span class="sd">         PC_num : int, optional</span>
</span><span id="GroupAnalysis-4005"><a href="#GroupAnalysis-4005"><span class="linenos">4005</span></a><span class="sd">             Number of top principal components to use for UMAP embedding. Default is 5.</span>
</span><span id="GroupAnalysis-4006"><a href="#GroupAnalysis-4006"><span class="linenos">4006</span></a>
</span><span id="GroupAnalysis-4007"><a href="#GroupAnalysis-4007"><span class="linenos">4007</span></a><span class="sd">         factorize_with_metadata : bool, optional</span>
</span><span id="GroupAnalysis-4008"><a href="#GroupAnalysis-4008"><span class="linenos">4008</span></a><span class="sd">             Whether to use metadata (e.g., &#39;sets&#39;) to factorize UMAP embedding. Default is False.</span>
</span><span id="GroupAnalysis-4009"><a href="#GroupAnalysis-4009"><span class="linenos">4009</span></a>
</span><span id="GroupAnalysis-4010"><a href="#GroupAnalysis-4010"><span class="linenos">4010</span></a><span class="sd">        harmonize_sets : bool, optional</span>
</span><span id="GroupAnalysis-4011"><a href="#GroupAnalysis-4011"><span class="linenos">4011</span></a><span class="sd">             If True, applies harmonization across data sets before computing the UMAP embedding.</span>
</span><span id="GroupAnalysis-4012"><a href="#GroupAnalysis-4012"><span class="linenos">4012</span></a><span class="sd">             Default is True.</span>
</span><span id="GroupAnalysis-4013"><a href="#GroupAnalysis-4013"><span class="linenos">4013</span></a>
</span><span id="GroupAnalysis-4014"><a href="#GroupAnalysis-4014"><span class="linenos">4014</span></a><span class="sd">         n_neighbors : int, optional</span>
</span><span id="GroupAnalysis-4015"><a href="#GroupAnalysis-4015"><span class="linenos">4015</span></a><span class="sd">             Number of neighbors for UMAP to compute local structure. Default is 25.</span>
</span><span id="GroupAnalysis-4016"><a href="#GroupAnalysis-4016"><span class="linenos">4016</span></a>
</span><span id="GroupAnalysis-4017"><a href="#GroupAnalysis-4017"><span class="linenos">4017</span></a><span class="sd">         min_dist : float, optional</span>
</span><span id="GroupAnalysis-4018"><a href="#GroupAnalysis-4018"><span class="linenos">4018</span></a><span class="sd">             Minimum distance between points in the low-dimensional embedding. Default is 0.01.</span>
</span><span id="GroupAnalysis-4019"><a href="#GroupAnalysis-4019"><span class="linenos">4019</span></a>
</span><span id="GroupAnalysis-4020"><a href="#GroupAnalysis-4020"><span class="linenos">4020</span></a><span class="sd">         n_components : int, optional</span>
</span><span id="GroupAnalysis-4021"><a href="#GroupAnalysis-4021"><span class="linenos">4021</span></a><span class="sd">             Number of dimensions for the UMAP embedding. Default is 2.</span>
</span><span id="GroupAnalysis-4022"><a href="#GroupAnalysis-4022"><span class="linenos">4022</span></a><span class="sd">             </span>
</span><span id="GroupAnalysis-4023"><a href="#GroupAnalysis-4023"><span class="linenos">4023</span></a><span class="sd">         width : int, optional</span>
</span><span id="GroupAnalysis-4024"><a href="#GroupAnalysis-4024"><span class="linenos">4024</span></a><span class="sd">             Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="GroupAnalysis-4025"><a href="#GroupAnalysis-4025"><span class="linenos">4025</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4026"><a href="#GroupAnalysis-4026"><span class="linenos">4026</span></a><span class="sd">         height : int, optional</span>
</span><span id="GroupAnalysis-4027"><a href="#GroupAnalysis-4027"><span class="linenos">4027</span></a><span class="sd">             Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="GroupAnalysis-4028"><a href="#GroupAnalysis-4028"><span class="linenos">4028</span></a>
</span><span id="GroupAnalysis-4029"><a href="#GroupAnalysis-4029"><span class="linenos">4029</span></a><span class="sd">         Notes</span>
</span><span id="GroupAnalysis-4030"><a href="#GroupAnalysis-4030"><span class="linenos">4030</span></a><span class="sd">         -----</span>
</span><span id="GroupAnalysis-4031"><a href="#GroupAnalysis-4031"><span class="linenos">4031</span></a><span class="sd">         Stores results in the following attributes:</span>
</span><span id="GroupAnalysis-4032"><a href="#GroupAnalysis-4032"><span class="linenos">4032</span></a><span class="sd">         - `self.UMAP_data` (np.ndarray): UMAP-transformed data.</span>
</span><span id="GroupAnalysis-4033"><a href="#GroupAnalysis-4033"><span class="linenos">4033</span></a><span class="sd">         - `self.UMAP_plot[&#39;static&#39;][&#39;PrimaryUMAP&#39;]` (matplotlib.figure.Figure): Static visualization of UMAP embedding.</span>
</span><span id="GroupAnalysis-4034"><a href="#GroupAnalysis-4034"><span class="linenos">4034</span></a><span class="sd">         - `self.UMAP_plot[&#39;html&#39;][&#39;PrimaryUMAP&#39;]` (plotly.graph_objs.Figure): Interactive Plotly visualization of UMAP embedding.</span>
</span><span id="GroupAnalysis-4035"><a href="#GroupAnalysis-4035"><span class="linenos">4035</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4036"><a href="#GroupAnalysis-4036"><span class="linenos">4036</span></a>
</span><span id="GroupAnalysis-4037"><a href="#GroupAnalysis-4037"><span class="linenos">4037</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis-4038"><a href="#GroupAnalysis-4038"><span class="linenos">4038</span></a>
</span><span id="GroupAnalysis-4039"><a href="#GroupAnalysis-4039"><span class="linenos">4039</span></a>            <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
</span><span id="GroupAnalysis-4040"><a href="#GroupAnalysis-4040"><span class="linenos">4040</span></a>                <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span>
</span><span id="GroupAnalysis-4041"><a href="#GroupAnalysis-4041"><span class="linenos">4041</span></a>                <span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span>
</span><span id="GroupAnalysis-4042"><a href="#GroupAnalysis-4042"><span class="linenos">4042</span></a>                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
</span><span id="GroupAnalysis-4043"><a href="#GroupAnalysis-4043"><span class="linenos">4043</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span><span id="GroupAnalysis-4044"><a href="#GroupAnalysis-4044"><span class="linenos">4044</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4045"><a href="#GroupAnalysis-4045"><span class="linenos">4045</span></a>
</span><span id="GroupAnalysis-4046"><a href="#GroupAnalysis-4046"><span class="linenos">4046</span></a>            <span class="n">pca_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span><span id="GroupAnalysis-4047"><a href="#GroupAnalysis-4047"><span class="linenos">4047</span></a>
</span><span id="GroupAnalysis-4048"><a href="#GroupAnalysis-4048"><span class="linenos">4048</span></a>            <span class="k">if</span> <span class="n">harmonize_sets</span><span class="p">:</span>
</span><span id="GroupAnalysis-4049"><a href="#GroupAnalysis-4049"><span class="linenos">4049</span></a>
</span><span id="GroupAnalysis-4050"><a href="#GroupAnalysis-4050"><span class="linenos">4050</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pca_res</span><span class="p">)</span>
</span><span id="GroupAnalysis-4051"><a href="#GroupAnalysis-4051"><span class="linenos">4051</span></a>
</span><span id="GroupAnalysis-4052"><a href="#GroupAnalysis-4052"><span class="linenos">4052</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="GroupAnalysis-4053"><a href="#GroupAnalysis-4053"><span class="linenos">4053</span></a>                    <span class="n">harmonize</span><span class="o">.</span><span class="n">run_harmony</span><span class="p">(</span>
</span><span id="GroupAnalysis-4054"><a href="#GroupAnalysis-4054"><span class="linenos">4054</span></a>                        <span class="n">pca_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span><span class="p">,</span> <span class="n">vars_use</span><span class="o">=</span><span class="s2">&quot;sets&quot;</span>
</span><span id="GroupAnalysis-4055"><a href="#GroupAnalysis-4055"><span class="linenos">4055</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">Z_corr</span>
</span><span id="GroupAnalysis-4056"><a href="#GroupAnalysis-4056"><span class="linenos">4056</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="GroupAnalysis-4057"><a href="#GroupAnalysis-4057"><span class="linenos">4057</span></a>
</span><span id="GroupAnalysis-4058"><a href="#GroupAnalysis-4058"><span class="linenos">4058</span></a>            <span class="k">if</span> <span class="n">factorize_with_metadata</span><span class="p">:</span>
</span><span id="GroupAnalysis-4059"><a href="#GroupAnalysis-4059"><span class="linenos">4059</span></a>                <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">codes</span>
</span><span id="GroupAnalysis-4060"><a href="#GroupAnalysis-4060"><span class="linenos">4060</span></a>
</span><span id="GroupAnalysis-4061"><a href="#GroupAnalysis-4061"><span class="linenos">4061</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
</span><span id="GroupAnalysis-4062"><a href="#GroupAnalysis-4062"><span class="linenos">4062</span></a>                    <span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">numeric_labels</span>
</span><span id="GroupAnalysis-4063"><a href="#GroupAnalysis-4063"><span class="linenos">4063</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis-4064"><a href="#GroupAnalysis-4064"><span class="linenos">4064</span></a>
</span><span id="GroupAnalysis-4065"><a href="#GroupAnalysis-4065"><span class="linenos">4065</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4066"><a href="#GroupAnalysis-4066"><span class="linenos">4066</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="GroupAnalysis-4067"><a href="#GroupAnalysis-4067"><span class="linenos">4067</span></a>
</span><span id="GroupAnalysis-4068"><a href="#GroupAnalysis-4068"><span class="linenos">4068</span></a>            <span class="n">umap_result_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">umap_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="GroupAnalysis-4069"><a href="#GroupAnalysis-4069"><span class="linenos">4069</span></a>
</span><span id="GroupAnalysis-4070"><a href="#GroupAnalysis-4070"><span class="linenos">4070</span></a>            <span class="n">umap_result_plot</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis-4071"><a href="#GroupAnalysis-4071"><span class="linenos">4071</span></a>
</span><span id="GroupAnalysis-4072"><a href="#GroupAnalysis-4072"><span class="linenos">4072</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</span><span id="GroupAnalysis-4073"><a href="#GroupAnalysis-4073"><span class="linenos">4073</span></a>
</span><span id="GroupAnalysis-4074"><a href="#GroupAnalysis-4074"><span class="linenos">4074</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis-4075"><a href="#GroupAnalysis-4075"><span class="linenos">4075</span></a>
</span><span id="GroupAnalysis-4076"><a href="#GroupAnalysis-4076"><span class="linenos">4076</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="n">umap_result</span>
</span><span id="GroupAnalysis-4077"><a href="#GroupAnalysis-4077"><span class="linenos">4077</span></a>
</span><span id="GroupAnalysis-4078"><a href="#GroupAnalysis-4078"><span class="linenos">4078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis-4079"><a href="#GroupAnalysis-4079"><span class="linenos">4079</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis-4080"><a href="#GroupAnalysis-4080"><span class="linenos">4080</span></a>
</span><span id="GroupAnalysis-4081"><a href="#GroupAnalysis-4081"><span class="linenos">4081</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4082"><a href="#GroupAnalysis-4082"><span class="linenos">4082</span></a>
</span><span id="GroupAnalysis-4083"><a href="#GroupAnalysis-4083"><span class="linenos">4083</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for UMAP. Please use the PCA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4084"><a href="#GroupAnalysis-4084"><span class="linenos">4084</span></a>
</span><span id="GroupAnalysis-4085"><a href="#GroupAnalysis-4085"><span class="linenos">4085</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">db_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="GroupAnalysis-4086"><a href="#GroupAnalysis-4086"><span class="linenos">4086</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4087"><a href="#GroupAnalysis-4087"><span class="linenos">4087</span></a><span class="sd">        Perform DBSCAN clustering on UMAP-transformed data.</span>
</span><span id="GroupAnalysis-4088"><a href="#GroupAnalysis-4088"><span class="linenos">4088</span></a>
</span><span id="GroupAnalysis-4089"><a href="#GroupAnalysis-4089"><span class="linenos">4089</span></a><span class="sd">        DBSCAN identifies clusters based on density, labeling points in dense regions as clusters and others as noise.</span>
</span><span id="GroupAnalysis-4090"><a href="#GroupAnalysis-4090"><span class="linenos">4090</span></a>
</span><span id="GroupAnalysis-4091"><a href="#GroupAnalysis-4091"><span class="linenos">4091</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4092"><a href="#GroupAnalysis-4092"><span class="linenos">4092</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4093"><a href="#GroupAnalysis-4093"><span class="linenos">4093</span></a><span class="sd">        eps : float, optional</span>
</span><span id="GroupAnalysis-4094"><a href="#GroupAnalysis-4094"><span class="linenos">4094</span></a><span class="sd">            Maximum distance between two points to be considered neighbors. Default is 0.5.</span>
</span><span id="GroupAnalysis-4095"><a href="#GroupAnalysis-4095"><span class="linenos">4095</span></a>
</span><span id="GroupAnalysis-4096"><a href="#GroupAnalysis-4096"><span class="linenos">4096</span></a><span class="sd">        min_samples : int, optional</span>
</span><span id="GroupAnalysis-4097"><a href="#GroupAnalysis-4097"><span class="linenos">4097</span></a><span class="sd">            Minimum number of points required to form a dense region (cluster). Default is 10.</span>
</span><span id="GroupAnalysis-4098"><a href="#GroupAnalysis-4098"><span class="linenos">4098</span></a>
</span><span id="GroupAnalysis-4099"><a href="#GroupAnalysis-4099"><span class="linenos">4099</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-4100"><a href="#GroupAnalysis-4100"><span class="linenos">4100</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-4101"><a href="#GroupAnalysis-4101"><span class="linenos">4101</span></a><span class="sd">        Stores the results in the following attribute:</span>
</span><span id="GroupAnalysis-4102"><a href="#GroupAnalysis-4102"><span class="linenos">4102</span></a><span class="sd">        - `self.dblabels` (list of str): Cluster labels assigned by DBSCAN for each point in the UMAP embedding.</span>
</span><span id="GroupAnalysis-4103"><a href="#GroupAnalysis-4103"><span class="linenos">4103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4104"><a href="#GroupAnalysis-4104"><span class="linenos">4104</span></a>
</span><span id="GroupAnalysis-4105"><a href="#GroupAnalysis-4105"><span class="linenos">4105</span></a>
</span><span id="GroupAnalysis-4106"><a href="#GroupAnalysis-4106"><span class="linenos">4106</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-4107"><a href="#GroupAnalysis-4107"><span class="linenos">4107</span></a>
</span><span id="GroupAnalysis-4108"><a href="#GroupAnalysis-4108"><span class="linenos">4108</span></a>            <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">)</span>
</span><span id="GroupAnalysis-4109"><a href="#GroupAnalysis-4109"><span class="linenos">4109</span></a>            <span class="n">dbscan_labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">)</span>
</span><span id="GroupAnalysis-4110"><a href="#GroupAnalysis-4110"><span class="linenos">4110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dbscan_labels</span><span class="p">]</span>
</span><span id="GroupAnalysis-4111"><a href="#GroupAnalysis-4111"><span class="linenos">4111</span></a>
</span><span id="GroupAnalysis-4112"><a href="#GroupAnalysis-4112"><span class="linenos">4112</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4113"><a href="#GroupAnalysis-4113"><span class="linenos">4113</span></a>
</span><span id="GroupAnalysis-4114"><a href="#GroupAnalysis-4114"><span class="linenos">4114</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for DBSCAN. Please use the UMAP() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4115"><a href="#GroupAnalysis-4115"><span class="linenos">4115</span></a>
</span><span id="GroupAnalysis-4116"><a href="#GroupAnalysis-4116"><span class="linenos">4116</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP_on_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_entities</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="GroupAnalysis-4117"><a href="#GroupAnalysis-4117"><span class="linenos">4117</span></a>                         <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="GroupAnalysis-4118"><a href="#GroupAnalysis-4118"><span class="linenos">4118</span></a>                         <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GroupAnalysis-4119"><a href="#GroupAnalysis-4119"><span class="linenos">4119</span></a>                         <span class="n">n_per_col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="GroupAnalysis-4120"><a href="#GroupAnalysis-4120"><span class="linenos">4120</span></a>                         <span class="p">):</span>
</span><span id="GroupAnalysis-4121"><a href="#GroupAnalysis-4121"><span class="linenos">4121</span></a><span class="w">        </span>
</span><span id="GroupAnalysis-4122"><a href="#GroupAnalysis-4122"><span class="linenos">4122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4123"><a href="#GroupAnalysis-4123"><span class="linenos">4123</span></a><span class="sd">        Generate UMAP visualizations for clusters filtered by a minimum entity threshold.</span>
</span><span id="GroupAnalysis-4124"><a href="#GroupAnalysis-4124"><span class="linenos">4124</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4125"><a href="#GroupAnalysis-4125"><span class="linenos">4125</span></a><span class="sd">        This method removes clusters containing fewer than `min_entities` observations</span>
</span><span id="GroupAnalysis-4126"><a href="#GroupAnalysis-4126"><span class="linenos">4126</span></a><span class="sd">        and produces two UMAP visualizations:</span>
</span><span id="GroupAnalysis-4127"><a href="#GroupAnalysis-4127"><span class="linenos">4127</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4128"><a href="#GroupAnalysis-4128"><span class="linenos">4128</span></a><span class="sd">        1. **Cluster UMAP** – points colored by cluster assignment only.</span>
</span><span id="GroupAnalysis-4129"><a href="#GroupAnalysis-4129"><span class="linenos">4129</span></a><span class="sd">        2. **Cluster × Set UMAP** – points colored by the combination of cluster and set identifier.</span>
</span><span id="GroupAnalysis-4130"><a href="#GroupAnalysis-4130"><span class="linenos">4130</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4131"><a href="#GroupAnalysis-4131"><span class="linenos">4131</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4132"><a href="#GroupAnalysis-4132"><span class="linenos">4132</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4133"><a href="#GroupAnalysis-4133"><span class="linenos">4133</span></a><span class="sd">        min_entities : int, optional</span>
</span><span id="GroupAnalysis-4134"><a href="#GroupAnalysis-4134"><span class="linenos">4134</span></a><span class="sd">            Minimum number of entities required for a cluster to be included</span>
</span><span id="GroupAnalysis-4135"><a href="#GroupAnalysis-4135"><span class="linenos">4135</span></a><span class="sd">            in the visualization. Default is 50.</span>
</span><span id="GroupAnalysis-4136"><a href="#GroupAnalysis-4136"><span class="linenos">4136</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4137"><a href="#GroupAnalysis-4137"><span class="linenos">4137</span></a><span class="sd">        width : int, optional</span>
</span><span id="GroupAnalysis-4138"><a href="#GroupAnalysis-4138"><span class="linenos">4138</span></a><span class="sd">            Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="GroupAnalysis-4139"><a href="#GroupAnalysis-4139"><span class="linenos">4139</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4140"><a href="#GroupAnalysis-4140"><span class="linenos">4140</span></a><span class="sd">        height : int, optional</span>
</span><span id="GroupAnalysis-4141"><a href="#GroupAnalysis-4141"><span class="linenos">4141</span></a><span class="sd">            Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="GroupAnalysis-4142"><a href="#GroupAnalysis-4142"><span class="linenos">4142</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4143"><a href="#GroupAnalysis-4143"><span class="linenos">4143</span></a><span class="sd">        n_per_col : int, optional</span>
</span><span id="GroupAnalysis-4144"><a href="#GroupAnalysis-4144"><span class="linenos">4144</span></a><span class="sd">            Maximum number of legend entries per column. Default is 20.</span>
</span><span id="GroupAnalysis-4145"><a href="#GroupAnalysis-4145"><span class="linenos">4145</span></a>
</span><span id="GroupAnalysis-4146"><a href="#GroupAnalysis-4146"><span class="linenos">4146</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-4147"><a href="#GroupAnalysis-4147"><span class="linenos">4147</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-4148"><a href="#GroupAnalysis-4148"><span class="linenos">4148</span></a><span class="sd">        This method updates the following attributes:</span>
</span><span id="GroupAnalysis-4149"><a href="#GroupAnalysis-4149"><span class="linenos">4149</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4150"><a href="#GroupAnalysis-4150"><span class="linenos">4150</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="GroupAnalysis-4151"><a href="#GroupAnalysis-4151"><span class="linenos">4151</span></a><span class="sd">          Static matplotlib figure of the filtered cluster-only UMAP.</span>
</span><span id="GroupAnalysis-4152"><a href="#GroupAnalysis-4152"><span class="linenos">4152</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4153"><a href="#GroupAnalysis-4153"><span class="linenos">4153</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="GroupAnalysis-4154"><a href="#GroupAnalysis-4154"><span class="linenos">4154</span></a><span class="sd">          Interactive HTML version of the cluster-only UMAP.</span>
</span><span id="GroupAnalysis-4155"><a href="#GroupAnalysis-4155"><span class="linenos">4155</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4156"><a href="#GroupAnalysis-4156"><span class="linenos">4156</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="GroupAnalysis-4157"><a href="#GroupAnalysis-4157"><span class="linenos">4157</span></a><span class="sd">          Static matplotlib figure showing clusters combined with set identifiers.</span>
</span><span id="GroupAnalysis-4158"><a href="#GroupAnalysis-4158"><span class="linenos">4158</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4159"><a href="#GroupAnalysis-4159"><span class="linenos">4159</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="GroupAnalysis-4160"><a href="#GroupAnalysis-4160"><span class="linenos">4160</span></a><span class="sd">          Interactive HTML version of the cluster × set visualization.</span>
</span><span id="GroupAnalysis-4161"><a href="#GroupAnalysis-4161"><span class="linenos">4161</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4162"><a href="#GroupAnalysis-4162"><span class="linenos">4162</span></a><span class="sd">        - `self.tmp_data`  </span>
</span><span id="GroupAnalysis-4163"><a href="#GroupAnalysis-4163"><span class="linenos">4163</span></a><span class="sd">          Dataset filtered to include only clusters meeting the `min_entities` threshold.</span>
</span><span id="GroupAnalysis-4164"><a href="#GroupAnalysis-4164"><span class="linenos">4164</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4165"><a href="#GroupAnalysis-4165"><span class="linenos">4165</span></a><span class="sd">        - `self.tmp_metadata`  </span>
</span><span id="GroupAnalysis-4166"><a href="#GroupAnalysis-4166"><span class="linenos">4166</span></a><span class="sd">          Metadata corresponding to the filtered dataset.</span>
</span><span id="GroupAnalysis-4167"><a href="#GroupAnalysis-4167"><span class="linenos">4167</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4168"><a href="#GroupAnalysis-4168"><span class="linenos">4168</span></a>
</span><span id="GroupAnalysis-4169"><a href="#GroupAnalysis-4169"><span class="linenos">4169</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis-4170"><a href="#GroupAnalysis-4170"><span class="linenos">4170</span></a>            
</span><span id="GroupAnalysis-4171"><a href="#GroupAnalysis-4171"><span class="linenos">4171</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_data_old&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis-4172"><a href="#GroupAnalysis-4172"><span class="linenos">4172</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span>
</span><span id="GroupAnalysis-4173"><a href="#GroupAnalysis-4173"><span class="linenos">4173</span></a>            
</span><span id="GroupAnalysis-4174"><a href="#GroupAnalysis-4174"><span class="linenos">4174</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_metadata_old&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis-4175"><a href="#GroupAnalysis-4175"><span class="linenos">4175</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span>
</span><span id="GroupAnalysis-4176"><a href="#GroupAnalysis-4176"><span class="linenos">4176</span></a>    
</span><span id="GroupAnalysis-4177"><a href="#GroupAnalysis-4177"><span class="linenos">4177</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="GroupAnalysis-4178"><a href="#GroupAnalysis-4178"><span class="linenos">4178</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">index</span>
</span><span id="GroupAnalysis-4179"><a href="#GroupAnalysis-4179"><span class="linenos">4179</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis-4180"><a href="#GroupAnalysis-4180"><span class="linenos">4180</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span><span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4181"><a href="#GroupAnalysis-4181"><span class="linenos">4181</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4182"><a href="#GroupAnalysis-4182"><span class="linenos">4182</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis-4183"><a href="#GroupAnalysis-4183"><span class="linenos">4183</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4184"><a href="#GroupAnalysis-4184"><span class="linenos">4184</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4185"><a href="#GroupAnalysis-4185"><span class="linenos">4185</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis-4186"><a href="#GroupAnalysis-4186"><span class="linenos">4186</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4187"><a href="#GroupAnalysis-4187"><span class="linenos">4187</span></a>
</span><span id="GroupAnalysis-4188"><a href="#GroupAnalysis-4188"><span class="linenos">4188</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span><span class="p">)</span>
</span><span id="GroupAnalysis-4189"><a href="#GroupAnalysis-4189"><span class="linenos">4189</span></a>
</span><span id="GroupAnalysis-4190"><a href="#GroupAnalysis-4190"><span class="linenos">4190</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="GroupAnalysis-4191"><a href="#GroupAnalysis-4191"><span class="linenos">4191</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4192"><a href="#GroupAnalysis-4192"><span class="linenos">4192</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4193"><a href="#GroupAnalysis-4193"><span class="linenos">4193</span></a>
</span><span id="GroupAnalysis-4194"><a href="#GroupAnalysis-4194"><span class="linenos">4194</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="GroupAnalysis-4195"><a href="#GroupAnalysis-4195"><span class="linenos">4195</span></a>
</span><span id="GroupAnalysis-4196"><a href="#GroupAnalysis-4196"><span class="linenos">4196</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="GroupAnalysis-4197"><a href="#GroupAnalysis-4197"><span class="linenos">4197</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4198"><a href="#GroupAnalysis-4198"><span class="linenos">4198</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4199"><a href="#GroupAnalysis-4199"><span class="linenos">4199</span></a>
</span><span id="GroupAnalysis-4200"><a href="#GroupAnalysis-4200"><span class="linenos">4200</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4201"><a href="#GroupAnalysis-4201"><span class="linenos">4201</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis-4202"><a href="#GroupAnalysis-4202"><span class="linenos">4202</span></a>
</span><span id="GroupAnalysis-4203"><a href="#GroupAnalysis-4203"><span class="linenos">4203</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="GroupAnalysis-4204"><a href="#GroupAnalysis-4204"><span class="linenos">4204</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis-4205"><a href="#GroupAnalysis-4205"><span class="linenos">4205</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis-4206"><a href="#GroupAnalysis-4206"><span class="linenos">4206</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="GroupAnalysis-4207"><a href="#GroupAnalysis-4207"><span class="linenos">4207</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis-4208"><a href="#GroupAnalysis-4208"><span class="linenos">4208</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis-4209"><a href="#GroupAnalysis-4209"><span class="linenos">4209</span></a>            
</span><span id="GroupAnalysis-4210"><a href="#GroupAnalysis-4210"><span class="linenos">4210</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="GroupAnalysis-4211"><a href="#GroupAnalysis-4211"><span class="linenos">4211</span></a>            
</span><span id="GroupAnalysis-4212"><a href="#GroupAnalysis-4212"><span class="linenos">4212</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]))]</span>
</span><span id="GroupAnalysis-4213"><a href="#GroupAnalysis-4213"><span class="linenos">4213</span></a>
</span><span id="GroupAnalysis-4214"><a href="#GroupAnalysis-4214"><span class="linenos">4214</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="GroupAnalysis-4215"><a href="#GroupAnalysis-4215"><span class="linenos">4215</span></a>
</span><span id="GroupAnalysis-4216"><a href="#GroupAnalysis-4216"><span class="linenos">4216</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis-4217"><a href="#GroupAnalysis-4217"><span class="linenos">4217</span></a>
</span><span id="GroupAnalysis-4218"><a href="#GroupAnalysis-4218"><span class="linenos">4218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis-4219"><a href="#GroupAnalysis-4219"><span class="linenos">4219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis-4220"><a href="#GroupAnalysis-4220"><span class="linenos">4220</span></a>
</span><span id="GroupAnalysis-4221"><a href="#GroupAnalysis-4221"><span class="linenos">4221</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="GroupAnalysis-4222"><a href="#GroupAnalysis-4222"><span class="linenos">4222</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4223"><a href="#GroupAnalysis-4223"><span class="linenos">4223</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4224"><a href="#GroupAnalysis-4224"><span class="linenos">4224</span></a>
</span><span id="GroupAnalysis-4225"><a href="#GroupAnalysis-4225"><span class="linenos">4225</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]))</span>
</span><span id="GroupAnalysis-4226"><a href="#GroupAnalysis-4226"><span class="linenos">4226</span></a>
</span><span id="GroupAnalysis-4227"><a href="#GroupAnalysis-4227"><span class="linenos">4227</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="GroupAnalysis-4228"><a href="#GroupAnalysis-4228"><span class="linenos">4228</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4229"><a href="#GroupAnalysis-4229"><span class="linenos">4229</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4230"><a href="#GroupAnalysis-4230"><span class="linenos">4230</span></a>
</span><span id="GroupAnalysis-4231"><a href="#GroupAnalysis-4231"><span class="linenos">4231</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="GroupAnalysis-4232"><a href="#GroupAnalysis-4232"><span class="linenos">4232</span></a>
</span><span id="GroupAnalysis-4233"><a href="#GroupAnalysis-4233"><span class="linenos">4233</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4234"><a href="#GroupAnalysis-4234"><span class="linenos">4234</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis-4235"><a href="#GroupAnalysis-4235"><span class="linenos">4235</span></a>
</span><span id="GroupAnalysis-4236"><a href="#GroupAnalysis-4236"><span class="linenos">4236</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="GroupAnalysis-4237"><a href="#GroupAnalysis-4237"><span class="linenos">4237</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis-4238"><a href="#GroupAnalysis-4238"><span class="linenos">4238</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis-4239"><a href="#GroupAnalysis-4239"><span class="linenos">4239</span></a>
</span><span id="GroupAnalysis-4240"><a href="#GroupAnalysis-4240"><span class="linenos">4240</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="GroupAnalysis-4241"><a href="#GroupAnalysis-4241"><span class="linenos">4241</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis-4242"><a href="#GroupAnalysis-4242"><span class="linenos">4242</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis-4243"><a href="#GroupAnalysis-4243"><span class="linenos">4243</span></a>
</span><span id="GroupAnalysis-4244"><a href="#GroupAnalysis-4244"><span class="linenos">4244</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
</span><span id="GroupAnalysis-4245"><a href="#GroupAnalysis-4245"><span class="linenos">4245</span></a>
</span><span id="GroupAnalysis-4246"><a href="#GroupAnalysis-4246"><span class="linenos">4246</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="GroupAnalysis-4247"><a href="#GroupAnalysis-4247"><span class="linenos">4247</span></a>
</span><span id="GroupAnalysis-4248"><a href="#GroupAnalysis-4248"><span class="linenos">4248</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis-4249"><a href="#GroupAnalysis-4249"><span class="linenos">4249</span></a>
</span><span id="GroupAnalysis-4250"><a href="#GroupAnalysis-4250"><span class="linenos">4250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis-4251"><a href="#GroupAnalysis-4251"><span class="linenos">4251</span></a>
</span><span id="GroupAnalysis-4252"><a href="#GroupAnalysis-4252"><span class="linenos">4252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis-4253"><a href="#GroupAnalysis-4253"><span class="linenos">4253</span></a>            
</span><span id="GroupAnalysis-4254"><a href="#GroupAnalysis-4254"><span class="linenos">4254</span></a>            
</span><span id="GroupAnalysis-4255"><a href="#GroupAnalysis-4255"><span class="linenos">4255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="GroupAnalysis-4256"><a href="#GroupAnalysis-4256"><span class="linenos">4256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span>
</span><span id="GroupAnalysis-4257"><a href="#GroupAnalysis-4257"><span class="linenos">4257</span></a>            
</span><span id="GroupAnalysis-4258"><a href="#GroupAnalysis-4258"><span class="linenos">4258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span>
</span><span id="GroupAnalysis-4259"><a href="#GroupAnalysis-4259"><span class="linenos">4259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span>
</span><span id="GroupAnalysis-4260"><a href="#GroupAnalysis-4260"><span class="linenos">4260</span></a>            
</span><span id="GroupAnalysis-4261"><a href="#GroupAnalysis-4261"><span class="linenos">4261</span></a>            
</span><span id="GroupAnalysis-4262"><a href="#GroupAnalysis-4262"><span class="linenos">4262</span></a>
</span><span id="GroupAnalysis-4263"><a href="#GroupAnalysis-4263"><span class="linenos">4263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4264"><a href="#GroupAnalysis-4264"><span class="linenos">4264</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-4265"><a href="#GroupAnalysis-4265"><span class="linenos">4265</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for visualization. Please use the UMAP() and db_scan() methods first.&quot;</span>
</span><span id="GroupAnalysis-4266"><a href="#GroupAnalysis-4266"><span class="linenos">4266</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4267"><a href="#GroupAnalysis-4267"><span class="linenos">4267</span></a>
</span><span id="GroupAnalysis-4268"><a href="#GroupAnalysis-4268"><span class="linenos">4268</span></a>    <span class="c1">## save data</span>
</span><span id="GroupAnalysis-4269"><a href="#GroupAnalysis-4269"><span class="linenos">4269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-4270"><a href="#GroupAnalysis-4270"><span class="linenos">4270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4271"><a href="#GroupAnalysis-4271"><span class="linenos">4271</span></a><span class="sd">        Merge data with metadata based on the &#39;full_id&#39; column.</span>
</span><span id="GroupAnalysis-4272"><a href="#GroupAnalysis-4272"><span class="linenos">4272</span></a>
</span><span id="GroupAnalysis-4273"><a href="#GroupAnalysis-4273"><span class="linenos">4273</span></a><span class="sd">        This method combines `self.tmp_data` and `self.tmp_metadata` into a single DataFrame if the metadata contains a &#39;full_id&#39; column. If &#39;full_id&#39; is not present, the method prints a warning to complete the preprocessing pipeline.</span>
</span><span id="GroupAnalysis-4274"><a href="#GroupAnalysis-4274"><span class="linenos">4274</span></a>
</span><span id="GroupAnalysis-4275"><a href="#GroupAnalysis-4275"><span class="linenos">4275</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-4276"><a href="#GroupAnalysis-4276"><span class="linenos">4276</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4277"><a href="#GroupAnalysis-4277"><span class="linenos">4277</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="GroupAnalysis-4278"><a href="#GroupAnalysis-4278"><span class="linenos">4278</span></a><span class="sd">            Merged DataFrame containing both data and metadata if &#39;full_id&#39; exists; otherwise, None.</span>
</span><span id="GroupAnalysis-4279"><a href="#GroupAnalysis-4279"><span class="linenos">4279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4280"><a href="#GroupAnalysis-4280"><span class="linenos">4280</span></a>
</span><span id="GroupAnalysis-4281"><a href="#GroupAnalysis-4281"><span class="linenos">4281</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4282"><a href="#GroupAnalysis-4282"><span class="linenos">4282</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4283"><a href="#GroupAnalysis-4283"><span class="linenos">4283</span></a>
</span><span id="GroupAnalysis-4284"><a href="#GroupAnalysis-4284"><span class="linenos">4284</span></a>        <span class="k">if</span> <span class="s2">&quot;full_id&quot;</span> <span class="ow">in</span> <span class="n">tmp_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GroupAnalysis-4285"><a href="#GroupAnalysis-4285"><span class="linenos">4285</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis-4286"><a href="#GroupAnalysis-4286"><span class="linenos">4286</span></a>
</span><span id="GroupAnalysis-4287"><a href="#GroupAnalysis-4287"><span class="linenos">4287</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="GroupAnalysis-4288"><a href="#GroupAnalysis-4288"><span class="linenos">4288</span></a>                <span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;full_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="GroupAnalysis-4289"><a href="#GroupAnalysis-4289"><span class="linenos">4289</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4290"><a href="#GroupAnalysis-4290"><span class="linenos">4290</span></a>
</span><span id="GroupAnalysis-4291"><a href="#GroupAnalysis-4291"><span class="linenos">4291</span></a>            <span class="k">return</span> <span class="n">merged_df</span>
</span><span id="GroupAnalysis-4292"><a href="#GroupAnalysis-4292"><span class="linenos">4292</span></a>
</span><span id="GroupAnalysis-4293"><a href="#GroupAnalysis-4293"><span class="linenos">4293</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4294"><a href="#GroupAnalysis-4294"><span class="linenos">4294</span></a>
</span><span id="GroupAnalysis-4295"><a href="#GroupAnalysis-4295"><span class="linenos">4295</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metadata is not completed!&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4296"><a href="#GroupAnalysis-4296"><span class="linenos">4296</span></a>
</span><span id="GroupAnalysis-4297"><a href="#GroupAnalysis-4297"><span class="linenos">4297</span></a>        <span class="c1">#################################################################################</span>
</span><span id="GroupAnalysis-4298"><a href="#GroupAnalysis-4298"><span class="linenos">4298</span></a>
</span><span id="GroupAnalysis-4299"><a href="#GroupAnalysis-4299"><span class="linenos">4299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_group_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">n_proc</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="GroupAnalysis-4300"><a href="#GroupAnalysis-4300"><span class="linenos">4300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4301"><a href="#GroupAnalysis-4301"><span class="linenos">4301</span></a><span class="sd">        Perform Differential Feature Analysis (DFA) on specified data groups.</span>
</span><span id="GroupAnalysis-4302"><a href="#GroupAnalysis-4302"><span class="linenos">4302</span></a>
</span><span id="GroupAnalysis-4303"><a href="#GroupAnalysis-4303"><span class="linenos">4303</span></a><span class="sd">        This method conducts DFA using a grouping factor from metadata and a dictionary of sets for comparison. It allows for the identification of significant differences across defined sets.</span>
</span><span id="GroupAnalysis-4304"><a href="#GroupAnalysis-4304"><span class="linenos">4304</span></a>
</span><span id="GroupAnalysis-4305"><a href="#GroupAnalysis-4305"><span class="linenos">4305</span></a><span class="sd">        The analysis includes:</span>
</span><span id="GroupAnalysis-4306"><a href="#GroupAnalysis-4306"><span class="linenos">4306</span></a><span class="sd">        - Mann–Whitney U test</span>
</span><span id="GroupAnalysis-4307"><a href="#GroupAnalysis-4307"><span class="linenos">4307</span></a><span class="sd">        - Percentage of non-zero values</span>
</span><span id="GroupAnalysis-4308"><a href="#GroupAnalysis-4308"><span class="linenos">4308</span></a><span class="sd">        - Means and standard deviations</span>
</span><span id="GroupAnalysis-4309"><a href="#GroupAnalysis-4309"><span class="linenos">4309</span></a><span class="sd">        - Effect size metric (ESM)</span>
</span><span id="GroupAnalysis-4310"><a href="#GroupAnalysis-4310"><span class="linenos">4310</span></a><span class="sd">        - Benjamini–Hochberg FDR correction</span>
</span><span id="GroupAnalysis-4311"><a href="#GroupAnalysis-4311"><span class="linenos">4311</span></a><span class="sd">        - Fold-change and log2 fold-change</span>
</span><span id="GroupAnalysis-4312"><a href="#GroupAnalysis-4312"><span class="linenos">4312</span></a>
</span><span id="GroupAnalysis-4313"><a href="#GroupAnalysis-4313"><span class="linenos">4313</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4314"><a href="#GroupAnalysis-4314"><span class="linenos">4314</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4315"><a href="#GroupAnalysis-4315"><span class="linenos">4315</span></a><span class="sd">        meta_group_by : str, optional</span>
</span><span id="GroupAnalysis-4316"><a href="#GroupAnalysis-4316"><span class="linenos">4316</span></a><span class="sd">            Metadata column used for grouping during the analysis.</span>
</span><span id="GroupAnalysis-4317"><a href="#GroupAnalysis-4317"><span class="linenos">4317</span></a><span class="sd">            Default is ``&#39;sets&#39;``.</span>
</span><span id="GroupAnalysis-4318"><a href="#GroupAnalysis-4318"><span class="linenos">4318</span></a><span class="sd">            To view available grouping categories, use ``self.groups``.</span>
</span><span id="GroupAnalysis-4319"><a href="#GroupAnalysis-4319"><span class="linenos">4319</span></a>
</span><span id="GroupAnalysis-4320"><a href="#GroupAnalysis-4320"><span class="linenos">4320</span></a><span class="sd">        sets : dict, optional</span>
</span><span id="GroupAnalysis-4321"><a href="#GroupAnalysis-4321"><span class="linenos">4321</span></a><span class="sd">            Dictionary defining groups for pairwise comparison.</span>
</span><span id="GroupAnalysis-4322"><a href="#GroupAnalysis-4322"><span class="linenos">4322</span></a><span class="sd">            Keys correspond to group names, and values are lists of labels</span>
</span><span id="GroupAnalysis-4323"><a href="#GroupAnalysis-4323"><span class="linenos">4323</span></a><span class="sd">            belonging to each group.</span>
</span><span id="GroupAnalysis-4324"><a href="#GroupAnalysis-4324"><span class="linenos">4324</span></a>
</span><span id="GroupAnalysis-4325"><a href="#GroupAnalysis-4325"><span class="linenos">4325</span></a><span class="sd">            Example</span>
</span><span id="GroupAnalysis-4326"><a href="#GroupAnalysis-4326"><span class="linenos">4326</span></a><span class="sd">            -------</span>
</span><span id="GroupAnalysis-4327"><a href="#GroupAnalysis-4327"><span class="linenos">4327</span></a><span class="sd">            &gt;&gt;&gt; sets = {</span>
</span><span id="GroupAnalysis-4328"><a href="#GroupAnalysis-4328"><span class="linenos">4328</span></a><span class="sd">            ...     &#39;healthy&#39;: [&#39;21q&#39;],</span>
</span><span id="GroupAnalysis-4329"><a href="#GroupAnalysis-4329"><span class="linenos">4329</span></a><span class="sd">            ...     &#39;disease&#39;: [&#39;71q&#39;, &#39;77q&#39;, &#39;109q&#39;]</span>
</span><span id="GroupAnalysis-4330"><a href="#GroupAnalysis-4330"><span class="linenos">4330</span></a><span class="sd">            ... }</span>
</span><span id="GroupAnalysis-4331"><a href="#GroupAnalysis-4331"><span class="linenos">4331</span></a><span class="sd">            In this configuration, the *healthy* group is compared against the</span>
</span><span id="GroupAnalysis-4332"><a href="#GroupAnalysis-4332"><span class="linenos">4332</span></a><span class="sd">            aggregated *disease* groups.</span>
</span><span id="GroupAnalysis-4333"><a href="#GroupAnalysis-4333"><span class="linenos">4333</span></a>
</span><span id="GroupAnalysis-4334"><a href="#GroupAnalysis-4334"><span class="linenos">4334</span></a><span class="sd">        n_proc : int, optional</span>
</span><span id="GroupAnalysis-4335"><a href="#GroupAnalysis-4335"><span class="linenos">4335</span></a><span class="sd">            Number of CPU cores used for parallel processing.</span>
</span><span id="GroupAnalysis-4336"><a href="#GroupAnalysis-4336"><span class="linenos">4336</span></a><span class="sd">            Default is ``5``.</span>
</span><span id="GroupAnalysis-4337"><a href="#GroupAnalysis-4337"><span class="linenos">4337</span></a>
</span><span id="GroupAnalysis-4338"><a href="#GroupAnalysis-4338"><span class="linenos">4338</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-4339"><a href="#GroupAnalysis-4339"><span class="linenos">4339</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4340"><a href="#GroupAnalysis-4340"><span class="linenos">4340</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="GroupAnalysis-4341"><a href="#GroupAnalysis-4341"><span class="linenos">4341</span></a><span class="sd">            A DataFrame containing statistical results for each feature, including:</span>
</span><span id="GroupAnalysis-4342"><a href="#GroupAnalysis-4342"><span class="linenos">4342</span></a>
</span><span id="GroupAnalysis-4343"><a href="#GroupAnalysis-4343"><span class="linenos">4343</span></a><span class="sd">            - ``feature`` : str</span>
</span><span id="GroupAnalysis-4344"><a href="#GroupAnalysis-4344"><span class="linenos">4344</span></a><span class="sd">            - ``p_val`` : float</span>
</span><span id="GroupAnalysis-4345"><a href="#GroupAnalysis-4345"><span class="linenos">4345</span></a><span class="sd">            - ``adj_pval`` : float</span>
</span><span id="GroupAnalysis-4346"><a href="#GroupAnalysis-4346"><span class="linenos">4346</span></a><span class="sd">            - ``pct_valid`` : float</span>
</span><span id="GroupAnalysis-4347"><a href="#GroupAnalysis-4347"><span class="linenos">4347</span></a><span class="sd">            - ``pct_ctrl`` : float</span>
</span><span id="GroupAnalysis-4348"><a href="#GroupAnalysis-4348"><span class="linenos">4348</span></a><span class="sd">            - ``avg_valid`` : float</span>
</span><span id="GroupAnalysis-4349"><a href="#GroupAnalysis-4349"><span class="linenos">4349</span></a><span class="sd">            - ``avg_ctrl`` : float</span>
</span><span id="GroupAnalysis-4350"><a href="#GroupAnalysis-4350"><span class="linenos">4350</span></a><span class="sd">            - ``sd_valid`` : float</span>
</span><span id="GroupAnalysis-4351"><a href="#GroupAnalysis-4351"><span class="linenos">4351</span></a><span class="sd">            - ``sd_ctrl`` : float</span>
</span><span id="GroupAnalysis-4352"><a href="#GroupAnalysis-4352"><span class="linenos">4352</span></a><span class="sd">            - ``esm`` : float</span>
</span><span id="GroupAnalysis-4353"><a href="#GroupAnalysis-4353"><span class="linenos">4353</span></a><span class="sd">            - ``FC`` : float</span>
</span><span id="GroupAnalysis-4354"><a href="#GroupAnalysis-4354"><span class="linenos">4354</span></a><span class="sd">            - ``log(FC)`` : float</span>
</span><span id="GroupAnalysis-4355"><a href="#GroupAnalysis-4355"><span class="linenos">4355</span></a><span class="sd">            - ``norm_diff`` : float</span>
</span><span id="GroupAnalysis-4356"><a href="#GroupAnalysis-4356"><span class="linenos">4356</span></a><span class="sd">            - ``valid_group`` : str</span>
</span><span id="GroupAnalysis-4357"><a href="#GroupAnalysis-4357"><span class="linenos">4357</span></a><span class="sd">            - ``-log(p_val)`` : float</span>
</span><span id="GroupAnalysis-4358"><a href="#GroupAnalysis-4358"><span class="linenos">4358</span></a>
</span><span id="GroupAnalysis-4359"><a href="#GroupAnalysis-4359"><span class="linenos">4359</span></a><span class="sd">            If ``sets`` is ``None``, results for each group are concatenated.</span>
</span><span id="GroupAnalysis-4360"><a href="#GroupAnalysis-4360"><span class="linenos">4360</span></a>
</span><span id="GroupAnalysis-4361"><a href="#GroupAnalysis-4361"><span class="linenos">4361</span></a><span class="sd">            Returns ``None`` in case of errors or invalid parameters.</span>
</span><span id="GroupAnalysis-4362"><a href="#GroupAnalysis-4362"><span class="linenos">4362</span></a>
</span><span id="GroupAnalysis-4363"><a href="#GroupAnalysis-4363"><span class="linenos">4363</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-4364"><a href="#GroupAnalysis-4364"><span class="linenos">4364</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-4365"><a href="#GroupAnalysis-4365"><span class="linenos">4365</span></a><span class="sd">        - Columns containing only zeros are automatically removed.</span>
</span><span id="GroupAnalysis-4366"><a href="#GroupAnalysis-4366"><span class="linenos">4366</span></a><span class="sd">        - p-values equal for both groups produce ``p_val = 1``.</span>
</span><span id="GroupAnalysis-4367"><a href="#GroupAnalysis-4367"><span class="linenos">4367</span></a><span class="sd">        - Benjamini–Hochberg correction is applied separately within each group comparison.</span>
</span><span id="GroupAnalysis-4368"><a href="#GroupAnalysis-4368"><span class="linenos">4368</span></a><span class="sd">        - Fold-change is stabilized using a small, data-derived ``low_factor``.</span>
</span><span id="GroupAnalysis-4369"><a href="#GroupAnalysis-4369"><span class="linenos">4369</span></a><span class="sd">        - Uses ``Mann–Whitney U`` test with ``alternative=&#39;two-sided&#39;``.</span>
</span><span id="GroupAnalysis-4370"><a href="#GroupAnalysis-4370"><span class="linenos">4370</span></a>
</span><span id="GroupAnalysis-4371"><a href="#GroupAnalysis-4371"><span class="linenos">4371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4372"><a href="#GroupAnalysis-4372"><span class="linenos">4372</span></a>
</span><span id="GroupAnalysis-4373"><a href="#GroupAnalysis-4373"><span class="linenos">4373</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4374"><a href="#GroupAnalysis-4374"><span class="linenos">4374</span></a>
</span><span id="GroupAnalysis-4375"><a href="#GroupAnalysis-4375"><span class="linenos">4375</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4376"><a href="#GroupAnalysis-4376"><span class="linenos">4376</span></a>
</span><span id="GroupAnalysis-4377"><a href="#GroupAnalysis-4377"><span class="linenos">4377</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4378"><a href="#GroupAnalysis-4378"><span class="linenos">4378</span></a>
</span><span id="GroupAnalysis-4379"><a href="#GroupAnalysis-4379"><span class="linenos">4379</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="GroupAnalysis-4380"><a href="#GroupAnalysis-4380"><span class="linenos">4380</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on provided sets dictionary and meta_group_by...&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4381"><a href="#GroupAnalysis-4381"><span class="linenos">4381</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="GroupAnalysis-4382"><a href="#GroupAnalysis-4382"><span class="linenos">4382</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="GroupAnalysis-4383"><a href="#GroupAnalysis-4383"><span class="linenos">4383</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="GroupAnalysis-4384"><a href="#GroupAnalysis-4384"><span class="linenos">4384</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="n">sets</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="GroupAnalysis-4385"><a href="#GroupAnalysis-4385"><span class="linenos">4385</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4386"><a href="#GroupAnalysis-4386"><span class="linenos">4386</span></a>
</span><span id="GroupAnalysis-4387"><a href="#GroupAnalysis-4387"><span class="linenos">4387</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4388"><a href="#GroupAnalysis-4388"><span class="linenos">4388</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-4389"><a href="#GroupAnalysis-4389"><span class="linenos">4389</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on for all groups to each other in meta_group_by...&quot;</span>
</span><span id="GroupAnalysis-4390"><a href="#GroupAnalysis-4390"><span class="linenos">4390</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4391"><a href="#GroupAnalysis-4391"><span class="linenos">4391</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="GroupAnalysis-4392"><a href="#GroupAnalysis-4392"><span class="linenos">4392</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="GroupAnalysis-4393"><a href="#GroupAnalysis-4393"><span class="linenos">4393</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="GroupAnalysis-4394"><a href="#GroupAnalysis-4394"><span class="linenos">4394</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="GroupAnalysis-4395"><a href="#GroupAnalysis-4395"><span class="linenos">4395</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4396"><a href="#GroupAnalysis-4396"><span class="linenos">4396</span></a>
</span><span id="GroupAnalysis-4397"><a href="#GroupAnalysis-4397"><span class="linenos">4397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="n">results</span>
</span><span id="GroupAnalysis-4398"><a href="#GroupAnalysis-4398"><span class="linenos">4398</span></a>
</span><span id="GroupAnalysis-4399"><a href="#GroupAnalysis-4399"><span class="linenos">4399</span></a>    
</span><span id="GroupAnalysis-4400"><a href="#GroupAnalysis-4400"><span class="linenos">4400</span></a>
</span><span id="GroupAnalysis-4401"><a href="#GroupAnalysis-4401"><span class="linenos">4401</span></a>
</span><span id="GroupAnalysis-4402"><a href="#GroupAnalysis-4402"><span class="linenos">4402</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heatmap_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="GroupAnalysis-4403"><a href="#GroupAnalysis-4403"><span class="linenos">4403</span></a>                    <span class="n">p_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
</span><span id="GroupAnalysis-4404"><a href="#GroupAnalysis-4404"><span class="linenos">4404</span></a>                    <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GroupAnalysis-4405"><a href="#GroupAnalysis-4405"><span class="linenos">4405</span></a>                    <span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GroupAnalysis-4406"><a href="#GroupAnalysis-4406"><span class="linenos">4406</span></a>                    <span class="n">clustering</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4407"><a href="#GroupAnalysis-4407"><span class="linenos">4407</span></a>                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
</span><span id="GroupAnalysis-4408"><a href="#GroupAnalysis-4408"><span class="linenos">4408</span></a><span class="w">        </span>
</span><span id="GroupAnalysis-4409"><a href="#GroupAnalysis-4409"><span class="linenos">4409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4410"><a href="#GroupAnalysis-4410"><span class="linenos">4410</span></a><span class="sd">        Generate a heatmap of the top DFA features filtered by p-value and log fold change.</span>
</span><span id="GroupAnalysis-4411"><a href="#GroupAnalysis-4411"><span class="linenos">4411</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4412"><a href="#GroupAnalysis-4412"><span class="linenos">4412</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4413"><a href="#GroupAnalysis-4413"><span class="linenos">4413</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4414"><a href="#GroupAnalysis-4414"><span class="linenos">4414</span></a><span class="sd">        p_value : float or int, optional</span>
</span><span id="GroupAnalysis-4415"><a href="#GroupAnalysis-4415"><span class="linenos">4415</span></a><span class="sd">            Significance threshold used to filter features by their p-value.</span>
</span><span id="GroupAnalysis-4416"><a href="#GroupAnalysis-4416"><span class="linenos">4416</span></a><span class="sd">            Only features with p_val &lt; p_value are included. Default is 0.05.</span>
</span><span id="GroupAnalysis-4417"><a href="#GroupAnalysis-4417"><span class="linenos">4417</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4418"><a href="#GroupAnalysis-4418"><span class="linenos">4418</span></a><span class="sd">        top_n : int, optional</span>
</span><span id="GroupAnalysis-4419"><a href="#GroupAnalysis-4419"><span class="linenos">4419</span></a><span class="sd">            Number of top features selected per group based on the &#39;esm&#39; score.</span>
</span><span id="GroupAnalysis-4420"><a href="#GroupAnalysis-4420"><span class="linenos">4420</span></a><span class="sd">            Default is 5.</span>
</span><span id="GroupAnalysis-4421"><a href="#GroupAnalysis-4421"><span class="linenos">4421</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4422"><a href="#GroupAnalysis-4422"><span class="linenos">4422</span></a><span class="sd">        scale : bool, optional</span>
</span><span id="GroupAnalysis-4423"><a href="#GroupAnalysis-4423"><span class="linenos">4423</span></a><span class="sd">            Whether to apply Min–Max scaling to heatmap values across features.</span>
</span><span id="GroupAnalysis-4424"><a href="#GroupAnalysis-4424"><span class="linenos">4424</span></a><span class="sd">            Default is False.</span>
</span><span id="GroupAnalysis-4425"><a href="#GroupAnalysis-4425"><span class="linenos">4425</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4426"><a href="#GroupAnalysis-4426"><span class="linenos">4426</span></a><span class="sd">        clustering : str or None, optional</span>
</span><span id="GroupAnalysis-4427"><a href="#GroupAnalysis-4427"><span class="linenos">4427</span></a><span class="sd">            Hierarchical clustering method applied to rows/columns of the heatmap.</span>
</span><span id="GroupAnalysis-4428"><a href="#GroupAnalysis-4428"><span class="linenos">4428</span></a><span class="sd">            If None, clustering is disabled. Default is &#39;ward&#39;.</span>
</span><span id="GroupAnalysis-4429"><a href="#GroupAnalysis-4429"><span class="linenos">4429</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4430"><a href="#GroupAnalysis-4430"><span class="linenos">4430</span></a><span class="sd">        figsize : tuple, optional</span>
</span><span id="GroupAnalysis-4431"><a href="#GroupAnalysis-4431"><span class="linenos">4431</span></a><span class="sd">            Size of the resulting matplotlib figure. Default is (10, 5).</span>
</span><span id="GroupAnalysis-4432"><a href="#GroupAnalysis-4432"><span class="linenos">4432</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis-4433"><a href="#GroupAnalysis-4433"><span class="linenos">4433</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis-4434"><a href="#GroupAnalysis-4434"><span class="linenos">4434</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis-4435"><a href="#GroupAnalysis-4435"><span class="linenos">4435</span></a><span class="sd">        - Only features with a positive log fold change (&#39;log(FC)&#39; &gt; 0) are considered.</span>
</span><span id="GroupAnalysis-4436"><a href="#GroupAnalysis-4436"><span class="linenos">4436</span></a><span class="sd">        - Heatmap values represent -log10(p_value) for visualization.</span>
</span><span id="GroupAnalysis-4437"><a href="#GroupAnalysis-4437"><span class="linenos">4437</span></a><span class="sd">        - If `scale=True`, values are normalized using Min–Max scaling.</span>
</span><span id="GroupAnalysis-4438"><a href="#GroupAnalysis-4438"><span class="linenos">4438</span></a><span class="sd">        - The generated figure is displayed and stored in `self.DFA_plot`.</span>
</span><span id="GroupAnalysis-4439"><a href="#GroupAnalysis-4439"><span class="linenos">4439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4440"><a href="#GroupAnalysis-4440"><span class="linenos">4440</span></a>
</span><span id="GroupAnalysis-4441"><a href="#GroupAnalysis-4441"><span class="linenos">4441</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4442"><a href="#GroupAnalysis-4442"><span class="linenos">4442</span></a>
</span><span id="GroupAnalysis-4443"><a href="#GroupAnalysis-4443"><span class="linenos">4443</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;log(FC)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="GroupAnalysis-4444"><a href="#GroupAnalysis-4444"><span class="linenos">4444</span></a>
</span><span id="GroupAnalysis-4445"><a href="#GroupAnalysis-4445"><span class="linenos">4445</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p_value</span><span class="p">]</span>
</span><span id="GroupAnalysis-4446"><a href="#GroupAnalysis-4446"><span class="linenos">4446</span></a>
</span><span id="GroupAnalysis-4447"><a href="#GroupAnalysis-4447"><span class="linenos">4447</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GroupAnalysis-4448"><a href="#GroupAnalysis-4448"><span class="linenos">4448</span></a>            <span class="n">df_reduced</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="s2">&quot;esm&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="GroupAnalysis-4449"><a href="#GroupAnalysis-4449"><span class="linenos">4449</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GroupAnalysis-4450"><a href="#GroupAnalysis-4450"><span class="linenos">4450</span></a>            <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>
</span><span id="GroupAnalysis-4451"><a href="#GroupAnalysis-4451"><span class="linenos">4451</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis-4452"><a href="#GroupAnalysis-4452"><span class="linenos">4452</span></a>
</span><span id="GroupAnalysis-4453"><a href="#GroupAnalysis-4453"><span class="linenos">4453</span></a>        <span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;-log(p_value)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis-4454"><a href="#GroupAnalysis-4454"><span class="linenos">4454</span></a>
</span><span id="GroupAnalysis-4455"><a href="#GroupAnalysis-4455"><span class="linenos">4455</span></a>        <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
</span><span id="GroupAnalysis-4456"><a href="#GroupAnalysis-4456"><span class="linenos">4456</span></a>            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;-log(p_value)&quot;</span>
</span><span id="GroupAnalysis-4457"><a href="#GroupAnalysis-4457"><span class="linenos">4457</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="GroupAnalysis-4458"><a href="#GroupAnalysis-4458"><span class="linenos">4458</span></a>
</span><span id="GroupAnalysis-4459"><a href="#GroupAnalysis-4459"><span class="linenos">4459</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;-log10(p_value)&quot;</span>
</span><span id="GroupAnalysis-4460"><a href="#GroupAnalysis-4460"><span class="linenos">4460</span></a>        
</span><span id="GroupAnalysis-4461"><a href="#GroupAnalysis-4461"><span class="linenos">4461</span></a>        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
</span><span id="GroupAnalysis-4462"><a href="#GroupAnalysis-4462"><span class="linenos">4462</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;scaled(</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GroupAnalysis-4463"><a href="#GroupAnalysis-4463"><span class="linenos">4463</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
</span><span id="GroupAnalysis-4464"><a href="#GroupAnalysis-4464"><span class="linenos">4464</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="GroupAnalysis-4465"><a href="#GroupAnalysis-4465"><span class="linenos">4465</span></a>                <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">),</span>
</span><span id="GroupAnalysis-4466"><a href="#GroupAnalysis-4466"><span class="linenos">4466</span></a>                <span class="n">index</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="GroupAnalysis-4467"><a href="#GroupAnalysis-4467"><span class="linenos">4467</span></a>                <span class="n">columns</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="GroupAnalysis-4468"><a href="#GroupAnalysis-4468"><span class="linenos">4468</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4469"><a href="#GroupAnalysis-4469"><span class="linenos">4469</span></a>            
</span><span id="GroupAnalysis-4470"><a href="#GroupAnalysis-4470"><span class="linenos">4470</span></a>        <span class="k">if</span> <span class="n">clustering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis-4471"><a href="#GroupAnalysis-4471"><span class="linenos">4471</span></a>            <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="GroupAnalysis-4472"><a href="#GroupAnalysis-4472"><span class="linenos">4472</span></a>            <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="GroupAnalysis-4473"><a href="#GroupAnalysis-4473"><span class="linenos">4473</span></a>    
</span><span id="GroupAnalysis-4474"><a href="#GroupAnalysis-4474"><span class="linenos">4474</span></a>            <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="GroupAnalysis-4475"><a href="#GroupAnalysis-4475"><span class="linenos">4475</span></a>            <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="GroupAnalysis-4476"><a href="#GroupAnalysis-4476"><span class="linenos">4476</span></a>    
</span><span id="GroupAnalysis-4477"><a href="#GroupAnalysis-4477"><span class="linenos">4477</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="GroupAnalysis-4478"><a href="#GroupAnalysis-4478"><span class="linenos">4478</span></a>
</span><span id="GroupAnalysis-4479"><a href="#GroupAnalysis-4479"><span class="linenos">4479</span></a>
</span><span id="GroupAnalysis-4480"><a href="#GroupAnalysis-4480"><span class="linenos">4480</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="GroupAnalysis-4481"><a href="#GroupAnalysis-4481"><span class="linenos">4481</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
</span><span id="GroupAnalysis-4482"><a href="#GroupAnalysis-4482"><span class="linenos">4482</span></a>            <span class="n">heatmap_data</span><span class="p">,</span>
</span><span id="GroupAnalysis-4483"><a href="#GroupAnalysis-4483"><span class="linenos">4483</span></a>            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4484"><a href="#GroupAnalysis-4484"><span class="linenos">4484</span></a>            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="GroupAnalysis-4485"><a href="#GroupAnalysis-4485"><span class="linenos">4485</span></a>            <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4486"><a href="#GroupAnalysis-4486"><span class="linenos">4486</span></a>            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">},</span>
</span><span id="GroupAnalysis-4487"><a href="#GroupAnalysis-4487"><span class="linenos">4487</span></a>            <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4488"><a href="#GroupAnalysis-4488"><span class="linenos">4488</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis-4489"><a href="#GroupAnalysis-4489"><span class="linenos">4489</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4490"><a href="#GroupAnalysis-4490"><span class="linenos">4490</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4491"><a href="#GroupAnalysis-4491"><span class="linenos">4491</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4492"><a href="#GroupAnalysis-4492"><span class="linenos">4492</span></a>
</span><span id="GroupAnalysis-4493"><a href="#GroupAnalysis-4493"><span class="linenos">4493</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="GroupAnalysis-4494"><a href="#GroupAnalysis-4494"><span class="linenos">4494</span></a>
</span><span id="GroupAnalysis-4495"><a href="#GroupAnalysis-4495"><span class="linenos">4495</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-4496"><a href="#GroupAnalysis-4496"><span class="linenos">4496</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="GroupAnalysis-4497"><a href="#GroupAnalysis-4497"><span class="linenos">4497</span></a>
</span><span id="GroupAnalysis-4498"><a href="#GroupAnalysis-4498"><span class="linenos">4498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="o">=</span> <span class="n">figure</span>
</span><span id="GroupAnalysis-4499"><a href="#GroupAnalysis-4499"><span class="linenos">4499</span></a>
</span><span id="GroupAnalysis-4500"><a href="#GroupAnalysis-4500"><span class="linenos">4500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis-4501"><a href="#GroupAnalysis-4501"><span class="linenos">4501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4502"><a href="#GroupAnalysis-4502"><span class="linenos">4502</span></a><span class="sd">        Retrieve the heatmap figure generated by `heatmap_DFA()`.</span>
</span><span id="GroupAnalysis-4503"><a href="#GroupAnalysis-4503"><span class="linenos">4503</span></a>
</span><span id="GroupAnalysis-4504"><a href="#GroupAnalysis-4504"><span class="linenos">4504</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4505"><a href="#GroupAnalysis-4505"><span class="linenos">4505</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4506"><a href="#GroupAnalysis-4506"><span class="linenos">4506</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis-4507"><a href="#GroupAnalysis-4507"><span class="linenos">4507</span></a><span class="sd">            Whether to display the stored heatmap figure. Default is True.</span>
</span><span id="GroupAnalysis-4508"><a href="#GroupAnalysis-4508"><span class="linenos">4508</span></a>
</span><span id="GroupAnalysis-4509"><a href="#GroupAnalysis-4509"><span class="linenos">4509</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-4510"><a href="#GroupAnalysis-4510"><span class="linenos">4510</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4511"><a href="#GroupAnalysis-4511"><span class="linenos">4511</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis-4512"><a href="#GroupAnalysis-4512"><span class="linenos">4512</span></a><span class="sd">            The figure object containing the DFA heatmap.</span>
</span><span id="GroupAnalysis-4513"><a href="#GroupAnalysis-4513"><span class="linenos">4513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4514"><a href="#GroupAnalysis-4514"><span class="linenos">4514</span></a>
</span><span id="GroupAnalysis-4515"><a href="#GroupAnalysis-4515"><span class="linenos">4515</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis-4516"><a href="#GroupAnalysis-4516"><span class="linenos">4516</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the heatmap_DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4517"><a href="#GroupAnalysis-4517"><span class="linenos">4517</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4518"><a href="#GroupAnalysis-4518"><span class="linenos">4518</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-4519"><a href="#GroupAnalysis-4519"><span class="linenos">4519</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GroupAnalysis-4520"><a href="#GroupAnalysis-4520"><span class="linenos">4520</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span><span id="GroupAnalysis-4521"><a href="#GroupAnalysis-4521"><span class="linenos">4521</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-4522"><a href="#GroupAnalysis-4522"><span class="linenos">4522</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis-4523"><a href="#GroupAnalysis-4523"><span class="linenos">4523</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-4524"><a href="#GroupAnalysis-4524"><span class="linenos">4524</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis-4525"><a href="#GroupAnalysis-4525"><span class="linenos">4525</span></a>
</span><span id="GroupAnalysis-4526"><a href="#GroupAnalysis-4526"><span class="linenos">4526</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span><span id="GroupAnalysis-4527"><a href="#GroupAnalysis-4527"><span class="linenos">4527</span></a>
</span><span id="GroupAnalysis-4528"><a href="#GroupAnalysis-4528"><span class="linenos">4528</span></a>       
</span><span id="GroupAnalysis-4529"><a href="#GroupAnalysis-4529"><span class="linenos">4529</span></a>
</span><span id="GroupAnalysis-4530"><a href="#GroupAnalysis-4530"><span class="linenos">4530</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_avaiable_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-4531"><a href="#GroupAnalysis-4531"><span class="linenos">4531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4532"><a href="#GroupAnalysis-4532"><span class="linenos">4532</span></a><span class="sd">        Print the available features (columns) in the current dataset.</span>
</span><span id="GroupAnalysis-4533"><a href="#GroupAnalysis-4533"><span class="linenos">4533</span></a>
</span><span id="GroupAnalysis-4534"><a href="#GroupAnalysis-4534"><span class="linenos">4534</span></a><span class="sd">        This method lists all column names in `self.tmp_data` to help identify which features are available for analysis.</span>
</span><span id="GroupAnalysis-4535"><a href="#GroupAnalysis-4535"><span class="linenos">4535</span></a>
</span><span id="GroupAnalysis-4536"><a href="#GroupAnalysis-4536"><span class="linenos">4536</span></a><span class="sd">        Example</span>
</span><span id="GroupAnalysis-4537"><a href="#GroupAnalysis-4537"><span class="linenos">4537</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4538"><a href="#GroupAnalysis-4538"><span class="linenos">4538</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.print_avaiable_features()</span>
</span><span id="GroupAnalysis-4539"><a href="#GroupAnalysis-4539"><span class="linenos">4539</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4540"><a href="#GroupAnalysis-4540"><span class="linenos">4540</span></a>
</span><span id="GroupAnalysis-4541"><a href="#GroupAnalysis-4541"><span class="linenos">4541</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Avaiable features:&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4542"><a href="#GroupAnalysis-4542"><span class="linenos">4542</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GroupAnalysis-4543"><a href="#GroupAnalysis-4543"><span class="linenos">4543</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span><span id="GroupAnalysis-4544"><a href="#GroupAnalysis-4544"><span class="linenos">4544</span></a>
</span><span id="GroupAnalysis-4545"><a href="#GroupAnalysis-4545"><span class="linenos">4545</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">proportion_analysis</span><span class="p">(</span>
</span><span id="GroupAnalysis-4546"><a href="#GroupAnalysis-4546"><span class="linenos">4546</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis-4547"><a href="#GroupAnalysis-4547"><span class="linenos">4547</span></a>        <span class="n">grouping_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4548"><a href="#GroupAnalysis-4548"><span class="linenos">4548</span></a>        <span class="n">val_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;nuclei_per_img&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4549"><a href="#GroupAnalysis-4549"><span class="linenos">4549</span></a>        <span class="n">grouping_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="GroupAnalysis-4550"><a href="#GroupAnalysis-4550"><span class="linenos">4550</span></a>        <span class="n">omit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="GroupAnalysis-4551"><a href="#GroupAnalysis-4551"><span class="linenos">4551</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis-4552"><a href="#GroupAnalysis-4552"><span class="linenos">4552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4553"><a href="#GroupAnalysis-4553"><span class="linenos">4553</span></a><span class="sd">        Perform proportion analysis by comparing the distribution of values across groups.</span>
</span><span id="GroupAnalysis-4554"><a href="#GroupAnalysis-4554"><span class="linenos">4554</span></a>
</span><span id="GroupAnalysis-4555"><a href="#GroupAnalysis-4555"><span class="linenos">4555</span></a><span class="sd">        This method analyzes the distribution of values (e.g., nuclei counts) across different groups defined in the dataset. It can optionally group categories, omit specific values, and produces both statistical results and a visualization.</span>
</span><span id="GroupAnalysis-4556"><a href="#GroupAnalysis-4556"><span class="linenos">4556</span></a>
</span><span id="GroupAnalysis-4557"><a href="#GroupAnalysis-4557"><span class="linenos">4557</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4558"><a href="#GroupAnalysis-4558"><span class="linenos">4558</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4559"><a href="#GroupAnalysis-4559"><span class="linenos">4559</span></a><span class="sd">        grouping_col : str, optional</span>
</span><span id="GroupAnalysis-4560"><a href="#GroupAnalysis-4560"><span class="linenos">4560</span></a><span class="sd">            Column to group by. Default is &#39;sets&#39;.</span>
</span><span id="GroupAnalysis-4561"><a href="#GroupAnalysis-4561"><span class="linenos">4561</span></a>
</span><span id="GroupAnalysis-4562"><a href="#GroupAnalysis-4562"><span class="linenos">4562</span></a><span class="sd">        val_col : str, optional</span>
</span><span id="GroupAnalysis-4563"><a href="#GroupAnalysis-4563"><span class="linenos">4563</span></a><span class="sd">            Column containing the values to analyze. Default is &#39;nuclei_per_img&#39;.</span>
</span><span id="GroupAnalysis-4564"><a href="#GroupAnalysis-4564"><span class="linenos">4564</span></a>
</span><span id="GroupAnalysis-4565"><a href="#GroupAnalysis-4565"><span class="linenos">4565</span></a><span class="sd">        grouping_dict : dict or None, optional</span>
</span><span id="GroupAnalysis-4566"><a href="#GroupAnalysis-4566"><span class="linenos">4566</span></a><span class="sd">            Dictionary mapping new group names to categories in `grouping_col`. If None, analysis is based on the original groups.</span>
</span><span id="GroupAnalysis-4567"><a href="#GroupAnalysis-4567"><span class="linenos">4567</span></a>
</span><span id="GroupAnalysis-4568"><a href="#GroupAnalysis-4568"><span class="linenos">4568</span></a><span class="sd">        omit : str, list, or None, optional</span>
</span><span id="GroupAnalysis-4569"><a href="#GroupAnalysis-4569"><span class="linenos">4569</span></a><span class="sd">            Values to exclude from the analysis. Default is None.</span>
</span><span id="GroupAnalysis-4570"><a href="#GroupAnalysis-4570"><span class="linenos">4570</span></a>
</span><span id="GroupAnalysis-4571"><a href="#GroupAnalysis-4571"><span class="linenos">4571</span></a><span class="sd">        Attributes</span>
</span><span id="GroupAnalysis-4572"><a href="#GroupAnalysis-4572"><span class="linenos">4572</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4573"><a href="#GroupAnalysis-4573"><span class="linenos">4573</span></a><span class="sd">        proportion_stats : pd.DataFrame</span>
</span><span id="GroupAnalysis-4574"><a href="#GroupAnalysis-4574"><span class="linenos">4574</span></a><span class="sd">            DataFrame containing chi-square test results for pairwise group comparisons.</span>
</span><span id="GroupAnalysis-4575"><a href="#GroupAnalysis-4575"><span class="linenos">4575</span></a>
</span><span id="GroupAnalysis-4576"><a href="#GroupAnalysis-4576"><span class="linenos">4576</span></a><span class="sd">        proportion_plot : matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis-4577"><a href="#GroupAnalysis-4577"><span class="linenos">4577</span></a><span class="sd">            Plot visualizing the proportions across groups.</span>
</span><span id="GroupAnalysis-4578"><a href="#GroupAnalysis-4578"><span class="linenos">4578</span></a>
</span><span id="GroupAnalysis-4579"><a href="#GroupAnalysis-4579"><span class="linenos">4579</span></a><span class="sd">        Example</span>
</span><span id="GroupAnalysis-4580"><a href="#GroupAnalysis-4580"><span class="linenos">4580</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4581"><a href="#GroupAnalysis-4581"><span class="linenos">4581</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.proportion_analysis(</span>
</span><span id="GroupAnalysis-4582"><a href="#GroupAnalysis-4582"><span class="linenos">4582</span></a><span class="sd">        ...     grouping_col=&#39;sets&#39;,</span>
</span><span id="GroupAnalysis-4583"><a href="#GroupAnalysis-4583"><span class="linenos">4583</span></a><span class="sd">        ...     val_col=&#39;nuclei_per_img&#39;,</span>
</span><span id="GroupAnalysis-4584"><a href="#GroupAnalysis-4584"><span class="linenos">4584</span></a><span class="sd">        ...     grouping_dict={&#39;Group A&#39;: [1, 2], &#39;Group B&#39;: [3, 4]},</span>
</span><span id="GroupAnalysis-4585"><a href="#GroupAnalysis-4585"><span class="linenos">4585</span></a><span class="sd">        ...     omit=5</span>
</span><span id="GroupAnalysis-4586"><a href="#GroupAnalysis-4586"><span class="linenos">4586</span></a><span class="sd">        ... )</span>
</span><span id="GroupAnalysis-4587"><a href="#GroupAnalysis-4587"><span class="linenos">4587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4588"><a href="#GroupAnalysis-4588"><span class="linenos">4588</span></a>
</span><span id="GroupAnalysis-4589"><a href="#GroupAnalysis-4589"><span class="linenos">4589</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis-4590"><a href="#GroupAnalysis-4590"><span class="linenos">4590</span></a>
</span><span id="GroupAnalysis-4591"><a href="#GroupAnalysis-4591"><span class="linenos">4591</span></a>        <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">])</span>
</span><span id="GroupAnalysis-4592"><a href="#GroupAnalysis-4592"><span class="linenos">4592</span></a>
</span><span id="GroupAnalysis-4593"><a href="#GroupAnalysis-4593"><span class="linenos">4593</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[[</span><span class="n">grouping_col</span><span class="p">,</span> <span class="n">val_col</span><span class="p">]]</span>
</span><span id="GroupAnalysis-4594"><a href="#GroupAnalysis-4594"><span class="linenos">4594</span></a>
</span><span id="GroupAnalysis-4595"><a href="#GroupAnalysis-4595"><span class="linenos">4595</span></a>        <span class="k">if</span> <span class="n">omit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis-4596"><a href="#GroupAnalysis-4596"><span class="linenos">4596</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">omit</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="GroupAnalysis-4597"><a href="#GroupAnalysis-4597"><span class="linenos">4597</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="o">~</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">omit</span><span class="p">)]</span>
</span><span id="GroupAnalysis-4598"><a href="#GroupAnalysis-4598"><span class="linenos">4598</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4599"><a href="#GroupAnalysis-4599"><span class="linenos">4599</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span> <span class="o">!=</span> <span class="n">omit</span><span class="p">]</span>
</span><span id="GroupAnalysis-4600"><a href="#GroupAnalysis-4600"><span class="linenos">4600</span></a>
</span><span id="GroupAnalysis-4601"><a href="#GroupAnalysis-4601"><span class="linenos">4601</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GroupAnalysis-4602"><a href="#GroupAnalysis-4602"><span class="linenos">4602</span></a>        <span class="n">andata</span><span class="p">[</span><span class="s2">&quot;index_col&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">index</span>
</span><span id="GroupAnalysis-4603"><a href="#GroupAnalysis-4603"><span class="linenos">4603</span></a>
</span><span id="GroupAnalysis-4604"><a href="#GroupAnalysis-4604"><span class="linenos">4604</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="GroupAnalysis-4605"><a href="#GroupAnalysis-4605"><span class="linenos">4605</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">grouping_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis-4606"><a href="#GroupAnalysis-4606"><span class="linenos">4606</span></a>                <span class="n">andata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="GroupAnalysis-4607"><a href="#GroupAnalysis-4607"><span class="linenos">4607</span></a>                    <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">grouping_col</span>
</span><span id="GroupAnalysis-4608"><a href="#GroupAnalysis-4608"><span class="linenos">4608</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="GroupAnalysis-4609"><a href="#GroupAnalysis-4609"><span class="linenos">4609</span></a>
</span><span id="GroupAnalysis-4610"><a href="#GroupAnalysis-4610"><span class="linenos">4610</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
</span><span id="GroupAnalysis-4611"><a href="#GroupAnalysis-4611"><span class="linenos">4611</span></a>            <span class="n">index</span><span class="o">=</span><span class="n">val_col</span><span class="p">,</span>
</span><span id="GroupAnalysis-4612"><a href="#GroupAnalysis-4612"><span class="linenos">4612</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">grouping_col</span><span class="p">,</span>
</span><span id="GroupAnalysis-4613"><a href="#GroupAnalysis-4613"><span class="linenos">4613</span></a>            <span class="n">values</span><span class="o">=</span><span class="s2">&quot;index_col&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4614"><a href="#GroupAnalysis-4614"><span class="linenos">4614</span></a>            <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis-4615"><a href="#GroupAnalysis-4615"><span class="linenos">4615</span></a>            <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="GroupAnalysis-4616"><a href="#GroupAnalysis-4616"><span class="linenos">4616</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis-4617"><a href="#GroupAnalysis-4617"><span class="linenos">4617</span></a>        
</span><span id="GroupAnalysis-4618"><a href="#GroupAnalysis-4618"><span class="linenos">4618</span></a>        <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4619"><a href="#GroupAnalysis-4619"><span class="linenos">4619</span></a>        <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="GroupAnalysis-4620"><a href="#GroupAnalysis-4620"><span class="linenos">4620</span></a>
</span><span id="GroupAnalysis-4621"><a href="#GroupAnalysis-4621"><span class="linenos">4621</span></a>        <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="GroupAnalysis-4622"><a href="#GroupAnalysis-4622"><span class="linenos">4622</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="GroupAnalysis-4623"><a href="#GroupAnalysis-4623"><span class="linenos">4623</span></a>
</span><span id="GroupAnalysis-4624"><a href="#GroupAnalysis-4624"><span class="linenos">4624</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="GroupAnalysis-4625"><a href="#GroupAnalysis-4625"><span class="linenos">4625</span></a>
</span><span id="GroupAnalysis-4626"><a href="#GroupAnalysis-4626"><span class="linenos">4626</span></a>        <span class="n">chi_df</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="GroupAnalysis-4627"><a href="#GroupAnalysis-4627"><span class="linenos">4627</span></a>
</span><span id="GroupAnalysis-4628"><a href="#GroupAnalysis-4628"><span class="linenos">4628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="GroupAnalysis-4629"><a href="#GroupAnalysis-4629"><span class="linenos">4629</span></a>
</span><span id="GroupAnalysis-4630"><a href="#GroupAnalysis-4630"><span class="linenos">4630</span></a>        <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;Significance_Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;p-value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_significance_label</span><span class="p">)</span>
</span><span id="GroupAnalysis-4631"><a href="#GroupAnalysis-4631"><span class="linenos">4631</span></a>
</span><span id="GroupAnalysis-4632"><a href="#GroupAnalysis-4632"><span class="linenos">4632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="n">prop_plot</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">,</span> <span class="n">chi_df</span><span class="p">)</span>
</span><span id="GroupAnalysis-4633"><a href="#GroupAnalysis-4633"><span class="linenos">4633</span></a>
</span><span id="GroupAnalysis-4634"><a href="#GroupAnalysis-4634"><span class="linenos">4634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis-4635"><a href="#GroupAnalysis-4635"><span class="linenos">4635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4636"><a href="#GroupAnalysis-4636"><span class="linenos">4636</span></a><span class="sd">        Retrieve the proportion bar plot generated by the `proportion_analysis()` method.</span>
</span><span id="GroupAnalysis-4637"><a href="#GroupAnalysis-4637"><span class="linenos">4637</span></a>
</span><span id="GroupAnalysis-4638"><a href="#GroupAnalysis-4638"><span class="linenos">4638</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis-4639"><a href="#GroupAnalysis-4639"><span class="linenos">4639</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis-4640"><a href="#GroupAnalysis-4640"><span class="linenos">4640</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis-4641"><a href="#GroupAnalysis-4641"><span class="linenos">4641</span></a><span class="sd">            Whether to display the proportion bar plot. Default is True.</span>
</span><span id="GroupAnalysis-4642"><a href="#GroupAnalysis-4642"><span class="linenos">4642</span></a>
</span><span id="GroupAnalysis-4643"><a href="#GroupAnalysis-4643"><span class="linenos">4643</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-4644"><a href="#GroupAnalysis-4644"><span class="linenos">4644</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4645"><a href="#GroupAnalysis-4645"><span class="linenos">4645</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis-4646"><a href="#GroupAnalysis-4646"><span class="linenos">4646</span></a><span class="sd">            The figure object containing the proportion bar plot.</span>
</span><span id="GroupAnalysis-4647"><a href="#GroupAnalysis-4647"><span class="linenos">4647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4648"><a href="#GroupAnalysis-4648"><span class="linenos">4648</span></a>
</span><span id="GroupAnalysis-4649"><a href="#GroupAnalysis-4649"><span class="linenos">4649</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis-4650"><a href="#GroupAnalysis-4650"><span class="linenos">4650</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-4651"><a href="#GroupAnalysis-4651"><span class="linenos">4651</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="GroupAnalysis-4652"><a href="#GroupAnalysis-4652"><span class="linenos">4652</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4653"><a href="#GroupAnalysis-4653"><span class="linenos">4653</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4654"><a href="#GroupAnalysis-4654"><span class="linenos">4654</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis-4655"><a href="#GroupAnalysis-4655"><span class="linenos">4655</span></a>                <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis-4656"><a href="#GroupAnalysis-4656"><span class="linenos">4656</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span><span id="GroupAnalysis-4657"><a href="#GroupAnalysis-4657"><span class="linenos">4657</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis-4658"><a href="#GroupAnalysis-4658"><span class="linenos">4658</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis-4659"><a href="#GroupAnalysis-4659"><span class="linenos">4659</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis-4660"><a href="#GroupAnalysis-4660"><span class="linenos">4660</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis-4661"><a href="#GroupAnalysis-4661"><span class="linenos">4661</span></a>
</span><span id="GroupAnalysis-4662"><a href="#GroupAnalysis-4662"><span class="linenos">4662</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span><span id="GroupAnalysis-4663"><a href="#GroupAnalysis-4663"><span class="linenos">4663</span></a>
</span><span id="GroupAnalysis-4664"><a href="#GroupAnalysis-4664"><span class="linenos">4664</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis-4665"><a href="#GroupAnalysis-4665"><span class="linenos">4665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4666"><a href="#GroupAnalysis-4666"><span class="linenos">4666</span></a><span class="sd">        Retrieve the proportion statistics computed by the `proportion_analysis()` method.</span>
</span><span id="GroupAnalysis-4667"><a href="#GroupAnalysis-4667"><span class="linenos">4667</span></a>
</span><span id="GroupAnalysis-4668"><a href="#GroupAnalysis-4668"><span class="linenos">4668</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis-4669"><a href="#GroupAnalysis-4669"><span class="linenos">4669</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis-4670"><a href="#GroupAnalysis-4670"><span class="linenos">4670</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="GroupAnalysis-4671"><a href="#GroupAnalysis-4671"><span class="linenos">4671</span></a><span class="sd">            The proportion statistics stored in `self.proportion_stats`.</span>
</span><span id="GroupAnalysis-4672"><a href="#GroupAnalysis-4672"><span class="linenos">4672</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis-4673"><a href="#GroupAnalysis-4673"><span class="linenos">4673</span></a>
</span><span id="GroupAnalysis-4674"><a href="#GroupAnalysis-4674"><span class="linenos">4674</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span><span class="p">:</span>
</span><span id="GroupAnalysis-4675"><a href="#GroupAnalysis-4675"><span class="linenos">4675</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis-4676"><a href="#GroupAnalysis-4676"><span class="linenos">4676</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="GroupAnalysis-4677"><a href="#GroupAnalysis-4677"><span class="linenos">4677</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis-4678"><a href="#GroupAnalysis-4678"><span class="linenos">4678</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis-4679"><a href="#GroupAnalysis-4679"><span class="linenos">4679</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span>
</span></pre></div>


            <div class="docstring"><p>A class for performing multivariate analysis, dimensionality reduction,
clustering, and differential feature analysis (DFA) on biological or
experimental datasets.</p>

<p>This class provides tools for:</p>

<ul>
<li>Scaling and PCA of input data</li>
<li>UMAP embedding and DBSCAN clustering</li>
<li>Differential Feature Analysis across groups</li>
<li>Proportion analysis and plotting</li>
<li>Data selection and merging with metadata</li>
</ul>

<h2 id="attributes">Attributes</h2>

<p>input_data : pd.DataFrame
    The primary dataset containing features for analysis.</p>

<p>input_metadata : pd.DataFrame
    Metadata corresponding to the input data, including identifiers and group labels.</p>

<p>tmp_data : pd.DataFrame
    Temporary copy of the input data, used for feature selection and filtering.</p>

<p>tmp_metadata : pd.DataFrame
    Temporary copy of metadata, used for filtered or subsetted operations.</p>

<p>scaled_data : np.ndarray or None
    Scaled version of the temporary dataset (<code><a href="#GroupAnalysis.tmp_data">tmp_data</a></code>), updated after <code><a href="#GroupAnalysis.data_scale">data_scale()</a></code>.</p>

<p>PCA_results : np.ndarray or None
    Results of PCA transformation applied on scaled data.</p>

<p>var_data : np.ndarray or None
    Explained variance ratio from PCA.</p>

<p>knee_plot : matplotlib.figure.Figure or None
    Figure of cumulative explained variance for PCA components.</p>

<p>UMAP_data : np.ndarray or None
    Embedding results from UMAP dimensionality reduction.</p>

<p>UMAP_plot : dict
    Dictionary containing UMAP plots. Keys: 'static' (matplotlib) and 'html' (plotly).</p>

<p>dblabels : list or None
    Cluster labels assigned by DBSCAN after UMAP embedding.</p>

<p>explained_variance_ratio : np.ndarray or None
    Explained variance ratio of PCA components.</p>

<p>DFA_results : pd.DataFrame or None
    Results of Differential Feature Analysis (DFA).</p>

<p>proportion_stats : pd.DataFrame or None
    Statistics from proportion analysis.</p>

<p>proportion_plot : matplotlib.figure.Figure or None
    Figure of proportion analysis results.</p>

<h2 id="methods">Methods</h2>

<p>resest_project():
    Reset all temporary and analysis results to initial state.</p>

<p>load_data(data, ids_col='id_name', set_col='set'):
    Class method to load data and metadata and initialize the object.</p>

<p>groups:
    Property returning available groups in the metadata.</p>

<p>get_DFA(), get_PCA(), get_knee_plot(), get_var_data(), get_scaled_data():
    Methods to retrieve previously computed results.</p>

<p>UMAP(), db_scan(), UMAP_on_clusters():
    Methods for dimensionality reduction and clustering visualization.</p>

<p>DFA(meta_group_by='sets', sets={}, n_proc=5):
    Perform Differential Feature Analysis.</p>

<p>proportion_analysis(grouping_col='sets', val_col='nuclei_per_img', ...):
    Perform and plot proportion analysis across groups.</p>
</div>


                            <div id="GroupAnalysis.__init__" class="classattr">
                                        <input id="GroupAnalysis.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">GroupAnalysis</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_data</span>, </span><span class="param"><span class="n">input_metadata</span></span>)</span>

                <label class="view-source-button" for="GroupAnalysis.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.__init__-3533"><a href="#GroupAnalysis.__init__-3533"><span class="linenos">3533</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GroupAnalysis.__init__-3534"><a href="#GroupAnalysis.__init__-3534"><span class="linenos">3534</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis.__init__-3535"><a href="#GroupAnalysis.__init__-3535"><span class="linenos">3535</span></a>        <span class="n">input_data</span><span class="p">,</span>
</span><span id="GroupAnalysis.__init__-3536"><a href="#GroupAnalysis.__init__-3536"><span class="linenos">3536</span></a>        <span class="n">input_metadata</span><span class="p">,</span>
</span><span id="GroupAnalysis.__init__-3537"><a href="#GroupAnalysis.__init__-3537"><span class="linenos">3537</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis.__init__-3538"><a href="#GroupAnalysis.__init__-3538"><span class="linenos">3538</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3539"><a href="#GroupAnalysis.__init__-3539"><span class="linenos">3539</span></a><span class="sd">        Initialize a GroupAnalysis instance with data and metadata.</span>
</span><span id="GroupAnalysis.__init__-3540"><a href="#GroupAnalysis.__init__-3540"><span class="linenos">3540</span></a>
</span><span id="GroupAnalysis.__init__-3541"><a href="#GroupAnalysis.__init__-3541"><span class="linenos">3541</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.__init__-3542"><a href="#GroupAnalysis.__init__-3542"><span class="linenos">3542</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.__init__-3543"><a href="#GroupAnalysis.__init__-3543"><span class="linenos">3543</span></a><span class="sd">        input_data : pd.DataFrame</span>
</span><span id="GroupAnalysis.__init__-3544"><a href="#GroupAnalysis.__init__-3544"><span class="linenos">3544</span></a><span class="sd">            Dataset containing features for analysis. Rows represent samples and columns represent features.</span>
</span><span id="GroupAnalysis.__init__-3545"><a href="#GroupAnalysis.__init__-3545"><span class="linenos">3545</span></a>
</span><span id="GroupAnalysis.__init__-3546"><a href="#GroupAnalysis.__init__-3546"><span class="linenos">3546</span></a><span class="sd">        input_metadata : pd.DataFrame</span>
</span><span id="GroupAnalysis.__init__-3547"><a href="#GroupAnalysis.__init__-3547"><span class="linenos">3547</span></a><span class="sd">            Metadata corresponding to `input_data`, including sample identifiers and group labels.</span>
</span><span id="GroupAnalysis.__init__-3548"><a href="#GroupAnalysis.__init__-3548"><span class="linenos">3548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3549"><a href="#GroupAnalysis.__init__-3549"><span class="linenos">3549</span></a>
</span><span id="GroupAnalysis.__init__-3550"><a href="#GroupAnalysis.__init__-3550"><span class="linenos">3550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="GroupAnalysis.__init__-3551"><a href="#GroupAnalysis.__init__-3551"><span class="linenos">3551</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored input dataset for analysis.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3552"><a href="#GroupAnalysis.__init__-3552"><span class="linenos">3552</span></a>
</span><span id="GroupAnalysis.__init__-3553"><a href="#GroupAnalysis.__init__-3553"><span class="linenos">3553</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="GroupAnalysis.__init__-3554"><a href="#GroupAnalysis.__init__-3554"><span class="linenos">3554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored metadata associated with `input_data`.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3555"><a href="#GroupAnalysis.__init__-3555"><span class="linenos">3555</span></a>
</span><span id="GroupAnalysis.__init__-3556"><a href="#GroupAnalysis.__init__-3556"><span class="linenos">3556</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">input_metadata</span>
</span><span id="GroupAnalysis.__init__-3557"><a href="#GroupAnalysis.__init__-3557"><span class="linenos">3557</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_data` used for filtering, selection, or scaling.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3558"><a href="#GroupAnalysis.__init__-3558"><span class="linenos">3558</span></a>
</span><span id="GroupAnalysis.__init__-3559"><a href="#GroupAnalysis.__init__-3559"><span class="linenos">3559</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">input_data</span>
</span><span id="GroupAnalysis.__init__-3560"><a href="#GroupAnalysis.__init__-3560"><span class="linenos">3560</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Temporary copy of `input_metadata` used for filtered operations.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3561"><a href="#GroupAnalysis.__init__-3561"><span class="linenos">3561</span></a>
</span><span id="GroupAnalysis.__init__-3562"><a href="#GroupAnalysis.__init__-3562"><span class="linenos">3562</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3563"><a href="#GroupAnalysis.__init__-3563"><span class="linenos">3563</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored scaled version of `tmp_data` after normalization or standardization.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3564"><a href="#GroupAnalysis.__init__-3564"><span class="linenos">3564</span></a>
</span><span id="GroupAnalysis.__init__-3565"><a href="#GroupAnalysis.__init__-3565"><span class="linenos">3565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3566"><a href="#GroupAnalysis.__init__-3566"><span class="linenos">3566</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; Stored results of PCA transformation applied on `scaled_data`.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3567"><a href="#GroupAnalysis.__init__-3567"><span class="linenos">3567</span></a>
</span><span id="GroupAnalysis.__init__-3568"><a href="#GroupAnalysis.__init__-3568"><span class="linenos">3568</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3569"><a href="#GroupAnalysis.__init__-3569"><span class="linenos">3569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sotred explained variance ratio for PCA components.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3570"><a href="#GroupAnalysis.__init__-3570"><span class="linenos">3570</span></a>
</span><span id="GroupAnalysis.__init__-3571"><a href="#GroupAnalysis.__init__-3571"><span class="linenos">3571</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3572"><a href="#GroupAnalysis.__init__-3572"><span class="linenos">3572</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure showing cumulative explained variance for PCA.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3573"><a href="#GroupAnalysis.__init__-3573"><span class="linenos">3573</span></a>
</span><span id="GroupAnalysis.__init__-3574"><a href="#GroupAnalysis.__init__-3574"><span class="linenos">3574</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3575"><a href="#GroupAnalysis.__init__-3575"><span class="linenos">3575</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored embedding coordinates from UMAP dimensionality reduction.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3576"><a href="#GroupAnalysis.__init__-3576"><span class="linenos">3576</span></a>
</span><span id="GroupAnalysis.__init__-3577"><a href="#GroupAnalysis.__init__-3577"><span class="linenos">3577</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="GroupAnalysis.__init__-3578"><a href="#GroupAnalysis.__init__-3578"><span class="linenos">3578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored dictionary containing UMAP plots: &#39;static&#39; (matplotlib) and &#39;html&#39; (plotly).&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3579"><a href="#GroupAnalysis.__init__-3579"><span class="linenos">3579</span></a>
</span><span id="GroupAnalysis.__init__-3580"><a href="#GroupAnalysis.__init__-3580"><span class="linenos">3580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3581"><a href="#GroupAnalysis.__init__-3581"><span class="linenos">3581</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored cluster labels assigned by DBSCAN after UMAP embedding.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3582"><a href="#GroupAnalysis.__init__-3582"><span class="linenos">3582</span></a>
</span><span id="GroupAnalysis.__init__-3583"><a href="#GroupAnalysis.__init__-3583"><span class="linenos">3583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3584"><a href="#GroupAnalysis.__init__-3584"><span class="linenos">3584</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored explained variance ratio of PCA components.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3585"><a href="#GroupAnalysis.__init__-3585"><span class="linenos">3585</span></a>
</span><span id="GroupAnalysis.__init__-3586"><a href="#GroupAnalysis.__init__-3586"><span class="linenos">3586</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3587"><a href="#GroupAnalysis.__init__-3587"><span class="linenos">3587</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored Differential Feature Analysis (DFA) results.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3588"><a href="#GroupAnalysis.__init__-3588"><span class="linenos">3588</span></a>
</span><span id="GroupAnalysis.__init__-3589"><a href="#GroupAnalysis.__init__-3589"><span class="linenos">3589</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3590"><a href="#GroupAnalysis.__init__-3590"><span class="linenos">3590</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Stored statistics from proportion analysis of groups.&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.__init__-3591"><a href="#GroupAnalysis.__init__-3591"><span class="linenos">3591</span></a>
</span><span id="GroupAnalysis.__init__-3592"><a href="#GroupAnalysis.__init__-3592"><span class="linenos">3592</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.__init__-3593"><a href="#GroupAnalysis.__init__-3593"><span class="linenos">3593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Figure visualizing proportion analysis results.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a GroupAnalysis instance with data and metadata.</p>

<h2 id="parameters">Parameters</h2>

<p>input_data : pd.DataFrame
    Dataset containing features for analysis. Rows represent samples and columns represent features.</p>

<p>input_metadata : pd.DataFrame
    Metadata corresponding to <code><a href="#GroupAnalysis.input_data">input_data</a></code>, including sample identifiers and group labels.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.input_data" class="classattr">
                                <div class="attr variable">
            <span class="name">input_data</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.input_data"></a>
    
            <div class="docstring"><p>Stored input dataset for analysis.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.input_metadata" class="classattr">
                                <div class="attr variable">
            <span class="name">input_metadata</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.input_metadata"></a>
    
            <div class="docstring"><p>Stored metadata associated with <code><a href="#GroupAnalysis.input_data">input_data</a></code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.tmp_metadata" class="classattr">
                                <div class="attr variable">
            <span class="name">tmp_metadata</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.tmp_metadata"></a>
    
            <div class="docstring"><p>Temporary copy of <code><a href="#GroupAnalysis.input_data">input_data</a></code> used for filtering, selection, or scaling.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.tmp_data" class="classattr">
                                <div class="attr variable">
            <span class="name">tmp_data</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.tmp_data"></a>
    
            <div class="docstring"><p>Temporary copy of <code><a href="#GroupAnalysis.input_metadata">input_metadata</a></code> used for filtered operations.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.scaled_data" class="classattr">
                                <div class="attr variable">
            <span class="name">scaled_data</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.scaled_data"></a>
    
            <div class="docstring"><p>Stored scaled version of <code><a href="#GroupAnalysis.tmp_data">tmp_data</a></code> after normalization or standardization.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.PCA_results" class="classattr">
                                <div class="attr variable">
            <span class="name">PCA_results</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.PCA_results"></a>
    
            <div class="docstring"><p>Stored results of PCA transformation applied on <code><a href="#GroupAnalysis.scaled_data">scaled_data</a></code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.var_data" class="classattr">
                                <div class="attr variable">
            <span class="name">var_data</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.var_data"></a>
    
            <div class="docstring"><p>Sotred explained variance ratio for PCA components.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.knee_plot" class="classattr">
                                <div class="attr variable">
            <span class="name">knee_plot</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.knee_plot"></a>
    
            <div class="docstring"><p>Figure showing cumulative explained variance for PCA.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.UMAP_data" class="classattr">
                                <div class="attr variable">
            <span class="name">UMAP_data</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.UMAP_data"></a>
    
            <div class="docstring"><p>Stored embedding coordinates from UMAP dimensionality reduction.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.UMAP_plot" class="classattr">
                                <div class="attr variable">
            <span class="name">UMAP_plot</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.UMAP_plot"></a>
    
            <div class="docstring"><p>Stored dictionary containing UMAP plots: 'static' (matplotlib) and 'html' (plotly).</p>
</div>


                            </div>
                            <div id="GroupAnalysis.dblabels" class="classattr">
                                <div class="attr variable">
            <span class="name">dblabels</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.dblabels"></a>
    
            <div class="docstring"><p>Stored cluster labels assigned by DBSCAN after UMAP embedding.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.explained_variance_ratio" class="classattr">
                                <div class="attr variable">
            <span class="name">explained_variance_ratio</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.explained_variance_ratio"></a>
    
            <div class="docstring"><p>Stored explained variance ratio of PCA components.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.DFA_results" class="classattr">
                                <div class="attr variable">
            <span class="name">DFA_results</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.DFA_results"></a>
    
            <div class="docstring"><p>Stored Differential Feature Analysis (DFA) results.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.proportion_stats" class="classattr">
                                <div class="attr variable">
            <span class="name">proportion_stats</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.proportion_stats"></a>
    
            <div class="docstring"><p>Stored statistics from proportion analysis of groups.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.proportion_plot" class="classattr">
                                <div class="attr variable">
            <span class="name">proportion_plot</span>

        
    </div>
    <a class="headerlink" href="#GroupAnalysis.proportion_plot"></a>
    
            <div class="docstring"><p>Figure visualizing proportion analysis results.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.resest_project" class="classattr">
                                        <input id="GroupAnalysis.resest_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resest_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.resest_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.resest_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.resest_project-3595"><a href="#GroupAnalysis.resest_project-3595"><span class="linenos">3595</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">resest_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.resest_project-3596"><a href="#GroupAnalysis.resest_project-3596"><span class="linenos">3596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.resest_project-3597"><a href="#GroupAnalysis.resest_project-3597"><span class="linenos">3597</span></a><span class="sd">        Resets the project state by clearing or reinitializing various attributes.</span>
</span><span id="GroupAnalysis.resest_project-3598"><a href="#GroupAnalysis.resest_project-3598"><span class="linenos">3598</span></a>
</span><span id="GroupAnalysis.resest_project-3599"><a href="#GroupAnalysis.resest_project-3599"><span class="linenos">3599</span></a><span class="sd">        This method resets the following attributes to initial values:</span>
</span><span id="GroupAnalysis.resest_project-3600"><a href="#GroupAnalysis.resest_project-3600"><span class="linenos">3600</span></a><span class="sd">        - `tmp_metadata`</span>
</span><span id="GroupAnalysis.resest_project-3601"><a href="#GroupAnalysis.resest_project-3601"><span class="linenos">3601</span></a><span class="sd">        - `tmp_data`</span>
</span><span id="GroupAnalysis.resest_project-3602"><a href="#GroupAnalysis.resest_project-3602"><span class="linenos">3602</span></a><span class="sd">        - `scaled_data`</span>
</span><span id="GroupAnalysis.resest_project-3603"><a href="#GroupAnalysis.resest_project-3603"><span class="linenos">3603</span></a><span class="sd">        - `PCA_results`</span>
</span><span id="GroupAnalysis.resest_project-3604"><a href="#GroupAnalysis.resest_project-3604"><span class="linenos">3604</span></a><span class="sd">        - `var_data`</span>
</span><span id="GroupAnalysis.resest_project-3605"><a href="#GroupAnalysis.resest_project-3605"><span class="linenos">3605</span></a><span class="sd">        - `knee_plot`</span>
</span><span id="GroupAnalysis.resest_project-3606"><a href="#GroupAnalysis.resest_project-3606"><span class="linenos">3606</span></a><span class="sd">        - `UMAP_data`</span>
</span><span id="GroupAnalysis.resest_project-3607"><a href="#GroupAnalysis.resest_project-3607"><span class="linenos">3607</span></a><span class="sd">        - `UMAP_plot`</span>
</span><span id="GroupAnalysis.resest_project-3608"><a href="#GroupAnalysis.resest_project-3608"><span class="linenos">3608</span></a><span class="sd">        - `dblabels`</span>
</span><span id="GroupAnalysis.resest_project-3609"><a href="#GroupAnalysis.resest_project-3609"><span class="linenos">3609</span></a><span class="sd">        - `explained_variance_ratio`</span>
</span><span id="GroupAnalysis.resest_project-3610"><a href="#GroupAnalysis.resest_project-3610"><span class="linenos">3610</span></a><span class="sd">        - `DFA_results`</span>
</span><span id="GroupAnalysis.resest_project-3611"><a href="#GroupAnalysis.resest_project-3611"><span class="linenos">3611</span></a>
</span><span id="GroupAnalysis.resest_project-3612"><a href="#GroupAnalysis.resest_project-3612"><span class="linenos">3612</span></a><span class="sd">        This method is typically called to reinitialize the project data and results, preparing the system for new computations or project resets.</span>
</span><span id="GroupAnalysis.resest_project-3613"><a href="#GroupAnalysis.resest_project-3613"><span class="linenos">3613</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.resest_project-3614"><a href="#GroupAnalysis.resest_project-3614"><span class="linenos">3614</span></a>
</span><span id="GroupAnalysis.resest_project-3615"><a href="#GroupAnalysis.resest_project-3615"><span class="linenos">3615</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span>
</span><span id="GroupAnalysis.resest_project-3616"><a href="#GroupAnalysis.resest_project-3616"><span class="linenos">3616</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span>
</span><span id="GroupAnalysis.resest_project-3617"><a href="#GroupAnalysis.resest_project-3617"><span class="linenos">3617</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3618"><a href="#GroupAnalysis.resest_project-3618"><span class="linenos">3618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3619"><a href="#GroupAnalysis.resest_project-3619"><span class="linenos">3619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3620"><a href="#GroupAnalysis.resest_project-3620"><span class="linenos">3620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3621"><a href="#GroupAnalysis.resest_project-3621"><span class="linenos">3621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3622"><a href="#GroupAnalysis.resest_project-3622"><span class="linenos">3622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;static&quot;</span><span class="p">:</span> <span class="p">{},</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="p">{}}</span>
</span><span id="GroupAnalysis.resest_project-3623"><a href="#GroupAnalysis.resest_project-3623"><span class="linenos">3623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3624"><a href="#GroupAnalysis.resest_project-3624"><span class="linenos">3624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3625"><a href="#GroupAnalysis.resest_project-3625"><span class="linenos">3625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3626"><a href="#GroupAnalysis.resest_project-3626"><span class="linenos">3626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="GroupAnalysis.resest_project-3627"><a href="#GroupAnalysis.resest_project-3627"><span class="linenos">3627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Resets the project state by clearing or reinitializing various attributes.</p>

<p>This method resets the following attributes to initial values:</p>

<ul>
<li><code><a href="#GroupAnalysis.tmp_metadata">tmp_metadata</a></code></li>
<li><code><a href="#GroupAnalysis.tmp_data">tmp_data</a></code></li>
<li><code><a href="#GroupAnalysis.scaled_data">scaled_data</a></code></li>
<li><code><a href="#GroupAnalysis.PCA_results">PCA_results</a></code></li>
<li><code><a href="#GroupAnalysis.var_data">var_data</a></code></li>
<li><code><a href="#GroupAnalysis.knee_plot">knee_plot</a></code></li>
<li><code><a href="#GroupAnalysis.UMAP_data">UMAP_data</a></code></li>
<li><code><a href="#GroupAnalysis.UMAP_plot">UMAP_plot</a></code></li>
<li><code><a href="#GroupAnalysis.dblabels">dblabels</a></code></li>
<li><code><a href="#GroupAnalysis.explained_variance_ratio">explained_variance_ratio</a></code></li>
<li><code><a href="#GroupAnalysis.DFA_results">DFA_results</a></code></li>
</ul>

<p>This method is typically called to reinitialize the project data and results, preparing the system for new computations or project resets.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.load_data" class="classattr">
                                        <input id="GroupAnalysis.load_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-classmethod">@classmethod</div>

        <span class="def">def</span>
        <span class="name">load_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">ids_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;id_name&#39;</span>, </span><span class="param"><span class="n">set_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;set&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.load_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.load_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.load_data-3629"><a href="#GroupAnalysis.load_data-3629"><span class="linenos">3629</span></a>    <span class="nd">@classmethod</span>
</span><span id="GroupAnalysis.load_data-3630"><a href="#GroupAnalysis.load_data-3630"><span class="linenos">3630</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ids_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id_name&quot;</span><span class="p">,</span> <span class="n">set_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;set&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis.load_data-3631"><a href="#GroupAnalysis.load_data-3631"><span class="linenos">3631</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.load_data-3632"><a href="#GroupAnalysis.load_data-3632"><span class="linenos">3632</span></a><span class="sd">        Load data and initialize the class by storing both the feature data and metadata.</span>
</span><span id="GroupAnalysis.load_data-3633"><a href="#GroupAnalysis.load_data-3633"><span class="linenos">3633</span></a>
</span><span id="GroupAnalysis.load_data-3634"><a href="#GroupAnalysis.load_data-3634"><span class="linenos">3634</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.load_data-3635"><a href="#GroupAnalysis.load_data-3635"><span class="linenos">3635</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.load_data-3636"><a href="#GroupAnalysis.load_data-3636"><span class="linenos">3636</span></a><span class="sd">        data : pd.DataFrame</span>
</span><span id="GroupAnalysis.load_data-3637"><a href="#GroupAnalysis.load_data-3637"><span class="linenos">3637</span></a><span class="sd">            Input dataset used for group analysis. Must contain both feature columns and</span>
</span><span id="GroupAnalysis.load_data-3638"><a href="#GroupAnalysis.load_data-3638"><span class="linenos">3638</span></a><span class="sd">            metadata columns specified by `ids_col` and `set_col`.</span>
</span><span id="GroupAnalysis.load_data-3639"><a href="#GroupAnalysis.load_data-3639"><span class="linenos">3639</span></a>
</span><span id="GroupAnalysis.load_data-3640"><a href="#GroupAnalysis.load_data-3640"><span class="linenos">3640</span></a><span class="sd">        ids_col : str, optional</span>
</span><span id="GroupAnalysis.load_data-3641"><a href="#GroupAnalysis.load_data-3641"><span class="linenos">3641</span></a><span class="sd">            Name of the column containing unique object identifiers.</span>
</span><span id="GroupAnalysis.load_data-3642"><a href="#GroupAnalysis.load_data-3642"><span class="linenos">3642</span></a><span class="sd">            Default is ``&#39;id_name&#39;``.</span>
</span><span id="GroupAnalysis.load_data-3643"><a href="#GroupAnalysis.load_data-3643"><span class="linenos">3643</span></a>
</span><span id="GroupAnalysis.load_data-3644"><a href="#GroupAnalysis.load_data-3644"><span class="linenos">3644</span></a><span class="sd">        set_col : str, optional</span>
</span><span id="GroupAnalysis.load_data-3645"><a href="#GroupAnalysis.load_data-3645"><span class="linenos">3645</span></a><span class="sd">            Name of the column specifying group or set assignment for each object.</span>
</span><span id="GroupAnalysis.load_data-3646"><a href="#GroupAnalysis.load_data-3646"><span class="linenos">3646</span></a><span class="sd">            Default is ``&#39;set&#39;``.</span>
</span><span id="GroupAnalysis.load_data-3647"><a href="#GroupAnalysis.load_data-3647"><span class="linenos">3647</span></a>
</span><span id="GroupAnalysis.load_data-3648"><a href="#GroupAnalysis.load_data-3648"><span class="linenos">3648</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.load_data-3649"><a href="#GroupAnalysis.load_data-3649"><span class="linenos">3649</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.load_data-3650"><a href="#GroupAnalysis.load_data-3650"><span class="linenos">3650</span></a><span class="sd">        This method performs in-place initialization of the class and does not return</span>
</span><span id="GroupAnalysis.load_data-3651"><a href="#GroupAnalysis.load_data-3651"><span class="linenos">3651</span></a><span class="sd">        a separate object. All loaded data and metadata become available through the</span>
</span><span id="GroupAnalysis.load_data-3652"><a href="#GroupAnalysis.load_data-3652"><span class="linenos">3652</span></a><span class="sd">        class attributes for downstream analysis.</span>
</span><span id="GroupAnalysis.load_data-3653"><a href="#GroupAnalysis.load_data-3653"><span class="linenos">3653</span></a>
</span><span id="GroupAnalysis.load_data-3654"><a href="#GroupAnalysis.load_data-3654"><span class="linenos">3654</span></a><span class="sd">        This method updates internal class attributes:</span>
</span><span id="GroupAnalysis.load_data-3655"><a href="#GroupAnalysis.load_data-3655"><span class="linenos">3655</span></a>
</span><span id="GroupAnalysis.load_data-3656"><a href="#GroupAnalysis.load_data-3656"><span class="linenos">3656</span></a><span class="sd">        - **input_data** : pd.DataFrame</span>
</span><span id="GroupAnalysis.load_data-3657"><a href="#GroupAnalysis.load_data-3657"><span class="linenos">3657</span></a><span class="sd">          Cleaned feature table with index set to object IDs.</span>
</span><span id="GroupAnalysis.load_data-3658"><a href="#GroupAnalysis.load_data-3658"><span class="linenos">3658</span></a>
</span><span id="GroupAnalysis.load_data-3659"><a href="#GroupAnalysis.load_data-3659"><span class="linenos">3659</span></a><span class="sd">        - **tmp_data** : pd.DataFrame</span>
</span><span id="GroupAnalysis.load_data-3660"><a href="#GroupAnalysis.load_data-3660"><span class="linenos">3660</span></a><span class="sd">          Copy of `input_data` used for temporary operations.</span>
</span><span id="GroupAnalysis.load_data-3661"><a href="#GroupAnalysis.load_data-3661"><span class="linenos">3661</span></a>
</span><span id="GroupAnalysis.load_data-3662"><a href="#GroupAnalysis.load_data-3662"><span class="linenos">3662</span></a><span class="sd">        - **input_metadata** : pd.DataFrame</span>
</span><span id="GroupAnalysis.load_data-3663"><a href="#GroupAnalysis.load_data-3663"><span class="linenos">3663</span></a><span class="sd">          Metadata containing object IDs and group assignments.</span>
</span><span id="GroupAnalysis.load_data-3664"><a href="#GroupAnalysis.load_data-3664"><span class="linenos">3664</span></a>
</span><span id="GroupAnalysis.load_data-3665"><a href="#GroupAnalysis.load_data-3665"><span class="linenos">3665</span></a><span class="sd">        - **tmp_metadata** : pd.DataFrame</span>
</span><span id="GroupAnalysis.load_data-3666"><a href="#GroupAnalysis.load_data-3666"><span class="linenos">3666</span></a><span class="sd">          Copy of `input_metadata` for temporary operations.</span>
</span><span id="GroupAnalysis.load_data-3667"><a href="#GroupAnalysis.load_data-3667"><span class="linenos">3667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.load_data-3668"><a href="#GroupAnalysis.load_data-3668"><span class="linenos">3668</span></a>
</span><span id="GroupAnalysis.load_data-3669"><a href="#GroupAnalysis.load_data-3669"><span class="linenos">3669</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</span><span id="GroupAnalysis.load_data-3670"><a href="#GroupAnalysis.load_data-3670"><span class="linenos">3670</span></a>
</span><span id="GroupAnalysis.load_data-3671"><a href="#GroupAnalysis.load_data-3671"><span class="linenos">3671</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</span><span id="GroupAnalysis.load_data-3672"><a href="#GroupAnalysis.load_data-3672"><span class="linenos">3672</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="GroupAnalysis.load_data-3673"><a href="#GroupAnalysis.load_data-3673"><span class="linenos">3673</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">set_col</span><span class="p">]</span>
</span><span id="GroupAnalysis.load_data-3674"><a href="#GroupAnalysis.load_data-3674"><span class="linenos">3674</span></a>
</span><span id="GroupAnalysis.load_data-3675"><a href="#GroupAnalysis.load_data-3675"><span class="linenos">3675</span></a>        <span class="n">data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ids_col</span><span class="p">]</span>
</span><span id="GroupAnalysis.load_data-3676"><a href="#GroupAnalysis.load_data-3676"><span class="linenos">3676</span></a>
</span><span id="GroupAnalysis.load_data-3677"><a href="#GroupAnalysis.load_data-3677"><span class="linenos">3677</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.load_data-3678"><a href="#GroupAnalysis.load_data-3678"><span class="linenos">3678</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;id_name&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.load_data-3679"><a href="#GroupAnalysis.load_data-3679"><span class="linenos">3679</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.load_data-3680"><a href="#GroupAnalysis.load_data-3680"><span class="linenos">3680</span></a>            <span class="kc">None</span>
</span><span id="GroupAnalysis.load_data-3681"><a href="#GroupAnalysis.load_data-3681"><span class="linenos">3681</span></a>
</span><span id="GroupAnalysis.load_data-3682"><a href="#GroupAnalysis.load_data-3682"><span class="linenos">3682</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.load_data-3683"><a href="#GroupAnalysis.load_data-3683"><span class="linenos">3683</span></a>            <span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;Object Number&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.load_data-3684"><a href="#GroupAnalysis.load_data-3684"><span class="linenos">3684</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.load_data-3685"><a href="#GroupAnalysis.load_data-3685"><span class="linenos">3685</span></a>            <span class="kc">None</span>
</span><span id="GroupAnalysis.load_data-3686"><a href="#GroupAnalysis.load_data-3686"><span class="linenos">3686</span></a>
</span><span id="GroupAnalysis.load_data-3687"><a href="#GroupAnalysis.load_data-3687"><span class="linenos">3687</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">metadata</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Load data and initialize the class by storing both the feature data and metadata.</p>

<h2 id="parameters">Parameters</h2>

<p>data : pd.DataFrame
    Input dataset used for group analysis. Must contain both feature columns and
    metadata columns specified by <code>ids_col</code> and <code>set_col</code>.</p>

<p>ids_col : str, optional
    Name of the column containing unique object identifiers.
    Default is <code>'id_name'</code>.</p>

<p>set_col : str, optional
    Name of the column specifying group or set assignment for each object.
    Default is <code>'set'</code>.</p>

<h2 id="notes">Notes</h2>

<p>This method performs in-place initialization of the class and does not return
a separate object. All loaded data and metadata become available through the
class attributes for downstream analysis.</p>

<p>This method updates internal class attributes:</p>

<ul>
<li><p><strong>input_data</strong> : pd.DataFrame
Cleaned feature table with index set to object IDs.</p></li>
<li><p><strong>tmp_data</strong> : pd.DataFrame
Copy of <code><a href="#GroupAnalysis.input_data">input_data</a></code> used for temporary operations.</p></li>
<li><p><strong>input_metadata</strong> : pd.DataFrame
Metadata containing object IDs and group assignments.</p></li>
<li><p><strong>tmp_metadata</strong> : pd.DataFrame
Copy of <code><a href="#GroupAnalysis.input_metadata">input_metadata</a></code> for temporary operations.</p></li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.groups" class="classattr">
                                        <input id="GroupAnalysis.groups-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">groups</span>

                <label class="view-source-button" for="GroupAnalysis.groups-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.groups"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.groups-3689"><a href="#GroupAnalysis.groups-3689"><span class="linenos">3689</span></a>    <span class="nd">@property</span>
</span><span id="GroupAnalysis.groups-3690"><a href="#GroupAnalysis.groups-3690"><span class="linenos">3690</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.groups-3691"><a href="#GroupAnalysis.groups-3691"><span class="linenos">3691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.groups-3692"><a href="#GroupAnalysis.groups-3692"><span class="linenos">3692</span></a><span class="sd">        Return information about available groups in the metadata for ``self.DFA``.</span>
</span><span id="GroupAnalysis.groups-3693"><a href="#GroupAnalysis.groups-3693"><span class="linenos">3693</span></a>
</span><span id="GroupAnalysis.groups-3694"><a href="#GroupAnalysis.groups-3694"><span class="linenos">3694</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.groups-3695"><a href="#GroupAnalysis.groups-3695"><span class="linenos">3695</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.groups-3696"><a href="#GroupAnalysis.groups-3696"><span class="linenos">3696</span></a><span class="sd">        dict</span>
</span><span id="GroupAnalysis.groups-3697"><a href="#GroupAnalysis.groups-3697"><span class="linenos">3697</span></a><span class="sd">            Dictionary mapping each metadata column name to a list of unique groups</span>
</span><span id="GroupAnalysis.groups-3698"><a href="#GroupAnalysis.groups-3698"><span class="linenos">3698</span></a><span class="sd">            available in that column.</span>
</span><span id="GroupAnalysis.groups-3699"><a href="#GroupAnalysis.groups-3699"><span class="linenos">3699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.groups-3700"><a href="#GroupAnalysis.groups-3700"><span class="linenos">3700</span></a>
</span><span id="GroupAnalysis.groups-3701"><a href="#GroupAnalysis.groups-3701"><span class="linenos">3701</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.groups-3702"><a href="#GroupAnalysis.groups-3702"><span class="linenos">3702</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="GroupAnalysis.groups-3703"><a href="#GroupAnalysis.groups-3703"><span class="linenos">3703</span></a>                <span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]),</span>
</span><span id="GroupAnalysis.groups-3704"><a href="#GroupAnalysis.groups-3704"><span class="linenos">3704</span></a>                <span class="s2">&quot;full_name&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]),</span>
</span><span id="GroupAnalysis.groups-3705"><a href="#GroupAnalysis.groups-3705"><span class="linenos">3705</span></a>            <span class="p">}</span>
</span><span id="GroupAnalysis.groups-3706"><a href="#GroupAnalysis.groups-3706"><span class="linenos">3706</span></a>        <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.groups-3707"><a href="#GroupAnalysis.groups-3707"><span class="linenos">3707</span></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;sets&quot;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])}</span>
</span></pre></div>


            <div class="docstring"><p>Return information about available groups in the metadata for <code>self.DFA</code>.</p>

<h2 id="returns">Returns</h2>

<p>dict
    Dictionary mapping each metadata column name to a list of unique groups
    available in that column.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_DFA" class="classattr">
                                        <input id="GroupAnalysis.get_DFA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_DFA</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_DFA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_DFA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_DFA-3709"><a href="#GroupAnalysis.get_DFA-3709"><span class="linenos">3709</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_DFA-3710"><a href="#GroupAnalysis.get_DFA-3710"><span class="linenos">3710</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_DFA-3711"><a href="#GroupAnalysis.get_DFA-3711"><span class="linenos">3711</span></a><span class="sd">        Retrieve the DFA results produced by the ``DFA()`` method.</span>
</span><span id="GroupAnalysis.get_DFA-3712"><a href="#GroupAnalysis.get_DFA-3712"><span class="linenos">3712</span></a>
</span><span id="GroupAnalysis.get_DFA-3713"><a href="#GroupAnalysis.get_DFA-3713"><span class="linenos">3713</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_DFA-3714"><a href="#GroupAnalysis.get_DFA-3714"><span class="linenos">3714</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_DFA-3715"><a href="#GroupAnalysis.get_DFA-3715"><span class="linenos">3715</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="GroupAnalysis.get_DFA-3716"><a href="#GroupAnalysis.get_DFA-3716"><span class="linenos">3716</span></a><span class="sd">            The DFA results stored in ``self.DFA_results``.</span>
</span><span id="GroupAnalysis.get_DFA-3717"><a href="#GroupAnalysis.get_DFA-3717"><span class="linenos">3717</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_DFA-3718"><a href="#GroupAnalysis.get_DFA-3718"><span class="linenos">3718</span></a>
</span><span id="GroupAnalysis.get_DFA-3719"><a href="#GroupAnalysis.get_DFA-3719"><span class="linenos">3719</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA-3720"><a href="#GroupAnalysis.get_DFA-3720"><span class="linenos">3720</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_DFA-3721"><a href="#GroupAnalysis.get_DFA-3721"><span class="linenos">3721</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA-3722"><a href="#GroupAnalysis.get_DFA-3722"><span class="linenos">3722</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the DFA results produced by the <code><a href="#GroupAnalysis.DFA">DFA()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    The DFA results stored in <code>self.DFA_results</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_PCA" class="classattr">
                                        <input id="GroupAnalysis.get_PCA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_PCA</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_PCA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_PCA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_PCA-3724"><a href="#GroupAnalysis.get_PCA-3724"><span class="linenos">3724</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_PCA-3725"><a href="#GroupAnalysis.get_PCA-3725"><span class="linenos">3725</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_PCA-3726"><a href="#GroupAnalysis.get_PCA-3726"><span class="linenos">3726</span></a><span class="sd">        Retrieve the PCA results produced by the ``PCA()`` method.</span>
</span><span id="GroupAnalysis.get_PCA-3727"><a href="#GroupAnalysis.get_PCA-3727"><span class="linenos">3727</span></a>
</span><span id="GroupAnalysis.get_PCA-3728"><a href="#GroupAnalysis.get_PCA-3728"><span class="linenos">3728</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_PCA-3729"><a href="#GroupAnalysis.get_PCA-3729"><span class="linenos">3729</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_PCA-3730"><a href="#GroupAnalysis.get_PCA-3730"><span class="linenos">3730</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis.get_PCA-3731"><a href="#GroupAnalysis.get_PCA-3731"><span class="linenos">3731</span></a><span class="sd">            The PCA results stored in ``self.PCA_results``.</span>
</span><span id="GroupAnalysis.get_PCA-3732"><a href="#GroupAnalysis.get_PCA-3732"><span class="linenos">3732</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_PCA-3733"><a href="#GroupAnalysis.get_PCA-3733"><span class="linenos">3733</span></a>
</span><span id="GroupAnalysis.get_PCA-3734"><a href="#GroupAnalysis.get_PCA-3734"><span class="linenos">3734</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_PCA-3735"><a href="#GroupAnalysis.get_PCA-3735"><span class="linenos">3735</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the PCA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_PCA-3736"><a href="#GroupAnalysis.get_PCA-3736"><span class="linenos">3736</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_PCA-3737"><a href="#GroupAnalysis.get_PCA-3737"><span class="linenos">3737</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the PCA results produced by the <code><a href="#GroupAnalysis.PCA">PCA()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>np.ndarray
    The PCA results stored in <code>self.PCA_results</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_knee_plot" class="classattr">
                                        <input id="GroupAnalysis.get_knee_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_knee_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_knee_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_knee_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_knee_plot-3739"><a href="#GroupAnalysis.get_knee_plot-3739"><span class="linenos">3739</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_knee_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_knee_plot-3740"><a href="#GroupAnalysis.get_knee_plot-3740"><span class="linenos">3740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_knee_plot-3741"><a href="#GroupAnalysis.get_knee_plot-3741"><span class="linenos">3741</span></a><span class="sd">        Retrieve the knee plot of cumulative explained variance generated by the ``var_plot()`` method.</span>
</span><span id="GroupAnalysis.get_knee_plot-3742"><a href="#GroupAnalysis.get_knee_plot-3742"><span class="linenos">3742</span></a>
</span><span id="GroupAnalysis.get_knee_plot-3743"><a href="#GroupAnalysis.get_knee_plot-3743"><span class="linenos">3743</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.get_knee_plot-3744"><a href="#GroupAnalysis.get_knee_plot-3744"><span class="linenos">3744</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.get_knee_plot-3745"><a href="#GroupAnalysis.get_knee_plot-3745"><span class="linenos">3745</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis.get_knee_plot-3746"><a href="#GroupAnalysis.get_knee_plot-3746"><span class="linenos">3746</span></a><span class="sd">            If ``True`` (default), the knee plot is displayed.</span>
</span><span id="GroupAnalysis.get_knee_plot-3747"><a href="#GroupAnalysis.get_knee_plot-3747"><span class="linenos">3747</span></a>
</span><span id="GroupAnalysis.get_knee_plot-3748"><a href="#GroupAnalysis.get_knee_plot-3748"><span class="linenos">3748</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_knee_plot-3749"><a href="#GroupAnalysis.get_knee_plot-3749"><span class="linenos">3749</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_knee_plot-3750"><a href="#GroupAnalysis.get_knee_plot-3750"><span class="linenos">3750</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis.get_knee_plot-3751"><a href="#GroupAnalysis.get_knee_plot-3751"><span class="linenos">3751</span></a><span class="sd">            The figure object containing the knee plot.</span>
</span><span id="GroupAnalysis.get_knee_plot-3752"><a href="#GroupAnalysis.get_knee_plot-3752"><span class="linenos">3752</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_knee_plot-3753"><a href="#GroupAnalysis.get_knee_plot-3753"><span class="linenos">3753</span></a>
</span><span id="GroupAnalysis.get_knee_plot-3754"><a href="#GroupAnalysis.get_knee_plot-3754"><span class="linenos">3754</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3755"><a href="#GroupAnalysis.get_knee_plot-3755"><span class="linenos">3755</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_knee_plot-3756"><a href="#GroupAnalysis.get_knee_plot-3756"><span class="linenos">3756</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3757"><a href="#GroupAnalysis.get_knee_plot-3757"><span class="linenos">3757</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3758"><a href="#GroupAnalysis.get_knee_plot-3758"><span class="linenos">3758</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3759"><a href="#GroupAnalysis.get_knee_plot-3759"><span class="linenos">3759</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span><span id="GroupAnalysis.get_knee_plot-3760"><a href="#GroupAnalysis.get_knee_plot-3760"><span class="linenos">3760</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3761"><a href="#GroupAnalysis.get_knee_plot-3761"><span class="linenos">3761</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_knee_plot-3762"><a href="#GroupAnalysis.get_knee_plot-3762"><span class="linenos">3762</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_knee_plot-3763"><a href="#GroupAnalysis.get_knee_plot-3763"><span class="linenos">3763</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis.get_knee_plot-3764"><a href="#GroupAnalysis.get_knee_plot-3764"><span class="linenos">3764</span></a>
</span><span id="GroupAnalysis.get_knee_plot-3765"><a href="#GroupAnalysis.get_knee_plot-3765"><span class="linenos">3765</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the knee plot of cumulative explained variance generated by the <code><a href="#GroupAnalysis.var_plot">var_plot()</a></code> method.</p>

<h2 id="parameters">Parameters</h2>

<p>show : bool, optional
    If <code>True</code> (default), the knee plot is displayed.</p>

<h2 id="returns">Returns</h2>

<p>matplotlib.figure.Figure
    The figure object containing the knee plot.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_var_data" class="classattr">
                                        <input id="GroupAnalysis.get_var_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_var_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_var_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_var_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_var_data-3767"><a href="#GroupAnalysis.get_var_data-3767"><span class="linenos">3767</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_var_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_var_data-3768"><a href="#GroupAnalysis.get_var_data-3768"><span class="linenos">3768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_var_data-3769"><a href="#GroupAnalysis.get_var_data-3769"><span class="linenos">3769</span></a><span class="sd">        Retrieve the explained variance data from the ``var_plot()`` method.</span>
</span><span id="GroupAnalysis.get_var_data-3770"><a href="#GroupAnalysis.get_var_data-3770"><span class="linenos">3770</span></a>
</span><span id="GroupAnalysis.get_var_data-3771"><a href="#GroupAnalysis.get_var_data-3771"><span class="linenos">3771</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_var_data-3772"><a href="#GroupAnalysis.get_var_data-3772"><span class="linenos">3772</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_var_data-3773"><a href="#GroupAnalysis.get_var_data-3773"><span class="linenos">3773</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis.get_var_data-3774"><a href="#GroupAnalysis.get_var_data-3774"><span class="linenos">3774</span></a><span class="sd">            Array containing the explained variance values stored in ``self.var_data``.</span>
</span><span id="GroupAnalysis.get_var_data-3775"><a href="#GroupAnalysis.get_var_data-3775"><span class="linenos">3775</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_var_data-3776"><a href="#GroupAnalysis.get_var_data-3776"><span class="linenos">3776</span></a>
</span><span id="GroupAnalysis.get_var_data-3777"><a href="#GroupAnalysis.get_var_data-3777"><span class="linenos">3777</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_var_data-3778"><a href="#GroupAnalysis.get_var_data-3778"><span class="linenos">3778</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the var_plot() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_var_data-3779"><a href="#GroupAnalysis.get_var_data-3779"><span class="linenos">3779</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_var_data-3780"><a href="#GroupAnalysis.get_var_data-3780"><span class="linenos">3780</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the explained variance data from the <code><a href="#GroupAnalysis.var_plot">var_plot()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>np.ndarray
    Array containing the explained variance values stored in <code>self.var_data</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_scaled_data" class="classattr">
                                        <input id="GroupAnalysis.get_scaled_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_scaled_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_scaled_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_scaled_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_scaled_data-3782"><a href="#GroupAnalysis.get_scaled_data-3782"><span class="linenos">3782</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_scaled_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_scaled_data-3783"><a href="#GroupAnalysis.get_scaled_data-3783"><span class="linenos">3783</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_scaled_data-3784"><a href="#GroupAnalysis.get_scaled_data-3784"><span class="linenos">3784</span></a><span class="sd">        Retrieve the scaled data produced by the ``data_scale()`` method.</span>
</span><span id="GroupAnalysis.get_scaled_data-3785"><a href="#GroupAnalysis.get_scaled_data-3785"><span class="linenos">3785</span></a>
</span><span id="GroupAnalysis.get_scaled_data-3786"><a href="#GroupAnalysis.get_scaled_data-3786"><span class="linenos">3786</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_scaled_data-3787"><a href="#GroupAnalysis.get_scaled_data-3787"><span class="linenos">3787</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_scaled_data-3788"><a href="#GroupAnalysis.get_scaled_data-3788"><span class="linenos">3788</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis.get_scaled_data-3789"><a href="#GroupAnalysis.get_scaled_data-3789"><span class="linenos">3789</span></a><span class="sd">            Scaled data stored in ``self.scaled_data``.</span>
</span><span id="GroupAnalysis.get_scaled_data-3790"><a href="#GroupAnalysis.get_scaled_data-3790"><span class="linenos">3790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_scaled_data-3791"><a href="#GroupAnalysis.get_scaled_data-3791"><span class="linenos">3791</span></a>
</span><span id="GroupAnalysis.get_scaled_data-3792"><a href="#GroupAnalysis.get_scaled_data-3792"><span class="linenos">3792</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_scaled_data-3793"><a href="#GroupAnalysis.get_scaled_data-3793"><span class="linenos">3793</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the data_scale() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_scaled_data-3794"><a href="#GroupAnalysis.get_scaled_data-3794"><span class="linenos">3794</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_scaled_data-3795"><a href="#GroupAnalysis.get_scaled_data-3795"><span class="linenos">3795</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the scaled data produced by the <code><a href="#GroupAnalysis.data_scale">data_scale()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>np.ndarray
    Scaled data stored in <code>self.scaled_data</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_UMAP_data" class="classattr">
                                        <input id="GroupAnalysis.get_UMAP_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_UMAP_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_UMAP_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_UMAP_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_UMAP_data-3797"><a href="#GroupAnalysis.get_UMAP_data-3797"><span class="linenos">3797</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_UMAP_data-3798"><a href="#GroupAnalysis.get_UMAP_data-3798"><span class="linenos">3798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_data-3799"><a href="#GroupAnalysis.get_UMAP_data-3799"><span class="linenos">3799</span></a><span class="sd">        Retrieve the UMAP-transformed data generated by the ``UMAP()`` method.</span>
</span><span id="GroupAnalysis.get_UMAP_data-3800"><a href="#GroupAnalysis.get_UMAP_data-3800"><span class="linenos">3800</span></a>
</span><span id="GroupAnalysis.get_UMAP_data-3801"><a href="#GroupAnalysis.get_UMAP_data-3801"><span class="linenos">3801</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_UMAP_data-3802"><a href="#GroupAnalysis.get_UMAP_data-3802"><span class="linenos">3802</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_UMAP_data-3803"><a href="#GroupAnalysis.get_UMAP_data-3803"><span class="linenos">3803</span></a><span class="sd">        np.ndarray</span>
</span><span id="GroupAnalysis.get_UMAP_data-3804"><a href="#GroupAnalysis.get_UMAP_data-3804"><span class="linenos">3804</span></a><span class="sd">            UMAP-embedded data stored in ``self.UMAP_data``.</span>
</span><span id="GroupAnalysis.get_UMAP_data-3805"><a href="#GroupAnalysis.get_UMAP_data-3805"><span class="linenos">3805</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_data-3806"><a href="#GroupAnalysis.get_UMAP_data-3806"><span class="linenos">3806</span></a>
</span><span id="GroupAnalysis.get_UMAP_data-3807"><a href="#GroupAnalysis.get_UMAP_data-3807"><span class="linenos">3807</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_data-3808"><a href="#GroupAnalysis.get_UMAP_data-3808"><span class="linenos">3808</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_UMAP_data-3809"><a href="#GroupAnalysis.get_UMAP_data-3809"><span class="linenos">3809</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_data-3810"><a href="#GroupAnalysis.get_UMAP_data-3810"><span class="linenos">3810</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the UMAP-transformed data generated by the <code><a href="#GroupAnalysis.UMAP">UMAP()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>np.ndarray
    UMAP-embedded data stored in <code>self.UMAP_data</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_UMAP_plots" class="classattr">
                                        <input id="GroupAnalysis.get_UMAP_plots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_UMAP_plots</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>, </span><span class="param"><span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_UMAP_plots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_UMAP_plots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_UMAP_plots-3812"><a href="#GroupAnalysis.get_UMAP_plots-3812"><span class="linenos">3812</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_UMAP_plots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;static&quot;</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3813"><a href="#GroupAnalysis.get_UMAP_plots-3813"><span class="linenos">3813</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3814"><a href="#GroupAnalysis.get_UMAP_plots-3814"><span class="linenos">3814</span></a><span class="sd">        Retrieve UMAP plots generated by the ``UMAP()`` and/or ``UMAP_on_clusters()`` methods.</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3815"><a href="#GroupAnalysis.get_UMAP_plots-3815"><span class="linenos">3815</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3816"><a href="#GroupAnalysis.get_UMAP_plots-3816"><span class="linenos">3816</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3817"><a href="#GroupAnalysis.get_UMAP_plots-3817"><span class="linenos">3817</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3818"><a href="#GroupAnalysis.get_UMAP_plots-3818"><span class="linenos">3818</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3819"><a href="#GroupAnalysis.get_UMAP_plots-3819"><span class="linenos">3819</span></a><span class="sd">            Whether to display the UMAP plots. Default is True.</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3820"><a href="#GroupAnalysis.get_UMAP_plots-3820"><span class="linenos">3820</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3821"><a href="#GroupAnalysis.get_UMAP_plots-3821"><span class="linenos">3821</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3822"><a href="#GroupAnalysis.get_UMAP_plots-3822"><span class="linenos">3822</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3823"><a href="#GroupAnalysis.get_UMAP_plots-3823"><span class="linenos">3823</span></a><span class="sd">        dict of matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3824"><a href="#GroupAnalysis.get_UMAP_plots-3824"><span class="linenos">3824</span></a><span class="sd">            A dictionary containing the UMAP plots. Keys correspond to plot names, and values are the figure objects.</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3825"><a href="#GroupAnalysis.get_UMAP_plots-3825"><span class="linenos">3825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3826"><a href="#GroupAnalysis.get_UMAP_plots-3826"><span class="linenos">3826</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3827"><a href="#GroupAnalysis.get_UMAP_plots-3827"><span class="linenos">3827</span></a>        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3828"><a href="#GroupAnalysis.get_UMAP_plots-3828"><span class="linenos">3828</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3829"><a href="#GroupAnalysis.get_UMAP_plots-3829"><span class="linenos">3829</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3830"><a href="#GroupAnalysis.get_UMAP_plots-3830"><span class="linenos">3830</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3831"><a href="#GroupAnalysis.get_UMAP_plots-3831"><span class="linenos">3831</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3832"><a href="#GroupAnalysis.get_UMAP_plots-3832"><span class="linenos">3832</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3833"><a href="#GroupAnalysis.get_UMAP_plots-3833"><span class="linenos">3833</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3834"><a href="#GroupAnalysis.get_UMAP_plots-3834"><span class="linenos">3834</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3835"><a href="#GroupAnalysis.get_UMAP_plots-3835"><span class="linenos">3835</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3836"><a href="#GroupAnalysis.get_UMAP_plots-3836"><span class="linenos">3836</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3837"><a href="#GroupAnalysis.get_UMAP_plots-3837"><span class="linenos">3837</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3838"><a href="#GroupAnalysis.get_UMAP_plots-3838"><span class="linenos">3838</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3839"><a href="#GroupAnalysis.get_UMAP_plots-3839"><span class="linenos">3839</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3840"><a href="#GroupAnalysis.get_UMAP_plots-3840"><span class="linenos">3840</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3841"><a href="#GroupAnalysis.get_UMAP_plots-3841"><span class="linenos">3841</span></a>                                <span class="kc">None</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3842"><a href="#GroupAnalysis.get_UMAP_plots-3842"><span class="linenos">3842</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3843"><a href="#GroupAnalysis.get_UMAP_plots-3843"><span class="linenos">3843</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3844"><a href="#GroupAnalysis.get_UMAP_plots-3844"><span class="linenos">3844</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3845"><a href="#GroupAnalysis.get_UMAP_plots-3845"><span class="linenos">3845</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3846"><a href="#GroupAnalysis.get_UMAP_plots-3846"><span class="linenos">3846</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3847"><a href="#GroupAnalysis.get_UMAP_plots-3847"><span class="linenos">3847</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3848"><a href="#GroupAnalysis.get_UMAP_plots-3848"><span class="linenos">3848</span></a>                <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3849"><a href="#GroupAnalysis.get_UMAP_plots-3849"><span class="linenos">3849</span></a>                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the UMAP() and / or UMAP_on_clusters() methods first.&quot;</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3850"><a href="#GroupAnalysis.get_UMAP_plots-3850"><span class="linenos">3850</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3851"><a href="#GroupAnalysis.get_UMAP_plots-3851"><span class="linenos">3851</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3852"><a href="#GroupAnalysis.get_UMAP_plots-3852"><span class="linenos">3852</span></a>                <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3853"><a href="#GroupAnalysis.get_UMAP_plots-3853"><span class="linenos">3853</span></a>                    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3854"><a href="#GroupAnalysis.get_UMAP_plots-3854"><span class="linenos">3854</span></a>                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3855"><a href="#GroupAnalysis.get_UMAP_plots-3855"><span class="linenos">3855</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3856"><a href="#GroupAnalysis.get_UMAP_plots-3856"><span class="linenos">3856</span></a>                            <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3857"><a href="#GroupAnalysis.get_UMAP_plots-3857"><span class="linenos">3857</span></a>                                <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3858"><a href="#GroupAnalysis.get_UMAP_plots-3858"><span class="linenos">3858</span></a>                            <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3859"><a href="#GroupAnalysis.get_UMAP_plots-3859"><span class="linenos">3859</span></a>                                <span class="kc">None</span>
</span><span id="GroupAnalysis.get_UMAP_plots-3860"><a href="#GroupAnalysis.get_UMAP_plots-3860"><span class="linenos">3860</span></a>
</span><span id="GroupAnalysis.get_UMAP_plots-3861"><a href="#GroupAnalysis.get_UMAP_plots-3861"><span class="linenos">3861</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve UMAP plots generated by the <code><a href="#GroupAnalysis.UMAP">UMAP()</a></code> and/or <code><a href="#GroupAnalysis.UMAP_on_clusters">UMAP_on_clusters()</a></code> methods.</p>

<h2 id="parameters">Parameters</h2>

<p>show : bool, optional
    Whether to display the UMAP plots. Default is True.</p>

<h2 id="returns">Returns</h2>

<p>dict of matplotlib.figure.Figure
    A dictionary containing the UMAP plots. Keys correspond to plot names, and values are the figure objects.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.select_data" class="classattr">
                                        <input id="GroupAnalysis.select_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">select_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">features_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.select_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.select_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.select_data-3863"><a href="#GroupAnalysis.select_data-3863"><span class="linenos">3863</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">select_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features_list</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[]):</span>
</span><span id="GroupAnalysis.select_data-3864"><a href="#GroupAnalysis.select_data-3864"><span class="linenos">3864</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.select_data-3865"><a href="#GroupAnalysis.select_data-3865"><span class="linenos">3865</span></a><span class="sd">        Select specific features (columns) from the dataset for further analysis.</span>
</span><span id="GroupAnalysis.select_data-3866"><a href="#GroupAnalysis.select_data-3866"><span class="linenos">3866</span></a>
</span><span id="GroupAnalysis.select_data-3867"><a href="#GroupAnalysis.select_data-3867"><span class="linenos">3867</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.select_data-3868"><a href="#GroupAnalysis.select_data-3868"><span class="linenos">3868</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.select_data-3869"><a href="#GroupAnalysis.select_data-3869"><span class="linenos">3869</span></a><span class="sd">        features_list : list of str, optional</span>
</span><span id="GroupAnalysis.select_data-3870"><a href="#GroupAnalysis.select_data-3870"><span class="linenos">3870</span></a><span class="sd">            List of feature names (column names) to select from the dataset. Default is an empty list, which selects no features.</span>
</span><span id="GroupAnalysis.select_data-3871"><a href="#GroupAnalysis.select_data-3871"><span class="linenos">3871</span></a>
</span><span id="GroupAnalysis.select_data-3872"><a href="#GroupAnalysis.select_data-3872"><span class="linenos">3872</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.select_data-3873"><a href="#GroupAnalysis.select_data-3873"><span class="linenos">3873</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.select_data-3874"><a href="#GroupAnalysis.select_data-3874"><span class="linenos">3874</span></a><span class="sd">        Modifies the `self.tmp_data` attribute to contain only the selected features from `self.input_data`.</span>
</span><span id="GroupAnalysis.select_data-3875"><a href="#GroupAnalysis.select_data-3875"><span class="linenos">3875</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.select_data-3876"><a href="#GroupAnalysis.select_data-3876"><span class="linenos">3876</span></a>
</span><span id="GroupAnalysis.select_data-3877"><a href="#GroupAnalysis.select_data-3877"><span class="linenos">3877</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.select_data-3878"><a href="#GroupAnalysis.select_data-3878"><span class="linenos">3878</span></a>
</span><span id="GroupAnalysis.select_data-3879"><a href="#GroupAnalysis.select_data-3879"><span class="linenos">3879</span></a>        <span class="n">not_in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="GroupAnalysis.select_data-3880"><a href="#GroupAnalysis.select_data-3880"><span class="linenos">3880</span></a>
</span><span id="GroupAnalysis.select_data-3881"><a href="#GroupAnalysis.select_data-3881"><span class="linenos">3881</span></a>        <span class="k">if</span> <span class="n">not_in_columns</span><span class="p">:</span>
</span><span id="GroupAnalysis.select_data-3882"><a href="#GroupAnalysis.select_data-3882"><span class="linenos">3882</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;These names are not in data&quot;</span><span class="p">,</span> <span class="n">not_in_columns</span><span class="p">)</span>
</span><span id="GroupAnalysis.select_data-3883"><a href="#GroupAnalysis.select_data-3883"><span class="linenos">3883</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.select_data-3884"><a href="#GroupAnalysis.select_data-3884"><span class="linenos">3884</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All names are present in data.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.select_data-3885"><a href="#GroupAnalysis.select_data-3885"><span class="linenos">3885</span></a>
</span><span id="GroupAnalysis.select_data-3886"><a href="#GroupAnalysis.select_data-3886"><span class="linenos">3886</span></a>        <span class="n">in_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">features_list</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dat</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</span><span id="GroupAnalysis.select_data-3887"><a href="#GroupAnalysis.select_data-3887"><span class="linenos">3887</span></a>
</span><span id="GroupAnalysis.select_data-3888"><a href="#GroupAnalysis.select_data-3888"><span class="linenos">3888</span></a>        <span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="n">in_columns</span><span class="p">]</span>
</span><span id="GroupAnalysis.select_data-3889"><a href="#GroupAnalysis.select_data-3889"><span class="linenos">3889</span></a>
</span><span id="GroupAnalysis.select_data-3890"><a href="#GroupAnalysis.select_data-3890"><span class="linenos">3890</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">dat</span>
</span></pre></div>


            <div class="docstring"><p>Select specific features (columns) from the dataset for further analysis.</p>

<h2 id="parameters">Parameters</h2>

<p>features_list : list of str, optional
    List of feature names (column names) to select from the dataset. Default is an empty list, which selects no features.</p>

<h2 id="notes">Notes</h2>

<p>Modifies the <code>self.tmp_data</code> attribute to contain only the selected features from <code>self.input_data</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.data_scale" class="classattr">
                                        <input id="GroupAnalysis.data_scale-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">data_scale</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.data_scale-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.data_scale"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.data_scale-3892"><a href="#GroupAnalysis.data_scale-3892"><span class="linenos">3892</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">data_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.data_scale-3893"><a href="#GroupAnalysis.data_scale-3893"><span class="linenos">3893</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.data_scale-3894"><a href="#GroupAnalysis.data_scale-3894"><span class="linenos">3894</span></a><span class="sd">        Scale the data using standardization (z-score normalization).</span>
</span><span id="GroupAnalysis.data_scale-3895"><a href="#GroupAnalysis.data_scale-3895"><span class="linenos">3895</span></a>
</span><span id="GroupAnalysis.data_scale-3896"><a href="#GroupAnalysis.data_scale-3896"><span class="linenos">3896</span></a><span class="sd">        This method applies `StandardScaler` from scikit-learn to the temporary dataset (`self.tmp_data`) and stores the scaled data.</span>
</span><span id="GroupAnalysis.data_scale-3897"><a href="#GroupAnalysis.data_scale-3897"><span class="linenos">3897</span></a>
</span><span id="GroupAnalysis.data_scale-3898"><a href="#GroupAnalysis.data_scale-3898"><span class="linenos">3898</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.data_scale-3899"><a href="#GroupAnalysis.data_scale-3899"><span class="linenos">3899</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.data_scale-3900"><a href="#GroupAnalysis.data_scale-3900"><span class="linenos">3900</span></a><span class="sd">        Modifies the `self.scaled_data` attribute to contain the standardized version of `self.tmp_data`.</span>
</span><span id="GroupAnalysis.data_scale-3901"><a href="#GroupAnalysis.data_scale-3901"><span class="linenos">3901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.data_scale-3902"><a href="#GroupAnalysis.data_scale-3902"><span class="linenos">3902</span></a>
</span><span id="GroupAnalysis.data_scale-3903"><a href="#GroupAnalysis.data_scale-3903"><span class="linenos">3903</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.data_scale-3904"><a href="#GroupAnalysis.data_scale-3904"><span class="linenos">3904</span></a>
</span><span id="GroupAnalysis.data_scale-3905"><a href="#GroupAnalysis.data_scale-3905"><span class="linenos">3905</span></a>            <span class="k">def</span><span class="w"> </span><span class="nf">is_id_column</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="GroupAnalysis.data_scale-3906"><a href="#GroupAnalysis.data_scale-3906"><span class="linenos">3906</span></a>                <span class="n">name_lower</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="GroupAnalysis.data_scale-3907"><a href="#GroupAnalysis.data_scale-3907"><span class="linenos">3907</span></a>                <span class="k">return</span> <span class="n">name_lower</span> <span class="o">==</span> <span class="s2">&quot;id&quot;</span> <span class="ow">or</span> <span class="s2">&quot;id_&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span> <span class="ow">or</span> <span class="s2">&quot;_id&quot;</span> <span class="ow">in</span> <span class="n">name_lower</span>
</span><span id="GroupAnalysis.data_scale-3908"><a href="#GroupAnalysis.data_scale-3908"><span class="linenos">3908</span></a>
</span><span id="GroupAnalysis.data_scale-3909"><a href="#GroupAnalysis.data_scale-3909"><span class="linenos">3909</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="GroupAnalysis.data_scale-3910"><a href="#GroupAnalysis.data_scale-3910"><span class="linenos">3910</span></a>
</span><span id="GroupAnalysis.data_scale-3911"><a href="#GroupAnalysis.data_scale-3911"><span class="linenos">3911</span></a>            <span class="n">cols_with_strings</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="GroupAnalysis.data_scale-3912"><a href="#GroupAnalysis.data_scale-3912"><span class="linenos">3912</span></a>                <span class="n">c</span>
</span><span id="GroupAnalysis.data_scale-3913"><a href="#GroupAnalysis.data_scale-3913"><span class="linenos">3913</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span>
</span><span id="GroupAnalysis.data_scale-3914"><a href="#GroupAnalysis.data_scale-3914"><span class="linenos">3914</span></a>                <span class="k">if</span> <span class="n">tmp</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span><span class="o">.</span><span class="n">any</span><span class="p">()</span>
</span><span id="GroupAnalysis.data_scale-3915"><a href="#GroupAnalysis.data_scale-3915"><span class="linenos">3915</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis.data_scale-3916"><a href="#GroupAnalysis.data_scale-3916"><span class="linenos">3916</span></a>
</span><span id="GroupAnalysis.data_scale-3917"><a href="#GroupAnalysis.data_scale-3917"><span class="linenos">3917</span></a>            <span class="n">cols_id_pattern</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tmp</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">is_id_column</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span>
</span><span id="GroupAnalysis.data_scale-3918"><a href="#GroupAnalysis.data_scale-3918"><span class="linenos">3918</span></a>
</span><span id="GroupAnalysis.data_scale-3919"><a href="#GroupAnalysis.data_scale-3919"><span class="linenos">3919</span></a>            <span class="n">cols_to_drop</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">cols_id_pattern</span> <span class="o">+</span> <span class="n">cols_with_strings</span><span class="p">))</span>
</span><span id="GroupAnalysis.data_scale-3920"><a href="#GroupAnalysis.data_scale-3920"><span class="linenos">3920</span></a>
</span><span id="GroupAnalysis.data_scale-3921"><a href="#GroupAnalysis.data_scale-3921"><span class="linenos">3921</span></a>            <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">cols_to_drop</span><span class="p">)</span>
</span><span id="GroupAnalysis.data_scale-3922"><a href="#GroupAnalysis.data_scale-3922"><span class="linenos">3922</span></a>
</span><span id="GroupAnalysis.data_scale-3923"><a href="#GroupAnalysis.data_scale-3923"><span class="linenos">3923</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</span><span id="GroupAnalysis.data_scale-3924"><a href="#GroupAnalysis.data_scale-3924"><span class="linenos">3924</span></a>
</span><span id="GroupAnalysis.data_scale-3925"><a href="#GroupAnalysis.data_scale-3925"><span class="linenos">3925</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
</span><span id="GroupAnalysis.data_scale-3926"><a href="#GroupAnalysis.data_scale-3926"><span class="linenos">3926</span></a>
</span><span id="GroupAnalysis.data_scale-3927"><a href="#GroupAnalysis.data_scale-3927"><span class="linenos">3927</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.data_scale-3928"><a href="#GroupAnalysis.data_scale-3928"><span class="linenos">3928</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.data_scale-3929"><a href="#GroupAnalysis.data_scale-3929"><span class="linenos">3929</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data to scale. Please use the load_data() method first, and optionally the select_data() method.&quot;</span>
</span><span id="GroupAnalysis.data_scale-3930"><a href="#GroupAnalysis.data_scale-3930"><span class="linenos">3930</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Scale the data using standardization (z-score normalization).</p>

<p>This method applies <code>StandardScaler</code> from scikit-learn to the temporary dataset (<code>self.tmp_data</code>) and stores the scaled data.</p>

<h2 id="notes">Notes</h2>

<p>Modifies the <code>self.scaled_data</code> attribute to contain the standardized version of <code>self.tmp_data</code>.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.PCA" class="classattr">
                                        <input id="GroupAnalysis.PCA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">PCA</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.PCA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.PCA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.PCA-3932"><a href="#GroupAnalysis.PCA-3932"><span class="linenos">3932</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">PCA</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.PCA-3933"><a href="#GroupAnalysis.PCA-3933"><span class="linenos">3933</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.PCA-3934"><a href="#GroupAnalysis.PCA-3934"><span class="linenos">3934</span></a><span class="sd">        Perform Principal Component Analysis (PCA) on the scaled data.</span>
</span><span id="GroupAnalysis.PCA-3935"><a href="#GroupAnalysis.PCA-3935"><span class="linenos">3935</span></a>
</span><span id="GroupAnalysis.PCA-3936"><a href="#GroupAnalysis.PCA-3936"><span class="linenos">3936</span></a><span class="sd">        This method reduces the dimensionality of `self.scaled_data` while retaining the maximum variance.</span>
</span><span id="GroupAnalysis.PCA-3937"><a href="#GroupAnalysis.PCA-3937"><span class="linenos">3937</span></a>
</span><span id="GroupAnalysis.PCA-3938"><a href="#GroupAnalysis.PCA-3938"><span class="linenos">3938</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.PCA-3939"><a href="#GroupAnalysis.PCA-3939"><span class="linenos">3939</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.PCA-3940"><a href="#GroupAnalysis.PCA-3940"><span class="linenos">3940</span></a><span class="sd">        Modifies the `self.PCA_results` attribute with the PCA-transformed data.</span>
</span><span id="GroupAnalysis.PCA-3941"><a href="#GroupAnalysis.PCA-3941"><span class="linenos">3941</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.PCA-3942"><a href="#GroupAnalysis.PCA-3942"><span class="linenos">3942</span></a>
</span><span id="GroupAnalysis.PCA-3943"><a href="#GroupAnalysis.PCA-3943"><span class="linenos">3943</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.PCA-3944"><a href="#GroupAnalysis.PCA-3944"><span class="linenos">3944</span></a>            <span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="GroupAnalysis.PCA-3945"><a href="#GroupAnalysis.PCA-3945"><span class="linenos">3945</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scaled_data</span><span class="p">)</span>
</span><span id="GroupAnalysis.PCA-3946"><a href="#GroupAnalysis.PCA-3946"><span class="linenos">3946</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
</span><span id="GroupAnalysis.PCA-3947"><a href="#GroupAnalysis.PCA-3947"><span class="linenos">3947</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.PCA-3948"><a href="#GroupAnalysis.PCA-3948"><span class="linenos">3948</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for PCA. Please use the data_scale() method first.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform Principal Component Analysis (PCA) on the scaled data.</p>

<p>This method reduces the dimensionality of <code>self.scaled_data</code> while retaining the maximum variance.</p>

<h2 id="notes">Notes</h2>

<p>Modifies the <code>self.PCA_results</code> attribute with the PCA-transformed data.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.var_plot" class="classattr">
                                        <input id="GroupAnalysis.var_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">var_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.var_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.var_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.var_plot-3950"><a href="#GroupAnalysis.var_plot-3950"><span class="linenos">3950</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">var_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.var_plot-3951"><a href="#GroupAnalysis.var_plot-3951"><span class="linenos">3951</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.var_plot-3952"><a href="#GroupAnalysis.var_plot-3952"><span class="linenos">3952</span></a><span class="sd">        Plot the cumulative explained variance of the principal components from PCA.</span>
</span><span id="GroupAnalysis.var_plot-3953"><a href="#GroupAnalysis.var_plot-3953"><span class="linenos">3953</span></a>
</span><span id="GroupAnalysis.var_plot-3954"><a href="#GroupAnalysis.var_plot-3954"><span class="linenos">3954</span></a><span class="sd">        This method visualizes the cumulative explained variance to help determine how many components capture most of the variance.</span>
</span><span id="GroupAnalysis.var_plot-3955"><a href="#GroupAnalysis.var_plot-3955"><span class="linenos">3955</span></a>
</span><span id="GroupAnalysis.var_plot-3956"><a href="#GroupAnalysis.var_plot-3956"><span class="linenos">3956</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.var_plot-3957"><a href="#GroupAnalysis.var_plot-3957"><span class="linenos">3957</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.var_plot-3958"><a href="#GroupAnalysis.var_plot-3958"><span class="linenos">3958</span></a><span class="sd">        Stores results in the following attributes:</span>
</span><span id="GroupAnalysis.var_plot-3959"><a href="#GroupAnalysis.var_plot-3959"><span class="linenos">3959</span></a><span class="sd">        - `self.var_data` (np.ndarray): Explained variance ratio for each principal component.</span>
</span><span id="GroupAnalysis.var_plot-3960"><a href="#GroupAnalysis.var_plot-3960"><span class="linenos">3960</span></a><span class="sd">        - `self.knee_plot` (matplotlib.figure.Figure): Figure of the cumulative explained variance plot.</span>
</span><span id="GroupAnalysis.var_plot-3961"><a href="#GroupAnalysis.var_plot-3961"><span class="linenos">3961</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.var_plot-3962"><a href="#GroupAnalysis.var_plot-3962"><span class="linenos">3962</span></a>
</span><span id="GroupAnalysis.var_plot-3963"><a href="#GroupAnalysis.var_plot-3963"><span class="linenos">3963</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis.var_plot-3964"><a href="#GroupAnalysis.var_plot-3964"><span class="linenos">3964</span></a>
</span><span id="GroupAnalysis.var_plot-3965"><a href="#GroupAnalysis.var_plot-3965"><span class="linenos">3965</span></a>            <span class="n">fig</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
</span><span id="GroupAnalysis.var_plot-3966"><a href="#GroupAnalysis.var_plot-3966"><span class="linenos">3966</span></a>            <span class="n">explained_var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explained_variance_ratio</span>
</span><span id="GroupAnalysis.var_plot-3967"><a href="#GroupAnalysis.var_plot-3967"><span class="linenos">3967</span></a>
</span><span id="GroupAnalysis.var_plot-3968"><a href="#GroupAnalysis.var_plot-3968"><span class="linenos">3968</span></a>            <span class="n">cumulative_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_var</span><span class="p">)</span>
</span><span id="GroupAnalysis.var_plot-3969"><a href="#GroupAnalysis.var_plot-3969"><span class="linenos">3969</span></a>
</span><span id="GroupAnalysis.var_plot-3970"><a href="#GroupAnalysis.var_plot-3970"><span class="linenos">3970</span></a>            <span class="c1"># Plot the cumulative explained variance as a function of the number of components</span>
</span><span id="GroupAnalysis.var_plot-3971"><a href="#GroupAnalysis.var_plot-3971"><span class="linenos">3971</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span>
</span><span id="GroupAnalysis.var_plot-3972"><a href="#GroupAnalysis.var_plot-3972"><span class="linenos">3972</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Number of Components&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.var_plot-3973"><a href="#GroupAnalysis.var_plot-3973"><span class="linenos">3973</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cumulative Explained Variance&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.var_plot-3974"><a href="#GroupAnalysis.var_plot-3974"><span class="linenos">3974</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Explained variance of PCs&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.var_plot-3975"><a href="#GroupAnalysis.var_plot-3975"><span class="linenos">3975</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">cumulative_var</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</span><span id="GroupAnalysis.var_plot-3976"><a href="#GroupAnalysis.var_plot-3976"><span class="linenos">3976</span></a>
</span><span id="GroupAnalysis.var_plot-3977"><a href="#GroupAnalysis.var_plot-3977"><span class="linenos">3977</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">var_data</span> <span class="o">=</span> <span class="n">explained_var</span>
</span><span id="GroupAnalysis.var_plot-3978"><a href="#GroupAnalysis.var_plot-3978"><span class="linenos">3978</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">knee_plot</span> <span class="o">=</span> <span class="n">fig</span>
</span><span id="GroupAnalysis.var_plot-3979"><a href="#GroupAnalysis.var_plot-3979"><span class="linenos">3979</span></a>
</span><span id="GroupAnalysis.var_plot-3980"><a href="#GroupAnalysis.var_plot-3980"><span class="linenos">3980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.var_plot-3981"><a href="#GroupAnalysis.var_plot-3981"><span class="linenos">3981</span></a>
</span><span id="GroupAnalysis.var_plot-3982"><a href="#GroupAnalysis.var_plot-3982"><span class="linenos">3982</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.var_plot-3983"><a href="#GroupAnalysis.var_plot-3983"><span class="linenos">3983</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for variance explanation analysis. Please use the PCA() method first.&quot;</span>
</span><span id="GroupAnalysis.var_plot-3984"><a href="#GroupAnalysis.var_plot-3984"><span class="linenos">3984</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plot the cumulative explained variance of the principal components from PCA.</p>

<p>This method visualizes the cumulative explained variance to help determine how many components capture most of the variance.</p>

<h2 id="notes">Notes</h2>

<p>Stores results in the following attributes:</p>

<ul>
<li><code>self.var_data</code> (np.ndarray): Explained variance ratio for each principal component.</li>
<li><code>self.knee_plot</code> (matplotlib.figure.Figure): Figure of the cumulative explained variance plot.</li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.UMAP" class="classattr">
                                        <input id="GroupAnalysis.UMAP-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">UMAP</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">PC_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">factorize_with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">harmonize_sets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span>,</span><span class="param">	<span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>,</span><span class="param">	<span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.UMAP-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.UMAP"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.UMAP-3986"><a href="#GroupAnalysis.UMAP-3986"><span class="linenos">3986</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP-3987"><a href="#GroupAnalysis.UMAP-3987"><span class="linenos">3987</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3988"><a href="#GroupAnalysis.UMAP-3988"><span class="linenos">3988</span></a>        <span class="n">PC_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3989"><a href="#GroupAnalysis.UMAP-3989"><span class="linenos">3989</span></a>        <span class="n">factorize_with_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3990"><a href="#GroupAnalysis.UMAP-3990"><span class="linenos">3990</span></a>        <span class="n">harmonize_sets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3991"><a href="#GroupAnalysis.UMAP-3991"><span class="linenos">3991</span></a>        <span class="n">n_neighbors</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3992"><a href="#GroupAnalysis.UMAP-3992"><span class="linenos">3992</span></a>        <span class="n">min_dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3993"><a href="#GroupAnalysis.UMAP-3993"><span class="linenos">3993</span></a>        <span class="n">n_components</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3994"><a href="#GroupAnalysis.UMAP-3994"><span class="linenos">3994</span></a>        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="GroupAnalysis.UMAP-3995"><a href="#GroupAnalysis.UMAP-3995"><span class="linenos">3995</span></a>        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-3996"><a href="#GroupAnalysis.UMAP-3996"><span class="linenos">3996</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis.UMAP-3997"><a href="#GroupAnalysis.UMAP-3997"><span class="linenos">3997</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.UMAP-3998"><a href="#GroupAnalysis.UMAP-3998"><span class="linenos">3998</span></a><span class="sd">         Perform UMAP (Uniform Manifold Approximation and Projection) dimensionality reduction on PCA results.</span>
</span><span id="GroupAnalysis.UMAP-3999"><a href="#GroupAnalysis.UMAP-3999"><span class="linenos">3999</span></a>
</span><span id="GroupAnalysis.UMAP-4000"><a href="#GroupAnalysis.UMAP-4000"><span class="linenos">4000</span></a><span class="sd">         UMAP is applied to the top principal components, optionally using metadata labels to influence the embedding. Generates both 2D/3D embeddings and visualizations.</span>
</span><span id="GroupAnalysis.UMAP-4001"><a href="#GroupAnalysis.UMAP-4001"><span class="linenos">4001</span></a>
</span><span id="GroupAnalysis.UMAP-4002"><a href="#GroupAnalysis.UMAP-4002"><span class="linenos">4002</span></a><span class="sd">         Parameters</span>
</span><span id="GroupAnalysis.UMAP-4003"><a href="#GroupAnalysis.UMAP-4003"><span class="linenos">4003</span></a><span class="sd">         ----------</span>
</span><span id="GroupAnalysis.UMAP-4004"><a href="#GroupAnalysis.UMAP-4004"><span class="linenos">4004</span></a><span class="sd">         PC_num : int, optional</span>
</span><span id="GroupAnalysis.UMAP-4005"><a href="#GroupAnalysis.UMAP-4005"><span class="linenos">4005</span></a><span class="sd">             Number of top principal components to use for UMAP embedding. Default is 5.</span>
</span><span id="GroupAnalysis.UMAP-4006"><a href="#GroupAnalysis.UMAP-4006"><span class="linenos">4006</span></a>
</span><span id="GroupAnalysis.UMAP-4007"><a href="#GroupAnalysis.UMAP-4007"><span class="linenos">4007</span></a><span class="sd">         factorize_with_metadata : bool, optional</span>
</span><span id="GroupAnalysis.UMAP-4008"><a href="#GroupAnalysis.UMAP-4008"><span class="linenos">4008</span></a><span class="sd">             Whether to use metadata (e.g., &#39;sets&#39;) to factorize UMAP embedding. Default is False.</span>
</span><span id="GroupAnalysis.UMAP-4009"><a href="#GroupAnalysis.UMAP-4009"><span class="linenos">4009</span></a>
</span><span id="GroupAnalysis.UMAP-4010"><a href="#GroupAnalysis.UMAP-4010"><span class="linenos">4010</span></a><span class="sd">        harmonize_sets : bool, optional</span>
</span><span id="GroupAnalysis.UMAP-4011"><a href="#GroupAnalysis.UMAP-4011"><span class="linenos">4011</span></a><span class="sd">             If True, applies harmonization across data sets before computing the UMAP embedding.</span>
</span><span id="GroupAnalysis.UMAP-4012"><a href="#GroupAnalysis.UMAP-4012"><span class="linenos">4012</span></a><span class="sd">             Default is True.</span>
</span><span id="GroupAnalysis.UMAP-4013"><a href="#GroupAnalysis.UMAP-4013"><span class="linenos">4013</span></a>
</span><span id="GroupAnalysis.UMAP-4014"><a href="#GroupAnalysis.UMAP-4014"><span class="linenos">4014</span></a><span class="sd">         n_neighbors : int, optional</span>
</span><span id="GroupAnalysis.UMAP-4015"><a href="#GroupAnalysis.UMAP-4015"><span class="linenos">4015</span></a><span class="sd">             Number of neighbors for UMAP to compute local structure. Default is 25.</span>
</span><span id="GroupAnalysis.UMAP-4016"><a href="#GroupAnalysis.UMAP-4016"><span class="linenos">4016</span></a>
</span><span id="GroupAnalysis.UMAP-4017"><a href="#GroupAnalysis.UMAP-4017"><span class="linenos">4017</span></a><span class="sd">         min_dist : float, optional</span>
</span><span id="GroupAnalysis.UMAP-4018"><a href="#GroupAnalysis.UMAP-4018"><span class="linenos">4018</span></a><span class="sd">             Minimum distance between points in the low-dimensional embedding. Default is 0.01.</span>
</span><span id="GroupAnalysis.UMAP-4019"><a href="#GroupAnalysis.UMAP-4019"><span class="linenos">4019</span></a>
</span><span id="GroupAnalysis.UMAP-4020"><a href="#GroupAnalysis.UMAP-4020"><span class="linenos">4020</span></a><span class="sd">         n_components : int, optional</span>
</span><span id="GroupAnalysis.UMAP-4021"><a href="#GroupAnalysis.UMAP-4021"><span class="linenos">4021</span></a><span class="sd">             Number of dimensions for the UMAP embedding. Default is 2.</span>
</span><span id="GroupAnalysis.UMAP-4022"><a href="#GroupAnalysis.UMAP-4022"><span class="linenos">4022</span></a><span class="sd">             </span>
</span><span id="GroupAnalysis.UMAP-4023"><a href="#GroupAnalysis.UMAP-4023"><span class="linenos">4023</span></a><span class="sd">         width : int, optional</span>
</span><span id="GroupAnalysis.UMAP-4024"><a href="#GroupAnalysis.UMAP-4024"><span class="linenos">4024</span></a><span class="sd">             Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="GroupAnalysis.UMAP-4025"><a href="#GroupAnalysis.UMAP-4025"><span class="linenos">4025</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP-4026"><a href="#GroupAnalysis.UMAP-4026"><span class="linenos">4026</span></a><span class="sd">         height : int, optional</span>
</span><span id="GroupAnalysis.UMAP-4027"><a href="#GroupAnalysis.UMAP-4027"><span class="linenos">4027</span></a><span class="sd">             Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="GroupAnalysis.UMAP-4028"><a href="#GroupAnalysis.UMAP-4028"><span class="linenos">4028</span></a>
</span><span id="GroupAnalysis.UMAP-4029"><a href="#GroupAnalysis.UMAP-4029"><span class="linenos">4029</span></a><span class="sd">         Notes</span>
</span><span id="GroupAnalysis.UMAP-4030"><a href="#GroupAnalysis.UMAP-4030"><span class="linenos">4030</span></a><span class="sd">         -----</span>
</span><span id="GroupAnalysis.UMAP-4031"><a href="#GroupAnalysis.UMAP-4031"><span class="linenos">4031</span></a><span class="sd">         Stores results in the following attributes:</span>
</span><span id="GroupAnalysis.UMAP-4032"><a href="#GroupAnalysis.UMAP-4032"><span class="linenos">4032</span></a><span class="sd">         - `self.UMAP_data` (np.ndarray): UMAP-transformed data.</span>
</span><span id="GroupAnalysis.UMAP-4033"><a href="#GroupAnalysis.UMAP-4033"><span class="linenos">4033</span></a><span class="sd">         - `self.UMAP_plot[&#39;static&#39;][&#39;PrimaryUMAP&#39;]` (matplotlib.figure.Figure): Static visualization of UMAP embedding.</span>
</span><span id="GroupAnalysis.UMAP-4034"><a href="#GroupAnalysis.UMAP-4034"><span class="linenos">4034</span></a><span class="sd">         - `self.UMAP_plot[&#39;html&#39;][&#39;PrimaryUMAP&#39;]` (plotly.graph_objs.Figure): Interactive Plotly visualization of UMAP embedding.</span>
</span><span id="GroupAnalysis.UMAP-4035"><a href="#GroupAnalysis.UMAP-4035"><span class="linenos">4035</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.UMAP-4036"><a href="#GroupAnalysis.UMAP-4036"><span class="linenos">4036</span></a>
</span><span id="GroupAnalysis.UMAP-4037"><a href="#GroupAnalysis.UMAP-4037"><span class="linenos">4037</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP-4038"><a href="#GroupAnalysis.UMAP-4038"><span class="linenos">4038</span></a>
</span><span id="GroupAnalysis.UMAP-4039"><a href="#GroupAnalysis.UMAP-4039"><span class="linenos">4039</span></a>            <span class="n">reducer</span> <span class="o">=</span> <span class="n">umap</span><span class="o">.</span><span class="n">UMAP</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP-4040"><a href="#GroupAnalysis.UMAP-4040"><span class="linenos">4040</span></a>                <span class="n">n_neighbors</span><span class="o">=</span><span class="n">n_neighbors</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-4041"><a href="#GroupAnalysis.UMAP-4041"><span class="linenos">4041</span></a>                <span class="n">min_dist</span><span class="o">=</span><span class="n">min_dist</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-4042"><a href="#GroupAnalysis.UMAP-4042"><span class="linenos">4042</span></a>                <span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-4043"><a href="#GroupAnalysis.UMAP-4043"><span class="linenos">4043</span></a>                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP-4044"><a href="#GroupAnalysis.UMAP-4044"><span class="linenos">4044</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP-4045"><a href="#GroupAnalysis.UMAP-4045"><span class="linenos">4045</span></a>
</span><span id="GroupAnalysis.UMAP-4046"><a href="#GroupAnalysis.UMAP-4046"><span class="linenos">4046</span></a>            <span class="n">pca_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PCA_results</span>
</span><span id="GroupAnalysis.UMAP-4047"><a href="#GroupAnalysis.UMAP-4047"><span class="linenos">4047</span></a>
</span><span id="GroupAnalysis.UMAP-4048"><a href="#GroupAnalysis.UMAP-4048"><span class="linenos">4048</span></a>            <span class="k">if</span> <span class="n">harmonize_sets</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP-4049"><a href="#GroupAnalysis.UMAP-4049"><span class="linenos">4049</span></a>
</span><span id="GroupAnalysis.UMAP-4050"><a href="#GroupAnalysis.UMAP-4050"><span class="linenos">4050</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pca_res</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP-4051"><a href="#GroupAnalysis.UMAP-4051"><span class="linenos">4051</span></a>
</span><span id="GroupAnalysis.UMAP-4052"><a href="#GroupAnalysis.UMAP-4052"><span class="linenos">4052</span></a>                <span class="n">pca_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP-4053"><a href="#GroupAnalysis.UMAP-4053"><span class="linenos">4053</span></a>                    <span class="n">harmonize</span><span class="o">.</span><span class="n">run_harmony</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP-4054"><a href="#GroupAnalysis.UMAP-4054"><span class="linenos">4054</span></a>                        <span class="n">pca_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">input_metadata</span><span class="p">,</span> <span class="n">vars_use</span><span class="o">=</span><span class="s2">&quot;sets&quot;</span>
</span><span id="GroupAnalysis.UMAP-4055"><a href="#GroupAnalysis.UMAP-4055"><span class="linenos">4055</span></a>                    <span class="p">)</span><span class="o">.</span><span class="n">Z_corr</span>
</span><span id="GroupAnalysis.UMAP-4056"><a href="#GroupAnalysis.UMAP-4056"><span class="linenos">4056</span></a>                <span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="GroupAnalysis.UMAP-4057"><a href="#GroupAnalysis.UMAP-4057"><span class="linenos">4057</span></a>
</span><span id="GroupAnalysis.UMAP-4058"><a href="#GroupAnalysis.UMAP-4058"><span class="linenos">4058</span></a>            <span class="k">if</span> <span class="n">factorize_with_metadata</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP-4059"><a href="#GroupAnalysis.UMAP-4059"><span class="linenos">4059</span></a>                <span class="n">numeric_labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">codes</span>
</span><span id="GroupAnalysis.UMAP-4060"><a href="#GroupAnalysis.UMAP-4060"><span class="linenos">4060</span></a>
</span><span id="GroupAnalysis.UMAP-4061"><a href="#GroupAnalysis.UMAP-4061"><span class="linenos">4061</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP-4062"><a href="#GroupAnalysis.UMAP-4062"><span class="linenos">4062</span></a>                    <span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">numeric_labels</span>
</span><span id="GroupAnalysis.UMAP-4063"><a href="#GroupAnalysis.UMAP-4063"><span class="linenos">4063</span></a>                <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP-4064"><a href="#GroupAnalysis.UMAP-4064"><span class="linenos">4064</span></a>
</span><span id="GroupAnalysis.UMAP-4065"><a href="#GroupAnalysis.UMAP-4065"><span class="linenos">4065</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP-4066"><a href="#GroupAnalysis.UMAP-4066"><span class="linenos">4066</span></a>                <span class="n">umap_result</span> <span class="o">=</span> <span class="n">reducer</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pca_res</span><span class="p">[:,</span> <span class="p">:</span> <span class="n">PC_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="GroupAnalysis.UMAP-4067"><a href="#GroupAnalysis.UMAP-4067"><span class="linenos">4067</span></a>
</span><span id="GroupAnalysis.UMAP-4068"><a href="#GroupAnalysis.UMAP-4068"><span class="linenos">4068</span></a>            <span class="n">umap_result_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">umap_result</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="GroupAnalysis.UMAP-4069"><a href="#GroupAnalysis.UMAP-4069"><span class="linenos">4069</span></a>
</span><span id="GroupAnalysis.UMAP-4070"><a href="#GroupAnalysis.UMAP-4070"><span class="linenos">4070</span></a>            <span class="n">umap_result_plot</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis.UMAP-4071"><a href="#GroupAnalysis.UMAP-4071"><span class="linenos">4071</span></a>
</span><span id="GroupAnalysis.UMAP-4072"><a href="#GroupAnalysis.UMAP-4072"><span class="linenos">4072</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP-4073"><a href="#GroupAnalysis.UMAP-4073"><span class="linenos">4073</span></a>
</span><span id="GroupAnalysis.UMAP-4074"><a href="#GroupAnalysis.UMAP-4074"><span class="linenos">4074</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result_plot</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP-4075"><a href="#GroupAnalysis.UMAP-4075"><span class="linenos">4075</span></a>
</span><span id="GroupAnalysis.UMAP-4076"><a href="#GroupAnalysis.UMAP-4076"><span class="linenos">4076</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span> <span class="o">=</span> <span class="n">umap_result</span>
</span><span id="GroupAnalysis.UMAP-4077"><a href="#GroupAnalysis.UMAP-4077"><span class="linenos">4077</span></a>
</span><span id="GroupAnalysis.UMAP-4078"><a href="#GroupAnalysis.UMAP-4078"><span class="linenos">4078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis.UMAP-4079"><a href="#GroupAnalysis.UMAP-4079"><span class="linenos">4079</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;PrimaryUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis.UMAP-4080"><a href="#GroupAnalysis.UMAP-4080"><span class="linenos">4080</span></a>
</span><span id="GroupAnalysis.UMAP-4081"><a href="#GroupAnalysis.UMAP-4081"><span class="linenos">4081</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP-4082"><a href="#GroupAnalysis.UMAP-4082"><span class="linenos">4082</span></a>
</span><span id="GroupAnalysis.UMAP-4083"><a href="#GroupAnalysis.UMAP-4083"><span class="linenos">4083</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for UMAP. Please use the PCA() method first.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform UMAP (Uniform Manifold Approximation and Projection) dimensionality reduction on PCA results.</p>

<p>UMAP is applied to the top principal components, optionally using metadata labels to influence the embedding. Generates both 2D/3D embeddings and visualizations.</p>

<p>Parameters</p>

<hr />

<p>PC_num : int, optional
     Number of top principal components to use for UMAP embedding. Default is 5.</p>

<p>factorize_with_metadata : bool, optional
     Whether to use metadata (e.g., 'sets') to factorize UMAP embedding. Default is False.</p>

<p>harmonize_sets : bool, optional
     If True, applies harmonization across data sets before computing the UMAP embedding.
     Default is True.</p>

<p>n_neighbors : int, optional
     Number of neighbors for UMAP to compute local structure. Default is 25.</p>

<p>min_dist : float, optional
     Minimum distance between points in the low-dimensional embedding. Default is 0.01.</p>

<p>n_components : int, optional
     Number of dimensions for the UMAP embedding. Default is 2.</p>

<p>width : int, optional
     Width of the generated matplotlib figures (in inches). Default is 8.</p>

<p>height : int, optional
     Height of the generated matplotlib figures (in inches). Default is 6.</p>

<p>Notes</p>

<hr />

<p>Stores results in the following attributes:</p>

<ul>
<li><code>self.UMAP_data</code> (np.ndarray): UMAP-transformed data.</li>
<li><code>self.UMAP_plot['static']['PrimaryUMAP']</code> (matplotlib.figure.Figure): Static visualization of UMAP embedding.</li>
<li><code>self.UMAP_plot['html']['PrimaryUMAP']</code> (plotly.graph_objs.Figure): Interactive Plotly visualization of UMAP embedding.</li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.db_scan" class="classattr">
                                        <input id="GroupAnalysis.db_scan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">db_scan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">eps</span><span class="o">=</span><span class="mf">0.5</span>, </span><span class="param"><span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.db_scan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.db_scan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.db_scan-4085"><a href="#GroupAnalysis.db_scan-4085"><span class="linenos">4085</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">db_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="GroupAnalysis.db_scan-4086"><a href="#GroupAnalysis.db_scan-4086"><span class="linenos">4086</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.db_scan-4087"><a href="#GroupAnalysis.db_scan-4087"><span class="linenos">4087</span></a><span class="sd">        Perform DBSCAN clustering on UMAP-transformed data.</span>
</span><span id="GroupAnalysis.db_scan-4088"><a href="#GroupAnalysis.db_scan-4088"><span class="linenos">4088</span></a>
</span><span id="GroupAnalysis.db_scan-4089"><a href="#GroupAnalysis.db_scan-4089"><span class="linenos">4089</span></a><span class="sd">        DBSCAN identifies clusters based on density, labeling points in dense regions as clusters and others as noise.</span>
</span><span id="GroupAnalysis.db_scan-4090"><a href="#GroupAnalysis.db_scan-4090"><span class="linenos">4090</span></a>
</span><span id="GroupAnalysis.db_scan-4091"><a href="#GroupAnalysis.db_scan-4091"><span class="linenos">4091</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.db_scan-4092"><a href="#GroupAnalysis.db_scan-4092"><span class="linenos">4092</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.db_scan-4093"><a href="#GroupAnalysis.db_scan-4093"><span class="linenos">4093</span></a><span class="sd">        eps : float, optional</span>
</span><span id="GroupAnalysis.db_scan-4094"><a href="#GroupAnalysis.db_scan-4094"><span class="linenos">4094</span></a><span class="sd">            Maximum distance between two points to be considered neighbors. Default is 0.5.</span>
</span><span id="GroupAnalysis.db_scan-4095"><a href="#GroupAnalysis.db_scan-4095"><span class="linenos">4095</span></a>
</span><span id="GroupAnalysis.db_scan-4096"><a href="#GroupAnalysis.db_scan-4096"><span class="linenos">4096</span></a><span class="sd">        min_samples : int, optional</span>
</span><span id="GroupAnalysis.db_scan-4097"><a href="#GroupAnalysis.db_scan-4097"><span class="linenos">4097</span></a><span class="sd">            Minimum number of points required to form a dense region (cluster). Default is 10.</span>
</span><span id="GroupAnalysis.db_scan-4098"><a href="#GroupAnalysis.db_scan-4098"><span class="linenos">4098</span></a>
</span><span id="GroupAnalysis.db_scan-4099"><a href="#GroupAnalysis.db_scan-4099"><span class="linenos">4099</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.db_scan-4100"><a href="#GroupAnalysis.db_scan-4100"><span class="linenos">4100</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.db_scan-4101"><a href="#GroupAnalysis.db_scan-4101"><span class="linenos">4101</span></a><span class="sd">        Stores the results in the following attribute:</span>
</span><span id="GroupAnalysis.db_scan-4102"><a href="#GroupAnalysis.db_scan-4102"><span class="linenos">4102</span></a><span class="sd">        - `self.dblabels` (list of str): Cluster labels assigned by DBSCAN for each point in the UMAP embedding.</span>
</span><span id="GroupAnalysis.db_scan-4103"><a href="#GroupAnalysis.db_scan-4103"><span class="linenos">4103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.db_scan-4104"><a href="#GroupAnalysis.db_scan-4104"><span class="linenos">4104</span></a>
</span><span id="GroupAnalysis.db_scan-4105"><a href="#GroupAnalysis.db_scan-4105"><span class="linenos">4105</span></a>
</span><span id="GroupAnalysis.db_scan-4106"><a href="#GroupAnalysis.db_scan-4106"><span class="linenos">4106</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.db_scan-4107"><a href="#GroupAnalysis.db_scan-4107"><span class="linenos">4107</span></a>
</span><span id="GroupAnalysis.db_scan-4108"><a href="#GroupAnalysis.db_scan-4108"><span class="linenos">4108</span></a>            <span class="n">dbscan</span> <span class="o">=</span> <span class="n">DBSCAN</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">min_samples</span><span class="o">=</span><span class="n">min_samples</span><span class="p">)</span>
</span><span id="GroupAnalysis.db_scan-4109"><a href="#GroupAnalysis.db_scan-4109"><span class="linenos">4109</span></a>            <span class="n">dbscan_labels</span> <span class="o">=</span> <span class="n">dbscan</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">)</span>
</span><span id="GroupAnalysis.db_scan-4110"><a href="#GroupAnalysis.db_scan-4110"><span class="linenos">4110</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dbscan_labels</span><span class="p">]</span>
</span><span id="GroupAnalysis.db_scan-4111"><a href="#GroupAnalysis.db_scan-4111"><span class="linenos">4111</span></a>
</span><span id="GroupAnalysis.db_scan-4112"><a href="#GroupAnalysis.db_scan-4112"><span class="linenos">4112</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.db_scan-4113"><a href="#GroupAnalysis.db_scan-4113"><span class="linenos">4113</span></a>
</span><span id="GroupAnalysis.db_scan-4114"><a href="#GroupAnalysis.db_scan-4114"><span class="linenos">4114</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for DBSCAN. Please use the UMAP() method first.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform DBSCAN clustering on UMAP-transformed data.</p>

<p>DBSCAN identifies clusters based on density, labeling points in dense regions as clusters and others as noise.</p>

<h2 id="parameters">Parameters</h2>

<p>eps : float, optional
    Maximum distance between two points to be considered neighbors. Default is 0.5.</p>

<p>min_samples : int, optional
    Minimum number of points required to form a dense region (cluster). Default is 10.</p>

<h2 id="notes">Notes</h2>

<p>Stores the results in the following attribute:</p>

<ul>
<li><code>self.dblabels</code> (list of str): Cluster labels assigned by DBSCAN for each point in the UMAP embedding.</li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.UMAP_on_clusters" class="classattr">
                                        <input id="GroupAnalysis.UMAP_on_clusters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">UMAP_on_clusters</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">min_entities</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span>,</span><span class="param">	<span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span>,</span><span class="param">	<span class="n">n_per_col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.UMAP_on_clusters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.UMAP_on_clusters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.UMAP_on_clusters-4116"><a href="#GroupAnalysis.UMAP_on_clusters-4116"><span class="linenos">4116</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">UMAP_on_clusters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_entities</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4117"><a href="#GroupAnalysis.UMAP_on_clusters-4117"><span class="linenos">4117</span></a>                         <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> 
</span><span id="GroupAnalysis.UMAP_on_clusters-4118"><a href="#GroupAnalysis.UMAP_on_clusters-4118"><span class="linenos">4118</span></a>                         <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4119"><a href="#GroupAnalysis.UMAP_on_clusters-4119"><span class="linenos">4119</span></a>                         <span class="n">n_per_col</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4120"><a href="#GroupAnalysis.UMAP_on_clusters-4120"><span class="linenos">4120</span></a>                         <span class="p">):</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4121"><a href="#GroupAnalysis.UMAP_on_clusters-4121"><span class="linenos">4121</span></a><span class="w">        </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4122"><a href="#GroupAnalysis.UMAP_on_clusters-4122"><span class="linenos">4122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4123"><a href="#GroupAnalysis.UMAP_on_clusters-4123"><span class="linenos">4123</span></a><span class="sd">        Generate UMAP visualizations for clusters filtered by a minimum entity threshold.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4124"><a href="#GroupAnalysis.UMAP_on_clusters-4124"><span class="linenos">4124</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4125"><a href="#GroupAnalysis.UMAP_on_clusters-4125"><span class="linenos">4125</span></a><span class="sd">        This method removes clusters containing fewer than `min_entities` observations</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4126"><a href="#GroupAnalysis.UMAP_on_clusters-4126"><span class="linenos">4126</span></a><span class="sd">        and produces two UMAP visualizations:</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4127"><a href="#GroupAnalysis.UMAP_on_clusters-4127"><span class="linenos">4127</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4128"><a href="#GroupAnalysis.UMAP_on_clusters-4128"><span class="linenos">4128</span></a><span class="sd">        1. **Cluster UMAP** – points colored by cluster assignment only.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4129"><a href="#GroupAnalysis.UMAP_on_clusters-4129"><span class="linenos">4129</span></a><span class="sd">        2. **Cluster × Set UMAP** – points colored by the combination of cluster and set identifier.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4130"><a href="#GroupAnalysis.UMAP_on_clusters-4130"><span class="linenos">4130</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4131"><a href="#GroupAnalysis.UMAP_on_clusters-4131"><span class="linenos">4131</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4132"><a href="#GroupAnalysis.UMAP_on_clusters-4132"><span class="linenos">4132</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4133"><a href="#GroupAnalysis.UMAP_on_clusters-4133"><span class="linenos">4133</span></a><span class="sd">        min_entities : int, optional</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4134"><a href="#GroupAnalysis.UMAP_on_clusters-4134"><span class="linenos">4134</span></a><span class="sd">            Minimum number of entities required for a cluster to be included</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4135"><a href="#GroupAnalysis.UMAP_on_clusters-4135"><span class="linenos">4135</span></a><span class="sd">            in the visualization. Default is 50.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4136"><a href="#GroupAnalysis.UMAP_on_clusters-4136"><span class="linenos">4136</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4137"><a href="#GroupAnalysis.UMAP_on_clusters-4137"><span class="linenos">4137</span></a><span class="sd">        width : int, optional</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4138"><a href="#GroupAnalysis.UMAP_on_clusters-4138"><span class="linenos">4138</span></a><span class="sd">            Width of the generated matplotlib figures (in inches). Default is 8.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4139"><a href="#GroupAnalysis.UMAP_on_clusters-4139"><span class="linenos">4139</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4140"><a href="#GroupAnalysis.UMAP_on_clusters-4140"><span class="linenos">4140</span></a><span class="sd">        height : int, optional</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4141"><a href="#GroupAnalysis.UMAP_on_clusters-4141"><span class="linenos">4141</span></a><span class="sd">            Height of the generated matplotlib figures (in inches). Default is 6.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4142"><a href="#GroupAnalysis.UMAP_on_clusters-4142"><span class="linenos">4142</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4143"><a href="#GroupAnalysis.UMAP_on_clusters-4143"><span class="linenos">4143</span></a><span class="sd">        n_per_col : int, optional</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4144"><a href="#GroupAnalysis.UMAP_on_clusters-4144"><span class="linenos">4144</span></a><span class="sd">            Maximum number of legend entries per column. Default is 20.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4145"><a href="#GroupAnalysis.UMAP_on_clusters-4145"><span class="linenos">4145</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4146"><a href="#GroupAnalysis.UMAP_on_clusters-4146"><span class="linenos">4146</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4147"><a href="#GroupAnalysis.UMAP_on_clusters-4147"><span class="linenos">4147</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4148"><a href="#GroupAnalysis.UMAP_on_clusters-4148"><span class="linenos">4148</span></a><span class="sd">        This method updates the following attributes:</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4149"><a href="#GroupAnalysis.UMAP_on_clusters-4149"><span class="linenos">4149</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4150"><a href="#GroupAnalysis.UMAP_on_clusters-4150"><span class="linenos">4150</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4151"><a href="#GroupAnalysis.UMAP_on_clusters-4151"><span class="linenos">4151</span></a><span class="sd">          Static matplotlib figure of the filtered cluster-only UMAP.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4152"><a href="#GroupAnalysis.UMAP_on_clusters-4152"><span class="linenos">4152</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4153"><a href="#GroupAnalysis.UMAP_on_clusters-4153"><span class="linenos">4153</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterUMAP&#39;]`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4154"><a href="#GroupAnalysis.UMAP_on_clusters-4154"><span class="linenos">4154</span></a><span class="sd">          Interactive HTML version of the cluster-only UMAP.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4155"><a href="#GroupAnalysis.UMAP_on_clusters-4155"><span class="linenos">4155</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4156"><a href="#GroupAnalysis.UMAP_on_clusters-4156"><span class="linenos">4156</span></a><span class="sd">        - `self.UMAP_plot[&#39;static&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4157"><a href="#GroupAnalysis.UMAP_on_clusters-4157"><span class="linenos">4157</span></a><span class="sd">          Static matplotlib figure showing clusters combined with set identifiers.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4158"><a href="#GroupAnalysis.UMAP_on_clusters-4158"><span class="linenos">4158</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4159"><a href="#GroupAnalysis.UMAP_on_clusters-4159"><span class="linenos">4159</span></a><span class="sd">        - `self.UMAP_plot[&#39;html&#39;][&#39;ClusterXSetsUMAP&#39;]`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4160"><a href="#GroupAnalysis.UMAP_on_clusters-4160"><span class="linenos">4160</span></a><span class="sd">          Interactive HTML version of the cluster × set visualization.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4161"><a href="#GroupAnalysis.UMAP_on_clusters-4161"><span class="linenos">4161</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4162"><a href="#GroupAnalysis.UMAP_on_clusters-4162"><span class="linenos">4162</span></a><span class="sd">        - `self.tmp_data`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4163"><a href="#GroupAnalysis.UMAP_on_clusters-4163"><span class="linenos">4163</span></a><span class="sd">          Dataset filtered to include only clusters meeting the `min_entities` threshold.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4164"><a href="#GroupAnalysis.UMAP_on_clusters-4164"><span class="linenos">4164</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4165"><a href="#GroupAnalysis.UMAP_on_clusters-4165"><span class="linenos">4165</span></a><span class="sd">        - `self.tmp_metadata`  </span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4166"><a href="#GroupAnalysis.UMAP_on_clusters-4166"><span class="linenos">4166</span></a><span class="sd">          Metadata corresponding to the filtered dataset.</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4167"><a href="#GroupAnalysis.UMAP_on_clusters-4167"><span class="linenos">4167</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4168"><a href="#GroupAnalysis.UMAP_on_clusters-4168"><span class="linenos">4168</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4169"><a href="#GroupAnalysis.UMAP_on_clusters-4169"><span class="linenos">4169</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4170"><a href="#GroupAnalysis.UMAP_on_clusters-4170"><span class="linenos">4170</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4171"><a href="#GroupAnalysis.UMAP_on_clusters-4171"><span class="linenos">4171</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_data_old&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4172"><a href="#GroupAnalysis.UMAP_on_clusters-4172"><span class="linenos">4172</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4173"><a href="#GroupAnalysis.UMAP_on_clusters-4173"><span class="linenos">4173</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4174"><a href="#GroupAnalysis.UMAP_on_clusters-4174"><span class="linenos">4174</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_tmp_metadata_old&quot;</span><span class="p">):</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4175"><a href="#GroupAnalysis.UMAP_on_clusters-4175"><span class="linenos">4175</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4176"><a href="#GroupAnalysis.UMAP_on_clusters-4176"><span class="linenos">4176</span></a>    
</span><span id="GroupAnalysis.UMAP_on_clusters-4177"><a href="#GroupAnalysis.UMAP_on_clusters-4177"><span class="linenos">4177</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">UMAP_data</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4178"><a href="#GroupAnalysis.UMAP_on_clusters-4178"><span class="linenos">4178</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">index</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4179"><a href="#GroupAnalysis.UMAP_on_clusters-4179"><span class="linenos">4179</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4180"><a href="#GroupAnalysis.UMAP_on_clusters-4180"><span class="linenos">4180</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span><span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4181"><a href="#GroupAnalysis.UMAP_on_clusters-4181"><span class="linenos">4181</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4182"><a href="#GroupAnalysis.UMAP_on_clusters-4182"><span class="linenos">4182</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4183"><a href="#GroupAnalysis.UMAP_on_clusters-4183"><span class="linenos">4183</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4184"><a href="#GroupAnalysis.UMAP_on_clusters-4184"><span class="linenos">4184</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4185"><a href="#GroupAnalysis.UMAP_on_clusters-4185"><span class="linenos">4185</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4186"><a href="#GroupAnalysis.UMAP_on_clusters-4186"><span class="linenos">4186</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">!=</span> <span class="s2">&quot;-1&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4187"><a href="#GroupAnalysis.UMAP_on_clusters-4187"><span class="linenos">4187</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4188"><a href="#GroupAnalysis.UMAP_on_clusters-4188"><span class="linenos">4188</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dblabels</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4189"><a href="#GroupAnalysis.UMAP_on_clusters-4189"><span class="linenos">4189</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4190"><a href="#GroupAnalysis.UMAP_on_clusters-4190"><span class="linenos">4190</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4191"><a href="#GroupAnalysis.UMAP_on_clusters-4191"><span class="linenos">4191</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4192"><a href="#GroupAnalysis.UMAP_on_clusters-4192"><span class="linenos">4192</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4193"><a href="#GroupAnalysis.UMAP_on_clusters-4193"><span class="linenos">4193</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4194"><a href="#GroupAnalysis.UMAP_on_clusters-4194"><span class="linenos">4194</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4195"><a href="#GroupAnalysis.UMAP_on_clusters-4195"><span class="linenos">4195</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4196"><a href="#GroupAnalysis.UMAP_on_clusters-4196"><span class="linenos">4196</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4197"><a href="#GroupAnalysis.UMAP_on_clusters-4197"><span class="linenos">4197</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4198"><a href="#GroupAnalysis.UMAP_on_clusters-4198"><span class="linenos">4198</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4199"><a href="#GroupAnalysis.UMAP_on_clusters-4199"><span class="linenos">4199</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4200"><a href="#GroupAnalysis.UMAP_on_clusters-4200"><span class="linenos">4200</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4201"><a href="#GroupAnalysis.UMAP_on_clusters-4201"><span class="linenos">4201</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4202"><a href="#GroupAnalysis.UMAP_on_clusters-4202"><span class="linenos">4202</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4203"><a href="#GroupAnalysis.UMAP_on_clusters-4203"><span class="linenos">4203</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4204"><a href="#GroupAnalysis.UMAP_on_clusters-4204"><span class="linenos">4204</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4205"><a href="#GroupAnalysis.UMAP_on_clusters-4205"><span class="linenos">4205</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4206"><a href="#GroupAnalysis.UMAP_on_clusters-4206"><span class="linenos">4206</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4207"><a href="#GroupAnalysis.UMAP_on_clusters-4207"><span class="linenos">4207</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4208"><a href="#GroupAnalysis.UMAP_on_clusters-4208"><span class="linenos">4208</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4209"><a href="#GroupAnalysis.UMAP_on_clusters-4209"><span class="linenos">4209</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4210"><a href="#GroupAnalysis.UMAP_on_clusters-4210"><span class="linenos">4210</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;clusters&quot;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4211"><a href="#GroupAnalysis.UMAP_on_clusters-4211"><span class="linenos">4211</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4212"><a href="#GroupAnalysis.UMAP_on_clusters-4212"><span class="linenos">4212</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]))]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4213"><a href="#GroupAnalysis.UMAP_on_clusters-4213"><span class="linenos">4213</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4214"><a href="#GroupAnalysis.UMAP_on_clusters-4214"><span class="linenos">4214</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4215"><a href="#GroupAnalysis.UMAP_on_clusters-4215"><span class="linenos">4215</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4216"><a href="#GroupAnalysis.UMAP_on_clusters-4216"><span class="linenos">4216</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4217"><a href="#GroupAnalysis.UMAP_on_clusters-4217"><span class="linenos">4217</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4218"><a href="#GroupAnalysis.UMAP_on_clusters-4218"><span class="linenos">4218</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4219"><a href="#GroupAnalysis.UMAP_on_clusters-4219"><span class="linenos">4219</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4220"><a href="#GroupAnalysis.UMAP_on_clusters-4220"><span class="linenos">4220</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4221"><a href="#GroupAnalysis.UMAP_on_clusters-4221"><span class="linenos">4221</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4222"><a href="#GroupAnalysis.UMAP_on_clusters-4222"><span class="linenos">4222</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot; # &quot;</span> <span class="o">+</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4223"><a href="#GroupAnalysis.UMAP_on_clusters-4223"><span class="linenos">4223</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4224"><a href="#GroupAnalysis.UMAP_on_clusters-4224"><span class="linenos">4224</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4225"><a href="#GroupAnalysis.UMAP_on_clusters-4225"><span class="linenos">4225</span></a>            <span class="n">label_counts_dict</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4226"><a href="#GroupAnalysis.UMAP_on_clusters-4226"><span class="linenos">4226</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4227"><a href="#GroupAnalysis.UMAP_on_clusters-4227"><span class="linenos">4227</span></a>            <span class="n">label_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4228"><a href="#GroupAnalysis.UMAP_on_clusters-4228"><span class="linenos">4228</span></a>                <span class="n">label_counts_dict</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4229"><a href="#GroupAnalysis.UMAP_on_clusters-4229"><span class="linenos">4229</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4230"><a href="#GroupAnalysis.UMAP_on_clusters-4230"><span class="linenos">4230</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4231"><a href="#GroupAnalysis.UMAP_on_clusters-4231"><span class="linenos">4231</span></a>            <span class="n">filtered_counts</span> <span class="o">=</span> <span class="n">label_counts</span><span class="p">[</span><span class="n">label_counts</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">min_entities</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4232"><a href="#GroupAnalysis.UMAP_on_clusters-4232"><span class="linenos">4232</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4233"><a href="#GroupAnalysis.UMAP_on_clusters-4233"><span class="linenos">4233</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4234"><a href="#GroupAnalysis.UMAP_on_clusters-4234"><span class="linenos">4234</span></a>            <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4235"><a href="#GroupAnalysis.UMAP_on_clusters-4235"><span class="linenos">4235</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4236"><a href="#GroupAnalysis.UMAP_on_clusters-4236"><span class="linenos">4236</span></a>            <span class="n">umap_result</span> <span class="o">=</span> <span class="n">umap_result</span><span class="p">[</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4237"><a href="#GroupAnalysis.UMAP_on_clusters-4237"><span class="linenos">4237</span></a>                <span class="n">umap_result</span><span class="p">[</span><span class="s2">&quot;clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4238"><a href="#GroupAnalysis.UMAP_on_clusters-4238"><span class="linenos">4238</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4239"><a href="#GroupAnalysis.UMAP_on_clusters-4239"><span class="linenos">4239</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4240"><a href="#GroupAnalysis.UMAP_on_clusters-4240"><span class="linenos">4240</span></a>            <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4241"><a href="#GroupAnalysis.UMAP_on_clusters-4241"><span class="linenos">4241</span></a>                <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4242"><a href="#GroupAnalysis.UMAP_on_clusters-4242"><span class="linenos">4242</span></a>            <span class="p">]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4243"><a href="#GroupAnalysis.UMAP_on_clusters-4243"><span class="linenos">4243</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4244"><a href="#GroupAnalysis.UMAP_on_clusters-4244"><span class="linenos">4244</span></a>            <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="p">[</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filtered_counts</span><span class="o">.</span><span class="n">index</span><span class="p">))]</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4245"><a href="#GroupAnalysis.UMAP_on_clusters-4245"><span class="linenos">4245</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4246"><a href="#GroupAnalysis.UMAP_on_clusters-4246"><span class="linenos">4246</span></a>            <span class="n">static_fig</span> <span class="o">=</span> <span class="n">umap_static</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">n_per_col</span><span class="o">=</span><span class="n">n_per_col</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4247"><a href="#GroupAnalysis.UMAP_on_clusters-4247"><span class="linenos">4247</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4248"><a href="#GroupAnalysis.UMAP_on_clusters-4248"><span class="linenos">4248</span></a>            <span class="n">html_fig</span> <span class="o">=</span> <span class="n">umap_html</span><span class="p">(</span><span class="n">umap_result</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4249"><a href="#GroupAnalysis.UMAP_on_clusters-4249"><span class="linenos">4249</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4250"><a href="#GroupAnalysis.UMAP_on_clusters-4250"><span class="linenos">4250</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;static&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_fig</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4251"><a href="#GroupAnalysis.UMAP_on_clusters-4251"><span class="linenos">4251</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4252"><a href="#GroupAnalysis.UMAP_on_clusters-4252"><span class="linenos">4252</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">UMAP_plot</span><span class="p">[</span><span class="s2">&quot;html&quot;</span><span class="p">][</span><span class="s2">&quot;ClusterXSetsUMAP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">html_fig</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4253"><a href="#GroupAnalysis.UMAP_on_clusters-4253"><span class="linenos">4253</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4254"><a href="#GroupAnalysis.UMAP_on_clusters-4254"><span class="linenos">4254</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4255"><a href="#GroupAnalysis.UMAP_on_clusters-4255"><span class="linenos">4255</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_data_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4256"><a href="#GroupAnalysis.UMAP_on_clusters-4256"><span class="linenos">4256</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tmp_metadata_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4257"><a href="#GroupAnalysis.UMAP_on_clusters-4257"><span class="linenos">4257</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4258"><a href="#GroupAnalysis.UMAP_on_clusters-4258"><span class="linenos">4258</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4259"><a href="#GroupAnalysis.UMAP_on_clusters-4259"><span class="linenos">4259</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span> <span class="o">=</span> <span class="n">tmp_metadata</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4260"><a href="#GroupAnalysis.UMAP_on_clusters-4260"><span class="linenos">4260</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4261"><a href="#GroupAnalysis.UMAP_on_clusters-4261"><span class="linenos">4261</span></a>            
</span><span id="GroupAnalysis.UMAP_on_clusters-4262"><a href="#GroupAnalysis.UMAP_on_clusters-4262"><span class="linenos">4262</span></a>
</span><span id="GroupAnalysis.UMAP_on_clusters-4263"><a href="#GroupAnalysis.UMAP_on_clusters-4263"><span class="linenos">4263</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4264"><a href="#GroupAnalysis.UMAP_on_clusters-4264"><span class="linenos">4264</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4265"><a href="#GroupAnalysis.UMAP_on_clusters-4265"><span class="linenos">4265</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No data for visualization. Please use the UMAP() and db_scan() methods first.&quot;</span>
</span><span id="GroupAnalysis.UMAP_on_clusters-4266"><a href="#GroupAnalysis.UMAP_on_clusters-4266"><span class="linenos">4266</span></a>            <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate UMAP visualizations for clusters filtered by a minimum entity threshold.</p>

<p>This method removes clusters containing fewer than <code>min_entities</code> observations
and produces two UMAP visualizations:</p>

<ol>
<li><strong>Cluster UMAP</strong> – points colored by cluster assignment only.</li>
<li><strong>Cluster × Set UMAP</strong> – points colored by the combination of cluster and set identifier.</li>
</ol>

<h2 id="parameters">Parameters</h2>

<p>min_entities : int, optional
    Minimum number of entities required for a cluster to be included
    in the visualization. Default is 50.</p>

<p>width : int, optional
    Width of the generated matplotlib figures (in inches). Default is 8.</p>

<p>height : int, optional
    Height of the generated matplotlib figures (in inches). Default is 6.</p>

<p>n_per_col : int, optional
    Maximum number of legend entries per column. Default is 20.</p>

<h2 id="notes">Notes</h2>

<p>This method updates the following attributes:</p>

<ul>
<li><p><code>self.UMAP_plot['static']['ClusterUMAP']</code><br />
Static matplotlib figure of the filtered cluster-only UMAP.</p></li>
<li><p><code>self.UMAP_plot['html']['ClusterUMAP']</code><br />
Interactive HTML version of the cluster-only UMAP.</p></li>
<li><p><code>self.UMAP_plot['static']['ClusterXSetsUMAP']</code><br />
Static matplotlib figure showing clusters combined with set identifiers.</p></li>
<li><p><code>self.UMAP_plot['html']['ClusterXSetsUMAP']</code><br />
Interactive HTML version of the cluster × set visualization.</p></li>
<li><p><code>self.tmp_data</code><br />
Dataset filtered to include only clusters meeting the <code>min_entities</code> threshold.</p></li>
<li><p><code>self.tmp_metadata</code><br />
Metadata corresponding to the filtered dataset.</p></li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.full_info" class="classattr">
                                        <input id="GroupAnalysis.full_info-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">full_info</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.full_info-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.full_info"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.full_info-4269"><a href="#GroupAnalysis.full_info-4269"><span class="linenos">4269</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">full_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.full_info-4270"><a href="#GroupAnalysis.full_info-4270"><span class="linenos">4270</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.full_info-4271"><a href="#GroupAnalysis.full_info-4271"><span class="linenos">4271</span></a><span class="sd">        Merge data with metadata based on the &#39;full_id&#39; column.</span>
</span><span id="GroupAnalysis.full_info-4272"><a href="#GroupAnalysis.full_info-4272"><span class="linenos">4272</span></a>
</span><span id="GroupAnalysis.full_info-4273"><a href="#GroupAnalysis.full_info-4273"><span class="linenos">4273</span></a><span class="sd">        This method combines `self.tmp_data` and `self.tmp_metadata` into a single DataFrame if the metadata contains a &#39;full_id&#39; column. If &#39;full_id&#39; is not present, the method prints a warning to complete the preprocessing pipeline.</span>
</span><span id="GroupAnalysis.full_info-4274"><a href="#GroupAnalysis.full_info-4274"><span class="linenos">4274</span></a>
</span><span id="GroupAnalysis.full_info-4275"><a href="#GroupAnalysis.full_info-4275"><span class="linenos">4275</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.full_info-4276"><a href="#GroupAnalysis.full_info-4276"><span class="linenos">4276</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.full_info-4277"><a href="#GroupAnalysis.full_info-4277"><span class="linenos">4277</span></a><span class="sd">        pd.DataFrame or None</span>
</span><span id="GroupAnalysis.full_info-4278"><a href="#GroupAnalysis.full_info-4278"><span class="linenos">4278</span></a><span class="sd">            Merged DataFrame containing both data and metadata if &#39;full_id&#39; exists; otherwise, None.</span>
</span><span id="GroupAnalysis.full_info-4279"><a href="#GroupAnalysis.full_info-4279"><span class="linenos">4279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.full_info-4280"><a href="#GroupAnalysis.full_info-4280"><span class="linenos">4280</span></a>
</span><span id="GroupAnalysis.full_info-4281"><a href="#GroupAnalysis.full_info-4281"><span class="linenos">4281</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.full_info-4282"><a href="#GroupAnalysis.full_info-4282"><span class="linenos">4282</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.full_info-4283"><a href="#GroupAnalysis.full_info-4283"><span class="linenos">4283</span></a>
</span><span id="GroupAnalysis.full_info-4284"><a href="#GroupAnalysis.full_info-4284"><span class="linenos">4284</span></a>        <span class="k">if</span> <span class="s2">&quot;full_id&quot;</span> <span class="ow">in</span> <span class="n">tmp_metadata</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GroupAnalysis.full_info-4285"><a href="#GroupAnalysis.full_info-4285"><span class="linenos">4285</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;full_id&quot;</span><span class="p">]</span>
</span><span id="GroupAnalysis.full_info-4286"><a href="#GroupAnalysis.full_info-4286"><span class="linenos">4286</span></a>
</span><span id="GroupAnalysis.full_info-4287"><a href="#GroupAnalysis.full_info-4287"><span class="linenos">4287</span></a>            <span class="n">merged_df</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
</span><span id="GroupAnalysis.full_info-4288"><a href="#GroupAnalysis.full_info-4288"><span class="linenos">4288</span></a>                <span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s2">&quot;full_id&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span>
</span><span id="GroupAnalysis.full_info-4289"><a href="#GroupAnalysis.full_info-4289"><span class="linenos">4289</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.full_info-4290"><a href="#GroupAnalysis.full_info-4290"><span class="linenos">4290</span></a>
</span><span id="GroupAnalysis.full_info-4291"><a href="#GroupAnalysis.full_info-4291"><span class="linenos">4291</span></a>            <span class="k">return</span> <span class="n">merged_df</span>
</span><span id="GroupAnalysis.full_info-4292"><a href="#GroupAnalysis.full_info-4292"><span class="linenos">4292</span></a>
</span><span id="GroupAnalysis.full_info-4293"><a href="#GroupAnalysis.full_info-4293"><span class="linenos">4293</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.full_info-4294"><a href="#GroupAnalysis.full_info-4294"><span class="linenos">4294</span></a>
</span><span id="GroupAnalysis.full_info-4295"><a href="#GroupAnalysis.full_info-4295"><span class="linenos">4295</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metadata is not completed!&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.full_info-4296"><a href="#GroupAnalysis.full_info-4296"><span class="linenos">4296</span></a>
</span><span id="GroupAnalysis.full_info-4297"><a href="#GroupAnalysis.full_info-4297"><span class="linenos">4297</span></a>        <span class="c1">#################################################################################</span>
</span></pre></div>


            <div class="docstring"><p>Merge data with metadata based on the 'full_id' column.</p>

<p>This method combines <code>self.tmp_data</code> and <code>self.tmp_metadata</code> into a single DataFrame if the metadata contains a 'full_id' column. If 'full_id' is not present, the method prints a warning to complete the preprocessing pipeline.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame or None
    Merged DataFrame containing both data and metadata if 'full_id' exists; otherwise, None.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.DFA" class="classattr">
                                        <input id="GroupAnalysis.DFA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">DFA</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">meta_group_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sets&#39;</span>, </span><span class="param"><span class="n">sets</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>, </span><span class="param"><span class="n">n_proc</span><span class="o">=</span><span class="mi">5</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.DFA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.DFA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.DFA-4299"><a href="#GroupAnalysis.DFA-4299"><span class="linenos">4299</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meta_group_by</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">n_proc</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
</span><span id="GroupAnalysis.DFA-4300"><a href="#GroupAnalysis.DFA-4300"><span class="linenos">4300</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.DFA-4301"><a href="#GroupAnalysis.DFA-4301"><span class="linenos">4301</span></a><span class="sd">        Perform Differential Feature Analysis (DFA) on specified data groups.</span>
</span><span id="GroupAnalysis.DFA-4302"><a href="#GroupAnalysis.DFA-4302"><span class="linenos">4302</span></a>
</span><span id="GroupAnalysis.DFA-4303"><a href="#GroupAnalysis.DFA-4303"><span class="linenos">4303</span></a><span class="sd">        This method conducts DFA using a grouping factor from metadata and a dictionary of sets for comparison. It allows for the identification of significant differences across defined sets.</span>
</span><span id="GroupAnalysis.DFA-4304"><a href="#GroupAnalysis.DFA-4304"><span class="linenos">4304</span></a>
</span><span id="GroupAnalysis.DFA-4305"><a href="#GroupAnalysis.DFA-4305"><span class="linenos">4305</span></a><span class="sd">        The analysis includes:</span>
</span><span id="GroupAnalysis.DFA-4306"><a href="#GroupAnalysis.DFA-4306"><span class="linenos">4306</span></a><span class="sd">        - Mann–Whitney U test</span>
</span><span id="GroupAnalysis.DFA-4307"><a href="#GroupAnalysis.DFA-4307"><span class="linenos">4307</span></a><span class="sd">        - Percentage of non-zero values</span>
</span><span id="GroupAnalysis.DFA-4308"><a href="#GroupAnalysis.DFA-4308"><span class="linenos">4308</span></a><span class="sd">        - Means and standard deviations</span>
</span><span id="GroupAnalysis.DFA-4309"><a href="#GroupAnalysis.DFA-4309"><span class="linenos">4309</span></a><span class="sd">        - Effect size metric (ESM)</span>
</span><span id="GroupAnalysis.DFA-4310"><a href="#GroupAnalysis.DFA-4310"><span class="linenos">4310</span></a><span class="sd">        - Benjamini–Hochberg FDR correction</span>
</span><span id="GroupAnalysis.DFA-4311"><a href="#GroupAnalysis.DFA-4311"><span class="linenos">4311</span></a><span class="sd">        - Fold-change and log2 fold-change</span>
</span><span id="GroupAnalysis.DFA-4312"><a href="#GroupAnalysis.DFA-4312"><span class="linenos">4312</span></a>
</span><span id="GroupAnalysis.DFA-4313"><a href="#GroupAnalysis.DFA-4313"><span class="linenos">4313</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.DFA-4314"><a href="#GroupAnalysis.DFA-4314"><span class="linenos">4314</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.DFA-4315"><a href="#GroupAnalysis.DFA-4315"><span class="linenos">4315</span></a><span class="sd">        meta_group_by : str, optional</span>
</span><span id="GroupAnalysis.DFA-4316"><a href="#GroupAnalysis.DFA-4316"><span class="linenos">4316</span></a><span class="sd">            Metadata column used for grouping during the analysis.</span>
</span><span id="GroupAnalysis.DFA-4317"><a href="#GroupAnalysis.DFA-4317"><span class="linenos">4317</span></a><span class="sd">            Default is ``&#39;sets&#39;``.</span>
</span><span id="GroupAnalysis.DFA-4318"><a href="#GroupAnalysis.DFA-4318"><span class="linenos">4318</span></a><span class="sd">            To view available grouping categories, use ``self.groups``.</span>
</span><span id="GroupAnalysis.DFA-4319"><a href="#GroupAnalysis.DFA-4319"><span class="linenos">4319</span></a>
</span><span id="GroupAnalysis.DFA-4320"><a href="#GroupAnalysis.DFA-4320"><span class="linenos">4320</span></a><span class="sd">        sets : dict, optional</span>
</span><span id="GroupAnalysis.DFA-4321"><a href="#GroupAnalysis.DFA-4321"><span class="linenos">4321</span></a><span class="sd">            Dictionary defining groups for pairwise comparison.</span>
</span><span id="GroupAnalysis.DFA-4322"><a href="#GroupAnalysis.DFA-4322"><span class="linenos">4322</span></a><span class="sd">            Keys correspond to group names, and values are lists of labels</span>
</span><span id="GroupAnalysis.DFA-4323"><a href="#GroupAnalysis.DFA-4323"><span class="linenos">4323</span></a><span class="sd">            belonging to each group.</span>
</span><span id="GroupAnalysis.DFA-4324"><a href="#GroupAnalysis.DFA-4324"><span class="linenos">4324</span></a>
</span><span id="GroupAnalysis.DFA-4325"><a href="#GroupAnalysis.DFA-4325"><span class="linenos">4325</span></a><span class="sd">            Example</span>
</span><span id="GroupAnalysis.DFA-4326"><a href="#GroupAnalysis.DFA-4326"><span class="linenos">4326</span></a><span class="sd">            -------</span>
</span><span id="GroupAnalysis.DFA-4327"><a href="#GroupAnalysis.DFA-4327"><span class="linenos">4327</span></a><span class="sd">            &gt;&gt;&gt; sets = {</span>
</span><span id="GroupAnalysis.DFA-4328"><a href="#GroupAnalysis.DFA-4328"><span class="linenos">4328</span></a><span class="sd">            ...     &#39;healthy&#39;: [&#39;21q&#39;],</span>
</span><span id="GroupAnalysis.DFA-4329"><a href="#GroupAnalysis.DFA-4329"><span class="linenos">4329</span></a><span class="sd">            ...     &#39;disease&#39;: [&#39;71q&#39;, &#39;77q&#39;, &#39;109q&#39;]</span>
</span><span id="GroupAnalysis.DFA-4330"><a href="#GroupAnalysis.DFA-4330"><span class="linenos">4330</span></a><span class="sd">            ... }</span>
</span><span id="GroupAnalysis.DFA-4331"><a href="#GroupAnalysis.DFA-4331"><span class="linenos">4331</span></a><span class="sd">            In this configuration, the *healthy* group is compared against the</span>
</span><span id="GroupAnalysis.DFA-4332"><a href="#GroupAnalysis.DFA-4332"><span class="linenos">4332</span></a><span class="sd">            aggregated *disease* groups.</span>
</span><span id="GroupAnalysis.DFA-4333"><a href="#GroupAnalysis.DFA-4333"><span class="linenos">4333</span></a>
</span><span id="GroupAnalysis.DFA-4334"><a href="#GroupAnalysis.DFA-4334"><span class="linenos">4334</span></a><span class="sd">        n_proc : int, optional</span>
</span><span id="GroupAnalysis.DFA-4335"><a href="#GroupAnalysis.DFA-4335"><span class="linenos">4335</span></a><span class="sd">            Number of CPU cores used for parallel processing.</span>
</span><span id="GroupAnalysis.DFA-4336"><a href="#GroupAnalysis.DFA-4336"><span class="linenos">4336</span></a><span class="sd">            Default is ``5``.</span>
</span><span id="GroupAnalysis.DFA-4337"><a href="#GroupAnalysis.DFA-4337"><span class="linenos">4337</span></a>
</span><span id="GroupAnalysis.DFA-4338"><a href="#GroupAnalysis.DFA-4338"><span class="linenos">4338</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.DFA-4339"><a href="#GroupAnalysis.DFA-4339"><span class="linenos">4339</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.DFA-4340"><a href="#GroupAnalysis.DFA-4340"><span class="linenos">4340</span></a><span class="sd">        pandas.DataFrame or None</span>
</span><span id="GroupAnalysis.DFA-4341"><a href="#GroupAnalysis.DFA-4341"><span class="linenos">4341</span></a><span class="sd">            A DataFrame containing statistical results for each feature, including:</span>
</span><span id="GroupAnalysis.DFA-4342"><a href="#GroupAnalysis.DFA-4342"><span class="linenos">4342</span></a>
</span><span id="GroupAnalysis.DFA-4343"><a href="#GroupAnalysis.DFA-4343"><span class="linenos">4343</span></a><span class="sd">            - ``feature`` : str</span>
</span><span id="GroupAnalysis.DFA-4344"><a href="#GroupAnalysis.DFA-4344"><span class="linenos">4344</span></a><span class="sd">            - ``p_val`` : float</span>
</span><span id="GroupAnalysis.DFA-4345"><a href="#GroupAnalysis.DFA-4345"><span class="linenos">4345</span></a><span class="sd">            - ``adj_pval`` : float</span>
</span><span id="GroupAnalysis.DFA-4346"><a href="#GroupAnalysis.DFA-4346"><span class="linenos">4346</span></a><span class="sd">            - ``pct_valid`` : float</span>
</span><span id="GroupAnalysis.DFA-4347"><a href="#GroupAnalysis.DFA-4347"><span class="linenos">4347</span></a><span class="sd">            - ``pct_ctrl`` : float</span>
</span><span id="GroupAnalysis.DFA-4348"><a href="#GroupAnalysis.DFA-4348"><span class="linenos">4348</span></a><span class="sd">            - ``avg_valid`` : float</span>
</span><span id="GroupAnalysis.DFA-4349"><a href="#GroupAnalysis.DFA-4349"><span class="linenos">4349</span></a><span class="sd">            - ``avg_ctrl`` : float</span>
</span><span id="GroupAnalysis.DFA-4350"><a href="#GroupAnalysis.DFA-4350"><span class="linenos">4350</span></a><span class="sd">            - ``sd_valid`` : float</span>
</span><span id="GroupAnalysis.DFA-4351"><a href="#GroupAnalysis.DFA-4351"><span class="linenos">4351</span></a><span class="sd">            - ``sd_ctrl`` : float</span>
</span><span id="GroupAnalysis.DFA-4352"><a href="#GroupAnalysis.DFA-4352"><span class="linenos">4352</span></a><span class="sd">            - ``esm`` : float</span>
</span><span id="GroupAnalysis.DFA-4353"><a href="#GroupAnalysis.DFA-4353"><span class="linenos">4353</span></a><span class="sd">            - ``FC`` : float</span>
</span><span id="GroupAnalysis.DFA-4354"><a href="#GroupAnalysis.DFA-4354"><span class="linenos">4354</span></a><span class="sd">            - ``log(FC)`` : float</span>
</span><span id="GroupAnalysis.DFA-4355"><a href="#GroupAnalysis.DFA-4355"><span class="linenos">4355</span></a><span class="sd">            - ``norm_diff`` : float</span>
</span><span id="GroupAnalysis.DFA-4356"><a href="#GroupAnalysis.DFA-4356"><span class="linenos">4356</span></a><span class="sd">            - ``valid_group`` : str</span>
</span><span id="GroupAnalysis.DFA-4357"><a href="#GroupAnalysis.DFA-4357"><span class="linenos">4357</span></a><span class="sd">            - ``-log(p_val)`` : float</span>
</span><span id="GroupAnalysis.DFA-4358"><a href="#GroupAnalysis.DFA-4358"><span class="linenos">4358</span></a>
</span><span id="GroupAnalysis.DFA-4359"><a href="#GroupAnalysis.DFA-4359"><span class="linenos">4359</span></a><span class="sd">            If ``sets`` is ``None``, results for each group are concatenated.</span>
</span><span id="GroupAnalysis.DFA-4360"><a href="#GroupAnalysis.DFA-4360"><span class="linenos">4360</span></a>
</span><span id="GroupAnalysis.DFA-4361"><a href="#GroupAnalysis.DFA-4361"><span class="linenos">4361</span></a><span class="sd">            Returns ``None`` in case of errors or invalid parameters.</span>
</span><span id="GroupAnalysis.DFA-4362"><a href="#GroupAnalysis.DFA-4362"><span class="linenos">4362</span></a>
</span><span id="GroupAnalysis.DFA-4363"><a href="#GroupAnalysis.DFA-4363"><span class="linenos">4363</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.DFA-4364"><a href="#GroupAnalysis.DFA-4364"><span class="linenos">4364</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.DFA-4365"><a href="#GroupAnalysis.DFA-4365"><span class="linenos">4365</span></a><span class="sd">        - Columns containing only zeros are automatically removed.</span>
</span><span id="GroupAnalysis.DFA-4366"><a href="#GroupAnalysis.DFA-4366"><span class="linenos">4366</span></a><span class="sd">        - p-values equal for both groups produce ``p_val = 1``.</span>
</span><span id="GroupAnalysis.DFA-4367"><a href="#GroupAnalysis.DFA-4367"><span class="linenos">4367</span></a><span class="sd">        - Benjamini–Hochberg correction is applied separately within each group comparison.</span>
</span><span id="GroupAnalysis.DFA-4368"><a href="#GroupAnalysis.DFA-4368"><span class="linenos">4368</span></a><span class="sd">        - Fold-change is stabilized using a small, data-derived ``low_factor``.</span>
</span><span id="GroupAnalysis.DFA-4369"><a href="#GroupAnalysis.DFA-4369"><span class="linenos">4369</span></a><span class="sd">        - Uses ``Mann–Whitney U`` test with ``alternative=&#39;two-sided&#39;``.</span>
</span><span id="GroupAnalysis.DFA-4370"><a href="#GroupAnalysis.DFA-4370"><span class="linenos">4370</span></a>
</span><span id="GroupAnalysis.DFA-4371"><a href="#GroupAnalysis.DFA-4371"><span class="linenos">4371</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.DFA-4372"><a href="#GroupAnalysis.DFA-4372"><span class="linenos">4372</span></a>
</span><span id="GroupAnalysis.DFA-4373"><a href="#GroupAnalysis.DFA-4373"><span class="linenos">4373</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.DFA-4374"><a href="#GroupAnalysis.DFA-4374"><span class="linenos">4374</span></a>
</span><span id="GroupAnalysis.DFA-4375"><a href="#GroupAnalysis.DFA-4375"><span class="linenos">4375</span></a>        <span class="n">tmp_data</span> <span class="o">=</span> <span class="n">tmp_data</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s2">&quot;number&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.DFA-4376"><a href="#GroupAnalysis.DFA-4376"><span class="linenos">4376</span></a>
</span><span id="GroupAnalysis.DFA-4377"><a href="#GroupAnalysis.DFA-4377"><span class="linenos">4377</span></a>        <span class="n">tmp_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.DFA-4378"><a href="#GroupAnalysis.DFA-4378"><span class="linenos">4378</span></a>
</span><span id="GroupAnalysis.DFA-4379"><a href="#GroupAnalysis.DFA-4379"><span class="linenos">4379</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="GroupAnalysis.DFA-4380"><a href="#GroupAnalysis.DFA-4380"><span class="linenos">4380</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on provided sets dictionary and meta_group_by...&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.DFA-4381"><a href="#GroupAnalysis.DFA-4381"><span class="linenos">4381</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="GroupAnalysis.DFA-4382"><a href="#GroupAnalysis.DFA-4382"><span class="linenos">4382</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="GroupAnalysis.DFA-4383"><a href="#GroupAnalysis.DFA-4383"><span class="linenos">4383</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="GroupAnalysis.DFA-4384"><a href="#GroupAnalysis.DFA-4384"><span class="linenos">4384</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="n">sets</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="GroupAnalysis.DFA-4385"><a href="#GroupAnalysis.DFA-4385"><span class="linenos">4385</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.DFA-4386"><a href="#GroupAnalysis.DFA-4386"><span class="linenos">4386</span></a>
</span><span id="GroupAnalysis.DFA-4387"><a href="#GroupAnalysis.DFA-4387"><span class="linenos">4387</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.DFA-4388"><a href="#GroupAnalysis.DFA-4388"><span class="linenos">4388</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.DFA-4389"><a href="#GroupAnalysis.DFA-4389"><span class="linenos">4389</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Analysis strated on for all groups to each other in meta_group_by...&quot;</span>
</span><span id="GroupAnalysis.DFA-4390"><a href="#GroupAnalysis.DFA-4390"><span class="linenos">4390</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.DFA-4391"><a href="#GroupAnalysis.DFA-4391"><span class="linenos">4391</span></a>            <span class="n">tmp_data</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">])</span>
</span><span id="GroupAnalysis.DFA-4392"><a href="#GroupAnalysis.DFA-4392"><span class="linenos">4392</span></a>            <span class="n">tmp_metadata</span><span class="p">[</span><span class="s2">&quot;sets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_metadata</span><span class="p">[</span><span class="n">meta_group_by</span><span class="p">]</span>
</span><span id="GroupAnalysis.DFA-4393"><a href="#GroupAnalysis.DFA-4393"><span class="linenos">4393</span></a>            <span class="n">results</span> <span class="o">=</span> <span class="n">statistic</span><span class="p">(</span>
</span><span id="GroupAnalysis.DFA-4394"><a href="#GroupAnalysis.DFA-4394"><span class="linenos">4394</span></a>                <span class="n">tmp_data</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">sets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metadata</span><span class="o">=</span><span class="n">tmp_metadata</span><span class="p">,</span> <span class="n">n_proc</span><span class="o">=</span><span class="n">n_proc</span>
</span><span id="GroupAnalysis.DFA-4395"><a href="#GroupAnalysis.DFA-4395"><span class="linenos">4395</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.DFA-4396"><a href="#GroupAnalysis.DFA-4396"><span class="linenos">4396</span></a>
</span><span id="GroupAnalysis.DFA-4397"><a href="#GroupAnalysis.DFA-4397"><span class="linenos">4397</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span> <span class="o">=</span> <span class="n">results</span>
</span></pre></div>


            <div class="docstring"><p>Perform Differential Feature Analysis (DFA) on specified data groups.</p>

<p>This method conducts DFA using a grouping factor from metadata and a dictionary of sets for comparison. It allows for the identification of significant differences across defined sets.</p>

<p>The analysis includes:</p>

<ul>
<li>Mann–Whitney U test</li>
<li>Percentage of non-zero values</li>
<li>Means and standard deviations</li>
<li>Effect size metric (ESM)</li>
<li>Benjamini–Hochberg FDR correction</li>
<li>Fold-change and log2 fold-change</li>
</ul>

<h2 id="parameters">Parameters</h2>

<p>meta_group_by : str, optional
    Metadata column used for grouping during the analysis.
    Default is <code>'sets'</code>.
    To view available grouping categories, use <code>self.groups</code>.</p>

<p>sets : dict, optional
    Dictionary defining groups for pairwise comparison.
    Keys correspond to group names, and values are lists of labels
    belonging to each group.</p>

<pre><code>Example
-------
&gt;&gt;&gt; sets = {
...     'healthy': ['21q'],
...     'disease': ['71q', '77q', '109q']
... }
In this configuration, the *healthy* group is compared against the
aggregated *disease* groups.
</code></pre>

<p>n_proc : int, optional
    Number of CPU cores used for parallel processing.
    Default is <code>5</code>.</p>

<h2 id="returns">Returns</h2>

<p>pandas.DataFrame or None
    A DataFrame containing statistical results for each feature, including:</p>

<pre><code>- ``feature`` : str
- ``p_val`` : float
- ``adj_pval`` : float
- ``pct_valid`` : float
- ``pct_ctrl`` : float
- ``avg_valid`` : float
- ``avg_ctrl`` : float
- ``sd_valid`` : float
- ``sd_ctrl`` : float
- ``esm`` : float
- ``FC`` : float
- ``log(FC)`` : float
- ``norm_diff`` : float
- ``valid_group`` : str
- ``-log(p_val)`` : float

If ``sets`` is ``None``, results for each group are concatenated.

Returns ``None`` in case of errors or invalid parameters.
</code></pre>

<h2 id="notes">Notes</h2>

<ul>
<li>Columns containing only zeros are automatically removed.</li>
<li>p-values equal for both groups produce <code>p_val = 1</code>.</li>
<li>Benjamini–Hochberg correction is applied separately within each group comparison.</li>
<li>Fold-change is stabilized using a small, data-derived <code>low_factor</code>.</li>
<li>Uses <code>Mann–Whitney U</code> test with <code>alternative='two-sided'</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.heatmap_DFA" class="classattr">
                                        <input id="GroupAnalysis.heatmap_DFA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">heatmap_DFA</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">p_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.05</span>,</span><span class="param">	<span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">clustering</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ward&#39;</span>,</span><span class="param">	<span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.heatmap_DFA-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.heatmap_DFA"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.heatmap_DFA-4402"><a href="#GroupAnalysis.heatmap_DFA-4402"><span class="linenos">4402</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">heatmap_DFA</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="GroupAnalysis.heatmap_DFA-4403"><a href="#GroupAnalysis.heatmap_DFA-4403"><span class="linenos">4403</span></a>                    <span class="n">p_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> 
</span><span id="GroupAnalysis.heatmap_DFA-4404"><a href="#GroupAnalysis.heatmap_DFA-4404"><span class="linenos">4404</span></a>                    <span class="n">top_n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4405"><a href="#GroupAnalysis.heatmap_DFA-4405"><span class="linenos">4405</span></a>                    <span class="n">scale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4406"><a href="#GroupAnalysis.heatmap_DFA-4406"><span class="linenos">4406</span></a>                    <span class="n">clustering</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s1">&#39;ward&#39;</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4407"><a href="#GroupAnalysis.heatmap_DFA-4407"><span class="linenos">4407</span></a>                    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)):</span>
</span><span id="GroupAnalysis.heatmap_DFA-4408"><a href="#GroupAnalysis.heatmap_DFA-4408"><span class="linenos">4408</span></a><span class="w">        </span>
</span><span id="GroupAnalysis.heatmap_DFA-4409"><a href="#GroupAnalysis.heatmap_DFA-4409"><span class="linenos">4409</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.heatmap_DFA-4410"><a href="#GroupAnalysis.heatmap_DFA-4410"><span class="linenos">4410</span></a><span class="sd">        Generate a heatmap of the top DFA features filtered by p-value and log fold change.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4411"><a href="#GroupAnalysis.heatmap_DFA-4411"><span class="linenos">4411</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4412"><a href="#GroupAnalysis.heatmap_DFA-4412"><span class="linenos">4412</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.heatmap_DFA-4413"><a href="#GroupAnalysis.heatmap_DFA-4413"><span class="linenos">4413</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.heatmap_DFA-4414"><a href="#GroupAnalysis.heatmap_DFA-4414"><span class="linenos">4414</span></a><span class="sd">        p_value : float or int, optional</span>
</span><span id="GroupAnalysis.heatmap_DFA-4415"><a href="#GroupAnalysis.heatmap_DFA-4415"><span class="linenos">4415</span></a><span class="sd">            Significance threshold used to filter features by their p-value.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4416"><a href="#GroupAnalysis.heatmap_DFA-4416"><span class="linenos">4416</span></a><span class="sd">            Only features with p_val &lt; p_value are included. Default is 0.05.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4417"><a href="#GroupAnalysis.heatmap_DFA-4417"><span class="linenos">4417</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4418"><a href="#GroupAnalysis.heatmap_DFA-4418"><span class="linenos">4418</span></a><span class="sd">        top_n : int, optional</span>
</span><span id="GroupAnalysis.heatmap_DFA-4419"><a href="#GroupAnalysis.heatmap_DFA-4419"><span class="linenos">4419</span></a><span class="sd">            Number of top features selected per group based on the &#39;esm&#39; score.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4420"><a href="#GroupAnalysis.heatmap_DFA-4420"><span class="linenos">4420</span></a><span class="sd">            Default is 5.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4421"><a href="#GroupAnalysis.heatmap_DFA-4421"><span class="linenos">4421</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4422"><a href="#GroupAnalysis.heatmap_DFA-4422"><span class="linenos">4422</span></a><span class="sd">        scale : bool, optional</span>
</span><span id="GroupAnalysis.heatmap_DFA-4423"><a href="#GroupAnalysis.heatmap_DFA-4423"><span class="linenos">4423</span></a><span class="sd">            Whether to apply Min–Max scaling to heatmap values across features.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4424"><a href="#GroupAnalysis.heatmap_DFA-4424"><span class="linenos">4424</span></a><span class="sd">            Default is False.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4425"><a href="#GroupAnalysis.heatmap_DFA-4425"><span class="linenos">4425</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4426"><a href="#GroupAnalysis.heatmap_DFA-4426"><span class="linenos">4426</span></a><span class="sd">        clustering : str or None, optional</span>
</span><span id="GroupAnalysis.heatmap_DFA-4427"><a href="#GroupAnalysis.heatmap_DFA-4427"><span class="linenos">4427</span></a><span class="sd">            Hierarchical clustering method applied to rows/columns of the heatmap.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4428"><a href="#GroupAnalysis.heatmap_DFA-4428"><span class="linenos">4428</span></a><span class="sd">            If None, clustering is disabled. Default is &#39;ward&#39;.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4429"><a href="#GroupAnalysis.heatmap_DFA-4429"><span class="linenos">4429</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4430"><a href="#GroupAnalysis.heatmap_DFA-4430"><span class="linenos">4430</span></a><span class="sd">        figsize : tuple, optional</span>
</span><span id="GroupAnalysis.heatmap_DFA-4431"><a href="#GroupAnalysis.heatmap_DFA-4431"><span class="linenos">4431</span></a><span class="sd">            Size of the resulting matplotlib figure. Default is (10, 5).</span>
</span><span id="GroupAnalysis.heatmap_DFA-4432"><a href="#GroupAnalysis.heatmap_DFA-4432"><span class="linenos">4432</span></a><span class="sd">    </span>
</span><span id="GroupAnalysis.heatmap_DFA-4433"><a href="#GroupAnalysis.heatmap_DFA-4433"><span class="linenos">4433</span></a><span class="sd">        Notes</span>
</span><span id="GroupAnalysis.heatmap_DFA-4434"><a href="#GroupAnalysis.heatmap_DFA-4434"><span class="linenos">4434</span></a><span class="sd">        -----</span>
</span><span id="GroupAnalysis.heatmap_DFA-4435"><a href="#GroupAnalysis.heatmap_DFA-4435"><span class="linenos">4435</span></a><span class="sd">        - Only features with a positive log fold change (&#39;log(FC)&#39; &gt; 0) are considered.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4436"><a href="#GroupAnalysis.heatmap_DFA-4436"><span class="linenos">4436</span></a><span class="sd">        - Heatmap values represent -log10(p_value) for visualization.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4437"><a href="#GroupAnalysis.heatmap_DFA-4437"><span class="linenos">4437</span></a><span class="sd">        - If `scale=True`, values are normalized using Min–Max scaling.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4438"><a href="#GroupAnalysis.heatmap_DFA-4438"><span class="linenos">4438</span></a><span class="sd">        - The generated figure is displayed and stored in `self.DFA_plot`.</span>
</span><span id="GroupAnalysis.heatmap_DFA-4439"><a href="#GroupAnalysis.heatmap_DFA-4439"><span class="linenos">4439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.heatmap_DFA-4440"><a href="#GroupAnalysis.heatmap_DFA-4440"><span class="linenos">4440</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4441"><a href="#GroupAnalysis.heatmap_DFA-4441"><span class="linenos">4441</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_results</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.heatmap_DFA-4442"><a href="#GroupAnalysis.heatmap_DFA-4442"><span class="linenos">4442</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4443"><a href="#GroupAnalysis.heatmap_DFA-4443"><span class="linenos">4443</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;log(FC)&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="GroupAnalysis.heatmap_DFA-4444"><a href="#GroupAnalysis.heatmap_DFA-4444"><span class="linenos">4444</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4445"><a href="#GroupAnalysis.heatmap_DFA-4445"><span class="linenos">4445</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="p">[</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">p_value</span><span class="p">]</span>
</span><span id="GroupAnalysis.heatmap_DFA-4446"><a href="#GroupAnalysis.heatmap_DFA-4446"><span class="linenos">4446</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4447"><a href="#GroupAnalysis.heatmap_DFA-4447"><span class="linenos">4447</span></a>        <span class="n">df_reduced</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="GroupAnalysis.heatmap_DFA-4448"><a href="#GroupAnalysis.heatmap_DFA-4448"><span class="linenos">4448</span></a>            <span class="n">df_reduced</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="s2">&quot;esm&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])</span>
</span><span id="GroupAnalysis.heatmap_DFA-4449"><a href="#GroupAnalysis.heatmap_DFA-4449"><span class="linenos">4449</span></a>            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4450"><a href="#GroupAnalysis.heatmap_DFA-4450"><span class="linenos">4450</span></a>            <span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">top_n</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4451"><a href="#GroupAnalysis.heatmap_DFA-4451"><span class="linenos">4451</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4452"><a href="#GroupAnalysis.heatmap_DFA-4452"><span class="linenos">4452</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4453"><a href="#GroupAnalysis.heatmap_DFA-4453"><span class="linenos">4453</span></a>        <span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;-log(p_value)&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df_reduced</span><span class="p">[</span><span class="s2">&quot;p_val&quot;</span><span class="p">])</span>
</span><span id="GroupAnalysis.heatmap_DFA-4454"><a href="#GroupAnalysis.heatmap_DFA-4454"><span class="linenos">4454</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4455"><a href="#GroupAnalysis.heatmap_DFA-4455"><span class="linenos">4455</span></a>        <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">df_reduced</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
</span><span id="GroupAnalysis.heatmap_DFA-4456"><a href="#GroupAnalysis.heatmap_DFA-4456"><span class="linenos">4456</span></a>            <span class="n">index</span><span class="o">=</span><span class="s2">&quot;feature&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;valid_group&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;-log(p_value)&quot;</span>
</span><span id="GroupAnalysis.heatmap_DFA-4457"><a href="#GroupAnalysis.heatmap_DFA-4457"><span class="linenos">4457</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4458"><a href="#GroupAnalysis.heatmap_DFA-4458"><span class="linenos">4458</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4459"><a href="#GroupAnalysis.heatmap_DFA-4459"><span class="linenos">4459</span></a>        <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;-log10(p_value)&quot;</span>
</span><span id="GroupAnalysis.heatmap_DFA-4460"><a href="#GroupAnalysis.heatmap_DFA-4460"><span class="linenos">4460</span></a>        
</span><span id="GroupAnalysis.heatmap_DFA-4461"><a href="#GroupAnalysis.heatmap_DFA-4461"><span class="linenos">4461</span></a>        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
</span><span id="GroupAnalysis.heatmap_DFA-4462"><a href="#GroupAnalysis.heatmap_DFA-4462"><span class="linenos">4462</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;scaled(</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span id="GroupAnalysis.heatmap_DFA-4463"><a href="#GroupAnalysis.heatmap_DFA-4463"><span class="linenos">4463</span></a>            <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
</span><span id="GroupAnalysis.heatmap_DFA-4464"><a href="#GroupAnalysis.heatmap_DFA-4464"><span class="linenos">4464</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="GroupAnalysis.heatmap_DFA-4465"><a href="#GroupAnalysis.heatmap_DFA-4465"><span class="linenos">4465</span></a>                <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">heatmap_data</span><span class="p">),</span>
</span><span id="GroupAnalysis.heatmap_DFA-4466"><a href="#GroupAnalysis.heatmap_DFA-4466"><span class="linenos">4466</span></a>                <span class="n">index</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4467"><a href="#GroupAnalysis.heatmap_DFA-4467"><span class="linenos">4467</span></a>                <span class="n">columns</span><span class="o">=</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4468"><a href="#GroupAnalysis.heatmap_DFA-4468"><span class="linenos">4468</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4469"><a href="#GroupAnalysis.heatmap_DFA-4469"><span class="linenos">4469</span></a>            
</span><span id="GroupAnalysis.heatmap_DFA-4470"><a href="#GroupAnalysis.heatmap_DFA-4470"><span class="linenos">4470</span></a>        <span class="k">if</span> <span class="n">clustering</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis.heatmap_DFA-4471"><a href="#GroupAnalysis.heatmap_DFA-4471"><span class="linenos">4471</span></a>            <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4472"><a href="#GroupAnalysis.heatmap_DFA-4472"><span class="linenos">4472</span></a>            <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4473"><a href="#GroupAnalysis.heatmap_DFA-4473"><span class="linenos">4473</span></a>    
</span><span id="GroupAnalysis.heatmap_DFA-4474"><a href="#GroupAnalysis.heatmap_DFA-4474"><span class="linenos">4474</span></a>            <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">heatmap_data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">clustering</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4475"><a href="#GroupAnalysis.heatmap_DFA-4475"><span class="linenos">4475</span></a>            <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4476"><a href="#GroupAnalysis.heatmap_DFA-4476"><span class="linenos">4476</span></a>    
</span><span id="GroupAnalysis.heatmap_DFA-4477"><a href="#GroupAnalysis.heatmap_DFA-4477"><span class="linenos">4477</span></a>            <span class="n">heatmap_data</span> <span class="o">=</span> <span class="n">heatmap_data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="GroupAnalysis.heatmap_DFA-4478"><a href="#GroupAnalysis.heatmap_DFA-4478"><span class="linenos">4478</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4479"><a href="#GroupAnalysis.heatmap_DFA-4479"><span class="linenos">4479</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4480"><a href="#GroupAnalysis.heatmap_DFA-4480"><span class="linenos">4480</span></a>        <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4481"><a href="#GroupAnalysis.heatmap_DFA-4481"><span class="linenos">4481</span></a>        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
</span><span id="GroupAnalysis.heatmap_DFA-4482"><a href="#GroupAnalysis.heatmap_DFA-4482"><span class="linenos">4482</span></a>            <span class="n">heatmap_data</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4483"><a href="#GroupAnalysis.heatmap_DFA-4483"><span class="linenos">4483</span></a>            <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4484"><a href="#GroupAnalysis.heatmap_DFA-4484"><span class="linenos">4484</span></a>            <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4485"><a href="#GroupAnalysis.heatmap_DFA-4485"><span class="linenos">4485</span></a>            <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4486"><a href="#GroupAnalysis.heatmap_DFA-4486"><span class="linenos">4486</span></a>            <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">label</span><span class="p">},</span>
</span><span id="GroupAnalysis.heatmap_DFA-4487"><a href="#GroupAnalysis.heatmap_DFA-4487"><span class="linenos">4487</span></a>            <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.heatmap_DFA-4488"><a href="#GroupAnalysis.heatmap_DFA-4488"><span class="linenos">4488</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4489"><a href="#GroupAnalysis.heatmap_DFA-4489"><span class="linenos">4489</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Feature&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4490"><a href="#GroupAnalysis.heatmap_DFA-4490"><span class="linenos">4490</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cluster&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4491"><a href="#GroupAnalysis.heatmap_DFA-4491"><span class="linenos">4491</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.heatmap_DFA-4492"><a href="#GroupAnalysis.heatmap_DFA-4492"><span class="linenos">4492</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4493"><a href="#GroupAnalysis.heatmap_DFA-4493"><span class="linenos">4493</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="GroupAnalysis.heatmap_DFA-4494"><a href="#GroupAnalysis.heatmap_DFA-4494"><span class="linenos">4494</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4495"><a href="#GroupAnalysis.heatmap_DFA-4495"><span class="linenos">4495</span></a>        <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.heatmap_DFA-4496"><a href="#GroupAnalysis.heatmap_DFA-4496"><span class="linenos">4496</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span><span id="GroupAnalysis.heatmap_DFA-4497"><a href="#GroupAnalysis.heatmap_DFA-4497"><span class="linenos">4497</span></a>
</span><span id="GroupAnalysis.heatmap_DFA-4498"><a href="#GroupAnalysis.heatmap_DFA-4498"><span class="linenos">4498</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="o">=</span> <span class="n">figure</span>
</span></pre></div>


            <div class="docstring"><p>Generate a heatmap of the top DFA features filtered by p-value and log fold change.</p>

<h2 id="parameters">Parameters</h2>

<p>p_value : float or int, optional
    Significance threshold used to filter features by their p-value.
    Only features with p_val &lt; p_value are included. Default is 0.05.</p>

<p>top_n : int, optional
    Number of top features selected per group based on the 'esm' score.
    Default is 5.</p>

<p>scale : bool, optional
    Whether to apply Min–Max scaling to heatmap values across features.
    Default is False.</p>

<p>clustering : str or None, optional
    Hierarchical clustering method applied to rows/columns of the heatmap.
    If None, clustering is disabled. Default is 'ward'.</p>

<p>figsize : tuple, optional
    Size of the resulting matplotlib figure. Default is (10, 5).</p>

<h2 id="notes">Notes</h2>

<ul>
<li>Only features with a positive log fold change ('log(FC)' &gt; 0) are considered.</li>
<li>Heatmap values represent -log10(p_value) for visualization.</li>
<li>If <code>scale=True</code>, values are normalized using Min–Max scaling.</li>
<li>The generated figure is displayed and stored in <code>self.DFA_plot</code>.</li>
</ul>
</div>


                            </div>
                            <div id="GroupAnalysis.get_DFA_plot" class="classattr">
                                        <input id="GroupAnalysis.get_DFA_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_DFA_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_DFA_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_DFA_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_DFA_plot-4500"><a href="#GroupAnalysis.get_DFA_plot-4500"><span class="linenos">4500</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_DFA_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_DFA_plot-4501"><a href="#GroupAnalysis.get_DFA_plot-4501"><span class="linenos">4501</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_DFA_plot-4502"><a href="#GroupAnalysis.get_DFA_plot-4502"><span class="linenos">4502</span></a><span class="sd">        Retrieve the heatmap figure generated by `heatmap_DFA()`.</span>
</span><span id="GroupAnalysis.get_DFA_plot-4503"><a href="#GroupAnalysis.get_DFA_plot-4503"><span class="linenos">4503</span></a>
</span><span id="GroupAnalysis.get_DFA_plot-4504"><a href="#GroupAnalysis.get_DFA_plot-4504"><span class="linenos">4504</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.get_DFA_plot-4505"><a href="#GroupAnalysis.get_DFA_plot-4505"><span class="linenos">4505</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.get_DFA_plot-4506"><a href="#GroupAnalysis.get_DFA_plot-4506"><span class="linenos">4506</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis.get_DFA_plot-4507"><a href="#GroupAnalysis.get_DFA_plot-4507"><span class="linenos">4507</span></a><span class="sd">            Whether to display the stored heatmap figure. Default is True.</span>
</span><span id="GroupAnalysis.get_DFA_plot-4508"><a href="#GroupAnalysis.get_DFA_plot-4508"><span class="linenos">4508</span></a>
</span><span id="GroupAnalysis.get_DFA_plot-4509"><a href="#GroupAnalysis.get_DFA_plot-4509"><span class="linenos">4509</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_DFA_plot-4510"><a href="#GroupAnalysis.get_DFA_plot-4510"><span class="linenos">4510</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_DFA_plot-4511"><a href="#GroupAnalysis.get_DFA_plot-4511"><span class="linenos">4511</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis.get_DFA_plot-4512"><a href="#GroupAnalysis.get_DFA_plot-4512"><span class="linenos">4512</span></a><span class="sd">            The figure object containing the DFA heatmap.</span>
</span><span id="GroupAnalysis.get_DFA_plot-4513"><a href="#GroupAnalysis.get_DFA_plot-4513"><span class="linenos">4513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_DFA_plot-4514"><a href="#GroupAnalysis.get_DFA_plot-4514"><span class="linenos">4514</span></a>
</span><span id="GroupAnalysis.get_DFA_plot-4515"><a href="#GroupAnalysis.get_DFA_plot-4515"><span class="linenos">4515</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4516"><a href="#GroupAnalysis.get_DFA_plot-4516"><span class="linenos">4516</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the heatmap_DFA() method first.&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_DFA_plot-4517"><a href="#GroupAnalysis.get_DFA_plot-4517"><span class="linenos">4517</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4518"><a href="#GroupAnalysis.get_DFA_plot-4518"><span class="linenos">4518</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4519"><a href="#GroupAnalysis.get_DFA_plot-4519"><span class="linenos">4519</span></a>                <span class="k">if</span> <span class="n">show</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4520"><a href="#GroupAnalysis.get_DFA_plot-4520"><span class="linenos">4520</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span><span id="GroupAnalysis.get_DFA_plot-4521"><a href="#GroupAnalysis.get_DFA_plot-4521"><span class="linenos">4521</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4522"><a href="#GroupAnalysis.get_DFA_plot-4522"><span class="linenos">4522</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_DFA_plot-4523"><a href="#GroupAnalysis.get_DFA_plot-4523"><span class="linenos">4523</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_DFA_plot-4524"><a href="#GroupAnalysis.get_DFA_plot-4524"><span class="linenos">4524</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis.get_DFA_plot-4525"><a href="#GroupAnalysis.get_DFA_plot-4525"><span class="linenos">4525</span></a>
</span><span id="GroupAnalysis.get_DFA_plot-4526"><a href="#GroupAnalysis.get_DFA_plot-4526"><span class="linenos">4526</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">DFA_plot</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the heatmap figure generated by <code><a href="#GroupAnalysis.heatmap_DFA">heatmap_DFA()</a></code>.</p>

<h2 id="parameters">Parameters</h2>

<p>show : bool, optional
    Whether to display the stored heatmap figure. Default is True.</p>

<h2 id="returns">Returns</h2>

<p>matplotlib.figure.Figure
    The figure object containing the DFA heatmap.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.print_avaiable_features" class="classattr">
                                        <input id="GroupAnalysis.print_avaiable_features-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_avaiable_features</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.print_avaiable_features-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.print_avaiable_features"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.print_avaiable_features-4530"><a href="#GroupAnalysis.print_avaiable_features-4530"><span class="linenos">4530</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">print_avaiable_features</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.print_avaiable_features-4531"><a href="#GroupAnalysis.print_avaiable_features-4531"><span class="linenos">4531</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.print_avaiable_features-4532"><a href="#GroupAnalysis.print_avaiable_features-4532"><span class="linenos">4532</span></a><span class="sd">        Print the available features (columns) in the current dataset.</span>
</span><span id="GroupAnalysis.print_avaiable_features-4533"><a href="#GroupAnalysis.print_avaiable_features-4533"><span class="linenos">4533</span></a>
</span><span id="GroupAnalysis.print_avaiable_features-4534"><a href="#GroupAnalysis.print_avaiable_features-4534"><span class="linenos">4534</span></a><span class="sd">        This method lists all column names in `self.tmp_data` to help identify which features are available for analysis.</span>
</span><span id="GroupAnalysis.print_avaiable_features-4535"><a href="#GroupAnalysis.print_avaiable_features-4535"><span class="linenos">4535</span></a>
</span><span id="GroupAnalysis.print_avaiable_features-4536"><a href="#GroupAnalysis.print_avaiable_features-4536"><span class="linenos">4536</span></a><span class="sd">        Example</span>
</span><span id="GroupAnalysis.print_avaiable_features-4537"><a href="#GroupAnalysis.print_avaiable_features-4537"><span class="linenos">4537</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.print_avaiable_features-4538"><a href="#GroupAnalysis.print_avaiable_features-4538"><span class="linenos">4538</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.print_avaiable_features()</span>
</span><span id="GroupAnalysis.print_avaiable_features-4539"><a href="#GroupAnalysis.print_avaiable_features-4539"><span class="linenos">4539</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.print_avaiable_features-4540"><a href="#GroupAnalysis.print_avaiable_features-4540"><span class="linenos">4540</span></a>
</span><span id="GroupAnalysis.print_avaiable_features-4541"><a href="#GroupAnalysis.print_avaiable_features-4541"><span class="linenos">4541</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Avaiable features:&quot;</span><span class="p">)</span>
</span><span id="GroupAnalysis.print_avaiable_features-4542"><a href="#GroupAnalysis.print_avaiable_features-4542"><span class="linenos">4542</span></a>        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span id="GroupAnalysis.print_avaiable_features-4543"><a href="#GroupAnalysis.print_avaiable_features-4543"><span class="linenos">4543</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print the available features (columns) in the current dataset.</p>

<p>This method lists all column names in <code>self.tmp_data</code> to help identify which features are available for analysis.</p>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">group_analysis</span><span class="o">.</span><span class="n">print_avaiable_features</span><span class="p">()</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="GroupAnalysis.proportion_analysis" class="classattr">
                                        <input id="GroupAnalysis.proportion_analysis-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">proportion_analysis</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">grouping_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;sets&#39;</span>,</span><span class="param">	<span class="n">val_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;nuclei_per_img&#39;</span>,</span><span class="param">	<span class="n">grouping_dict</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">omit</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.proportion_analysis-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.proportion_analysis"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.proportion_analysis-4545"><a href="#GroupAnalysis.proportion_analysis-4545"><span class="linenos">4545</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">proportion_analysis</span><span class="p">(</span>
</span><span id="GroupAnalysis.proportion_analysis-4546"><a href="#GroupAnalysis.proportion_analysis-4546"><span class="linenos">4546</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4547"><a href="#GroupAnalysis.proportion_analysis-4547"><span class="linenos">4547</span></a>        <span class="n">grouping_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sets&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4548"><a href="#GroupAnalysis.proportion_analysis-4548"><span class="linenos">4548</span></a>        <span class="n">val_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;nuclei_per_img&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4549"><a href="#GroupAnalysis.proportion_analysis-4549"><span class="linenos">4549</span></a>        <span class="n">grouping_dict</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4550"><a href="#GroupAnalysis.proportion_analysis-4550"><span class="linenos">4550</span></a>        <span class="n">omit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4551"><a href="#GroupAnalysis.proportion_analysis-4551"><span class="linenos">4551</span></a>    <span class="p">):</span>
</span><span id="GroupAnalysis.proportion_analysis-4552"><a href="#GroupAnalysis.proportion_analysis-4552"><span class="linenos">4552</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.proportion_analysis-4553"><a href="#GroupAnalysis.proportion_analysis-4553"><span class="linenos">4553</span></a><span class="sd">        Perform proportion analysis by comparing the distribution of values across groups.</span>
</span><span id="GroupAnalysis.proportion_analysis-4554"><a href="#GroupAnalysis.proportion_analysis-4554"><span class="linenos">4554</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4555"><a href="#GroupAnalysis.proportion_analysis-4555"><span class="linenos">4555</span></a><span class="sd">        This method analyzes the distribution of values (e.g., nuclei counts) across different groups defined in the dataset. It can optionally group categories, omit specific values, and produces both statistical results and a visualization.</span>
</span><span id="GroupAnalysis.proportion_analysis-4556"><a href="#GroupAnalysis.proportion_analysis-4556"><span class="linenos">4556</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4557"><a href="#GroupAnalysis.proportion_analysis-4557"><span class="linenos">4557</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.proportion_analysis-4558"><a href="#GroupAnalysis.proportion_analysis-4558"><span class="linenos">4558</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.proportion_analysis-4559"><a href="#GroupAnalysis.proportion_analysis-4559"><span class="linenos">4559</span></a><span class="sd">        grouping_col : str, optional</span>
</span><span id="GroupAnalysis.proportion_analysis-4560"><a href="#GroupAnalysis.proportion_analysis-4560"><span class="linenos">4560</span></a><span class="sd">            Column to group by. Default is &#39;sets&#39;.</span>
</span><span id="GroupAnalysis.proportion_analysis-4561"><a href="#GroupAnalysis.proportion_analysis-4561"><span class="linenos">4561</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4562"><a href="#GroupAnalysis.proportion_analysis-4562"><span class="linenos">4562</span></a><span class="sd">        val_col : str, optional</span>
</span><span id="GroupAnalysis.proportion_analysis-4563"><a href="#GroupAnalysis.proportion_analysis-4563"><span class="linenos">4563</span></a><span class="sd">            Column containing the values to analyze. Default is &#39;nuclei_per_img&#39;.</span>
</span><span id="GroupAnalysis.proportion_analysis-4564"><a href="#GroupAnalysis.proportion_analysis-4564"><span class="linenos">4564</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4565"><a href="#GroupAnalysis.proportion_analysis-4565"><span class="linenos">4565</span></a><span class="sd">        grouping_dict : dict or None, optional</span>
</span><span id="GroupAnalysis.proportion_analysis-4566"><a href="#GroupAnalysis.proportion_analysis-4566"><span class="linenos">4566</span></a><span class="sd">            Dictionary mapping new group names to categories in `grouping_col`. If None, analysis is based on the original groups.</span>
</span><span id="GroupAnalysis.proportion_analysis-4567"><a href="#GroupAnalysis.proportion_analysis-4567"><span class="linenos">4567</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4568"><a href="#GroupAnalysis.proportion_analysis-4568"><span class="linenos">4568</span></a><span class="sd">        omit : str, list, or None, optional</span>
</span><span id="GroupAnalysis.proportion_analysis-4569"><a href="#GroupAnalysis.proportion_analysis-4569"><span class="linenos">4569</span></a><span class="sd">            Values to exclude from the analysis. Default is None.</span>
</span><span id="GroupAnalysis.proportion_analysis-4570"><a href="#GroupAnalysis.proportion_analysis-4570"><span class="linenos">4570</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4571"><a href="#GroupAnalysis.proportion_analysis-4571"><span class="linenos">4571</span></a><span class="sd">        Attributes</span>
</span><span id="GroupAnalysis.proportion_analysis-4572"><a href="#GroupAnalysis.proportion_analysis-4572"><span class="linenos">4572</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.proportion_analysis-4573"><a href="#GroupAnalysis.proportion_analysis-4573"><span class="linenos">4573</span></a><span class="sd">        proportion_stats : pd.DataFrame</span>
</span><span id="GroupAnalysis.proportion_analysis-4574"><a href="#GroupAnalysis.proportion_analysis-4574"><span class="linenos">4574</span></a><span class="sd">            DataFrame containing chi-square test results for pairwise group comparisons.</span>
</span><span id="GroupAnalysis.proportion_analysis-4575"><a href="#GroupAnalysis.proportion_analysis-4575"><span class="linenos">4575</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4576"><a href="#GroupAnalysis.proportion_analysis-4576"><span class="linenos">4576</span></a><span class="sd">        proportion_plot : matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis.proportion_analysis-4577"><a href="#GroupAnalysis.proportion_analysis-4577"><span class="linenos">4577</span></a><span class="sd">            Plot visualizing the proportions across groups.</span>
</span><span id="GroupAnalysis.proportion_analysis-4578"><a href="#GroupAnalysis.proportion_analysis-4578"><span class="linenos">4578</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4579"><a href="#GroupAnalysis.proportion_analysis-4579"><span class="linenos">4579</span></a><span class="sd">        Example</span>
</span><span id="GroupAnalysis.proportion_analysis-4580"><a href="#GroupAnalysis.proportion_analysis-4580"><span class="linenos">4580</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.proportion_analysis-4581"><a href="#GroupAnalysis.proportion_analysis-4581"><span class="linenos">4581</span></a><span class="sd">        &gt;&gt;&gt; group_analysis.proportion_analysis(</span>
</span><span id="GroupAnalysis.proportion_analysis-4582"><a href="#GroupAnalysis.proportion_analysis-4582"><span class="linenos">4582</span></a><span class="sd">        ...     grouping_col=&#39;sets&#39;,</span>
</span><span id="GroupAnalysis.proportion_analysis-4583"><a href="#GroupAnalysis.proportion_analysis-4583"><span class="linenos">4583</span></a><span class="sd">        ...     val_col=&#39;nuclei_per_img&#39;,</span>
</span><span id="GroupAnalysis.proportion_analysis-4584"><a href="#GroupAnalysis.proportion_analysis-4584"><span class="linenos">4584</span></a><span class="sd">        ...     grouping_dict={&#39;Group A&#39;: [1, 2], &#39;Group B&#39;: [3, 4]},</span>
</span><span id="GroupAnalysis.proportion_analysis-4585"><a href="#GroupAnalysis.proportion_analysis-4585"><span class="linenos">4585</span></a><span class="sd">        ...     omit=5</span>
</span><span id="GroupAnalysis.proportion_analysis-4586"><a href="#GroupAnalysis.proportion_analysis-4586"><span class="linenos">4586</span></a><span class="sd">        ... )</span>
</span><span id="GroupAnalysis.proportion_analysis-4587"><a href="#GroupAnalysis.proportion_analysis-4587"><span class="linenos">4587</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.proportion_analysis-4588"><a href="#GroupAnalysis.proportion_analysis-4588"><span class="linenos">4588</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4589"><a href="#GroupAnalysis.proportion_analysis-4589"><span class="linenos">4589</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmp_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="GroupAnalysis.proportion_analysis-4590"><a href="#GroupAnalysis.proportion_analysis-4590"><span class="linenos">4590</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4591"><a href="#GroupAnalysis.proportion_analysis-4591"><span class="linenos">4591</span></a>        <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmp_metadata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">])</span>
</span><span id="GroupAnalysis.proportion_analysis-4592"><a href="#GroupAnalysis.proportion_analysis-4592"><span class="linenos">4592</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4593"><a href="#GroupAnalysis.proportion_analysis-4593"><span class="linenos">4593</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[[</span><span class="n">grouping_col</span><span class="p">,</span> <span class="n">val_col</span><span class="p">]]</span>
</span><span id="GroupAnalysis.proportion_analysis-4594"><a href="#GroupAnalysis.proportion_analysis-4594"><span class="linenos">4594</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4595"><a href="#GroupAnalysis.proportion_analysis-4595"><span class="linenos">4595</span></a>        <span class="k">if</span> <span class="n">omit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis.proportion_analysis-4596"><a href="#GroupAnalysis.proportion_analysis-4596"><span class="linenos">4596</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">omit</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="GroupAnalysis.proportion_analysis-4597"><a href="#GroupAnalysis.proportion_analysis-4597"><span class="linenos">4597</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="o">~</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">omit</span><span class="p">)]</span>
</span><span id="GroupAnalysis.proportion_analysis-4598"><a href="#GroupAnalysis.proportion_analysis-4598"><span class="linenos">4598</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.proportion_analysis-4599"><a href="#GroupAnalysis.proportion_analysis-4599"><span class="linenos">4599</span></a>                <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="p">[</span><span class="n">andata</span><span class="p">[</span><span class="n">val_col</span><span class="p">]</span> <span class="o">!=</span> <span class="n">omit</span><span class="p">]</span>
</span><span id="GroupAnalysis.proportion_analysis-4600"><a href="#GroupAnalysis.proportion_analysis-4600"><span class="linenos">4600</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4601"><a href="#GroupAnalysis.proportion_analysis-4601"><span class="linenos">4601</span></a>        <span class="n">andata</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4602"><a href="#GroupAnalysis.proportion_analysis-4602"><span class="linenos">4602</span></a>        <span class="n">andata</span><span class="p">[</span><span class="s2">&quot;index_col&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">index</span>
</span><span id="GroupAnalysis.proportion_analysis-4603"><a href="#GroupAnalysis.proportion_analysis-4603"><span class="linenos">4603</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4604"><a href="#GroupAnalysis.proportion_analysis-4604"><span class="linenos">4604</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="GroupAnalysis.proportion_analysis-4605"><a href="#GroupAnalysis.proportion_analysis-4605"><span class="linenos">4605</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">grouping_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="GroupAnalysis.proportion_analysis-4606"><a href="#GroupAnalysis.proportion_analysis-4606"><span class="linenos">4606</span></a>                <span class="n">andata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
</span><span id="GroupAnalysis.proportion_analysis-4607"><a href="#GroupAnalysis.proportion_analysis-4607"><span class="linenos">4607</span></a>                    <span class="n">andata</span><span class="p">[</span><span class="n">grouping_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">grouping_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]),</span> <span class="n">grouping_col</span>
</span><span id="GroupAnalysis.proportion_analysis-4608"><a href="#GroupAnalysis.proportion_analysis-4608"><span class="linenos">4608</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="GroupAnalysis.proportion_analysis-4609"><a href="#GroupAnalysis.proportion_analysis-4609"><span class="linenos">4609</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4610"><a href="#GroupAnalysis.proportion_analysis-4610"><span class="linenos">4610</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">andata</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
</span><span id="GroupAnalysis.proportion_analysis-4611"><a href="#GroupAnalysis.proportion_analysis-4611"><span class="linenos">4611</span></a>            <span class="n">index</span><span class="o">=</span><span class="n">val_col</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4612"><a href="#GroupAnalysis.proportion_analysis-4612"><span class="linenos">4612</span></a>            <span class="n">columns</span><span class="o">=</span><span class="n">grouping_col</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4613"><a href="#GroupAnalysis.proportion_analysis-4613"><span class="linenos">4613</span></a>            <span class="n">values</span><span class="o">=</span><span class="s2">&quot;index_col&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4614"><a href="#GroupAnalysis.proportion_analysis-4614"><span class="linenos">4614</span></a>            <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4615"><a href="#GroupAnalysis.proportion_analysis-4615"><span class="linenos">4615</span></a>            <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="GroupAnalysis.proportion_analysis-4616"><a href="#GroupAnalysis.proportion_analysis-4616"><span class="linenos">4616</span></a>        <span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4617"><a href="#GroupAnalysis.proportion_analysis-4617"><span class="linenos">4617</span></a>        
</span><span id="GroupAnalysis.proportion_analysis-4618"><a href="#GroupAnalysis.proportion_analysis-4618"><span class="linenos">4618</span></a>        <span class="n">Z_rows</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4619"><a href="#GroupAnalysis.proportion_analysis-4619"><span class="linenos">4619</span></a>        <span class="n">row_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_rows</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4620"><a href="#GroupAnalysis.proportion_analysis-4620"><span class="linenos">4620</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4621"><a href="#GroupAnalysis.proportion_analysis-4621"><span class="linenos">4621</span></a>        <span class="n">Z_cols</span> <span class="o">=</span> <span class="n">linkage</span><span class="p">(</span><span class="n">df_pivot</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;ward&#39;</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4622"><a href="#GroupAnalysis.proportion_analysis-4622"><span class="linenos">4622</span></a>        <span class="n">col_order</span> <span class="o">=</span> <span class="n">leaves_list</span><span class="p">(</span><span class="n">Z_cols</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4623"><a href="#GroupAnalysis.proportion_analysis-4623"><span class="linenos">4623</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4624"><a href="#GroupAnalysis.proportion_analysis-4624"><span class="linenos">4624</span></a>        <span class="n">df_pivot</span> <span class="o">=</span> <span class="n">df_pivot</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_order</span><span class="p">,</span> <span class="n">col_order</span><span class="p">]</span>
</span><span id="GroupAnalysis.proportion_analysis-4625"><a href="#GroupAnalysis.proportion_analysis-4625"><span class="linenos">4625</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4626"><a href="#GroupAnalysis.proportion_analysis-4626"><span class="linenos">4626</span></a>        <span class="n">chi_df</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4627"><a href="#GroupAnalysis.proportion_analysis-4627"><span class="linenos">4627</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4628"><a href="#GroupAnalysis.proportion_analysis-4628"><span class="linenos">4628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span> <span class="o">=</span> <span class="n">chi_pairs</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4629"><a href="#GroupAnalysis.proportion_analysis-4629"><span class="linenos">4629</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4630"><a href="#GroupAnalysis.proportion_analysis-4630"><span class="linenos">4630</span></a>        <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;Significance_Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">chi_df</span><span class="p">[</span><span class="s2">&quot;p-value&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_significance_label</span><span class="p">)</span>
</span><span id="GroupAnalysis.proportion_analysis-4631"><a href="#GroupAnalysis.proportion_analysis-4631"><span class="linenos">4631</span></a>
</span><span id="GroupAnalysis.proportion_analysis-4632"><a href="#GroupAnalysis.proportion_analysis-4632"><span class="linenos">4632</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="o">=</span> <span class="n">prop_plot</span><span class="p">(</span><span class="n">df_pivot</span><span class="p">,</span> <span class="n">chi_df</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform proportion analysis by comparing the distribution of values across groups.</p>

<p>This method analyzes the distribution of values (e.g., nuclei counts) across different groups defined in the dataset. It can optionally group categories, omit specific values, and produces both statistical results and a visualization.</p>

<h2 id="parameters">Parameters</h2>

<p>grouping_col : str, optional
    Column to group by. Default is 'sets'.</p>

<p>val_col : str, optional
    Column containing the values to analyze. Default is 'nuclei_per_img'.</p>

<p>grouping_dict : dict or None, optional
    Dictionary mapping new group names to categories in <code>grouping_col</code>. If None, analysis is based on the original groups.</p>

<p>omit : str, list, or None, optional
    Values to exclude from the analysis. Default is None.</p>

<h2 id="attributes">Attributes</h2>

<p>proportion_stats : pd.DataFrame
    DataFrame containing chi-square test results for pairwise group comparisons.</p>

<p>proportion_plot : matplotlib.figure.Figure
    Plot visualizing the proportions across groups.</p>

<h2 id="example">Example</h2>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">group_analysis</span><span class="o">.</span><span class="n">proportion_analysis</span><span class="p">(</span>
<span class="gp">... </span>    <span class="n">grouping_col</span><span class="o">=</span><span class="s1">&#39;sets&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">val_col</span><span class="o">=</span><span class="s1">&#39;nuclei_per_img&#39;</span><span class="p">,</span>
<span class="gp">... </span>    <span class="n">grouping_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Group A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;Group B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]},</span>
<span class="gp">... </span>    <span class="n">omit</span><span class="o">=</span><span class="mi">5</span>
<span class="gp">... </span><span class="p">)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="GroupAnalysis.get_proportion_plot" class="classattr">
                                        <input id="GroupAnalysis.get_proportion_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_proportion_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_proportion_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_proportion_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_proportion_plot-4634"><a href="#GroupAnalysis.get_proportion_plot-4634"><span class="linenos">4634</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_proportion_plot-4635"><a href="#GroupAnalysis.get_proportion_plot-4635"><span class="linenos">4635</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_proportion_plot-4636"><a href="#GroupAnalysis.get_proportion_plot-4636"><span class="linenos">4636</span></a><span class="sd">        Retrieve the proportion bar plot generated by the `proportion_analysis()` method.</span>
</span><span id="GroupAnalysis.get_proportion_plot-4637"><a href="#GroupAnalysis.get_proportion_plot-4637"><span class="linenos">4637</span></a>
</span><span id="GroupAnalysis.get_proportion_plot-4638"><a href="#GroupAnalysis.get_proportion_plot-4638"><span class="linenos">4638</span></a><span class="sd">        Parameters</span>
</span><span id="GroupAnalysis.get_proportion_plot-4639"><a href="#GroupAnalysis.get_proportion_plot-4639"><span class="linenos">4639</span></a><span class="sd">        ----------</span>
</span><span id="GroupAnalysis.get_proportion_plot-4640"><a href="#GroupAnalysis.get_proportion_plot-4640"><span class="linenos">4640</span></a><span class="sd">        show : bool, optional</span>
</span><span id="GroupAnalysis.get_proportion_plot-4641"><a href="#GroupAnalysis.get_proportion_plot-4641"><span class="linenos">4641</span></a><span class="sd">            Whether to display the proportion bar plot. Default is True.</span>
</span><span id="GroupAnalysis.get_proportion_plot-4642"><a href="#GroupAnalysis.get_proportion_plot-4642"><span class="linenos">4642</span></a>
</span><span id="GroupAnalysis.get_proportion_plot-4643"><a href="#GroupAnalysis.get_proportion_plot-4643"><span class="linenos">4643</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_proportion_plot-4644"><a href="#GroupAnalysis.get_proportion_plot-4644"><span class="linenos">4644</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_proportion_plot-4645"><a href="#GroupAnalysis.get_proportion_plot-4645"><span class="linenos">4645</span></a><span class="sd">        matplotlib.figure.Figure</span>
</span><span id="GroupAnalysis.get_proportion_plot-4646"><a href="#GroupAnalysis.get_proportion_plot-4646"><span class="linenos">4646</span></a><span class="sd">            The figure object containing the proportion bar plot.</span>
</span><span id="GroupAnalysis.get_proportion_plot-4647"><a href="#GroupAnalysis.get_proportion_plot-4647"><span class="linenos">4647</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_proportion_plot-4648"><a href="#GroupAnalysis.get_proportion_plot-4648"><span class="linenos">4648</span></a>
</span><span id="GroupAnalysis.get_proportion_plot-4649"><a href="#GroupAnalysis.get_proportion_plot-4649"><span class="linenos">4649</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4650"><a href="#GroupAnalysis.get_proportion_plot-4650"><span class="linenos">4650</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.get_proportion_plot-4651"><a href="#GroupAnalysis.get_proportion_plot-4651"><span class="linenos">4651</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="GroupAnalysis.get_proportion_plot-4652"><a href="#GroupAnalysis.get_proportion_plot-4652"><span class="linenos">4652</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.get_proportion_plot-4653"><a href="#GroupAnalysis.get_proportion_plot-4653"><span class="linenos">4653</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4654"><a href="#GroupAnalysis.get_proportion_plot-4654"><span class="linenos">4654</span></a>            <span class="k">if</span> <span class="n">cfg</span><span class="o">.</span><span class="n">_DISPLAY_MODE</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4655"><a href="#GroupAnalysis.get_proportion_plot-4655"><span class="linenos">4655</span></a>                <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4656"><a href="#GroupAnalysis.get_proportion_plot-4656"><span class="linenos">4656</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span><span id="GroupAnalysis.get_proportion_plot-4657"><a href="#GroupAnalysis.get_proportion_plot-4657"><span class="linenos">4657</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4658"><a href="#GroupAnalysis.get_proportion_plot-4658"><span class="linenos">4658</span></a>                        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span><span class="p">)</span>
</span><span id="GroupAnalysis.get_proportion_plot-4659"><a href="#GroupAnalysis.get_proportion_plot-4659"><span class="linenos">4659</span></a>                    <span class="k">except</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_plot-4660"><a href="#GroupAnalysis.get_proportion_plot-4660"><span class="linenos">4660</span></a>                        <span class="kc">None</span>
</span><span id="GroupAnalysis.get_proportion_plot-4661"><a href="#GroupAnalysis.get_proportion_plot-4661"><span class="linenos">4661</span></a>
</span><span id="GroupAnalysis.get_proportion_plot-4662"><a href="#GroupAnalysis.get_proportion_plot-4662"><span class="linenos">4662</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_plot</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the proportion bar plot generated by the <code><a href="#GroupAnalysis.proportion_analysis">proportion_analysis()</a></code> method.</p>

<h2 id="parameters">Parameters</h2>

<p>show : bool, optional
    Whether to display the proportion bar plot. Default is True.</p>

<h2 id="returns">Returns</h2>

<p>matplotlib.figure.Figure
    The figure object containing the proportion bar plot.</p>
</div>


                            </div>
                            <div id="GroupAnalysis.get_proportion_stats" class="classattr">
                                        <input id="GroupAnalysis.get_proportion_stats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_proportion_stats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="GroupAnalysis.get_proportion_stats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GroupAnalysis.get_proportion_stats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GroupAnalysis.get_proportion_stats-4664"><a href="#GroupAnalysis.get_proportion_stats-4664"><span class="linenos">4664</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_proportion_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="GroupAnalysis.get_proportion_stats-4665"><a href="#GroupAnalysis.get_proportion_stats-4665"><span class="linenos">4665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_proportion_stats-4666"><a href="#GroupAnalysis.get_proportion_stats-4666"><span class="linenos">4666</span></a><span class="sd">        Retrieve the proportion statistics computed by the `proportion_analysis()` method.</span>
</span><span id="GroupAnalysis.get_proportion_stats-4667"><a href="#GroupAnalysis.get_proportion_stats-4667"><span class="linenos">4667</span></a>
</span><span id="GroupAnalysis.get_proportion_stats-4668"><a href="#GroupAnalysis.get_proportion_stats-4668"><span class="linenos">4668</span></a><span class="sd">        Returns</span>
</span><span id="GroupAnalysis.get_proportion_stats-4669"><a href="#GroupAnalysis.get_proportion_stats-4669"><span class="linenos">4669</span></a><span class="sd">        -------</span>
</span><span id="GroupAnalysis.get_proportion_stats-4670"><a href="#GroupAnalysis.get_proportion_stats-4670"><span class="linenos">4670</span></a><span class="sd">        pd.DataFrame</span>
</span><span id="GroupAnalysis.get_proportion_stats-4671"><a href="#GroupAnalysis.get_proportion_stats-4671"><span class="linenos">4671</span></a><span class="sd">            The proportion statistics stored in `self.proportion_stats`.</span>
</span><span id="GroupAnalysis.get_proportion_stats-4672"><a href="#GroupAnalysis.get_proportion_stats-4672"><span class="linenos">4672</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="GroupAnalysis.get_proportion_stats-4673"><a href="#GroupAnalysis.get_proportion_stats-4673"><span class="linenos">4673</span></a>
</span><span id="GroupAnalysis.get_proportion_stats-4674"><a href="#GroupAnalysis.get_proportion_stats-4674"><span class="linenos">4674</span></a>        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_stats-4675"><a href="#GroupAnalysis.get_proportion_stats-4675"><span class="linenos">4675</span></a>            <span class="nb">print</span><span class="p">(</span>
</span><span id="GroupAnalysis.get_proportion_stats-4676"><a href="#GroupAnalysis.get_proportion_stats-4676"><span class="linenos">4676</span></a>                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">No results to return! Please run the proportion_analysis() method first.&quot;</span>
</span><span id="GroupAnalysis.get_proportion_stats-4677"><a href="#GroupAnalysis.get_proportion_stats-4677"><span class="linenos">4677</span></a>            <span class="p">)</span>
</span><span id="GroupAnalysis.get_proportion_stats-4678"><a href="#GroupAnalysis.get_proportion_stats-4678"><span class="linenos">4678</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="GroupAnalysis.get_proportion_stats-4679"><a href="#GroupAnalysis.get_proportion_stats-4679"><span class="linenos">4679</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_stats</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve the proportion statistics computed by the <code><a href="#GroupAnalysis.proportion_analysis">proportion_analysis()</a></code> method.</p>

<h2 id="returns">Returns</h2>

<p>pd.DataFrame
    The proportion statistics stored in <code>self.proportion_stats</code>.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>